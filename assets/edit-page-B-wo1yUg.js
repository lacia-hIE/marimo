const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DUl-dbak.js","./VegaLite-DkRMl6TK.js","./index-CaEtVMzc.js","./index-wucNfsJm.css","./time-DIADEcda.js","./timer-Di1g2zcK.js","./linear-CDgARHmx.js","./init-DLRA0X12.js","./range-CtcPcB_L.js","./zoom-COrs4lFh.js","./ordinal-DDUp3AbE.js","./arc-CyWW4RED.js","./path-qnb_ma6O.js","./step-CPXY0cSE.js","./array-DmjLdZ15.js","./line-BfNOlI_-.js","./index-BgkBZJF1.js","./terminal-Du0Oc1Yh.js","./terminal-DMtZkNnb.css"])))=>i.map(i=>d[i]);
var e,t=Object.defineProperty,n=(e,n,o)=>((e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o)(e,"symbol"!=typeof n?n+"":n,o);import{c as o,p as r,j as a,T as s,a6 as i,a8 as l,a9 as c,ad as d,B as u,ab as h,ae as f,af as m,ag as p,ah as g,ai as x,aj as y,ak as v,al as b,am as w,an as k,ao as N,ap as E,aq as C,ar as j,r as S,as as I,at as A,R as T,au as O,av as M,aw as _,Y as P,ax as D,ay as F,az as L,aA as R,aB as z,aC as B,v as U,aD as V,aE as $,aF as G,aG as H,_ as W,aH as q,g as Y,aI as J,aJ as K,aK as X,aL as Z,a7 as Q,L as ee,aM as te,aN as ne,aO as oe,aP as re,V as ae,aQ as se,aR as ie,aS as le,aT as ce,aU as de,l as ue,aV as he,aW as fe,aX as me,aY as pe,aZ as ge,a_ as xe,a$ as ye,b0 as ve,u as be,b1 as we,O as ke,b2 as Ne,b3 as Ee,b4 as Ce,b5 as je,b6 as Se,b7 as Ie,b8 as Ae,b9 as Te,ba as Oe,bb as Me,bc as _e,bd as Pe,I as De,aa as Fe,be as Le,A as Re,bf as ze,bg as Be,bh as Ue,bi as Ve,bj as $e,U as Ge,bk as He,bl as We,bm as qe,bn as Ye,bo as Je,Q as Ke,bp as Xe,bq as Ze,br as Qe,bs as et,bt as tt,bu as nt,a3 as ot,ac as rt,bv as at,W as st,bw as it,bx as lt,by as ct,bz as dt,bA as ut,D as ht,x as ft,z as mt,bB as pt,bC as gt,bD as xt,bE as yt,bF as vt,bG as bt,G as wt,bH as kt,bI as Nt,bJ as Et,bK as Ct,bL as jt,bM as St,bN as It,bO as At,bP as Tt,bQ as Ot,bR as Mt,bS as _t,bT as Pt,bU as Dt,bV as Ft,k as Lt,F as Rt,b as zt,bW as Bt,i as Ut,bX as Vt,bY as $t,bZ as Gt,b_ as Ht,X as Wt,b$ as qt,c0 as Yt,c1 as Jt,c2 as Kt,c3 as Xt,c4 as Zt,c5 as Qt,c6 as en,c7 as tn,c8 as nn,c9 as on,ca as rn,cb as an,cc as sn,cd as ln,ce as cn,cf as dn,cg as un,ch as hn,ci as fn,cj as mn,ck as pn,cl as gn,cm as xn,cn as yn,co as vn,cp as bn,cq as wn,cr as kn,cs as Nn,ct as En,cu as Cn,cv as jn,cw as Sn,cx as In,cy as An,cz as Tn,cA as On,cB as Mn,cC as _n,cD as Pn,cE as Dn,cF as Fn,cG as Ln,cH as Rn,cI as zn,cJ as Bn,cK as Un,cL as Vn,cM as $n,cN as Gn,cO as Hn,cP as Wn,cQ as qn,cR as Yn,cS as Jn,cT as Kn,cU as Xn,cV as Zn,cW as Qn,cX as eo,cY as to,cZ as no,c_ as oo,c$ as ro,d0 as ao,d1 as so,d2 as io,d3 as lo,d4 as co,d5 as uo,d6 as ho,d7 as fo,d8 as mo,d9 as po,da as go,db as xo,dc as yo,dd as vo,de as bo,df as wo,dg as ko,dh as No,di as Eo,dj as Co,dk as jo,dl as So,dm as Io,dn as Ao,dp as To,dq as Oo,dr as Mo,ds as _o,dt as Po,du as Do,dv as Fo,dw as Lo,e as Ro,dx as zo,dy as Bo,dz as Uo,dA as Vo,dB as $o,dC as Go,dD as Ho,dE as Wo,dF as qo,dG as Yo,dH as Jo,dI as Ko,o as Xo,dJ as Zo,dK as Qo,dL as er,C as tr,dM as nr,dN as or,dO as rr,dP as ar,dQ as sr,dR as ir,dS as lr,dT as cr,m as dr,dU as ur,dV as hr,f as fr,dW as mr,dX as pr,dY as gr,dZ as xr,d_ as yr,d$ as vr,e0 as br,e1 as wr,e2 as kr,e3 as Nr,e4 as Er,e5 as Cr,e6 as jr,e7 as Sr,e8 as Ir,e9 as Ar,ea as Tr,eb as Or,ec as Mr,ed as _r,ee as Pr,ef as Dr,eg as Fr,eh as Lr,ei as Rr,ej as zr,a as Br,ek as Ur,el as Vr,em as $r,M as Gr,en as Hr,eo as Wr,ep as qr,eq as Yr,er as Jr,es as Kr,et as Xr,eu as Zr,$ as Qr,Z as ea,J as ta,ev as na,ew as oa,ex as ra,ey as aa,ez as sa,eA as ia,a0 as la,eB as ca,eC as da,eD as ua,eE as ha,eF as fa,S as ma,eG as pa,eH as ga,eI as xa,eJ as ya,eK as va,eL as ba,eM as wa,eN as ka,eO as Na,eP as Ea,eQ as Ca,eR as ja,eS as Sa,eT as Ia,eU as Aa,eV as Ta,eW as Oa,eX as Ma,eY as _a,eZ as Pa,e_ as Da,e$ as Fa,f0 as La,f1 as Ra,f2 as za,f3 as Ba,f4 as Ua,f5 as Va,f6 as $a,f7 as Ga,f8 as Ha,f9 as Wa,fa as qa,fb as Ya,fc as Ja,fd as Ka,fe as Xa,ff as Za,fg as Qa,fh as es,E as ts,fi as ns,fj as os,fk as rs,fl as as,fm as ss,fn as is,fo as ls,fp as cs,fq as ds,fr as us,fs as hs,ft as fs,fu as ms,fv as ps,fw as gs,fx as xs,fy as ys,fz as vs,fA as bs,fB as ws,fC as ks,fD as Ns,fE as Es,fF as Cs,fG as js,fH as Ss}from"./index-CaEtVMzc.js";import{a as Is,r as As,B as Ts,G as Os,b as Ms,M as _s,c as Ps,d as Ds,K as Fs,e as Ls,k as Rs,f as zs,C as Bs,S as Us,g as Vs,h as $s,i as Gs,j as Hs,l as Ws,m as qs,L as Ys,n as Js,o as Ks,p as Xs,q as Zs,s as Qs,u as ei,t as ti,v as ni,P as oi,w as ri,x as ai,T as si}from"./tree-Bup1odIq.js";import{b as ii,c as li,L as ci,N as di,I as ui,V as hi,d as fi,W as mi,F as pi,e as gi,M as xi,E as yi,f as vi,g as bi,h as wi,i as ki,j as Ni,k as Ei,l as Ci,m as ji,n as Si,o as Ii,R as Ai,u as Ti,p as Oi,A as Mi,a as _i,C as Pi,q as Di,r as Fi,O as Li,T as Ri}from"./useMarimoWebSocket-CPYGL9oO.js";import{s as zi,i as Bi,T as Ui,a as Vi}from"./transform-Bt5y6rR1.js";import{d as $i}from"./timer-Di1g2zcK.js";import{i as Gi}from"./zoom-COrs4lFh.js";import{s as Hi}from"./sortBy-D47FQmEq.js";import"./index-BgkBZJF1.js";import"./_baseEach-BOXOU8B-.js";
/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wi=o("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),qi=o("ArrowRightFromLine",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M21 12H7",key:"13ipq5"}],["path",{d:"m15 18 6-6-6-6",key:"6tx3qv"}]]),Yi=o("ArrowRightToLine",[["path",{d:"M17 12H3",key:"8awo09"}],["path",{d:"m11 18 6-6-6-6",key:"8c2y43"}],["path",{d:"M21 5v14",key:"nzette"}]]),Ji=o("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Ki=o("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),Xi=o("BetweenHorizontalStart",[["rect",{width:"13",height:"7",x:"8",y:"3",rx:"1",key:"pkso9a"}],["path",{d:"m2 9 3 3-3 3",key:"1agib5"}],["rect",{width:"13",height:"7",x:"8",y:"14",rx:"1",key:"1q5fc1"}]]),Zi=o("BookMarked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]),Qi=o("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),el=o("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]),tl=o("ChevronsUp",[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]]),nl=o("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ol=o("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),rl=o("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]),al=o("ClipboardPaste",[["path",{d:"M15 2H9a1 1 0 0 0-1 1v2c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V3c0-.6-.4-1-1-1Z",key:"1pp7kr"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2M16 4h2a2 2 0 0 1 2 2v2M11 14h10",key:"2ik1ml"}],["path",{d:"m17 10 4 4-4 4",key:"vp2hj1"}]]),sl=o("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]),il=o("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]),ll=o("Command",[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]]),cl=o("CopyMinus",[["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),dl=o("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),ul=o("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),hl=o("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]),fl=o("FilePen",[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]]),ml=o("FilePlus2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M3 15h6",key:"4e2qda"}],["path",{d:"M6 12v6",key:"1u72j0"}]]),pl=o("Files",[["path",{d:"M20 7h-3a2 2 0 0 1-2-2V2",key:"x099mo"}],["path",{d:"M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z",key:"18t6ie"}],["path",{d:"M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8",key:"1nja0z"}]]),gl=o("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),xl=o("FolderTree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]),yl=o("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),vl=o("HardDriveDownload",[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m16 6-4 4-4-4",key:"6wukr"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",key:"w68u3i"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 18h.01",key:"h775k"}]]),bl=o("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),wl=o("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]),kl=o("LayoutTemplate",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]]),Nl=o("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),El=o("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),Cl=o("MemoryStick",[["path",{d:"M6 19v-3",key:"1nvgqn"}],["path",{d:"M10 19v-3",key:"iu8nkm"}],["path",{d:"M14 19v-3",key:"kcehxu"}],["path",{d:"M18 19v-3",key:"1vh91z"}],["path",{d:"M8 11V9",key:"63erz4"}],["path",{d:"M16 11V9",key:"fru6f3"}],["path",{d:"M12 11V9",key:"ha00sb"}],["path",{d:"M2 15h20",key:"16ne18"}],["path",{d:"M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v1.1a2 2 0 0 0 0 3.837V17a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-5.1a2 2 0 0 0 0-3.837Z",key:"lhddv3"}]]),jl=o("MessageCircleQuestion",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Sl=o("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),Il=o("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]]),Al=o("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]]),Tl=o("PackageCheck",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),Ol=o("PackageX",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]]),Ml=o("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]),_l=o("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]),Pl=o("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),Dl=o("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),Fl=o("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]),Ll=o("Regex",[["path",{d:"M17 3v10",key:"15fgeh"}],["path",{d:"m12.67 5.5 8.66 5",key:"1gpheq"}],["path",{d:"m12.67 10.5 8.66-5",key:"1dkfa6"}],["path",{d:"M9 17a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2z",key:"swwfx4"}]]),Rl=o("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),zl=o("Rows3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M21 9H3",key:"1338ky"}],["path",{d:"M21 15H3",key:"9uk58r"}]]),Bl=o("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),Ul=o("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Vl=o("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]),$l=o("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Gl=o("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),Hl=o("SquareCode",[["path",{d:"M10 9.5 8 12l2 2.5",key:"3mjy60"}],["path",{d:"m14 9.5 2 2.5-2 2.5",key:"1bir2l"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Wl=o("SquareDashedBottomCode",[["path",{d:"M10 9.5 8 12l2 2.5",key:"3mjy60"}],["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"m14 9.5 2 2.5-2 2.5",key:"1bir2l"}],["path",{d:"M5 21a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2",key:"as5y1o"}],["path",{d:"M9 21h1",key:"15o7lz"}]]),ql=o("SquareEqual",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 10h10",key:"1101jm"}],["path",{d:"M7 14h10",key:"1mhdw3"}]]),Yl=o("SquareM",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 16V8l4 4 4-4v8",key:"141u4e"}]]),Jl=o("SquarePlay",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"m9 8 6 4-6 4Z",key:"f1r3lt"}]]),Kl=o("SquarePlus",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),Xl=o("SquarePower",[["path",{d:"M12 7v4",key:"xawao1"}],["path",{d:"M7.998 9.003a5 5 0 1 0 8-.005",key:"1pek45"}],["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}]]),Zl=o("SquareTerminal",[["path",{d:"m7 11 2-2-2-2",key:"1lz0vl"}],["path",{d:"M11 13h4",key:"1p7l4v"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}]]),Ql=o("TextCursorInput",[["path",{d:"M5 4h1a3 3 0 0 1 3 3 3 3 0 0 1 3-3h1",key:"18xjzo"}],["path",{d:"M13 20h-1a3 3 0 0 1-3-3 3 3 0 0 1-3 3H5",key:"fj48gi"}],["path",{d:"M5 16H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h1",key:"1n9rhb"}],["path",{d:"M13 8h7a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-7",key:"13ksps"}],["path",{d:"M9 7v10",key:"1vc8ob"}]]),ec=o("TextSearch",[["path",{d:"M21 6H3",key:"1jwq7v"}],["path",{d:"M10 12H3",key:"1ulcyk"}],["path",{d:"M10 18H3",key:"13769t"}],["circle",{cx:"17",cy:"15",r:"3",key:"1upz2a"}],["path",{d:"m21 19-1.9-1.9",key:"dwi7p8"}]]),tc=o("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),nc=o("View",[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]]),oc=o("WholeWord",[["circle",{cx:"7",cy:"12",r:"3",key:"12clwm"}],["path",{d:"M10 9v6",key:"17i7lo"}],["circle",{cx:"17",cy:"12",r:"3",key:"gl7c2s"}],["path",{d:"M14 7v8",key:"dl84cr"}],["path",{d:"M22 17v1c0 .5-.5 1-1 1H3c-.5 0-1-.5-1-1v-1",key:"lt2kga"}]]),rc=o("Workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]),ac=o("ZapOff",[["path",{d:"M10.513 4.856 13.12 2.17a.5.5 0 0 1 .86.46l-1.377 4.317",key:"193nxd"}],["path",{d:"M15.656 10H20a1 1 0 0 1 .78 1.63l-1.72 1.773",key:"27a7lr"}],["path",{d:"M16.273 16.273 10.88 21.83a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14H4a1 1 0 0 1-.78-1.63l4.507-4.643",key:"1e0qe9"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),sc=o("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),ic=e=>a.jsx(i,{className:"w-fit",children:a.jsxs("form",{onSubmit:t=>{t.preventDefault(),h(new Blob([e.getCellsAsJSON()],{type:"text/plain"}),`${e.proposedName}.json`),e.closeModal()},onKeyDown:t=>{"Escape"===t.key&&e.closeModal()},children:[a.jsx(l,{className:"text-accent mb-6",children:"Download unsaved changes?"}),a.jsxs(c,{className:"markdown break-words",style:{wordBreak:"break-word"},children:[a.jsx("p",{children:"This app has unsaved changes. To recover:"}),a.jsxs("ol",{children:[a.jsxs("li",{style:{paddingBottom:"10px"},children:['Click the "Download" button. This will download a file called ',a.jsxs("code",{children:[e.proposedName,".json"]}),". This file contains your code."]}),a.jsxs("li",{style:{paddingBottom:"10px"},children:["In your terminal, type",a.jsxs("code",{style:{display:"block",padding:"10px"},children:["marimo recover ",e.proposedName,".json ",">"," ",e.proposedName,".py"]}),"to overwrite ",a.jsxs("code",{children:[e.proposedName,".py"]})," with the recovered changes."]})]})]}),a.jsxs(d,{children:[a.jsx(u,{"aria-label":"Cancel",variant:"secondary","data-testid":"cancel-recovery-button",onClick:e.closeModal,children:"Cancel"}),a.jsx(u,{"data-testid":"download-recovery-button","aria-label":"Download",variant:"default",type:"submit",children:"Download"})]})]})}),lc=e=>{const{filename:t,needsSave:n,getCellsAsJSON:o}=e,{openModal:i,closeModal:l}=r(),c=null===t?"app":t.slice(0,-3),d=()=>{n&&i(a.jsx(ic,{getCellsAsJSON:o,proposedName:c,closeModal:l}))};return Is("global.save",d),a.jsx(s,{content:As("global.save"),children:a.jsx(Ts,{onClick:d,id:"save-button","aria-label":"Save",className:"rectangle",color:n?"yellow":"gray",children:a.jsx(Bl,{strokeWidth:1.5,size:18})})})};
/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cc={markdown:!0,wasm_layouts:!1,scratchpad:!0};function dc(e){var t;return(null==(t=m().experimental)?void 0:t[e])??cc[e]}!function(e,t){if("undefined"==typeof window)return;const n=`__marimo__${t}`;window[n]&&f.warn(`Overwriting existing debug object ${n}`),window[n]=e}((function(e,t){const n=m();n.experimental[e]=t,p({config:n})}),"setFeatureFlag");const uc=()=>{const{selectedLayout:e}=ii(),{setLayoutView:t}=li();return v()&&!dc("wasm_layouts")?null:a.jsxs(b,{"data-testid":"layout-select",value:e,onValueChange:e=>t(e),children:[a.jsx(w,{className:"min-w-[110px] border-border bg-background","data-testid":"layout-select",children:a.jsx(k,{placeholder:"Select a view"})}),a.jsx(N,{children:a.jsxs(E,{children:[a.jsx(C,{children:"View as"}),ci.map((e=>a.jsx(j,{value:e,children:a.jsxs("div",{className:"flex items-center gap-1.5 leading-5",children:[hc(e),a.jsx("span",{children:mc(e)})]})},e)))]})})]})};function hc(e){const t=fc(e);return a.jsx(t,{className:"h-4 w-4"})}function fc(e){switch(e){case"vertical":return El;case"grid":return Os;case"slides":return Fl;default:return g(e),x}}function mc(e){return y(e)}function pc(){const[e,t]=function(e,t){const n=new I(e,t),[o,r]=S.useState((()=>n.get()));return[o,e=>{r(e),n.set(e)}]}("marimo:commands",[]);return{recentCommands:e,addRecentCommand:n=>{const o=(r=[n,...e],[...new Set(r)]);var r;t(o.slice(0,3))}}}function gc(e){return void 0!==e.dropdown}function xc(e,t=""){return e.flatMap((e=>e.label?gc(e)?xc(e.dropdown,`${t+e.label} > `):{...e,label:t+e.label}:[]))}const yc=({children:e,layerTop:t=!1})=>{const[n,o]=T.Children.toArray(e),r=t?"top-[-1px] left-[-1px]":"bottom-[-1px] right-[-1px]";return a.jsxs("div",{className:"multi-icon relative w-fit",children:[n,a.jsx("div",{className:`second-icon absolute ${r} rounded-full`,children:o})]})};function vc(){const e=O(),{prepareForRun:t}=P();return M((async n=>{if(0===n.length)return;const{cellHandles:o,cellData:r}=e,a=[];for(const e of n){const n=o[e];n.current?(a.push(D(n.current.editorView)),n.current.registerRun()):(t({cellId:e}),a.push(r[e].code))}await F({cellIds:n,codes:a}).catch((e=>{f.error(e)}))}))}const bc=L(null),wc=L(!1),kc=e=>{R(window,"keydown",(t=>{var n;(t.ctrlKey||t.metaKey)&&"z"===t.key&&(t.preventDefault(),t.stopPropagation(),null==(n=e.onClick)||n.call(e,t))}),{capture:!0});const t=e.children??"Undo";return a.jsxs(u,{"data-testid":"undo-button",size:"sm",variant:"outline",...e,children:[t," ",a.jsx(Ms,{className:"ml-2",shortcut:"cmd-z"})]})};function Nc(){const{deleteCell:e,undoDeleteCell:t}=P();return M((n=>{if(1===z().length)return;const{cellId:o}=n;e({cellId:o}),B({cellId:o}).catch((()=>{t()}));const{dismiss:r}=U({title:"Cell deleted",description:"You can bring it back by clicking undo or through the command palette.",action:a.jsx(kc,{"data-testid":"undo-delete-button",onClick:()=>{t(),r()}})})}))}function Ec(e,t,n,o=G){if(t in o.get(V))return!1;const{cellData:r,cellIds:a}=o.get($),s=new RegExp(`import[ \t]+${e}[ \t]+as[ \t]+${t}`,"g");for(const i of a.inOrderIds)if(s.test(r[i].code))return!1;return n(`import ${e} as ${t}`),!0}function Cc(e,t,n){return Ec("marimo","mo",(o=>{const r=H.create();t({cellId:n??"__end__",before:!1,code:o,lastCodeRun:e?o:void 0,newCellId:r,autoFocus:!1}),e&&F({cellIds:[r],codes:[o]})}))}function jc({cell:e}){const{createNewCell:t,updateCellConfig:n,updateCellCode:o,updateCellName:s,moveCell:c,sendToTop:d,sendToBottom:u}=P(),h=function(e){const t=vc();return M((()=>{void 0!==e&&t([e])}))}(null==e?void 0:e.cellId),f=!W(q),m=Nc(),{openModal:p}=r(),g=Y(bc),x=W(J),y=W(K),v=X(),b=W(Z);if(!e||b)return[];const{cellId:w,config:k,getEditorView:N,name:E,hasOutput:C,status:j}=e,S=v.inOrderIds.indexOf(w),I=N(),T=async()=>{const e={disabled:!k.disabled};await fe({configs:{[w]:e}}),n({cellId:w,config:e})};return[[{icon:a.jsx(Ql,{size:13,strokeWidth:1.5}),label:"Name",disableClick:!0,handle:e=>{null==e||e.stopPropagation(),null==e||e.preventDefault()},handleHeadless:()=>{p(a.jsxs(i,{children:[a.jsx(Q,{children:a.jsx(l,{children:"Rename cell"})}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(ee,{htmlFor:"cell-name",children:"Cell name"}),a.jsx(di,{placeholder:`cell_${S}`,value:E,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),p(null))},onChange:e=>s({cellId:w,name:e})})]})]}))},rightElement:a.jsx(di,{placeholder:`cell_${S}`,value:E,onChange:e=>s({cellId:w,name:e})})},{icon:a.jsx(Dl,{size:13,strokeWidth:1.5}),label:"Run cell",hotkey:"cell.run",hidden:"running"===j||"queued"===j||"disabled-transitively"===j||k.disabled,handle:()=>h()},{icon:a.jsx(Gl,{size:13,strokeWidth:1.5}),label:"AI completion",hidden:!x,handle:()=>{g((e=>(null==e?void 0:e.cellId)===w?null:{cellId:w}))},hotkey:"cell.aiCompletion"},{icon:a.jsx(ui,{size:13,strokeWidth:1.5}),label:"Export output as PNG",hidden:!C,handle:()=>function(e){const t=document.getElementById(`output-${e}`);t&&(t.classList.add("printing-output"),A(t,"result.png").finally((()=>{t.classList.remove("printing-output")})))}(w)},{icon:a.jsx(te,{size:13,strokeWidth:1.5}),label:"Format cell",hotkey:"cell.format",handle:()=>{I&&ne({[w]:I},o)}},{icon:a.jsx(_s,{}),label:"View as Markdown",hotkey:"cell.viewAsMarkdown",hidden:"python"!==oe(I),handle:()=>{I&&(Cc(y,t),re(I,"markdown",{force:!0}))}},{icon:a.jsx(ae,{size:13,strokeWidth:1.5}),label:"View as SQL",hidden:!se(I,"sql"),handle:()=>{I&&re(I,"sql")}},{icon:a.jsx(Ps,{}),label:"View as Python",hotkey:"markdown"===oe(I)?"cell.viewAsMarkdown":void 0,hidden:!se(I,"python"),handle:()=>{I&&(Cc(y,t),re(I,"python"))}},{icon:k.hide_code?a.jsx(ie,{size:13,strokeWidth:1.5}):a.jsx(le,{size:13,strokeWidth:1.5}),label:k.hide_code?"Show code":"Hide code",handle:async()=>{const e={hide_code:!k.hide_code};await fe({configs:{[w]:e}}),n({cellId:w,config:e}),I&&(e.hide_code?I.contentDOM.blur():I.focus())},hotkey:"cell.hideCode"},{icon:k.disabled?a.jsx(ac,{size:13,strokeWidth:1.5}):a.jsx(sc,{size:13,strokeWidth:1.5}),label:"Reactive execution",rightElement:a.jsx(ce,{"data-testid":"cell-disable-switch",checked:!k.disabled,size:"sm",onCheckedChange:T}),handle:T}],[{icon:a.jsxs(yc,{children:[a.jsx(ol,{size:13,strokeWidth:1.5}),a.jsx(de,{size:8,strokeWidth:2})]}),label:"Create cell above",hotkey:"cell.createAbove",handle:()=>t({cellId:w,before:!0})},{icon:a.jsxs(yc,{children:[a.jsx(ol,{size:13,strokeWidth:1.5}),a.jsx(ue,{size:8,strokeWidth:2})]}),label:"Create cell below",hotkey:"cell.createBelow",handle:()=>t({cellId:w,before:!1})},{icon:a.jsx(de,{size:13,strokeWidth:1.5}),label:"Move cell up",hotkey:"cell.moveUp",handle:()=>c({cellId:w,before:!0})},{icon:a.jsx(ue,{size:13,strokeWidth:1.5}),label:"Move cell down",hotkey:"cell.moveDown",handle:()=>c({cellId:w,before:!1})},{icon:a.jsx(tl,{size:13,strokeWidth:1.5}),label:"Send to top",hotkey:"cell.sendToTop",handle:()=>d({cellId:w})},{icon:a.jsx(el,{size:13,strokeWidth:1.5}),label:"Send to bottom",hotkey:"cell.sendToBottom",handle:()=>u({cellId:w})}],[{label:"Delete",hidden:!f,variant:"danger",icon:a.jsx(he,{size:13,strokeWidth:1.5}),handle:()=>{m({cellId:w})}}]].map((e=>e.filter((e=>!e.hidden)))).filter((e=>e.length>0))}const Sc=L(null);function Ic(){return W(Sc)}const Ac=L((e=>{const t=e(Sc);return t?t===me?null:Tc(t,e($)):null}));function Tc(e,t){var n;const{cellData:o,cellHandles:r,cellRuntime:a}=t,s=o[e],i=a[e],l=null==(n=r[e])?void 0:n.current;if(!s||!l)return null;return{cellId:e,name:s.name,config:s.config,status:i?i.status:"idle",getEditorView:()=>l.editorView,hasOutput:null!=(null==i?void 0:i.output)}}function Oc(){const{theme:e}=pe(),[t,n]=ge(),[o,r]=xe(),a=async e=>{await p({config:e}).then((()=>{n(e)}))};return[...ye.filter((e=>e!==o.width)).map((e=>({label:`App config > Set width=${e}`,handle:()=>{(async e=>{await ve({config:e}).then((()=>{r(e)}))})({...o,width:e})}}))),{label:"Config > Toggle dark mode",handle:()=>{a({...t,display:{...t.display,theme:"dark"===e?"light":"dark"}})}},{label:"Config > Switch keymap to  VIM",hidden:"vim"===t.keymap.preset,handle:()=>{a({...t,keymap:{...t.keymap,preset:"vim"}})}},{label:"Config > Switch keymap to default (current: VIM)",hidden:"default"===t.keymap.preset,handle:()=>{a({...t,keymap:{...t.keymap,preset:"default"}})}},{label:"Config > Disable GitHub Copilot",handle:()=>{a({...t,completion:{...t.completion,copilot:!1}})},hidden:"github"!==t.completion.copilot},{label:"Config > Enable GitHub Copilot",handle:()=>{a({...t,completion:{...t.completion,copilot:"github"}})},hidden:"github"===t.completion.copilot}].filter((e=>!e.hidden))}const Mc=L(!1),_c=()=>{const[e,t]=be(Mc),n=Ds(),o=W(Ac),r=W(we);let s=jc({cell:o}).flat();s=xc(s);const i=Oc();let l=Yc();l=[...xc(l),...xc(i)];const c=l.filter((e=>!e.hotkey)),d=ke.keyBy(c,(e=>e.label)),{recentCommands:u,addRecentCommand:h}=pc(),f=new Set(u);R(document,"keydown",(e=>{Ne(r.getHotkey("global.commandPalette").key)(e)&&(e.preventDefault(),t((e=>!e)))}));const m=e=>{const o=n[e];if(!o)return null;const s=r.getHotkey(e);return a.jsxs(Oe,{onSelect:()=>{h(e),t(!1),requestAnimationFrame((()=>{o()}))},value:s.name,children:[a.jsx("span",{children:s.name}),a.jsx(Me,{children:a.jsx(Fs,{shortcut:s.key})})]},e)},p=(e,n,o)=>a.jsxs(Oe,{onSelect:()=>{h(e),t(!1),requestAnimationFrame((()=>{n()}))},value:e,children:[a.jsx("span",{children:e}),o]},e);return a.jsxs(Ee,{open:e,onOpenChange:t,children:[a.jsx(Ce,{placeholder:"Type to search..."}),a.jsxs(je,{children:[a.jsx(Se,{children:"No results found."}),u.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(Ie,{heading:"Recently Used",children:u.map((e=>{if(Ae(e))return m(e);const t=d[e];return t&&!gc(t)?p(t.label,t.handleHeadless||t.handle):null}))}),a.jsx(Te,{})]}),a.jsxs(Ie,{heading:"Commands",children:[r.iterate().map((e=>f.has(e)?null:m(e))),c.map((e=>f.has(e.label)?null:p(e.label,e.handleHeadless||e.handle))),s.map((e=>f.has(e.label)?null:p(`Cell > ${e.label}`,e.handleHeadless||e.handle)))]})]})]})},Pc="https://static.marimo.app",Dc=({onClose:e})=>{const[t,n]=S.useState(""),o=`${t}-${S.useRef(Math.random().toString(36).slice(2,6)).current}`,r=`${Pc}/static/${o}`;return a.jsx(i,{className:"w-fit",children:a.jsxs("form",{onSubmit:async t=>{t.preventDefault(),e();const n=await _e({download:!1,includeCode:!0,files:hi.INSTANCE.filenames()}),r=U({title:"Uploading static notebook...",description:"Please wait."});await fetch(`${Pc}/api/static`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:n,path:o})}).catch((()=>{r.dismiss(),U({title:"Error uploading static page",description:a.jsxs("div",{children:["Please try again later. If the problem persists, please file a bug report on"," ",a.jsx("a",{href:Pe.issuesPage,target:"_blank",rel:"noreferrer",className:"underline",children:"GitHub"}),"."]})})})),r.dismiss(),U({title:"Static page uploaded!",description:a.jsxs("div",{children:["The URL has been copied to your clipboard.",a.jsx("br",{}),"You can share it with anyone."]})})},children:[a.jsxs(Q,{children:[a.jsx(l,{children:"Share static notebook"}),a.jsxs(c,{children:["You can publish a static, non-interactive version of this notebook to the public web. We will create a link for you that lives on"," ",a.jsx("a",{href:Pc,target:"_blank",rel:"noreferrer",children:Pc}),"."]})]}),a.jsxs("div",{className:"flex flex-col gap-6 py-4",children:[a.jsx(De,{"data-testid":"slug-input",id:"slug",autoFocus:!0,value:t,placeholder:"Notebook slug",onChange:e=>{const t=e.target.value.toLowerCase().replaceAll(/\s/g,"-").replaceAll(/[^\da-z-]/g,"");n(t)},required:!0,autoComplete:"off"}),a.jsxs("div",{className:"font-semibold text-sm text-muted-foreground gap-2 flex flex-col",children:["Anyone will be able to access your notebook at this URL:",a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Fc,{text:r}),a.jsx("span",{className:"text-primary",children:r})]})]})]}),a.jsxs(d,{children:[a.jsx(u,{"data-testid":"cancel-share-static-notebook-button",variant:"secondary",onClick:e,children:"Cancel"}),a.jsx(u,{"data-testid":"share-static-notebook-button","aria-label":"Save",variant:"default",type:"submit",onClick:()=>{navigator.clipboard.writeText(r)},children:"Create"})]})]})})},Fc=e=>{const[t,n]=T.useState(!1),o=Le.stopPropagation((t=>{t.preventDefault(),navigator.clipboard.writeText(e.text),n(!0),setTimeout((()=>n(!1)),2e3)}));return a.jsx(s,{content:"Copied!",open:t,children:a.jsx(u,{"data-testid":"copy-static-notebook-url-button",onClick:o,size:"xs",variant:"secondary",children:a.jsx(Fe,{size:14,strokeWidth:1.5})})})};function Lc(){const{openConfirm:e}=r(),t=Y(fi);return()=>{e({title:"Restart Kernel",description:"This will restart the Python kernel. You'll lose all data that's in memory. You will also lose any unsaved changes, so make sure to save your work before restarting.",variant:"destructive",confirmAction:a.jsx(Re,{onClick:async()=>{t({state:mi.CLOSING}),await ze(),window.location.reload()},"aria-label":"Confirm Restart",children:"Restart"})})}}const Rc=new Be("marimo:sidebar",Ue.object({selectedPanel:Ue.string().optional().transform((e=>e)),isSidebarOpen:Ue.boolean(),isTerminalOpen:Ue.boolean()}),(function(){return{selectedPanel:"variables",isSidebarOpen:!1,isTerminalOpen:!1}}));const{reducer:zc,createActions:Bc,valueAtom:Uc,useActions:Vc}=Ve((()=>Rc.get()),{openApplication:(e,t)=>({...e,selectedPanel:t,isSidebarOpen:!e.isSidebarOpen||e.selectedPanel!==t}),toggleSidebarPanel:e=>({...e,isSidebarOpen:!e.isSidebarOpen}),setIsSidebarOpen:(e,t)=>({...e,isSidebarOpen:t}),toggleTerminal:e=>({...e,isTerminalOpen:!e.isTerminalOpen}),setIsTerminalOpen:(e,t)=>({...e,isTerminalOpen:t})},[(e,t)=>Rc.set(t)]),$c=()=>{const e=W(Uc);return e.isSidebarOpen?e:{...e,selectedPanel:void 0}};function Gc(){return Vc()}const Hc=[{type:"files",Icon:xl,tooltip:"View files",position:"sidebar"},{type:"variables",Icon:$e,tooltip:"Explore variables",position:"sidebar"},{type:"datasources",Icon:ae,tooltip:"Explore data sources",position:"sidebar"},{type:"dependencies",Icon:Sl,tooltip:"Explore dependencies",position:"sidebar"},{type:"outline",Icon:Vl,tooltip:"View outline",position:"sidebar"},{type:"documentation",Icon:ec,tooltip:"View live docs",position:"sidebar"},{type:"logs",Icon:Ge,tooltip:"Notebook logs",position:"sidebar"},{type:"snippets",Icon:Wl,tooltip:"Snippets",position:"sidebar"},{type:"scratchpad",Icon:Il,hidden:!dc("scratchpad"),tooltip:"Scratchpad",position:"sidebar"},{type:"errors",Icon:He,tooltip:"View errors",position:"footer"}];function Wc(){const e=Y(We);return S.useCallback((()=>{const t=document.getElementsByClassName("output-area"),n=window.innerHeight||document.documentElement.clientHeight;let o=null;for(const e of Array.from(t)){const t=e.getBoundingClientRect();if(t.top>=0&&t.top<=n||t.bottom>=0&&t.bottom<=n){o=qe.parse(e.parentNode.id);break}}e((e=>({mode:Ye(e.mode),cellAnchor:o}))),requestAnimationFrame((()=>{var e;null!==o&&(null==(e=document.getElementById(qe.create(o)))||e.scrollIntoView())}))}),[e])}const qc=e=>{null==e||e.preventDefault(),null==e||e.stopPropagation()};function Yc(){const{t:e}=Ls(),[t]=Ze(),{openModal:n,closeModal:o}=r(),{openApplication:s}=Gc(),{selectedPanel:i}=$c(),[l]=be(We),c=W(Z),d=O(),{updateCellConfig:u,undoDeleteCell:f}=P(),m=Lc(),p=function(e){const{openPrompt:t,closeModal:n}=r();return()=>{if(!e)return null;const o=Je.guessDeliminator(e),r=Ke.basename(e);t({title:"Copy notebook",description:"Enter a new filename for the notebook copy.",defaultValue:`_${r}`,confirmText:"Copy notebook",spellCheck:!1,onConfirm:t=>{const r=o.join(Ke.dirname(e),t);Xe({source:e,destination:r}).then((()=>{n(),U({title:"Notebook copied",description:"A copy of the notebook has been created."}),window.open(`/?file=${r}`,"_blank")}))}})}}(t),g=Y(Mc),x=Y(Rs),b=Qe(d),w=et(d),{selectedLayout:k}=ii(),{setLayoutView:N}=li(),E=Wc();return[{icon:a.jsx($l,{size:14,strokeWidth:1.5}),label:e("Share"),handle:qc,dropdown:[{icon:a.jsx(tt,{size:14,strokeWidth:1.5}),label:e("Publish HTML to web"),handle:async()=>{n(a.jsx(Dc,{onClose:o}))}},{icon:a.jsx(Nl,{size:14,strokeWidth:1.5}),label:e("Create WebAssembly link"),handle:async()=>{const t=await nt(),n=ot({code:t.contents});window.navigator.clipboard.writeText(n),U({title:e("Copied"),description:e("Link copied to clipboard.")})}}]},{icon:a.jsx(rt,{size:14,strokeWidth:1.5}),label:e("Download"),handle:qc,dropdown:[{icon:a.jsx(pi,{size:14,strokeWidth:1.5}),label:e("Download as HTML"),handle:async()=>{t?await gi({filename:t}):U({variant:"danger",title:e("Error"),description:e("Notebooks must be named to be exported.")})}},{icon:a.jsx(ui,{size:14,strokeWidth:1.5}),label:e("Download as PNG"),handle:async()=>{const t=U({title:e("Starting download"),description:e("Downloading as PNG...")});await at((async()=>{const e=document.getElementById("App");e&&(await new Promise((e=>setTimeout(e,3e3))),await A(e,document.title))})),t.dismiss()}},{icon:a.jsx(st,{size:14,strokeWidth:1.5}),label:e("Download PDF"),handle:async()=>{const t=U({title:e("Starting download"),description:e("Downloading as PDF...")});await at((async()=>{await new Promise((e=>setTimeout(e,3e3))),t.dismiss();const e=new Event("export-beforeprint"),n=new Event("export-afterprint");window.dispatchEvent(e),setTimeout((()=>window.print()),0),setTimeout((()=>window.dispatchEvent(n)),0)}))}},{icon:a.jsx(_s,{strokeWidth:1.5,style:{width:14,height:14}}),label:e("Download as Markdown"),handle:async()=>{const e=await it({download:!1});h(new Blob([e],{type:"text/plain"}),lt.toMarkdown(document.title))}},{icon:a.jsx(il,{size:14,strokeWidth:1.5}),label:e("Download Python code"),handle:async()=>{const e=await nt();h(new Blob([e.contents],{type:"text/plain"}),lt.toPY(document.title))}}]},{divider:!0,icon:a.jsx(Ml,{size:14,strokeWidth:1.5}),label:e("Helper panel"),handle:qc,dropdown:Hc.flatMap((({type:e,Icon:t,hidden:n})=>{return n?[]:{label:y(e),rightElement:(o=i===e,a.jsx("div",{className:"w-8 flex justify-end",children:o&&a.jsx(dt,{size:14})})),icon:a.jsx(t,{size:14,strokeWidth:1.5}),handle:()=>s(e)};var o}))},{icon:a.jsx(Fl,{size:14,strokeWidth:1.5}),label:e("Present as"),handle:qc,dropdown:[{icon:"present"===l.mode?a.jsx(ct,{size:14,strokeWidth:1.5}):a.jsx(kl,{size:14,strokeWidth:1.5}),label:e("Toggle app view"),hotkey:"global.hideCode",handle:()=>{E()}},...ci.map(((e,t)=>{const n=fc(e);return{divider:0===t,label:mc(e),icon:a.jsx(n,{size:14,strokeWidth:1.5}),rightElement:a.jsx("div",{className:"w-8 flex justify-end",children:k===e&&a.jsx(dt,{size:14})}),handle:()=>{N(e),"edit"===l.mode&&E()}}}))]},{icon:a.jsx(pl,{size:14,strokeWidth:1.5}),label:e("Create notebook copy"),hidden:!t||v(),handle:p},{icon:a.jsx(rl,{size:14,strokeWidth:1.5}),label:e("Copy code to clipboard"),hidden:!t,handle:async()=>{const t=await nt();navigator.clipboard.writeText(t.contents),U({title:e("Copied"),description:e("Code copied to clipboard.")})}},{icon:a.jsx(sc,{size:14,strokeWidth:1.5}),label:e("Enable all cells"),hidden:0===b.length||c,handle:async()=>{const e=b.map((e=>e.id)),t=ke.fromEntries(e.map((e=>[e,{disabled:!1}])));await fe({configs:t});for(const n of e)u({cellId:n,config:{disabled:!1}})}},{icon:a.jsx(ac,{size:14,strokeWidth:1.5}),label:e("Disable all cells"),hidden:0===w.length||c,handle:async()=>{const e=w.map((e=>e.id)),t=ke.fromEntries(e.map((e=>[e,{disabled:!0}])));await fe({configs:t});for(const n of e)u({cellId:n,config:{disabled:!0}})}},{icon:a.jsx(tc,{size:14,strokeWidth:1.5}),label:e("Undo cell deletion"),hidden:!ut(d)||c,handle:()=>{f()}},{divider:!0,icon:a.jsx(ll,{size:14,strokeWidth:1.5}),label:e("Command palette"),hotkey:"global.commandPalette",handle:()=>g((e=>!e))},{icon:a.jsx(wl,{size:14,strokeWidth:1.5}),label:e("Keyboard shortcuts"),hotkey:"global.showHelp",handle:()=>x((e=>!e))},{icon:a.jsx(Zi,{size:14,strokeWidth:1.5}),label:e("Open documentation"),handle:()=>{window.open("https://docs.marimo.io","_blank")}},{divider:!0,icon:a.jsx(bl,{size:14,strokeWidth:1.5}),label:e("Return home"),hidden:!location.search.includes("file"),handle:()=>{window.location.href=document.baseURI}},{icon:a.jsx(Xl,{size:14,strokeWidth:1.5}),label:e("Restart kernel"),variant:"danger",handle:m}].filter((e=>!e.hidden))}const Jc=()=>{const e=Yc(),t=a.jsx(Ts,{"aria-label":"Config",shape:"circle",size:"small",className:"h-[27px] w-[27px]","data-testid":"notebook-menu-dropdown",color:"hint-green",children:a.jsx(xi,{strokeWidth:1.8})}),n=e=>a.jsxs(a.Fragment,{children:[e.icon&&a.jsx("span",{className:"flex-0 mr-2",children:e.icon}),a.jsx("span",{className:"flex-1",children:e.labelElement||e.label}),e.hotkey&&a.jsx(zs,{shortcut:e.hotkey,className:"ml-4"}),e.rightElement]}),o=e=>a.jsx(wt,{variant:e.variant,onSelect:t=>e.handle(t),"data-testid":`notebook-menu-dropdown-${e.label}`,children:n(e)},e.label);return a.jsxs(ht,{modal:!1,children:[a.jsx(ft,{asChild:!0,children:t}),a.jsxs(mt,{align:"end",className:"no-print w-[240px]",children:[e.map((e=>e.hidden?null:e.dropdown?a.jsxs(pt,{children:[a.jsx(gt,{"data-testid":`notebook-menu-dropdown-${e.label}`,children:n(e)}),a.jsx(xt,{children:a.jsx(yt,{children:e.dropdown.map((e=>a.jsxs(T.Fragment,{children:[e.divider&&a.jsx(vt,{}),o(e)]},e.label)))})})]},e.label):a.jsxs(T.Fragment,{children:[e.divider&&a.jsx(vt,{}),o(e)]},e.label))),a.jsx(vt,{}),a.jsx("div",{className:"flex-1 px-2 text-xs text-muted-foreground",children:a.jsxs("span",{children:["Version: ",bt()]})})]})]})},Kc=kt({findText:"",replaceText:"",caseSensitive:!1,wholeWord:!1,regexp:!1,isOpen:!1,currentView:void 0},((e,t)=>{if(void 0===t)return e;switch(t.type){case"setFind":return{...e,findText:t.find};case"setReplace":return{...e,replaceText:t.replace};case"setCaseSensitive":return{...e,caseSensitive:t.caseSensitive};case"setWholeWord":return{...e,wholeWord:t.wholeWord};case"setRegex":return{...e,regexp:t.regexp};case"setIsOpen":return{...e,isOpen:t.isOpen};case"setCurrentView":return{...e,currentView:{view:t.view,range:t.range}};case"clearCurrentView":return{...e,currentView:void 0}}}));function Xc(e){if([...document.querySelectorAll('[role="dialog"][data-state="open"]')].some((e=>e instanceof HTMLElement&&e.childNodes.length>0)))return!1;if(e){const t=e.state.selection.main,n=e.state.sliceDoc(t.from,t.to);n?(G.set(Kc,{type:"setFind",find:n}),G.set(Kc,{type:"setCurrentView",view:e,range:{from:t.from,to:t.to}})):G.set(Kc,{type:"setCurrentView",view:e,range:{from:0,to:0}})}return G.get(Kc).isOpen?(G.set(Kc,{type:"setIsOpen",isOpen:!1}),requestAnimationFrame((()=>{G.set(Kc,{type:"setIsOpen",isOpen:!0})})),!0):(G.set(Kc,{type:"setIsOpen",isOpen:!0}),!0)}function Zc(){return!!G.get(Kc).isOpen&&(G.set(Kc,{type:"setIsOpen",isOpen:!1}),!0)}function Qc(e){return Nt("create"in e,'Expected query to have a "create" method'),e}function ed(e){return()=>{const t=G.get(Kc),n=new Et({search:t.findText,caseSensitive:t.caseSensitive,regexp:t.regexp,replace:t.replaceText,wholeWord:t.wholeWord});return!!n.valid&&e({query:Qc(n).create(),search:n})}}const td=e=>ed((({query:t})=>{const n=Ct(),o=G.get(Kc).currentView||{view:n[0],range:{from:0,to:0}};let r=o.range.to;"prev"===e&&(n.reverse(),r=o.range.from);let a=n.indexOf(o.view);a<0&&(a=0);const s=[...n,...n].slice(a);for(const i of s){const n="next"===e?t.nextMatch(i.state,0,r??0):t.prevMatch(i.state,r??i.state.doc.length,i.state.doc.length);if(!n){r=null,i.dispatch({selection:jt.single(0)});continue}const o=jt.single(n.from,n.to);return i.dispatch({selection:o,effects:[St.scrollIntoView(o.main,{y:"center"})],userEvent:"select.search"}),G.set(Kc,{type:"setCurrentView",view:i,range:{from:n.from,to:n.to}}),n}return!1})),nd=td("next"),od=td("prev"),rd=ed((({query:e})=>{var t;const n=Ct(),o=[];for(const r of n){if(r.state.readOnly)continue;const n=null==(t=e.matchAll(r.state,1e9))?void 0:t.map((t=>{const{from:n,to:o}=t;return{from:n,to:o,insert:e.getReplacement(t)}}));if(!n||0===n.length)continue;const a=r.state.doc.toString();o.push((()=>{r.dispatch({changes:[{from:0,to:r.state.doc.length,insert:a}],userEvent:"input.replace.all"})})),r.dispatch({changes:n,userEvent:"input.replace.all"})}return()=>{for(const e of o)e()}})),ad=ed((({query:e})=>{const t=Ct(),n=G.get(Kc).currentView||{view:t[0],range:{from:0,to:0}};let o=n.range.from,r=t.indexOf(n.view);r<0&&(r=0);const a=[...t,...t].slice(r);for(const s of a){const t=e.nextMatch(s.state,0,o??0);if(!t){o=null,s.dispatch({selection:jt.single(0)});continue}const n=s.state.toText(e.getReplacement(t));return s.dispatch({changes:[{from:t.from,to:t.to,insert:n}],userEvent:"input.replace"}),nd()}return!1})),sd=ed((({query:e})=>{const t=Ct();let n=0;const o=new Map;for(const r of t){const t=e.matchAll(r.state,1e9)||[];for(const e of t){const{from:t,to:a}=e,s=o.get(r)||new Map;s.set(`${t}:${a}`,n++),o.set(r,s)}}return{count:n,position:o}})),id=It.define();function ld(){const e=Ct();for(const t of e)t.state.readOnly||t.dispatch({effects:id.of(new Et({search:""}))})}const cd=At.define({create(){const e=G.get(Kc);return Qc(new Et({search:e.findText,caseSensitive:e.caseSensitive,regexp:e.regexp,replace:e.replaceText,wholeWord:e.wholeWord})).create()},update(e,t){for(const n of t.effects)n.is(id)&&(e=Qc(n.value).create());return e}}),dd=Tt.mark({class:"cm-searchMatch"}),ud=Tt.mark({class:"cm-searchMatch cm-searchMatch-selected"}),hd=Ot.fromClass(class{constructor(e){n(this,"decorations"),this.view=e,this.decorations=this.highlight(e.state.field(cd))}update(e){const t=e.state.field(cd);(t!==e.startState.field(cd)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight(e){if(!e.spec.valid)return Tt.none;const{view:t}=this,n=new Mt,o=t.visibleRanges,r=o.length;for(let a=0;a<r;a++){let{to:s}=o[a];const{from:i}=o[a];for(;a<r-1&&s>o[a+1].from-500;)s=o[++a].to;e.highlight(t.state,i,s,((e,o)=>{const r=t.state.selection.ranges.some((t=>t.from===e&&t.to===o));n.add(e,o,r?ud:dd)}))}return n.finish()}},{decorations:e=>e.decorations}),fd=St.baseTheme({"&light .cm-searchMatch":{backgroundColor:"#99ff7780"},"&dark .cm-searchMatch":{backgroundColor:"#22bb0070"},"&light .cm-searchMatch-selected":{backgroundColor:"transparent"},"&dark .cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff88 !important"}}),md=()=>{var e;const[t,n]=S.useState(!1),[o,r]=be(Kc),[i,l]=S.useState(),c=S.useRef(null),d=W(we);if(Is("cell.findAndReplace",(()=>(!t||!o.isOpen)&&Xc())),S.useEffect((()=>{o.isOpen&&c.current&&(c.current.focus(),c.current.select())}),[o.isOpen]),S.useEffect((()=>{if(!o.isOpen)return void ld();if(""===o.findText)return l(void 0),void ld();const e=sd();l(!1===e?void 0:e),function(){const e=G.get(Kc),t=Ct();for(const n of t)n.state.readOnly||n.dispatch({effects:id.of(new Et({search:e.findText,caseSensitive:e.caseSensitive,regexp:e.regexp,replace:e.replaceText,wholeWord:e.wholeWord}))})}()}),[o.findText,o.isOpen,o.caseSensitive,o.regexp,o.wholeWord]),!o.isOpen)return null;const h=o.currentView,f=h&&i?null==(e=i.position.get(h.view))?void 0:e.get(`${h.range.from}:${h.range.to}`):void 0;return a.jsx(_t,{restoreFocus:!0,autoFocus:!0,children:a.jsxs("div",{onFocus:()=>n(!0),onClick:e=>{e.stopPropagation(),e.preventDefault()},onBlur:()=>n(!1),className:"fixed top-0 right-0 w-[500px] flex flex-col bg-[var(--sage-1)] p-4 z-50 mt-2 mr-3 rounded-md shadow-lg border gap-2 print:hidden",onKeyDown:e=>{"Escape"===e.key&&r({type:"setIsOpen",isOpen:!1})},children:[a.jsx("div",{className:"absolute top-0 right-0",children:a.jsx(u,{"data-testid":"close-find-replace-button",onClick:()=>r({type:"setIsOpen",isOpen:!1}),size:"xs",variant:"text",children:a.jsx(Pt,{className:"w-4 h-4"})})}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex flex-col flex-2 gap-2 w-[55%]",children:[a.jsx(De,{ref:c,"data-testid":"find-input",value:o.findText,autoFocus:!0,className:"mr-2 mb-0",placeholder:"Find",onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey?od():nd())},onChange:e=>{r({type:"setFind",find:e.target.value})}}),a.jsx(De,{"data-testid":"replace-input",value:o.replaceText,placeholder:"Replace",onChange:e=>{r({type:"setReplace",replace:e.target.value})}})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center gap-[2px]",children:[a.jsx(s,{content:"Case Sensitive",children:a.jsx(Dt,{size:"sm",pressed:o.caseSensitive,"data-state":o.caseSensitive?"on":"off",onPressedChange:e=>r({type:"setCaseSensitive",caseSensitive:e}),children:a.jsx(Ft,{className:"w-4 h-4"})})}),a.jsx(s,{content:"Match Whole Word",children:a.jsx(Dt,{size:"sm",pressed:o.wholeWord,"data-state":o.wholeWord?"on":"off",onPressedChange:e=>r({type:"setWholeWord",wholeWord:e}),children:a.jsx(oc,{className:"w-4 h-4"})})}),a.jsx(s,{content:"Use Regular Expression",children:a.jsx(Dt,{size:"sm",pressed:o.regexp,"data-state":o.regexp?"on":"off",onPressedChange:e=>r({type:"setRegex",regexp:e}),children:a.jsx(Ll,{className:"w-4 h-4"})})})]}),a.jsxs("div",{className:"flex items-center gap-[2px]",children:[a.jsx(u,{"data-testid":"replace-next-button",size:"xs",variant:"outline",className:"h-6 text-xs",onClick:()=>ad(),disabled:""===o.findText||""===o.replaceText,children:"Replace Next"}),a.jsx(u,{"data-testid":"replace-all-button",size:"xs",variant:"outline",className:"h-6 text-xs",onClick:()=>{const e=rd();if(!e)return;const{dismiss:t}=U({title:"Replaced all occurrences",action:a.jsx(kc,{"data-testid":"undo-replace-all-button",onClick:()=>{e(),t()}})})},disabled:""===o.findText||""===o.replaceText,children:"Replace All"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(s,{content:"Find Previous",children:a.jsx(u,{"data-testid":"find-prev-button",size:"xs",variant:"secondary",onClick:()=>od(),children:a.jsx(Wi,{className:"w-4 h-4"})})}),a.jsx(s,{content:"Find Next",children:a.jsx(u,{"data-testid":"find-next-button",size:"xs",variant:"secondary",onClick:()=>nd(),children:a.jsx(Ji,{className:"w-4 h-4"})})}),null!=i&&null==f&&a.jsxs("span",{className:"text-sm",children:[i.count," matches"]}),null!=i&&null!=f&&a.jsxs("span",{className:"text-sm",children:[f+1," of ",i.count]})]}),a.jsxs("div",{className:"text-xs text-muted-foreground flex gap-1 mt-2",children:["Press"," ",a.jsx(Fs,{shortcut:d.getHotkey("cell.findAndReplace").key})," ","again to open the native browser search."]})]})})};function pd(e){const[t,n]=S.useState(!1);return S.useEffect((()=>{if(!e)return;n(!1);const t=setTimeout((()=>{n(!0)}),200);return()=>clearTimeout(t)}),[e]),e&&t}const gd=()=>{const e=Y(Mc);return a.jsx(s,{content:As("global.commandPalette"),children:a.jsx(Ts,{"data-testid":"command-palette-button",onClick:()=>e((e=>!e)),shape:"rectangle",color:"hint-green",children:a.jsx(ll,{strokeWidth:1.5,size:18})})})},xd=({children:e})=>W(Z)?null:e,yd=({children:e})=>W(Z)?e:null,vd=({filename:e,needsSave:t,onSaveNotebook:n,getCellsAsJSON:o,presenting:r,onTogglePresenting:i,onInterrupt:l,onRun:c,closed:d,running:u,needsRun:h,undoAvailable:f,appWidth:m})=>{const{undoDeleteCell:p}=P();let g=null;return!d&&f&&(g=a.jsx(s,{content:"Undo cell deletion",children:a.jsx(Ts,{"data-testid":"undo-delete-cell",size:"medium",color:"hint-green",shape:"circle",onClick:p,children:a.jsx(tc,{size:16,strokeWidth:1.5})})})),a.jsxs(a.Fragment,{children:[!r&&a.jsx(md,{}),!d&&a.jsxs("div",{className:kd,children:[r&&a.jsx(uc,{}),a.jsx(Jc,{}),a.jsx(Bs,{}),a.jsx(Us,{description:"This will terminate the Python kernel. You'll lose all data that's in memory."})]}),a.jsxs("div",{className:Lt(Nd,"compact"===m&&"xl:flex-row items-end"),children:[a.jsx(xd,{children:d?a.jsx(lc,{filename:e,getCellsAsJSON:o,needsSave:t}):a.jsx(s,{content:As("global.save"),children:a.jsx(Ts,{"data-testid":"save-button",id:"save-button",shape:"rectangle",color:t?"yellow":"hint-green",onClick:e=>{e.preventDefault(),e.stopPropagation(),n()},children:a.jsx(Bl,{strokeWidth:1.5,size:18})})})}),a.jsx(s,{content:As("global.hideCode"),children:a.jsx(Ts,{"data-testid":"hide-code-button",id:"preview-button",shape:"rectangle",color:"hint-green",onClick:i,children:r?a.jsx(ct,{strokeWidth:1.5,size:18}):a.jsx(kl,{strokeWidth:1.5,size:18})})}),a.jsx(gd,{}),a.jsx(Vs,{}),a.jsx("div",{}),a.jsx(xd,{children:a.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[g,!d&&a.jsx(wd,{running:u,onInterrupt:l}),!d&&a.jsx(bd,{needsRun:h,onRun:c})]})})]})]})},bd=({needsRun:e,onRun:t})=>e?a.jsx(s,{content:As("global.runStale"),children:a.jsx(Ts,{"data-testid":"run-button",size:"medium",color:"yellow",shape:"circle",onClick:t,children:a.jsx(Dl,{strokeWidth:1.5,size:16})})}):a.jsx(s,{content:"Nothing to run",children:a.jsx(Ts,{"data-testid":"run-button",className:"inactive-button",color:"disabled",size:"medium",shape:"circle",children:a.jsx(Dl,{strokeWidth:1.5,size:16})})}),wd=({running:e,onInterrupt:t})=>{const n=pd(e);return a.jsx(s,{content:As("global.interrupt"),children:a.jsx(Ts,{className:Lt(!n&&"inactive-button active:shadow-xsSolid"),"data-testid":"interrupt-button",size:"medium",color:n?"yellow":"disabled",shape:"circle",onClick:n?t:Rt.NOOP,children:a.jsx(x,{strokeWidth:1.5,size:16})})})},kd="absolute top-3 right-5 m-0 flex items-center space-x-3 min-h-[28px] no-print pointer-events-auto z-30 print:hidden",Nd="absolute bottom-5 right-5 flex flex-col gap-2 items-center no-print pointer-events-auto z-30 print:hidden",Ed=({resetOnBlur:e=!1,placeholderText:t,initialValue:n=null,flexibleWidth:o=!1,onNameChange:r,className:s})=>{const[i,l]=S.useState(n),[c,d]=S.useState([]),[u,h]=S.useState(!1),f=S.useRef(null),m=S.useRef(!1);S.useEffect((()=>{l(n)}),[n]);const p=Ke.dirname(i||""),g=Ke.basename(i||""),x=c.filter((e=>Ke.basename(e.path).startsWith(g))),{loading:y}=zt((async()=>{if(!u)return void d([]);const e=await Bt({path:p});d(e.files)}),[p,u]),v=function(e,t,n){if(!e)return;if(e.endsWith("/"))return;(dc("markdown")?new Set(["py","md","markdown","qmd"]):new Set(["py"])).has(Ke.extension(e))||(e=e.endsWith(".")?`${e}py`:e.endsWith(".p")?`${e}y`:`${e}.py`);if(t.some((t=>t.path===e||Ke.basename(t.path)===e)))return;if(n&&(n===e||Ke.basename(n)===e))return;return e}(i,c,n),b=(v||x.length>0)&&a.jsxs(je,{className:"font-mono",children:[!y&&a.jsx(Se,{children:"No files"}),v&&a.jsxs(Oe,{variant:"success",className:"py-2 px-3",onSelect:()=>{var e;v&&(m.current=!0,r(v),null==(e=f.current)||e.blur())},children:[a.jsx(fl,{className:"w-4 h-4 mr-2"})," ",a.jsxs("span",{className:"text-sm",children:[n?"Rename to: ":"Save as: ",a.jsx("span",{className:"font-medium text-sm",children:Ke.basename(v)})]})]},"_rename_"),x.map((e=>{const t=e.isDirectory?"directory":Ut(e.path),n=Wt[t];return a.jsxs(Oe,{variant:e.isDirectory?"default":"muted",className:"py-2 px-3",onSelect:()=>{e.isDirectory?l(`${e.path}/`):l(e.path)},children:[a.jsx(n,{className:"w-4 h-4 mr-2"})," ",Ke.basename(e.path)]},e.path)}))]}),w=10*Math.max(20,(null==i?void 0:i.length)||(null==t?void 0:t.length)||0);return a.jsx(Vt,{open:!0,modal:!1,children:a.jsx($t,{onFocus:()=>{h(!0)},onBlur:t=>{var o;(null==(o=t.relatedTarget)?void 0:o.closest(".filename-input"))||(h(!1),e&&l(n))},shouldFilter:!1,className:"bg-transparent group filename-input",children:a.jsxs(je,{children:[a.jsx(Gt,{children:a.jsx(Ce,{"data-testid":"dir-completion-input",tabIndex:-1,rootClassName:"border-none justify-center px-1",spellCheck:"false",value:u?i||"":n||"",onKeyDown:e=>{"Escape"===e.key&&e.currentTarget.blur()},icon:null,ref:f,onValueChange:l,placeholder:t,autoComplete:"off",style:o?{maxWidth:w}:void 0,className:Lt(s,"w-full px-4 py-1 my-1 h-9 font-mono text-foreground/60")})}),a.jsx(Ht,{side:"bottom",className:Lt("p-0 w-full min-w-80 max-w-80vw hidden",b&&"group-focus-within:block"),portal:!1,children:b})]})})})};const Cd=({filename:e,setFilename:t})=>a.jsx(Ed,{placeholderText:e?Ke.basename(e):"untitled marimo app",initialValue:e,onNameChange:t,flexibleWidth:!0,resetOnBlur:!0,"data-testid":"filename-input",className:null===e?"missing-filename":"filename"});const jd=e=>{let{transform:t}=e;return{...t,x:0}},Sd=T.memo((({children:e,disabled:t})=>{const n=O(),{dropCellOver:o}=P(),r=qt(Yt(tn,{activationConstraint:{distance:8}}),Yt(en,{coordinateGetter:Qt})),s=n.cellIds.topLevelIds,i=M((e=>{const{active:t,over:n}=e;null!==n&&t.id!==n.id&&o({cellId:t.id,overCellId:n.id})}));return a.jsx(Jt,{autoScroll:{threshold:{x:0,y:.1}},sensors:r,collisionDetection:Kt,modifiers:[jd],onDragEnd:i,children:a.jsx(Xt,{items:s,disabled:t,strategy:Zt,children:e})})}));function Id(e){return[nn.of([{key:"Escape",preventDefault:!1,run:Zc},{key:e.getHotkey("cell.selectNextOccurrence").key,preventDefault:!0,run:on},{key:e.getHotkey("cell.findAndReplace").key,preventDefault:!0,run:Xc}]),rn(),hd,cd,fd]}var Ad=Object.defineProperty,Td=(e,t,n)=>(((e,t,n)=>{t in e?Ad(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const Od=At.define({create:()=>({suggestion:null}),update(e,t){const n=t.effects.find((e=>e.is(Md)));return t.state.doc&&n&&t.state.doc==n.value.doc?{suggestion:n.value.text}:{suggestion:null}}}),Md=It.define();class _d extends sn{constructor(e){super(),Td(this,"suggestion"),this.suggestion=e}toDOM(){const e=document.createElement("span");return e.style.opacity="0.4",e.className="cm-inline-suggestion",e.textContent=this.suggestion,e}get lineBreaks(){return this.suggestion.split("\n").length-1}}const Pd=e=>Ot.fromClass(class{async update(t){const n=t.state.doc;if(!t.docChanged)return;const o=await e(t.state);t.view.dispatch({effects:Md.of({text:o,doc:n})})}}),Dd=Ot.fromClass(class{constructor(){Td(this,"decorations"),this.decorations=Tt.none}update(e){var t;const n=null==(t=e.state.field(Od))?void 0:t.suggestion;this.decorations=n?function(e,t){const n=e.state.selection.main.head,o=[],r=Tt.widget({widget:new _d(t),side:1});return o.push(r.range(n)),Tt.set(o)}(e.view,n):Tt.none}},{decorations:e=>e.decorations}),Fd=an.highest(nn.of([{key:"Tab",run:e=>{var t;const n=null==(t=e.state.field(Od))?void 0:t.suggestion;return!!n&&(e.dispatch({...Ld(e.state,n,e.state.selection.main.head,e.state.selection.main.head)}),!0)}}]));function Ld(e,t,n,o){return{...e.changeByRange((r=>{if(r==e.selection.main)return{changes:{from:n,to:o,insert:t},range:jt.cursor(n+t.length)};const a=o-n;return!r.empty||a&&e.sliceDoc(r.from-a,r.from)!=e.sliceDoc(n,o)?{range:r}:{changes:{from:r.from-a,to:r.from,insert:t},range:jt.cursor(r.from-a+t.length)}})),userEvent:"input.complete"}}function Rd(e){const{delay:t=500}=e,n=function(e,t,n){let o=()=>{};return(...r)=>(o(),new Promise(((a,s)=>{const i=setTimeout((()=>a(e(...r))),t);o=()=>{clearTimeout(i),void 0!==n&&s(n)}})))}(e.fetchFn,t);return[Od,Pd(n),Dd,Fd]}const zd=It.define(),Bd=It.define(),Ud=It.define();function Vd(e,t){if(!e)throw new Error(t)}const $d=34028234663852886e22,Gd=-34028234663852886e22,Hd=4294967295,Wd=2147483647,qd=-2147483648;function Yd(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>Wd||e<qd)throw new Error("invalid int 32: "+e)}function Jd(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>Hd||e<0)throw new Error("invalid uint 32: "+e)}function Kd(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>$d||e<Gd))throw new Error("invalid float 32: "+e)}const Xd=Symbol("@bufbuild/protobuf/enum-type");function Zd(e){const t=e[Xd];return Vd(t,"missing enum type on enum object"),t}function Qd(e,t,n,o){e[Xd]=eu(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function eu(e,t,n){const o=Object.create(null),r=Object.create(null),a=[];for(const s of t){const e=nu(s);a.push(e),o[s.name]=e,r[s.no]=e}return{typeName:e,values:a,findName:e=>o[e],findNumber:e=>r[e]}}function tu(e,t,n){const o={};for(const r of t){const e=nu(r);o[e.localName]=e.no,o[e.no]=e.localName}return Qd(o,e,t),o}function nu(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class ou{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,o=n.makeReadOptions(t);return n.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,t){const n=this.getType(),o=n.runtime.json,r=o.makeReadOptions(t);return o.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(o){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${o instanceof Error?o.message:String(o)}`)}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),o=n.writerFactory();return t.writeMessage(this,o,n),o.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function ru(){let e=0,t=0;for(let o=0;o<28;o+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<o,!(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let o=3;o<=31;o+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<o,!(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function au(e,t,n){for(let a=0;a<28;a+=7){const o=e>>>a,r=!(o>>>7==0&&0==t),s=255&(r?128|o:o);if(n.push(s),!r)return}const o=e>>>28&15|(7&t)<<4,r=!!(t>>3);if(n.push(255&(r?128|o:o)),r){for(let e=3;e<31;e+=7){const o=t>>>e,r=!(o>>>7==0),a=255&(r?128|o:o);if(n.push(a),!r)return}n.push(t>>>31&1)}}const su=4294967296;function iu(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let o=0,r=0;function a(t,a){const s=Number(e.slice(t,a));r*=n,o=o*n+s,o>=su&&(r+=o/su|0,o%=su)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?du(o,r):cu(o,r)}function lu(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(su*t+e);const n=16777215&(e>>>24|t<<8),o=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*o,a=n+8147497*o,s=2*o;const i=1e7;return r>=i&&(a+=Math.floor(r/i),r%=i),a>=i&&(s+=Math.floor(a/i),a%=i),s.toString()+uu(a)+uu(r)}function cu(e,t){return{lo:0|e,hi:0|t}}function du(e,t){return t=~t,e?e=1+~e:t+=1,cu(e,t)}const uu=e=>{const t=String(e);return"0000000".slice(t.length)+t};function hu(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function fu(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;128&e&&n<10;n++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var mu={};const pu=function(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"object"!=typeof mu||"1"!==mu.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),o=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const o="bigint"==typeof e?e:BigInt(e);if(o>n||o<t)throw new Error(`int64 invalid: ${e}`);return o},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<o)throw new Error(`uint64 invalid: ${e}`);return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>Vd(/^-?[0-9]+$/.test(e),`int64 invalid: ${e}`),n=e=>Vd(/^[0-9]+$/.test(e),`uint64 invalid: ${e}`);return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),iu(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),iu(e)),dec:(e,t)=>function(e,t){let n=cu(e,t);const o=2147483648&n.hi;o&&(n=du(n.lo,n.hi));const r=lu(n.lo,n.hi);return o?"-"+r:r}(e,t),uDec:(e,t)=>lu(e,t)}}();var gu,xu,yu,vu,bu,wu;function ku(e,t,n){if(t===n)return!0;if(e==gu.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case gu.UINT64:case gu.FIXED64:case gu.INT64:case gu.SFIXED64:case gu.SINT64:return t==n}return!1}function Nu(e,t){switch(e){case gu.BOOL:return!1;case gu.UINT64:case gu.FIXED64:case gu.INT64:case gu.SFIXED64:case gu.SINT64:return 0==t?pu.zero:"0";case gu.DOUBLE:case gu.FLOAT:return 0;case gu.BYTES:return new Uint8Array(0);case gu.STRING:return"";default:return 0}}function Eu(e,t){switch(e){case gu.BOOL:return!1===t;case gu.STRING:return""===t;case gu.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}(xu=gu||(gu={}))[xu.DOUBLE=1]="DOUBLE",xu[xu.FLOAT=2]="FLOAT",xu[xu.INT64=3]="INT64",xu[xu.UINT64=4]="UINT64",xu[xu.INT32=5]="INT32",xu[xu.FIXED64=6]="FIXED64",xu[xu.FIXED32=7]="FIXED32",xu[xu.BOOL=8]="BOOL",xu[xu.STRING=9]="STRING",xu[xu.BYTES=12]="BYTES",xu[xu.UINT32=13]="UINT32",xu[xu.SFIXED32=15]="SFIXED32",xu[xu.SFIXED64=16]="SFIXED64",xu[xu.SINT32=17]="SINT32",xu[xu.SINT64=18]="SINT64",(vu=yu||(yu={}))[vu.BIGINT=0]="BIGINT",vu[vu.STRING=1]="STRING",(wu=bu||(bu={}))[wu.Varint=0]="Varint",wu[wu.Bit64=1]="Bit64",wu[wu.LengthDelimited=2]="LengthDelimited",wu[wu.StartGroup=3]="StartGroup",wu[wu.EndGroup=4]="EndGroup",wu[wu.Bit32=5]="Bit32";class Cu{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let o=0;o<this.chunks.length;o++)e+=this.chunks[o].length;let t=new Uint8Array(e),n=0;for(let o=0;o<this.chunks.length;o++)t.set(this.chunks[o],n),n+=this.chunks[o].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Jd(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return Yd(e),hu(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Kd(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Jd(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Yd(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Yd(e),hu(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),o=pu.enc(e);return n.setInt32(0,o.lo,!0),n.setInt32(4,o.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),o=pu.uEnc(e);return n.setInt32(0,o.lo,!0),n.setInt32(4,o.hi,!0),this.raw(t)}int64(e){let t=pu.enc(e);return au(t.lo,t.hi,this.buf),this}sint64(e){let t=pu.enc(e),n=t.hi>>31;return au(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=pu.uEnc(e);return au(t.lo,t.hi,this.buf),this}}class ju{constructor(e,t){this.varint64=ru,this.uint32=fu,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case bu.Varint:for(;128&this.buf[this.pos++];);break;case bu.Bit64:this.pos+=4;case bu.Bit32:this.pos+=4;break;case bu.LengthDelimited:let n=this.uint32();this.pos+=n;break;case bu.StartGroup:for(;;){const[e,n]=this.tag();if(n===bu.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return pu.dec(...this.varint64())}uint64(){return pu.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,pu.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return pu.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return pu.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function Su(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return Nu(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let Iu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Au=[];for(let aT=0;aT<Iu.length;aT++)Au[Iu[aT].charCodeAt(0)]=aT;Au["-".charCodeAt(0)]=Iu.indexOf("+"),Au["_".charCodeAt(0)]=Iu.indexOf("/");const Tu={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,o=new Uint8Array(t),r=0,a=0,s=0;for(let i=0;i<e.length;i++){if(n=Au[e.charCodeAt(i)],void 0===n)switch(e[i]){case"=":a=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:s=n,a=1;break;case 1:o[r++]=s<<2|(48&n)>>4,s=n,a=2;break;case 2:o[r++]=(15&s)<<4|(60&n)>>2,s=n,a=3;break;case 3:o[r++]=(3&s)<<6|n,a=0}}if(1==a)throw Error("invalid base64 string.");return o.subarray(0,r)},enc(e){let t,n="",o=0,r=0;for(let a=0;a<e.length;a++)switch(t=e[a],o){case 0:n+=Iu[t>>2],r=(3&t)<<4,o=1;break;case 1:n+=Iu[r|t>>4],r=(15&t)<<2,o=2;break;case 2:n+=Iu[r|t>>6],n+=Iu[63&t],o=0}return o&&(n+=Iu[r],n+="=",1==o&&(n+="=")),n}};function Ou(e,t,n){Pu(t,e);const o=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter((e=>e.no===t.no))}(e.getType().runtime.bin.listUnknownFields(e),t.field),[a,s]=Su(t);for(const i of r)t.runtime.bin.readField(a,o.readerFactory(i.data),t.field,i.wireType,o);return s()}function Mu(e,t,n,o){Pu(t,e);const r=t.runtime.bin.makeReadOptions(o),a=t.runtime.bin.makeWriteOptions(o);if(_u(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter((e=>e.no!=t.field.no));e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const s=a.writerFactory();let i=t.field;i.opt||i.repeated||"enum"!=i.kind&&"scalar"!=i.kind||(i=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(i,n,s,a);const l=r.readerFactory(s.finish());for(;l.pos<l.len;){const[t,n]=l.tag(),o=l.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,o)}}function _u(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find((e=>e.no==t.field.no))}function Pu(e,t){Vd(e.extendee.typeName==t.getType().typeName,`extension ${e.typeName} can only be applied to message ${e.extendee.typeName}`)}function Du(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!Eu(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function Fu(e,t){const n=e.localName,o=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=o?e.T.values[0].no:void 0;break;case"scalar":t[n]=o?Nu(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function Lu(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(ou.prototype).every((t=>t in e&&"function"==typeof e[t])))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function Ru(e,t){return Lu(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}gu.DOUBLE,gu.FLOAT,gu.INT64,gu.UINT64,gu.INT32,gu.UINT32,gu.BOOL,gu.STRING,gu.BYTES;const zu={ignoreUnknownFields:!1},Bu={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Uu(e){return e?Object.assign(Object.assign({},zu),e):zu}function Vu(e){return e?Object.assign(Object.assign({},Bu),e):Bu}const $u=Symbol(),Gu=Symbol();function Hu(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":`"${e.split('"').join('\\"')}"`;default:return String(e)}}function Wu(e,t,n,o,r){let a=n.localName;if(n.repeated){if(Vd("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: ${Hu(t)}`);const i=e[a];for(const e of t){if(null===e)throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: ${Hu(e)}`);switch(n.kind){case"message":i.push(n.T.fromJson(e,o));break;case"enum":const t=Ju(n.T,e,o.ignoreUnknownFields,!0);t!==Gu&&i.push(t);break;case"scalar":try{i.push(Yu(n.T,e,n.L,!0))}catch(s){let t=`cannot decode field ${r.typeName}.${n.name} from JSON: ${Hu(e)}`;throw s instanceof Error&&s.message.length>0&&(t+=`: ${s.message}`),new Error(t)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: ${Hu(t)}`);const i=e[a];for(const[e,a]of Object.entries(t)){if(null===a)throw new Error(`cannot decode field ${r.typeName}.${n.name} from JSON: map value null`);let l;try{l=qu(n.K,e)}catch(s){let e=`cannot decode map key for field ${r.typeName}.${n.name} from JSON: ${Hu(t)}`;throw s instanceof Error&&s.message.length>0&&(e+=`: ${s.message}`),new Error(e)}switch(n.V.kind){case"message":i[l]=n.V.T.fromJson(a,o);break;case"enum":const e=Ju(n.V.T,a,o.ignoreUnknownFields,!0);e!==Gu&&(i[l]=e);break;case"scalar":try{i[l]=Yu(n.V.T,a,yu.BIGINT,!0)}catch(s){let e=`cannot decode map value for field ${r.typeName}.${n.name} from JSON: ${Hu(t)}`;throw s instanceof Error&&s.message.length>0&&(e+=`: ${s.message}`),new Error(e)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:a},a="value"),n.kind){case"message":const i=n.T;if(null===t&&"google.protobuf.Value"!=i.typeName)return;let l=e[a];Lu(l)?l.fromJson(t,o):(e[a]=l=i.fromJson(t,o),i.fieldWrapper&&!n.oneof&&(e[a]=i.fieldWrapper.unwrapField(l)));break;case"enum":const c=Ju(n.T,t,o.ignoreUnknownFields,!1);switch(c){case $u:Fu(n,e);break;case Gu:break;default:e[a]=c}break;case"scalar":try{const o=Yu(n.T,t,n.L,!1);if(o===$u)Fu(n,e);else e[a]=o}catch(s){let e=`cannot decode field ${r.typeName}.${n.name} from JSON: ${Hu(t)}`;throw s instanceof Error&&s.message.length>0&&(e+=`: ${s.message}`),new Error(e)}}}function qu(e,t){if(e===gu.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return Yu(e,t,yu.BIGINT,!0).toString()}function Yu(e,t,n,o){if(null===t)return o?Nu(e,n):$u;switch(e){case gu.DOUBLE:case gu.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const o=Number(t);if(Number.isNaN(o))break;if(!Number.isFinite(o))break;return e==gu.FLOAT&&Kd(o),o;case gu.INT32:case gu.FIXED32:case gu.SFIXED32:case gu.SINT32:case gu.UINT32:let a;if("number"==typeof t?a=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(a=Number(t)),void 0===a)break;return e==gu.UINT32||e==gu.FIXED32?Jd(a):Yd(a),a;case gu.INT64:case gu.SFIXED64:case gu.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const s=pu.parse(t);return n?s.toString():s;case gu.FIXED64:case gu.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const i=pu.uParse(t);return n?i.toString():i;case gu.BOOL:if("boolean"!=typeof t)break;return t;case gu.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(r){throw new Error("invalid UTF8")}return t;case gu.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return Tu.dec(t)}throw new Error}function Ju(e,t,n,o){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:o?e.values[0].no:$u;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const o=e.findName(t);if(void 0!==o)return o.no;if(n)return Gu}throw new Error(`cannot decode enum ${e.typeName} from JSON: ${Hu(t)}`)}function Ku(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function Xu(e,t,n){if("map"==e.kind){Vd("object"==typeof t&&null!=t);const o={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,a]of r)o[n.toString()]=Qu(e.V.T,a);break;case"message":for(const[e,a]of r)o[e.toString()]=a.toJson(n);break;case"enum":const t=e.V.T;for(const[e,a]of r)o[e.toString()]=Zu(t,a,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?o:void 0}if(e.repeated){Vd(Array.isArray(t));const o=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)o.push(Qu(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)o.push(Zu(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)o.push(t[e].toJson(n))}return n.emitDefaultValues||o.length>0?o:void 0}switch(e.kind){case"scalar":return Qu(e.T,t);case"enum":return Zu(e.T,t,n.enumAsInteger);case"message":return Ru(e.T,t).toJson(n)}}function Zu(e,t,n){var o;if(Vd("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(o=null==r?void 0:r.name)&&void 0!==o?o:t}function Qu(e,t){switch(e){case gu.INT32:case gu.SFIXED32:case gu.SINT32:case gu.FIXED32:case gu.UINT32:return Vd("number"==typeof t),t;case gu.FLOAT:case gu.DOUBLE:return Vd("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case gu.STRING:return Vd("string"==typeof t),t;case gu.BOOL:return Vd("boolean"==typeof t),t;case gu.UINT64:case gu.FIXED64:case gu.INT64:case gu.SFIXED64:case gu.SINT64:return Vd("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case gu.BYTES:return Vd(t instanceof Uint8Array),Tu.enc(t)}}const eh=Symbol("@bufbuild/protobuf/unknown-fields"),th={readUnknownFields:!0,readerFactory:e=>new ju(e)},nh={writeUnknownFields:!0,writerFactory:()=>new Cu};function oh(e){return e?Object.assign(Object.assign({},th),e):th}function rh(e){return e?Object.assign(Object.assign({},nh),e):nh}function ah(e,t,n,o,r){let{repeated:a,localName:s}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=s&&delete e.value,e.case=s,s="value"),n.kind){case"scalar":case"enum":const i="enum"==n.kind?gu.INT32:n.T;let l=lh;if("scalar"==n.kind&&n.L>0&&(l=ih),a){let n=e[s];if(o==bu.LengthDelimited&&i!=gu.STRING&&i!=gu.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(l(t,i))}else n.push(l(t,i))}else e[s]=l(t,i);break;case"message":const c=n.T;a?e[s].push(sh(t,new c,r,n)):Lu(e[s])?sh(t,e[s],r,n):(e[s]=sh(t,new c,r,n),!c.fieldWrapper||n.oneof||n.repeated||(e[s]=c.fieldWrapper.unwrapField(e[s])));break;case"map":let[d,u]=function(e,t,n){const o=t.uint32(),r=t.pos+o;let a,s;for(;t.pos<r;){const[o]=t.tag();switch(o){case 1:a=lh(t,e.K);break;case 2:switch(e.V.kind){case"scalar":s=lh(t,e.V.T);break;case"enum":s=t.int32();break;case"message":s=sh(t,new e.V.T,n,void 0)}}}void 0===a&&(a=Nu(e.K,yu.BIGINT));"string"!=typeof a&&"number"!=typeof a&&(a=a.toString());if(void 0===s)switch(e.V.kind){case"scalar":s=Nu(e.V.T,yu.BIGINT);break;case"enum":s=e.V.T.values[0].no;break;case"message":s=new e.V.T}return[a,s]}(n,t,r);e[s][d]=u}}function sh(e,t,n,o){const r=t.getType().runtime.bin,a=null==o?void 0:o.delimited;return r.readMessage(t,e,a?o.no:e.uint32(),n,a),t}function ih(e,t){const n=lh(e,t);return"bigint"==typeof n?n.toString():n}function lh(e,t){switch(t){case gu.STRING:return e.string();case gu.BOOL:return e.bool();case gu.DOUBLE:return e.double();case gu.FLOAT:return e.float();case gu.INT32:return e.int32();case gu.INT64:return e.int64();case gu.UINT64:return e.uint64();case gu.FIXED64:return e.fixed64();case gu.BYTES:return e.bytes();case gu.FIXED32:return e.fixed32();case gu.SFIXED32:return e.sfixed32();case gu.SFIXED64:return e.sfixed64();case gu.SINT64:return e.sint64();case gu.UINT32:return e.uint32();case gu.SINT32:return e.sint32()}}function ch(e,t,n,o){Vd(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let a="enum"==e.kind?gu.INT32:e.T;if(r)if(Vd(Array.isArray(t)),e.packed)!function(e,t,n,o){if(!o.length)return;e.tag(n,bu.LengthDelimited).fork();let[,r]=fh(t);for(let a=0;a<o.length;a++)e[r](o[a]);e.join()}(n,a,e.no,t);else for(const o of t)hh(n,a,e.no,o);else hh(n,a,e.no,t);break;case"message":if(r){Vd(Array.isArray(t));for(const r of t)uh(n,o,e,r)}else uh(n,o,e,t);break;case"map":Vd("object"==typeof t&&null!=t);for(const[r,s]of Object.entries(t))dh(n,o,e,r,s)}}function dh(e,t,n,o,r){e.tag(n.no,bu.LengthDelimited),e.fork();let a=o;switch(n.K){case gu.INT32:case gu.FIXED32:case gu.UINT32:case gu.SFIXED32:case gu.SINT32:a=Number.parseInt(o);break;case gu.BOOL:Vd("true"==o||"false"==o),a="true"==o}switch(hh(e,n.K,1,a),n.V.kind){case"scalar":hh(e,n.V.T,2,r);break;case"enum":hh(e,gu.INT32,2,r);break;case"message":Vd(void 0!==r),e.tag(2,bu.LengthDelimited).bytes(r.toBinary(t))}e.join()}function uh(e,t,n,o){const r=Ru(n.T,o);n.delimited?e.tag(n.no,bu.StartGroup).raw(r.toBinary(t)).tag(n.no,bu.EndGroup):e.tag(n.no,bu.LengthDelimited).bytes(r.toBinary(t))}function hh(e,t,n,o){Vd(void 0!==o);let[r,a]=fh(t);e.tag(n,r)[a](o)}function fh(e){let t=bu.Varint;switch(e){case gu.BYTES:case gu.STRING:t=bu.LengthDelimited;break;case gu.DOUBLE:case gu.FIXED64:case gu.SFIXED64:t=bu.Bit64;break;case gu.FIXED32:case gu.SFIXED32:case gu.FLOAT:t=bu.Bit32}return[t,gu[e].toLowerCase()]}function mh(e){if(void 0===e)return e;if(Lu(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function ph(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class gh{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function xh(e,t){const n=vh(e);return t?n:Eh(Nh(n))}const yh=vh;function vh(e){let t=!1;const n=[];for(let o=0;o<e.length;o++){let r=e.charAt(o);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const bh=new Set(["constructor","toString","toJSON","valueOf"]),wh=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),kh=e=>`${e}$`,Nh=e=>wh.has(e)?kh(e):e,Eh=e=>bh.has(e)?kh(e):e;class Ch{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=xh(e,!1)}addField(e){Vd(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const jh=(Sh=e=>new gh(e,(e=>function(e,t){var n,o,r,a,s,i;const l=[];let c;for(const d of"function"==typeof e?e():e){const e=d;if(e.localName=xh(d.name,void 0!==d.oneof),e.jsonName=null!==(n=d.jsonName)&&void 0!==n?n:yh(d.name),e.repeated=null!==(o=d.repeated)&&void 0!==o&&o,"scalar"==d.kind&&(e.L=null!==(r=d.L)&&void 0!==r?r:yu.BIGINT),e.delimited=null!==(a=d.delimited)&&void 0!==a&&a,e.req=null!==(s=d.req)&&void 0!==s&&s,e.opt=null!==(i=d.opt)&&void 0!==i&&i,void 0===d.packed&&(e.packed="enum"==d.kind||"scalar"==d.kind&&d.T!=gu.BYTES&&d.T!=gu.STRING),void 0!==d.oneof){const t="string"==typeof d.oneof?d.oneof:d.oneof.name;c&&c.name==t||(c=new Ch(t)),e.oneof=c,c.addField(e)}l.push(e)}return l}(e))),Ih=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,o=e;if(t.repeated)o[n]=[];else switch(t.kind){case"oneof":o[n]={case:void 0};break;case"enum":o[n]=0;break;case"map":o[n]={};break;case"scalar":o[n]=Nu(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:Uu,makeWriteOptions:Vu,readMessage(e,t,n,o){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error(`cannot decode message ${e.typeName} from JSON: ${Hu(t)}`);o=null!=o?o:new e;const r=new Map,a=n.typeRegistry;for(const[s,i]of Object.entries(t)){const t=e.fields.findJsonName(s);if(t){if(t.oneof){if(null===i&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error(`cannot decode message ${e.typeName} from JSON: multiple keys for oneof "${t.oneof.name}" present: "${n}", "${s}"`);r.set(t.oneof,s)}Wu(o,i,t,n,e)}else{let t=!1;if((null==a?void 0:a.findExtension)&&s.startsWith("[")&&s.endsWith("]")){const r=a.findExtension(s.substring(1,s.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,a]=Su(r);Wu(e,i,r.field,n,r),Mu(o,r,a(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error(`cannot decode message ${e.typeName} from JSON: key "${s}" is unknown`)}}return o},writeMessage(e,t){const n=e.getType(),o={};let r;try{for(r of n.fields.byNumber()){if(!Du(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!Ku(r))continue}const n=Xu(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(o[t.useProtoFieldName?r.name:r.jsonName]=n)}const a=t.typeRegistry;if(null==a?void 0:a.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const s=a.findExtensionFor(n.typeName,r.no);if(s&&_u(e,s)){const n=Ou(e,s,t),r=Xu(s.field,n,t);void 0!==r&&(o[s.field.jsonName]=r)}}}catch(a){const e=r?`cannot encode field ${n.typeName}.${r.name} to JSON`:`cannot encode message ${n.typeName} to JSON`,t=a instanceof Error?a.message:String(a);throw new Error(e+(t.length>0?`: ${t}`:""))}return o},readScalar:(e,t,n)=>Yu(e,t,null!=n?n:yu.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||Eu(e,t)?Qu(e,t):void 0},debug:Hu},bin:{makeReadOptions:oh,makeWriteOptions:rh,listUnknownFields(e){var t;return null!==(t=e[eh])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[eh]},writeUnknownFields(e,t){const n=e[eh];if(n)for(const o of n)t.tag(o.no,o.wireType).raw(o.data)},onUnknownField(e,t,n,o){const r=e;Array.isArray(r[eh])||(r[eh]=[]),r[eh].push({no:t,wireType:n,data:o})},readMessage(e,t,n,o,r){const a=e.getType(),s=r?t.len:t.pos+n;let i,l;for(;t.pos<s&&([i,l]=t.tag(),!0!==r||l!=bu.EndGroup);){const n=a.fields.find(i);if(n)ah(e,t,n,l,o);else{const n=t.skip(l,i);o.readUnknownFields&&this.onUnknownField(e,i,l,n)}}if(r&&(l!=bu.EndGroup||i!==n))throw new Error("invalid end group tag")},readField:ah,writeMessage(e,t,n){const o=e.getType();for(const r of o.fields.byNumber())if(Du(r,e))ch(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error(`cannot encode field ${o.typeName}.${r.name} to binary: required field not set`);return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,o){void 0!==t&&ch(e,t,n,o)}},util:Object.assign(Object.assign({},{setEnumType:Qd,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const o of n.fields.byMember()){const n=o.localName,r=t,a=e;if(null!=a[n])switch(o.kind){case"oneof":const e=a[n].case;if(void 0===e)continue;const t=o.findField(e);let s=a[n].value;t&&"message"==t.kind&&!Lu(s,t.T)?s=new t.T(s):t&&"scalar"===t.kind&&t.T===gu.BYTES&&(s=ph(s)),r[n]={case:e,value:s};break;case"scalar":case"enum":let i=a[n];o.T===gu.BYTES&&(i=o.repeated?i.map(ph):ph(i)),r[n]=i;break;case"map":switch(o.V.kind){case"scalar":case"enum":if(o.V.T===gu.BYTES)for(const[t,o]of Object.entries(a[n]))r[n][t]=ph(o);else Object.assign(r[n],a[n]);break;case"message":const e=o.V.T;for(const t of Object.keys(a[n])){let o=a[n][t];e.fieldWrapper||(o=new e(o)),r[n][t]=o}}break;case"message":const l=o.T;if(o.repeated)r[n]=a[n].map((e=>Lu(e,l)?e:new l(e)));else{const e=a[n];l.fieldWrapper?"google.protobuf.BytesValue"===l.typeName?r[n]=ph(e):r[n]=e:r[n]=Lu(e,l)?e:new l(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const o=t[e.localName],r=n[e.localName];if(e.repeated){if(o.length!==r.length)return!1;switch(e.kind){case"message":return o.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return o.every(((t,n)=>ku(e.T,t,r[n])));case"enum":return o.every(((e,t)=>ku(gu.INT32,e,r[t])))}throw new Error(`repeated cannot contain ${e.kind}`)}switch(e.kind){case"message":return e.T.equals(o,r);case"enum":return ku(gu.INT32,o,r);case"scalar":return ku(e.T,o,r);case"oneof":if(o.case!==r.case)return!1;const t=e.findField(o.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(o.value,r.value);case"enum":return ku(gu.INT32,o.value,r.value);case"scalar":return ku(t.T,o.value,r.value)}throw new Error(`oneof cannot contain ${t.kind}`);case"map":const n=Object.keys(o).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(o[e],r[e])));case"enum":return n.every((e=>ku(gu.INT32,o[e],r[e])));case"scalar":const a=e.V.T;return n.every((e=>ku(a,o[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,o=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(mh);else if("map"==r.kind){n=o[r.localName];for(const[e,o]of Object.entries(t))n[e]=mh(o)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:mh(t.value)}:{case:void 0}:mh(t);o[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(o,r.no,r.wireType,r.data);return n}}),{newFieldList:Sh,initFields:Ih}),makeMessageType(e,t,n){return function(e,t,n,o){var r;const a=null!==(r=null==o?void 0:o.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),s={[a]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[a];return Object.setPrototypeOf(s.prototype,new ou),Object.assign(s,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new s).fromBinary(e,t),fromJson:(e,t)=>(new s).fromJson(e,t),fromJsonString:(e,t)=>(new s).fromJsonString(e,t),equals:(t,n)=>e.util.equals(s,t,n)}),s}(this,e,t,n)},makeEnum:tu,makeEnumType:eu,getEnumType:Zd,makeExtension(e,t,n){return function(e,t,n,o){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof o?o():o;n.name=t.split(".").pop(),n.jsonName=`[${t}]`,r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var Sh,Ih,Ah,Th,Oh,Mh,_h,Ph,Dh,Fh,Lh,Rh,zh,Bh,Uh,Vh;(Th=Ah||(Ah={}))[Th.Unary=0]="Unary",Th[Th.ServerStreaming=1]="ServerStreaming",Th[Th.ClientStreaming=2]="ClientStreaming",Th[Th.BiDiStreaming=3]="BiDiStreaming",(Mh=Oh||(Oh={}))[Mh.NoSideEffects=1]="NoSideEffects",Mh[Mh.Idempotent=2]="Idempotent",(Ph=_h||(_h={}))[Ph.UNSPECIFIED=0]="UNSPECIFIED",Ph[Ph.JUPYTER_FORMAT=77]="JUPYTER_FORMAT",jh.util.setEnumType(_h,"exa.codeium_common_pb.ExperimentKey",[{no:0,name:"UNSPECIFIED"},{no:77,name:"JUPYTER_FORMAT"}]),(Fh=Dh||(Dh={}))[Fh.CODEIUM=0]="CODEIUM",jh.util.setEnumType(Dh,"exa.codeium_common_pb.AuthSource",[{no:0,name:"AUTH_SOURCE_CODEIUM"}]),(Rh=Lh||(Lh={}))[Rh.UNSPECIFIED=0]="UNSPECIFIED",Rh[Rh.ENABLE_CODEIUM=1]="ENABLE_CODEIUM",Rh[Rh.DISABLE_CODEIUM=2]="DISABLE_CODEIUM",Rh[Rh.SHOW_PREVIOUS_COMPLETION=3]="SHOW_PREVIOUS_COMPLETION",Rh[Rh.SHOW_NEXT_COMPLETION=4]="SHOW_NEXT_COMPLETION",jh.util.setEnumType(Lh,"exa.codeium_common_pb.EventType",[{no:0,name:"EVENT_TYPE_UNSPECIFIED"},{no:1,name:"EVENT_TYPE_ENABLE_CODEIUM"},{no:2,name:"EVENT_TYPE_DISABLE_CODEIUM"},{no:3,name:"EVENT_TYPE_SHOW_PREVIOUS_COMPLETION"},{no:4,name:"EVENT_TYPE_SHOW_NEXT_COMPLETION"}]),(Bh=zh||(zh={}))[Bh.UNSPECIFIED=0]="UNSPECIFIED",Bh[Bh.TYPING_AS_SUGGESTED=1]="TYPING_AS_SUGGESTED",Bh[Bh.CACHE=2]="CACHE",Bh[Bh.NETWORK=3]="NETWORK",jh.util.setEnumType(zh,"exa.codeium_common_pb.CompletionSource",[{no:0,name:"COMPLETION_SOURCE_UNSPECIFIED"},{no:1,name:"COMPLETION_SOURCE_TYPING_AS_SUGGESTED"},{no:2,name:"COMPLETION_SOURCE_CACHE"},{no:3,name:"COMPLETION_SOURCE_NETWORK"}]),(Vh=Uh||(Uh={}))[Vh.UNSPECIFIED=0]="UNSPECIFIED",Vh[Vh.C=1]="C",Vh[Vh.CLOJURE=2]="CLOJURE",Vh[Vh.COFFEESCRIPT=3]="COFFEESCRIPT",Vh[Vh.CPP=4]="CPP",Vh[Vh.CSHARP=5]="CSHARP",Vh[Vh.CSS=6]="CSS",Vh[Vh.CUDACPP=7]="CUDACPP",Vh[Vh.DOCKERFILE=8]="DOCKERFILE",Vh[Vh.GO=9]="GO",Vh[Vh.GROOVY=10]="GROOVY",Vh[Vh.HANDLEBARS=11]="HANDLEBARS",Vh[Vh.HASKELL=12]="HASKELL",Vh[Vh.HCL=13]="HCL",Vh[Vh.HTML=14]="HTML",Vh[Vh.INI=15]="INI",Vh[Vh.JAVA=16]="JAVA",Vh[Vh.JAVASCRIPT=17]="JAVASCRIPT",Vh[Vh.JSON=18]="JSON",Vh[Vh.JULIA=19]="JULIA",Vh[Vh.KOTLIN=20]="KOTLIN",Vh[Vh.LATEX=21]="LATEX",Vh[Vh.LESS=22]="LESS",Vh[Vh.LUA=23]="LUA",Vh[Vh.MAKEFILE=24]="MAKEFILE",Vh[Vh.MARKDOWN=25]="MARKDOWN",Vh[Vh.OBJECTIVEC=26]="OBJECTIVEC",Vh[Vh.OBJECTIVECPP=27]="OBJECTIVECPP",Vh[Vh.PERL=28]="PERL",Vh[Vh.PHP=29]="PHP",Vh[Vh.PLAINTEXT=30]="PLAINTEXT",Vh[Vh.PROTOBUF=31]="PROTOBUF",Vh[Vh.PBTXT=32]="PBTXT",Vh[Vh.PYTHON=33]="PYTHON",Vh[Vh.R=34]="R",Vh[Vh.RUBY=35]="RUBY",Vh[Vh.RUST=36]="RUST",Vh[Vh.SASS=37]="SASS",Vh[Vh.SCALA=38]="SCALA",Vh[Vh.SCSS=39]="SCSS",Vh[Vh.SHELL=40]="SHELL",Vh[Vh.SQL=41]="SQL",Vh[Vh.STARLARK=42]="STARLARK",Vh[Vh.SWIFT=43]="SWIFT",Vh[Vh.TSX=44]="TSX",Vh[Vh.TYPESCRIPT=45]="TYPESCRIPT",Vh[Vh.VISUALBASIC=46]="VISUALBASIC",Vh[Vh.VUE=47]="VUE",Vh[Vh.XML=48]="XML",Vh[Vh.XSL=49]="XSL",Vh[Vh.YAML=50]="YAML",Vh[Vh.SVELTE=51]="SVELTE",Vh[Vh.TOML=52]="TOML",Vh[Vh.DART=53]="DART",Vh[Vh.RST=54]="RST",Vh[Vh.OCAML=55]="OCAML",Vh[Vh.CMAKE=56]="CMAKE",Vh[Vh.PASCAL=57]="PASCAL",Vh[Vh.ELIXIR=58]="ELIXIR",Vh[Vh.FSHARP=59]="FSHARP",Vh[Vh.LISP=60]="LISP",Vh[Vh.MATLAB=61]="MATLAB",Vh[Vh.POWERSHELL=62]="POWERSHELL",Vh[Vh.SOLIDITY=63]="SOLIDITY",Vh[Vh.ADA=64]="ADA",Vh[Vh.OCAML_INTERFACE=65]="OCAML_INTERFACE",jh.util.setEnumType(Uh,"exa.codeium_common_pb.Language",[{no:0,name:"LANGUAGE_UNSPECIFIED"},{no:1,name:"LANGUAGE_C"},{no:2,name:"LANGUAGE_CLOJURE"},{no:3,name:"LANGUAGE_COFFEESCRIPT"},{no:4,name:"LANGUAGE_CPP"},{no:5,name:"LANGUAGE_CSHARP"},{no:6,name:"LANGUAGE_CSS"},{no:7,name:"LANGUAGE_CUDACPP"},{no:8,name:"LANGUAGE_DOCKERFILE"},{no:9,name:"LANGUAGE_GO"},{no:10,name:"LANGUAGE_GROOVY"},{no:11,name:"LANGUAGE_HANDLEBARS"},{no:12,name:"LANGUAGE_HASKELL"},{no:13,name:"LANGUAGE_HCL"},{no:14,name:"LANGUAGE_HTML"},{no:15,name:"LANGUAGE_INI"},{no:16,name:"LANGUAGE_JAVA"},{no:17,name:"LANGUAGE_JAVASCRIPT"},{no:18,name:"LANGUAGE_JSON"},{no:19,name:"LANGUAGE_JULIA"},{no:20,name:"LANGUAGE_KOTLIN"},{no:21,name:"LANGUAGE_LATEX"},{no:22,name:"LANGUAGE_LESS"},{no:23,name:"LANGUAGE_LUA"},{no:24,name:"LANGUAGE_MAKEFILE"},{no:25,name:"LANGUAGE_MARKDOWN"},{no:26,name:"LANGUAGE_OBJECTIVEC"},{no:27,name:"LANGUAGE_OBJECTIVECPP"},{no:28,name:"LANGUAGE_PERL"},{no:29,name:"LANGUAGE_PHP"},{no:30,name:"LANGUAGE_PLAINTEXT"},{no:31,name:"LANGUAGE_PROTOBUF"},{no:32,name:"LANGUAGE_PBTXT"},{no:33,name:"LANGUAGE_PYTHON"},{no:34,name:"LANGUAGE_R"},{no:35,name:"LANGUAGE_RUBY"},{no:36,name:"LANGUAGE_RUST"},{no:37,name:"LANGUAGE_SASS"},{no:38,name:"LANGUAGE_SCALA"},{no:39,name:"LANGUAGE_SCSS"},{no:40,name:"LANGUAGE_SHELL"},{no:41,name:"LANGUAGE_SQL"},{no:42,name:"LANGUAGE_STARLARK"},{no:43,name:"LANGUAGE_SWIFT"},{no:44,name:"LANGUAGE_TSX"},{no:45,name:"LANGUAGE_TYPESCRIPT"},{no:46,name:"LANGUAGE_VISUALBASIC"},{no:47,name:"LANGUAGE_VUE"},{no:48,name:"LANGUAGE_XML"},{no:49,name:"LANGUAGE_XSL"},{no:50,name:"LANGUAGE_YAML"},{no:51,name:"LANGUAGE_SVELTE"},{no:52,name:"LANGUAGE_TOML"},{no:53,name:"LANGUAGE_DART"},{no:54,name:"LANGUAGE_RST"},{no:55,name:"LANGUAGE_OCAML"},{no:56,name:"LANGUAGE_CMAKE"},{no:57,name:"LANGUAGE_PASCAL"},{no:58,name:"LANGUAGE_ELIXIR"},{no:59,name:"LANGUAGE_FSHARP"},{no:60,name:"LANGUAGE_LISP"},{no:61,name:"LANGUAGE_MATLAB"},{no:62,name:"LANGUAGE_POWERSHELL"},{no:63,name:"LANGUAGE_SOLIDITY"},{no:64,name:"LANGUAGE_ADA"},{no:65,name:"LANGUAGE_OCAML_INTERFACE"}]);const $h=class e extends ou{constructor(e){super(),n(this,"completionId",""),n(this,"text",""),n(this,"prefix",""),n(this,"stop",""),n(this,"score",0),n(this,"tokens",[]),n(this,"decodedTokens",[]),n(this,"probabilities",[]),n(this,"adjustedProbabilities",[]),n(this,"generatedLength",pu.zero),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n($h,"runtime",jh),n($h,"typeName","exa.codeium_common_pb.Completion"),n($h,"fields",jh.util.newFieldList((()=>[{no:1,name:"completion_id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"prefix",kind:"scalar",T:9},{no:4,name:"stop",kind:"scalar",T:9},{no:5,name:"score",kind:"scalar",T:1},{no:6,name:"tokens",kind:"scalar",T:4,repeated:!0},{no:7,name:"decoded_tokens",kind:"scalar",T:9,repeated:!0},{no:8,name:"probabilities",kind:"scalar",T:1,repeated:!0},{no:9,name:"adjusted_probabilities",kind:"scalar",T:1,repeated:!0},{no:10,name:"generated_length",kind:"scalar",T:4}])));let Gh=$h;const Hh=class e extends ou{constructor(e){super(),n(this,"ideName",""),n(this,"ideVersion",""),n(this,"extensionName",""),n(this,"extensionVersion",""),n(this,"apiKey",""),n(this,"locale",""),n(this,"sessionId",""),n(this,"requestId",pu.zero),n(this,"userAgent",""),n(this,"url",""),n(this,"authSource",Dh.CODEIUM),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(Hh,"runtime",jh),n(Hh,"typeName","exa.codeium_common_pb.Metadata"),n(Hh,"fields",jh.util.newFieldList((()=>[{no:1,name:"ide_name",kind:"scalar",T:9},{no:7,name:"ide_version",kind:"scalar",T:9},{no:12,name:"extension_name",kind:"scalar",T:9},{no:2,name:"extension_version",kind:"scalar",T:9},{no:3,name:"api_key",kind:"scalar",T:9},{no:4,name:"locale",kind:"scalar",T:9},{no:10,name:"session_id",kind:"scalar",T:9},{no:9,name:"request_id",kind:"scalar",T:4},{no:13,name:"user_agent",kind:"scalar",T:9},{no:14,name:"url",kind:"scalar",T:9},{no:15,name:"auth_source",kind:"enum",T:jh.getEnumType(Dh)}])));let Wh=Hh;const qh=class e extends ou{constructor(e){super(),n(this,"tabSize",pu.zero),n(this,"insertSpaces",!1),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(qh,"runtime",jh),n(qh,"typeName","exa.codeium_common_pb.EditorOptions"),n(qh,"fields",jh.util.newFieldList((()=>[{no:1,name:"tab_size",kind:"scalar",T:4},{no:2,name:"insert_spaces",kind:"scalar",T:8}])));let Yh=qh;e=class extends ou{constructor(e){super(),n(this,"eventType",Lh.UNSPECIFIED),n(this,"eventJson",""),n(this,"timestampUnixMs",pu.zero),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}},n(e,"runtime",jh),n(e,"typeName","exa.codeium_common_pb.Event"),n(e,"fields",jh.util.newFieldList((()=>[{no:1,name:"event_type",kind:"enum",T:jh.getEnumType(Lh)},{no:2,name:"event_json",kind:"scalar",T:9},{no:3,name:"timestamp_unix_ms",kind:"scalar",T:3}])));class Jh extends sn{constructor(e,t){super(),n(this,"index"),n(this,"total"),this.index=e,this.total=t}toDOM(){const e=document.createElement("span");e.setAttribute("aria-hidden","true"),e.className="cm-codeium-cycle";const t=e.appendChild(document.createElement("span"));t.className="cm-codeium-cycle-explanation",t.innerText=`${this.index+1}/${this.total}`;const n=e.appendChild(document.createElement("button"));return n.className="cm-codeium-cycle-key",n.innerText="→ (Ctrl ])",n.dataset.action="codeium-cycle",e}ignoreEvent(){return!1}}const Kh=ln.define({combine:e=>cn(e,{language:Uh.TYPESCRIPT,timeout:150,widgetClass:Jh,alwaysOn:!0},{})}),Xh=ln.define({combine:e=>cn(e,{override:()=>[]},{})}),Zh=Tt.mark({class:"cm-ghostText"}),Qh=At.define({create:e=>null,update(e,t){var n;const o=t.state.facet(Kh);for(const r of t.effects){if(r.is(zd)){const{changeSpecs:e,index:t}=r.value,a=e[t].map((e=>Zh.range(e.absoluteStartPos,e.absoluteEndPos))),s=null==(n=a.at(-1))?void 0:n.to;return{index:t,decorations:Tt.set([...a,...void 0!==s&&e.length>1&&o.widgetClass?[Tt.widget({widget:new o.widgetClass(t,e.length),side:1}).range(s)]:[]]),changeSpecs:e,reverseChangeSet:r.value.reverseChangeSet}}if(r.is(Bd))return null;if(r.is(Ud))return null}return e?{...e,decorations:e.decorations.map(t.changes),reverseChangeSet:e.reverseChangeSet.map(t.changes)}:e},provide:e=>St.decorations.from(e,(e=>(null==e?void 0:e.decorations)||Tt.none))}),ef=dn.define(),tf=dn.define();var nf,of;function rf(e){const t=nf[e];return"string"!=typeof t?e.toString():t[0].toLowerCase()+t.substring(1).replace(/[A-Z]/g,(e=>"_"+e.toLowerCase()))}let af;(of=nf||(nf={}))[of.Canceled=1]="Canceled",of[of.Unknown=2]="Unknown",of[of.InvalidArgument=3]="InvalidArgument",of[of.DeadlineExceeded=4]="DeadlineExceeded",of[of.NotFound=5]="NotFound",of[of.AlreadyExists=6]="AlreadyExists",of[of.PermissionDenied=7]="PermissionDenied",of[of.ResourceExhausted=8]="ResourceExhausted",of[of.FailedPrecondition=9]="FailedPrecondition",of[of.Aborted=10]="Aborted",of[of.OutOfRange=11]="OutOfRange",of[of.Unimplemented=12]="Unimplemented",of[of.Internal=13]="Internal",of[of.Unavailable=14]="Unavailable",of[of.DataLoss=15]="DataLoss",of[of.Unauthenticated=16]="Unauthenticated";class sf extends Error{constructor(e,t=nf.Unknown,n,o,r){super(function(e,t){return e.length?`[${rf(t)}] ${e}`:`[${rf(t)}]`}(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(null!=n?n:{}),this.details=null!=o?o:[],this.cause=r}static from(e,t=nf.Unknown){return e instanceof sf?e:e instanceof Error?"AbortError"==e.name?new sf(e.message,nf.Canceled):new sf(e.message,t,void 0,void 0,e):new sf(String(e),t,void 0,void 0,e)}static[Symbol.hasInstance](e){return e instanceof Error&&(Object.getPrototypeOf(e)===sf.prototype||"ConnectError"===e.name&&"code"in e&&"number"==typeof e.code&&"metadata"in e&&"details"in e&&Array.isArray(e.details)&&"rawMessage"in e&&"string"==typeof e.rawMessage&&"cause"in e)}findDetails(e){const t="typeName"in e?{findMessage:t=>t===e.typeName?e:void 0}:e,n=[];for(const r of this.details){if("getType"in r){t.findMessage(r.getType().typeName)&&n.push(r);continue}const e=t.findMessage(r.type);if(e)try{n.push(e.fromBinary(r.value))}catch(o){}}return n}}var lf=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,r){(function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)})(o,r,(t=e[n](t)).done,t.value)}))}}},cf=function(e){return this instanceof cf?(this.v=e,this):new cf(e)},df=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),a=[];return o={},s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),o[Symbol.asyncIterator]=function(){return this},o;function s(e,t){r[e]&&(o[e]=function(t){return new Promise((function(n,o){a.push([e,t,n,o])>1||i(e,t)}))},t&&(o[e]=t(o[e])))}function i(e,t){try{(n=r[e](t)).value instanceof cf?Promise.resolve(n.value.v).then(l,c):d(a[0][2],n)}catch(o){d(a[0][3],o)}var n}function l(e){i("next",e)}function c(e){i("throw",e)}function d(e,t){e(t),a.shift(),a.length&&i(a[0][0],a[0][1])}},uf=function(e){var t,n;return t={},o("next"),o("throw",(function(e){throw e})),o("return"),t[Symbol.iterator]=function(){return this},t;function o(o,r){t[o]=e[o]?function(t){return(n=!n)?{value:cf(e[o](t)),done:!1}:r?r(t):t}:r}};var hf=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,r){(function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)})(o,r,(t=e[n](t)).done,t.value)}))}}},ff=function(e){return this instanceof ff?(this.v=e,this):new ff(e)},mf=function(e){var t,n;return t={},o("next"),o("throw",(function(e){throw e})),o("return"),t[Symbol.iterator]=function(){return this},t;function o(o,r){t[o]=e[o]?function(t){return(n=!n)?{value:ff(e[o](t)),done:!1}:r?r(t):t}:r}},pf=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),a=[];return o={},s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),o[Symbol.asyncIterator]=function(){return this},o;function s(e,t){r[e]&&(o[e]=function(t){return new Promise((function(n,o){a.push([e,t,n,o])>1||i(e,t)}))},t&&(o[e]=t(o[e])))}function i(e,t){try{(n=r[e](t)).value instanceof ff?Promise.resolve(n.value.v).then(l,c):d(a[0][2],n)}catch(o){d(a[0][3],o)}var n}function l(e){i("next",e)}function c(e){i("throw",e)}function d(e,t){e(t),a.shift(),a.length&&i(a[0][0],a[0][1])}};function gf(e,t){const n=function(){var n,o;return pf(this,arguments,(function*(){const r=yield ff(e);null===(n=null==t?void 0:t.onHeader)||void 0===n||n.call(t,r.header),yield ff(yield*mf(hf(r.message))),null===(o=null==t?void 0:t.onTrailer)||void 0===o||o.call(t,r.trailer)}))}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>n.next()})}}function xf(e){if(!e.aborted)return;if(void 0!==e.reason)return e.reason;const t=new Error("This operation was aborted");return t.name="AbortError",t}function yf(){return{get(e){return e.id in this?this[e.id]:e.defaultValue},set(e,t){return this[e.id]=t,this},delete(e){return delete this[e.id],this}}}function vf(e,t,n){const o="string"==typeof t?t:t.typeName,r="string"==typeof n?n:n.name;return e.toString().replace(/\/?$/,`/${o}/${r}`)}function bf(e,t){return t instanceof e?t:new e(t)}function wf(e,t){function n(t){return!0===t.done?t:{done:t.done,value:bf(e,t.value)}}return{[Symbol.asyncIterator](){const e=t[Symbol.asyncIterator](),o={next:()=>e.next().then(n)};return void 0!==e.throw&&(o.throw=t=>e.throw(t).then(n)),void 0!==e.return&&(o.return=t=>e.return(t).then(n)),o}}}function kf(e,t){var n;return null!==(n=null==t?void 0:t.concat().reverse().reduce(((e,t)=>t(e)),e))&&void 0!==n?n:e}function Nf(e){var t;const n=Object.assign({},e);return null!==(t=n.ignoreUnknownFields)&&void 0!==t||(n.ignoreUnknownFields=!0),n}function Ef(e,t,n,o){const r=t?Cf(e.I,o):jf(e.I,n);return{parse:(t?Cf(e.O,o):jf(e.O,n)).parse,serialize:r.serialize}}function Cf(e,t){return{parse(n){try{return e.fromBinary(n,t)}catch(o){const e=o instanceof Error?o.message:String(o);throw new sf(`parse binary: ${e}`,nf.InvalidArgument)}},serialize(e){try{return e.toBinary(t)}catch(n){const e=n instanceof Error?n.message:String(n);throw new sf(`serialize binary: ${e}`,nf.Internal)}}}}function jf(e,t){var n,o;const r=null!==(n=null==t?void 0:t.textEncoder)&&void 0!==n?n:new TextEncoder,a=null!==(o=null==t?void 0:t.textDecoder)&&void 0!==o?o:new TextDecoder,s=Nf(t);return{parse(t){try{const n=a.decode(t);return e.fromJsonString(n,s)}catch(n){throw sf.from(n,nf.InvalidArgument)}},serialize(e){try{const t=e.toJsonString(s);return r.encode(t)}catch(t){throw sf.from(t,nf.Internal)}}}}const Sf=/^application\/(connect\+)?(?:(json)(?:; ?charset=utf-?8)?|(proto))$/i,If="application/proto",Af="application/json",Tf="application/connect+proto",Of="application/connect+json";function Mf(e,t,n){if(t&&new Headers(t).forEach(((e,t)=>n.metadata.append(t,e))),"object"!=typeof e||null==e||Array.isArray(e)||!("code"in e)||"string"!=typeof e.code)throw n;const o=function(e){if(!af){af={};for(const e of Object.values(nf))"string"!=typeof e&&(af[rf(e)]=e)}return af[e]}(e.code);if(void 0===o)throw n;const r=e.message;if(null!=r&&"string"!=typeof r)throw n;const a=new sf(null!=r?r:"",o,t);if("details"in e&&Array.isArray(e.details))for(const i of e.details){if(null===i||"object"!=typeof i||Array.isArray(i)||"string"!=typeof i.type||"string"!=typeof i.value||"debug"in i&&"object"!=typeof i.debug)throw n;try{a.details.push({type:i.type,value:Tu.dec(i.value),debug:i.debug})}catch(s){throw n}}return a}function _f(e){const t=new sf("invalid end stream",nf.InvalidArgument);let n;try{n=JSON.parse("string"==typeof e?e:(new TextDecoder).decode(e))}catch(r){throw t}if("object"!=typeof n||null==n||Array.isArray(n))throw t;const o=new Headers;if("metadata"in n){if("object"!=typeof n.metadata||null==n.metadata||Array.isArray(n.metadata))throw t;for(const[e,r]of Object.entries(n.metadata)){if(!Array.isArray(r)||r.some((e=>"string"!=typeof e)))throw t;for(const t of r)o.append(e,t)}}return{metadata:o,error:"error"in n?Mf(n.error,o,t):void 0}}const Pf="Content-Type",Df="Content-Length",Ff="Content-Encoding",Lf="Accept-Encoding",Rf="Connect-Timeout-Ms",zf="Connect-Protocol-Version";function Bf(e){const t=new Headers,n=new Headers;return e.forEach(((e,o)=>{o.toLowerCase().startsWith("trailer-")?n.set(o.substring(8),e):t.set(o,e)})),[t,n]}const Uf="1";function Vf(e,t,n,o,r){const a=new Headers(null!=o?o:{});return void 0!==n&&a.set(Rf,`${n}`),a.set(Pf,e==Ah.Unary?t?If:Af:t?Tf:Of),a.set(zf,Uf),a}function $f(e,t,n){const o=function(e){const t=null==e?void 0:e.match(Sf);if(!t)return;return{stream:!!t[1],binary:!!t[3]}}(n.get("Content-Type"));if(200!==t){const r=new sf(`HTTP ${t}`,function(e){switch(e){case 400:return nf.InvalidArgument;case 401:return nf.Unauthenticated;case 403:return nf.PermissionDenied;case 404:return nf.Unimplemented;case 408:return nf.DeadlineExceeded;case 409:return nf.Aborted;case 412:return nf.FailedPrecondition;case 413:case 431:return nf.ResourceExhausted;case 415:return nf.Internal;case 429:case 502:case 503:case 504:return nf.Unavailable;default:return nf.Unknown}}(t),n);if(e==Ah.Unary&&o&&!o.binary)return{isUnaryError:!0,unaryError:r};throw r}return{isUnaryError:!1}}const Gf="application/";function Hf(e,t,n){let o=`?connect=v${Uf}`;const r=e.header.get(Pf);0===(null==r?void 0:r.indexOf(Gf))&&(o+="&encoding="+encodeURIComponent(r.slice(Gf.length)));const a=e.header.get(Ff);null!==a&&"identity"!==a&&(o+="&compression="+encodeURIComponent(a),n=!0),n&&(o+="&base64=1"),o+="&message="+function(e,t){return t?Tu.enc(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):encodeURIComponent((new TextDecoder).decode(e))}(t,n);const s=e.url+o,i=new Headers(e.header);return[zf,Pf,Df,Ff,Lf].forEach((e=>i.delete(e))),Object.assign(Object.assign({},e),{init:Object.assign(Object.assign({},e.init),{method:"GET"}),url:s,header:i})}function Wf(e){const{signal:t,cleanup:n}=function(e){const t=new AbortController,n=()=>{t.abort(new sf("the operation timed out",nf.DeadlineExceeded))};let o;return void 0!==e&&(e<=0?n():o=setTimeout(n,e)),{signal:t.signal,cleanup:()=>clearTimeout(o)}}(e.timeoutMs),o=function(...e){const t=new AbortController,n=e.filter((e=>void 0!==e)).concat(t.signal);for(const r of n){if(r.aborted){o.apply(r);break}r.addEventListener("abort",o)}function o(){t.signal.aborted||t.abort(xf(this));for(const e of n)e.removeEventListener("abort",o)}return t}(e.signal,t);return[o.signal,function(e){const r=sf.from(t.aborted?xf(t):e);return o.abort(r),n(),Promise.reject(r)},function(){n(),o.abort()}]}var qf,Yf,Jf,Kf,Xf,Zf;(Yf=qf||(qf={}))[Yf.UNSPECIFIED=0]="UNSPECIFIED",Yf[Yf.INACTIVE=1]="INACTIVE",Yf[Yf.PROCESSING=2]="PROCESSING",Yf[Yf.SUCCESS=3]="SUCCESS",Yf[Yf.WARNING=4]="WARNING",Yf[Yf.ERROR=5]="ERROR",jh.util.setEnumType(qf,"exa.language_server_pb.CodeiumState",[{no:0,name:"CODEIUM_STATE_UNSPECIFIED"},{no:1,name:"CODEIUM_STATE_INACTIVE"},{no:2,name:"CODEIUM_STATE_PROCESSING"},{no:3,name:"CODEIUM_STATE_SUCCESS"},{no:4,name:"CODEIUM_STATE_WARNING"},{no:5,name:"CODEIUM_STATE_ERROR"}]),(Kf=Jf||(Jf={}))[Kf.UNSPECIFIED=0]="UNSPECIFIED",Kf[Kf.SINGLE=1]="SINGLE",Kf[Kf.MULTI=2]="MULTI",jh.util.setEnumType(Jf,"exa.language_server_pb.LineType",[{no:0,name:"LINE_TYPE_UNSPECIFIED"},{no:1,name:"LINE_TYPE_SINGLE"},{no:2,name:"LINE_TYPE_MULTI"}]),(Zf=Xf||(Xf={}))[Zf.UNSPECIFIED=0]="UNSPECIFIED",Zf[Zf.INLINE=1]="INLINE",Zf[Zf.BLOCK=2]="BLOCK",Zf[Zf.INLINE_MASK=3]="INLINE_MASK",jh.util.setEnumType(Xf,"exa.language_server_pb.CompletionPartType",[{no:0,name:"COMPLETION_PART_TYPE_UNSPECIFIED"},{no:1,name:"COMPLETION_PART_TYPE_INLINE"},{no:2,name:"COMPLETION_PART_TYPE_BLOCK"},{no:3,name:"COMPLETION_PART_TYPE_INLINE_MASK"}]);const Qf=class e extends ou{constructor(e){super(),n(this,"threshold",0),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(Qf,"runtime",jh),n(Qf,"typeName","exa.language_server_pb.MultilineConfig"),n(Qf,"fields",jh.util.newFieldList((()=>[{no:1,name:"threshold",kind:"scalar",T:2}])));let em=Qf;const tm=class e extends ou{constructor(e){super(),n(this,"metadata"),n(this,"document"),n(this,"editorOptions"),n(this,"otherDocuments",[]),n(this,"experimentConfig"),n(this,"modelName",""),n(this,"multilineConfig"),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(tm,"runtime",jh),n(tm,"typeName","exa.language_server_pb.GetCompletionsRequest"),n(tm,"fields",jh.util.newFieldList((()=>[{no:1,name:"metadata",kind:"message",T:Wh},{no:2,name:"document",kind:"message",T:gm},{no:3,name:"editor_options",kind:"message",T:Yh},{no:5,name:"other_documents",kind:"message",T:gm,repeated:!0},{no:7,name:"experiment_config",kind:"message",T:ym},{no:10,name:"model_name",kind:"scalar",T:9},{no:13,name:"multiline_config",kind:"message",T:em}])));let nm=tm;const om=class e extends ou{constructor(e){super(),n(this,"state"),n(this,"completionItems",[]),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(om,"runtime",jh),n(om,"typeName","exa.language_server_pb.GetCompletionsResponse"),n(om,"fields",jh.util.newFieldList((()=>[{no:1,name:"state",kind:"message",T:bm},{no:2,name:"completion_items",kind:"message",T:Im,repeated:!0}])));let rm=om;const am=class e extends ou{constructor(e){super(),n(this,"metadata"),n(this,"completionId",""),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(am,"runtime",jh),n(am,"typeName","exa.language_server_pb.AcceptCompletionRequest"),n(am,"fields",jh.util.newFieldList((()=>[{no:1,name:"metadata",kind:"message",T:Wh},{no:2,name:"completion_id",kind:"scalar",T:9}])));let sm=am;const im=class e extends ou{constructor(e){super(),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(im,"runtime",jh),n(im,"typeName","exa.language_server_pb.AcceptCompletionResponse"),n(im,"fields",jh.util.newFieldList((()=>[])));let lm=im;const cm=class e extends ou{constructor(e){super(),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(cm,"runtime",jh),n(cm,"typeName","exa.language_server_pb.GetAuthTokenRequest"),n(cm,"fields",jh.util.newFieldList((()=>[])));let dm=cm;const um=class e extends ou{constructor(e){super(),n(this,"authToken",""),n(this,"uuid",""),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(um,"runtime",jh),n(um,"typeName","exa.language_server_pb.GetAuthTokenResponse"),n(um,"fields",jh.util.newFieldList((()=>[{no:1,name:"auth_token",kind:"scalar",T:9},{no:2,name:"uuid",kind:"scalar",T:9}])));let hm=um;const fm=class e extends ou{constructor(e){super(),n(this,"row",pu.zero),n(this,"col",pu.zero),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(fm,"runtime",jh),n(fm,"typeName","exa.language_server_pb.DocumentPosition"),n(fm,"fields",jh.util.newFieldList((()=>[{no:1,name:"row",kind:"scalar",T:4},{no:2,name:"col",kind:"scalar",T:4}])));let mm=fm;const pm=class e extends ou{constructor(e){super(),n(this,"absolutePath",""),n(this,"relativePath",""),n(this,"text",""),n(this,"editorLanguage",""),n(this,"language",Uh.UNSPECIFIED),n(this,"cursorOffset",pu.zero),n(this,"cursorPosition"),n(this,"lineEnding",""),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(pm,"runtime",jh),n(pm,"typeName","exa.language_server_pb.Document"),n(pm,"fields",jh.util.newFieldList((()=>[{no:1,name:"absolute_path",kind:"scalar",T:9},{no:2,name:"relative_path",kind:"scalar",T:9},{no:3,name:"text",kind:"scalar",T:9},{no:4,name:"editor_language",kind:"scalar",T:9},{no:5,name:"language",kind:"enum",T:jh.getEnumType(Uh)},{no:6,name:"cursor_offset",kind:"scalar",T:4},{no:8,name:"cursor_position",kind:"message",T:mm},{no:7,name:"line_ending",kind:"scalar",T:9}])));let gm=pm;const xm=class e extends ou{constructor(e){super(),n(this,"forceEnableExperiments",[]),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(xm,"runtime",jh),n(xm,"typeName","exa.language_server_pb.ExperimentConfig"),n(xm,"fields",jh.util.newFieldList((()=>[{no:1,name:"force_enable_experiments",kind:"enum",T:jh.getEnumType(_h),repeated:!0}])));let ym=xm;const vm=class e extends ou{constructor(e){super(),n(this,"state",qf.UNSPECIFIED),n(this,"message",""),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(vm,"runtime",jh),n(vm,"typeName","exa.language_server_pb.State"),n(vm,"fields",jh.util.newFieldList((()=>[{no:1,name:"state",kind:"enum",T:jh.getEnumType(qf)},{no:2,name:"message",kind:"scalar",T:9}])));let bm=vm;const wm=class e extends ou{constructor(e){super(),n(this,"startOffset",pu.zero),n(this,"endOffset",pu.zero),n(this,"startPosition"),n(this,"endPosition"),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(wm,"runtime",jh),n(wm,"typeName","exa.language_server_pb.Range"),n(wm,"fields",jh.util.newFieldList((()=>[{no:1,name:"start_offset",kind:"scalar",T:4},{no:2,name:"end_offset",kind:"scalar",T:4},{no:3,name:"start_position",kind:"message",T:mm},{no:4,name:"end_position",kind:"message",T:mm}])));let km=wm;const Nm=class e extends ou{constructor(e){super(),n(this,"text",""),n(this,"deltaCursorOffset",pu.zero),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(Nm,"runtime",jh),n(Nm,"typeName","exa.language_server_pb.Suffix"),n(Nm,"fields",jh.util.newFieldList((()=>[{no:1,name:"text",kind:"scalar",T:9},{no:2,name:"delta_cursor_offset",kind:"scalar",T:3}])));let Em=Nm;const Cm=class e extends ou{constructor(e){super(),n(this,"text",""),n(this,"offset",pu.zero),n(this,"type",Xf.UNSPECIFIED),n(this,"prefix",""),n(this,"line",pu.zero),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(Cm,"runtime",jh),n(Cm,"typeName","exa.language_server_pb.CompletionPart"),n(Cm,"fields",jh.util.newFieldList((()=>[{no:1,name:"text",kind:"scalar",T:9},{no:2,name:"offset",kind:"scalar",T:4},{no:3,name:"type",kind:"enum",T:jh.getEnumType(Xf)},{no:4,name:"prefix",kind:"scalar",T:9},{no:5,name:"line",kind:"scalar",T:4}])));let jm=Cm;const Sm=class e extends ou{constructor(e){super(),n(this,"completion"),n(this,"suffix"),n(this,"range"),n(this,"source",zh.UNSPECIFIED),n(this,"completionParts",[]),jh.util.initPartial(e,this)}static fromBinary(t,n){return(new e).fromBinary(t,n)}static fromJson(t,n){return(new e).fromJson(t,n)}static fromJsonString(t,n){return(new e).fromJsonString(t,n)}static equals(t,n){return jh.util.equals(e,t,n)}};n(Sm,"runtime",jh),n(Sm,"typeName","exa.language_server_pb.CompletionItem"),n(Sm,"fields",jh.util.newFieldList((()=>[{no:1,name:"completion",kind:"message",T:Gh},{no:5,name:"suffix",kind:"message",T:Em},{no:2,name:"range",kind:"message",T:km},{no:3,name:"source",kind:"enum",T:jh.getEnumType(zh)},{no:8,name:"completion_parts",kind:"message",T:jm,repeated:!0}])));let Im=Sm;const Am={typeName:"exa.language_server_pb.LanguageServerService",methods:{getCompletions:{name:"GetCompletions",I:nm,O:rm,kind:Ah.Unary},acceptCompletion:{name:"AcceptCompletion",I:sm,O:lm,kind:Ah.Unary},getAuthToken:{name:"GetAuthToken",I:dm,O:hm,kind:Ah.Unary}}};var Tm=function(e){return this instanceof Tm?(this.v=e,this):new Tm(e)},Om=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),a=[];return o={},s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),o[Symbol.asyncIterator]=function(){return this},o;function s(e,t){r[e]&&(o[e]=function(t){return new Promise((function(n,o){a.push([e,t,n,o])>1||i(e,t)}))},t&&(o[e]=t(o[e])))}function i(e,t){try{(n=r[e](t)).value instanceof Tm?Promise.resolve(n.value.v).then(l,c):d(a[0][2],n)}catch(o){d(a[0][3],o)}var n}function l(e){i("next",e)}function c(e){i("throw",e)}function d(e,t){e(t),a.shift(),a.length&&i(a[0][0],a[0][1])}};const Mm=function(e){var t;!function(){try{new Headers}catch(e){throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}();const n=null!==(t=e.useBinaryFormat)&&void 0!==t&&t;return{async unary(t,o,r,a,s,i,l){var c;const{serialize:d,parse:u}=Ef(o,n,e.jsonOptions,e.binaryOptions);return a=void 0===a?e.defaultTimeoutMs:a<=0?void 0:a,await function(e){const t=kf(e.next,e.interceptors),[n,o,r]=Wf(e);return t(Object.assign(Object.assign({},e.req),{message:bf(e.req.method.I,e.req.message),signal:n})).then((e=>(r(),e)),o)}({interceptors:e.interceptors,signal:r,timeoutMs:a,req:{stream:!1,service:t,method:o,url:vf(e.baseUrl,t,o),init:{method:"POST",credentials:null!==(c=e.credentials)&&void 0!==c?c:"same-origin",redirect:"error",mode:"cors"},header:Vf(o.kind,n,a,s),contextValues:null!=l?l:yf(),message:i},next:async r=>{var a;let s=null;!0===e.useHttpGet&&o.idempotency===Oh.NoSideEffects?r=Hf(r,d(r.message),n):s=d(r.message);const i=null!==(a=e.fetch)&&void 0!==a?a:globalThis.fetch,l=await i(r.url,Object.assign(Object.assign({},r.init),{headers:r.header,signal:r.signal,body:s})),{isUnaryError:c,unaryError:h}=$f(o.kind,l.status,l.headers);if(c)throw Mf(await l.json(),function(...e){const t=new Headers;for(const n of e)n.forEach(((e,n)=>{t.append(n,e)}));return t}(...Bf(l.headers)),h);const[f,m]=Bf(l.headers);return{stream:!1,service:t,method:o,header:f,message:n?u(new Uint8Array(await l.arrayBuffer())):o.O.fromJson(await l.json(),Nf(e.jsonOptions)),trailer:m}}})},async stream(t,o,r,a,s,i,l){var c;const{serialize:d,parse:u}=Ef(o,n,e.jsonOptions,e.binaryOptions);function h(e,t,n){return Om(this,arguments,(function*(){const o=function(e){let t,n=new Uint8Array(0);function o(e){const t=new Uint8Array(n.length+e.length);t.set(n),t.set(e,n.length),n=t}return new ReadableStream({start(){t=e.getReader()},async pull(e){let r;for(;;){if(void 0===r&&n.byteLength>=5){let e=0;for(let t=1;t<5;t++)e=(e<<8)+n[t];r={flags:n[0],length:e}}if(void 0!==r&&n.byteLength>=r.length+5)break;const e=await t.read();if(e.done)break;o(e.value)}if(void 0===r)return 0==n.byteLength?void e.close():void e.error(new sf("premature end of stream",nf.DataLoss));const a=n.subarray(5,5+r.length);n=n.subarray(5+r.length),e.enqueue({flags:r.flags,data:a})}})}(e).getReader();let r=!1;for(;;){const e=yield Tm(o.read());if(e.done)break;const{flags:a,data:s}=e.value;if(2&~a)yield yield Tm(u(s));else{r=!0;const e=_f(s);if(e.error){const t=e.error;throw n.forEach(((e,n)=>{t.metadata.append(n,e)})),t}e.metadata.forEach(((e,n)=>t.set(n,e)))}}if(!r)throw"missing EndStreamResponse"}))}async function f(e){if(o.kind!=Ah.ServerStreaming)throw"The fetch API does not support streaming request bodies";const t=await e[Symbol.asyncIterator]().next();if(1==t.done)throw"missing request message";return function(e,t){const n=new Uint8Array(t.length+5);n.set(t,5);const o=new DataView(n.buffer,n.byteOffset,n.byteLength);return o.setUint8(0,e),o.setUint32(1,t.length),n}(0,d(t.value))}return a=void 0===a?e.defaultTimeoutMs:a<=0?void 0:a,await function(e){const t=kf(e.next,e.interceptors),[n,o,r]=Wf(e),a=Object.assign(Object.assign({},e.req),{message:wf(e.req.method.I,e.req.message),signal:n});let s=!1;return n.addEventListener("abort",(function(){var t,n;const o=e.req.message[Symbol.asyncIterator]();s||null===(t=o.throw)||void 0===t||t.call(o,this.reason).catch((()=>{})),null===(n=o.return)||void 0===n||n.call(o).catch((()=>{}))})),t(a).then((e=>Object.assign(Object.assign({},e),{message:{[Symbol.asyncIterator](){const t=e.message[Symbol.asyncIterator]();return{next:()=>t.next().then((e=>(1==e.done&&(s=!0,r()),e)),o)}}}})),o)}({interceptors:e.interceptors,timeoutMs:a,signal:r,req:{stream:!0,service:t,method:o,url:vf(e.baseUrl,t,o),init:{method:"POST",credentials:null!==(c=e.credentials)&&void 0!==c?c:"same-origin",redirect:"error",mode:"cors"},header:Vf(o.kind,n,a,s),contextValues:null!=l?l:yf(),message:i},next:async t=>{var n;const r=null!==(n=e.fetch)&&void 0!==n?n:globalThis.fetch,a=await r(t.url,Object.assign(Object.assign({},t.init),{headers:t.header,signal:t.signal,body:await f(t.message)}));if($f(o.kind,a.status,a.headers),null===a.body)throw"missing response body";const s=new Headers;return Object.assign(Object.assign({},t),{header:a.headers,trailer:s,message:h(a.body,s,a.headers)})}})}}}({baseUrl:"https://web-backend.codeium.com",useBinaryFormat:!0}),_m=(Dm=Mm,function(e,t){const n={};for(const[o,r]of Object.entries(e.methods)){const a=t(Object.assign(Object.assign({},r),{localName:o,service:e}));null!=a&&(n[o]=a)}return n}(Pm=Am,(e=>{switch(e.kind){case Ah.Unary:return function(e,t,n){return async function(o,r){var a,s;const i=await e.unary(t,n,null==r?void 0:r.signal,null==r?void 0:r.timeoutMs,null==r?void 0:r.headers,o,null==r?void 0:r.contextValues);return null===(a=null==r?void 0:r.onHeader)||void 0===a||a.call(r,i.header),null===(s=null==r?void 0:r.onTrailer)||void 0===s||s.call(r,i.trailer),i.message}}(Dm,Pm,e);case Ah.ServerStreaming:return function(e,t,n){return function(o,r){return gf(e.stream(t,n,null==r?void 0:r.signal,null==r?void 0:r.timeoutMs,null==r?void 0:r.headers,function(e){return df(this,arguments,(function*(){yield cf(yield*uf(lf(e)))}))}([o]),null==r?void 0:r.contextValues),r)}}(Dm,Pm,e);case Ah.ClientStreaming:return function(e,t,n){return async function(o,r){var a,s,i,l,c,d;const u=await e.stream(t,n,null==r?void 0:r.signal,null==r?void 0:r.timeoutMs,null==r?void 0:r.headers,o,null==r?void 0:r.contextValues);let h;null===(c=null==r?void 0:r.onHeader)||void 0===c||c.call(r,u.header);try{for(var f,m=!0,p=hf(u.message);!(a=(f=await p.next()).done);m=!0)l=f.value,m=!1,h=l}catch(g){s={error:g}}finally{try{m||a||!(i=p.return)||await i.call(p)}finally{if(s)throw s.error}}if(!h)throw new sf("protocol error: missing response message",nf.Internal);return null===(d=null==r?void 0:r.onTrailer)||void 0===d||d.call(r,u.trailer),h}}(Dm,Pm,e);case Ah.BiDiStreaming:return function(e,t,n){return function(o,r){return gf(e.stream(t,n,null==r?void 0:r.signal,null==r?void 0:r.timeoutMs,null==r?void 0:r.headers,o,null==r?void 0:r.contextValues),r)}}(Dm,Pm,e);default:return null}})));var Pm,Dm;let Fm;try{Fm=crypto.randomUUID()}catch{Fm=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(+e^(crypto.getRandomValues(new Uint8Array(1))[0]??0)&15>>+e/4).toString(16)))}()}async function Lm(e,t){const n=e.state.facet(Kh),{override:o}=e.state.facet(Xh),r=await o(),a=e.state,s=a.selection.main.head,i=a.doc.toString();try{const o=await async function({text:e,cursorOffset:t,config:n,otherDocuments:o}){return await _m.getCompletions({metadata:{ideName:"web",ideVersion:"0.0.5",extensionName:"@valtown/codemirror-codeium",extensionVersion:"1.0.0",apiKey:n.apiKey,sessionId:Fm,authSource:n.authSource},document:{text:e,cursorOffset:BigInt(t),language:n.language,editorLanguage:"typescript",lineEnding:"\n"},editorOptions:{tabSize:2n,insertSpaces:!0},otherDocuments:o,multilineConfig:void 0},{headers:{Authorization:`Basic ${n.apiKey}-${Fm}`}})}({text:i,cursorOffset:s,config:n,otherDocuments:r});if(!o||0===o.completionItems.length)return;if(void 0!==t&&s!==t||"active"===un(e.state)||!e.hasFocus)return;const l=o.completionItems.map((e=>{let t=0;return e.completionParts.filter((e=>3!==e.type)).map((e=>{const n=Number(e.offset),o=2===e.type?`\n${e.text}`:e.text,r={absoluteStartPos:t+n,absoluteEndPos:t+n+o.length,from:n,to:n,insert:o};return t+=o.length,r}))})),c=0,d=l.at(c);if(!d)return;const u=hn.of(d,a.doc.length),h=u.invert(a.doc);e.dispatch({changes:u,effects:zd.of({index:c,reverseChangeSet:h,changeSpecs:l}),annotations:[tf.of(null),ef.of(null),fn.addToHistory.of(!1)]})}catch(l){console.warn("copilot completion failed",l),await new Promise((e=>setTimeout(e,300)))}}function Rm(){let e=null,t=0;return St.updateListener.of((n=>{const o=n.view.state.facet(Kh);if(!o.alwaysOn)return;if(!function(e){return e.docChanged&&!e.transactions.some((e=>e.effects.some((e=>e.is(Bd)||e.is(Ud)))))}(n))return;if(e&&clearTimeout(e),function(e){if(!e.view.hasFocus)return!0;if(e.state.field(Qh))return!0;if("active"===un(e.state))return!0;for(const t of e.transactions)if(void 0!==t.annotation(ef))return!0}(n))return;const r=n.state.selection.main.head;o.shouldComplete&&!o.shouldComplete(new mn(n.view.state,r,!1))||(e=setTimeout((async()=>{r===t&&await Lm(n.view,t)}),o.timeout),t=r)}))}function zm(e){var t;const n=e.state.field(Qh);if(!n)return!1;const o=null==(t=n.reverseChangeSet)?void 0:t.invert(e.state.doc);e.dispatch({changes:n.reverseChangeSet,effects:Bd.of(null),annotations:[tf.of(null),ef.of(null),fn.addToHistory.of(!1)]});let r=0;return null==o||o.iterChangedRanges(((e,t,n,o)=>{r=o})),e.dispatch({changes:o,selection:jt.cursor(r),annotations:[ef.of(null),fn.addToHistory.of(!0)]}),!0}const Bm=e=>{const{state:t}=e,n=t.field(Qh);if(!n)return!1;const{changeSpecs:o}=n;if(o.length<2)return!1;const r=(n.index+1)%o.length,a=o.at(r);if(!a)return!1;const s=n.reverseChangeSet.apply(t.doc),i=hn.of(n.reverseChangeSet,t.doc.length).compose(hn.of(a,s.length)),l=hn.of(a,s.length).invert(s);return e.dispatch({changes:i,effects:zd.of({index:r,reverseChangeSet:l,changeSpecs:o}),annotations:[tf.of(null),ef.of(null),fn.addToHistory.of(!1)]}),!0};function Um(e){const t=e.state.field(Qh);return!!t&&(e.dispatch({changes:t.reverseChangeSet,effects:Ud.of(null),annotations:[tf.of(null),ef.of(null),fn.addToHistory.of(!1)]}),!1)}function Vm(){return St.domEventHandlers({keydown:(e,t)=>("]"!==e.key||!e.ctrlKey)&&("Shift"!==e.key&&"Control"!==e.key&&"Alt"!==e.key&&"Meta"!==e.key&&function(e,t){return!!e.state.field(Qh)&&("Tab"===t?zm(e):Um(e))}(t,e.key)),mouseup(e,t){const n=e.target;return"BUTTON"===n.nodeName&&"codeium-cycle"===n.dataset.action?(Bm(t),e.stopPropagation(),e.preventDefault(),!0):function(e){var t,n;let o=!1;const r=null==(t=e.state.selection.asSingle().ranges.at(0))?void 0:t.head,a=e.state.field(Qh);return!(void 0===r||!a)&&(null==(n=a.decorations)||n.between(r,r,(()=>{o=!0})),o)}(t)?zm(t):Um(t)}})}const $m=e=>{const t=[];return"codeium"===e.copilot&&e.codeium_api_key&&t.push(function(e){return[Kh.of(e),Qh,an.highest(nn.of([{key:"Ctrl-]",run:Bm}])),an.highest(St.updateListener.of((e=>{e.focusChanged&&Um(e.view)}))),an.high(Vm()),Rm()]}({apiKey:e.codeium_api_key,language:Uh.PYTHON}),Xh.of({override:async()=>[{text:$s(""),language:Uh.PYTHON,editorLanguage:"python"}]})),"github"===e.copilot&&t.push(Rd({delay:500,fetchFn:async e=>{if(!Hs())return"";if(0===e.doc.length)return"";await new Promise((e=>setTimeout(e,20)));const t=e.doc.toString(),n=function(e,t){const n=e.doc.toString(),o=t.split("\n").length-n.split("\n").length,r=function(e,t){const n=e.lineAt(t);return{line:n.number-1,character:t-n.from}}(e.doc,e.selection.main.head);return r.line+=o,{doc:{source:t,tabSize:e.tabSize,indentSize:1,insertSpaces:!0,path:qs,version:"replace_me",uri:`file://${qs}`,relativePath:qs,languageId:Ys,position:r}}}(e,$s(t)),o=function(e,t,n){if(0===e.completions.length)return"";const{displayText:o,position:r}=e.completions[0],a=r.character-t.character,s=a<0?o.slice(-a):o,i=n.doc.sliceString(n.selection.main.head,n.doc.length);for(let l=0;l<s.length;l++){const e=s.slice(l);if(i.startsWith(e))return s.slice(0,l)}return s}(await Ws().getCompletion(n),n.doc.position,e);return o&&f.debug("Copilot suggestion:",o),o}})),[...t,Gs().slice(0,-2)]};const Gm=Tt.mark({class:"underline"}),Hm=It.define(),Wm=It.define(),qm=At.define({create:()=>Tt.none,update(e,t){let n=e.map(t.changes);for(const o of t.effects)o.is(Hm)?n=e.update({add:[Gm.range(o.value.from,o.value.to)]}):o.is(Wm)&&(n=Tt.none);return n},provide:e=>St.decorations.from(e)});class Ym{constructor(e,t){n(this,"view"),n(this,"commandClickMode"),n(this,"hoveredRange"),n(this,"onClick"),n(this,"keydown",(e=>{"Meta"!==e.key&&"Control"!==e.key||(this.commandClickMode=!0,this.view.dom.addEventListener("mousemove",this.mousemove),this.view.dom.addEventListener("click",this.click))})),n(this,"keyup",(e=>{"Meta"!==e.key&&"Control"!==e.key||this.exitCommandClickMode()})),n(this,"windowBlur",(()=>{this.commandClickMode&&this.exitCommandClickMode()})),n(this,"mousemove",(e=>{if(!e.metaKey&&!e.ctrlKey)return void this.exitCommandClickMode();if(!this.commandClickMode)return void this.clearUnderline();const t=this.view.posAtCoords({x:e.clientX,y:e.clientY});if(null==t)return void this.clearUnderline();const n=pn(this.view.state).cursorAt(t);if("VariableName"===n.name){const{from:e,to:o}=n;if(this.hoveredRange&&this.hoveredRange.from===e&&this.hoveredRange.to===o)return;this.clearUnderline(),this.hoveredRange={from:e,to:o,position:t},this.view.dispatch({effects:Hm.of(this.hoveredRange)})}else this.clearUnderline()})),n(this,"click",(e=>{if(this.hoveredRange){const t=this.view.state.doc.sliceString(this.hoveredRange.from,this.hoveredRange.to);e.preventDefault(),e.stopPropagation(),this.onClick(this.view,t),this.view.dispatch({selection:{head:this.hoveredRange.position,anchor:this.hoveredRange.position}})}})),this.view=e,this.commandClickMode=!1,this.hoveredRange=null,this.onClick=t,window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),window.addEventListener("blur",this.windowBlur),window.addEventListener("mouseleave",this.windowBlur)}update(e){}destroy(){window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.windowBlur),window.removeEventListener("mouseleave",this.windowBlur),this.view.dom.removeEventListener("mousemove",this.mousemove),this.view.dom.removeEventListener("click",this.click)}exitCommandClickMode(){this.commandClickMode=!1,this.view.dom.removeEventListener("mousemove",this.mousemove),this.view.dom.removeEventListener("click",this.click),this.clearUnderline()}clearUnderline(){this.hoveredRange&&(this.view.dispatch({effects:Wm.of(null)}),this.hoveredRange=null)}}const Jm=({variant:e,settings:t,styles:n})=>{const o=St.theme({"&":{backgroundColor:t.background,color:t.foreground},".cm-content":{caretColor:t.caret},".cm-cursor, .cm-dropCursor":{borderLeftColor:t.caret},"&.cm-focused .cm-selectionBackgroundm .cm-selectionBackground, .cm-content ::selection":{backgroundColor:t.selection},".cm-activeLine":{backgroundColor:t.lineHighlight},".cm-gutters":{backgroundColor:t.gutterBackground,color:t.gutterForeground},".cm-activeLineGutter":{backgroundColor:t.lineHighlight}},{dark:"dark"===e}),r=xn.define(n);return[o,yn(r)]};Jm({variant:"dark",settings:{background:"#200020",foreground:"#D0D0FF",caret:"#7070FF",selection:"#80000080",gutterBackground:"#200020",gutterForeground:"#C080C0",lineHighlight:"#80000040"},styles:[{tag:vn.comment,color:"#404080"},{tag:[vn.string,vn.regexp],color:"#999999"},{tag:vn.number,color:"#7090B0"},{tag:[vn.bool,vn.null],color:"#8080A0"},{tag:[vn.punctuation,vn.derefOperator],color:"#805080"},{tag:vn.keyword,color:"#60B0FF"},{tag:vn.definitionKeyword,color:"#B0FFF0"},{tag:vn.moduleKeyword,color:"#60B0FF"},{tag:vn.operator,color:"#A0A0FF"},{tag:[vn.variableName,vn.self],color:"#008080"},{tag:vn.operatorKeyword,color:"#A0A0FF"},{tag:vn.controlKeyword,color:"#80A0FF"},{tag:vn.className,color:"#70E080"},{tag:[vn.function(vn.propertyName),vn.propertyName],color:"#50A0A0"},{tag:vn.tagName,color:"#009090"},{tag:vn.modifier,color:"#B0FFF0"},{tag:[vn.squareBracket,vn.attributeName],color:"#D0D0FF"}]}),Jm({variant:"light",settings:{background:"#fcfcfc",foreground:"#5c6166",caret:"#ffaa33",selection:"#036dd626",gutterBackground:"#fcfcfc",gutterForeground:"#8a919966",lineHighlight:"#8a91991a"},styles:[{tag:vn.comment,color:"#787b8099"},{tag:vn.string,color:"#86b300"},{tag:vn.regexp,color:"#4cbf99"},{tag:[vn.number,vn.bool,vn.null],color:"#ffaa33"},{tag:vn.variableName,color:"#5c6166"},{tag:[vn.definitionKeyword,vn.modifier],color:"#fa8d3e"},{tag:[vn.keyword,vn.special(vn.brace)],color:"#fa8d3e"},{tag:vn.operator,color:"#ed9366"},{tag:vn.separator,color:"#5c6166b3"},{tag:vn.punctuation,color:"#5c6166"},{tag:[vn.definition(vn.propertyName),vn.function(vn.variableName)],color:"#f2ae49"},{tag:[vn.className,vn.definition(vn.typeName)],color:"#22a4e6"},{tag:[vn.tagName,vn.typeName,vn.self,vn.labelName],color:"#55b4d4"},{tag:vn.angleBracket,color:"#55b4d480"},{tag:vn.attributeName,color:"#f2ae49"}]}),Jm({variant:"dark",settings:{background:"#15191EFA",foreground:"#EEF2F7",caret:"#C4C4C4",selection:"#90B2D557",gutterBackground:"#15191EFA",gutterForeground:"#aaaaaa95",lineHighlight:"#57575712"},styles:[{tag:vn.comment,color:"#6E6E6E"},{tag:[vn.string,vn.regexp,vn.special(vn.brace)],color:"#5C81B3"},{tag:vn.number,color:"#C1E1B8"},{tag:vn.bool,color:"#53667D"},{tag:[vn.definitionKeyword,vn.modifier,vn.function(vn.propertyName)],color:"#A3D295",fontWeight:"bold"},{tag:[vn.keyword,vn.moduleKeyword,vn.operatorKeyword,vn.operator],color:"#697A8E",fontWeight:"bold"},{tag:[vn.variableName,vn.attributeName],color:"#708E67"},{tag:[vn.function(vn.variableName),vn.definition(vn.propertyName),vn.derefOperator],color:"#fff"},{tag:vn.tagName,color:"#A3D295"}]}),Jm({variant:"dark",settings:{background:"#2e241d",foreground:"#BAAE9E",caret:"#A7A7A7",selection:"#DDF0FF33",gutterBackground:"#28211C",gutterForeground:"#BAAE9E90",lineHighlight:"#FFFFFF08"},styles:[{tag:vn.comment,color:"#666666"},{tag:[vn.string,vn.special(vn.brace)],color:"#54BE0D"},{tag:vn.regexp,color:"#E9C062"},{tag:vn.number,color:"#CF6A4C"},{tag:[vn.keyword,vn.operator],color:"#5EA6EA"},{tag:vn.variableName,color:"#7587A6"},{tag:[vn.definitionKeyword,vn.modifier],color:"#F9EE98"},{tag:[vn.propertyName,vn.function(vn.variableName)],color:"#937121"},{tag:[vn.typeName,vn.angleBracket,vn.tagName],color:"#9B859D"}]}),Jm({variant:"dark",settings:{background:"#3b2627",foreground:"#E6E1C4",caret:"#E6E1C4",selection:"#16120E",gutterBackground:"#3b2627",gutterForeground:"#E6E1C490",lineHighlight:"#1F1611"},styles:[{tag:vn.comment,color:"#6B4E32"},{tag:[vn.keyword,vn.operator,vn.derefOperator],color:"#EF5D32"},{tag:vn.className,color:"#EFAC32",fontWeight:"bold"},{tag:[vn.typeName,vn.propertyName,vn.function(vn.variableName),vn.definition(vn.variableName)],color:"#EFAC32"},{tag:vn.definition(vn.typeName),color:"#EFAC32",fontWeight:"bold"},{tag:vn.labelName,color:"#EFAC32",fontWeight:"bold"},{tag:[vn.number,vn.bool],color:"#6C99BB"},{tag:[vn.variableName,vn.self],color:"#7DAF9C"},{tag:[vn.string,vn.special(vn.brace),vn.regexp],color:"#D9D762"},{tag:[vn.angleBracket,vn.tagName,vn.attributeName],color:"#EFCB43"}]}),Jm({variant:"dark",settings:{background:"#000205",foreground:"#FFFFFF",caret:"#E60065",selection:"#E60C6559",gutterBackground:"#000205",gutterForeground:"#ffffff90",lineHighlight:"#4DD7FC1A"},styles:[{tag:vn.comment,color:"#404040"},{tag:[vn.string,vn.special(vn.brace),vn.regexp],color:"#00D8FF"},{tag:vn.number,color:"#E62286"},{tag:[vn.variableName,vn.attributeName,vn.self],color:"#E62286",fontWeight:"bold"},{tag:vn.function(vn.variableName),color:"#fff",fontWeight:"bold"}]}),Jm({variant:"light",settings:{background:"#fff",foreground:"#000",caret:"#000",selection:"#BDD5FC",gutterBackground:"#fff",gutterForeground:"#00000070",lineHighlight:"#FFFBD1"},styles:[{tag:vn.comment,color:"#BCC8BA"},{tag:[vn.string,vn.special(vn.brace),vn.regexp],color:"#5D90CD"},{tag:[vn.number,vn.bool,vn.null],color:"#46A609"},{tag:vn.keyword,color:"#AF956F"},{tag:[vn.definitionKeyword,vn.modifier],color:"#C52727"},{tag:[vn.angleBracket,vn.tagName,vn.attributeName],color:"#606060"},{tag:vn.self,color:"#000"}]}),Jm({variant:"dark",settings:{background:"#00254b",foreground:"#FFFFFF",caret:"#FFFFFF",selection:"#B36539BF",gutterBackground:"#00254b",gutterForeground:"#FFFFFF70",lineHighlight:"#00000059"},styles:[{tag:vn.comment,color:"#0088FF"},{tag:vn.string,color:"#3AD900"},{tag:vn.regexp,color:"#80FFC2"},{tag:[vn.number,vn.bool,vn.null],color:"#FF628C"},{tag:[vn.definitionKeyword,vn.modifier],color:"#FFEE80"},{tag:vn.variableName,color:"#CCCCCC"},{tag:vn.self,color:"#FF80E1"},{tag:[vn.className,vn.definition(vn.propertyName),vn.function(vn.variableName),vn.definition(vn.typeName),vn.labelName],color:"#FFDD00"},{tag:[vn.keyword,vn.operator],color:"#FF9D00"},{tag:[vn.propertyName,vn.typeName],color:"#80FFBB"},{tag:vn.special(vn.brace),color:"#EDEF7D"},{tag:vn.attributeName,color:"#9EFFFF"},{tag:vn.derefOperator,color:"#fff"}]}),Jm({variant:"dark",settings:{background:"#060521",foreground:"#E0E0E0",caret:"#FFFFFFA6",selection:"#122BBB",gutterBackground:"#060521",gutterForeground:"#E0E0E090",lineHighlight:"#FFFFFF0F"},styles:[{tag:vn.comment,color:"#AEAEAE"},{tag:[vn.string,vn.special(vn.brace),vn.regexp],color:"#8DFF8E"},{tag:[vn.className,vn.definition(vn.propertyName),vn.function(vn.variableName),vn.function(vn.definition(vn.variableName)),vn.definition(vn.typeName)],color:"#A3EBFF"},{tag:[vn.number,vn.bool,vn.null],color:"#62E9BD"},{tag:[vn.keyword,vn.operator],color:"#2BF1DC"},{tag:[vn.definitionKeyword,vn.modifier],color:"#F8FBB1"},{tag:[vn.variableName,vn.self],color:"#B683CA"},{tag:[vn.angleBracket,vn.tagName,vn.typeName,vn.propertyName],color:"#60A4F1"},{tag:vn.derefOperator,color:"#E0E0E0"},{tag:vn.attributeName,color:"#7BACCA"}]}),Jm({variant:"dark",settings:{background:"#2d2f3f",foreground:"#f8f8f2",caret:"#f8f8f0",selection:"#44475a",gutterBackground:"#282a36",gutterForeground:"rgb(144, 145, 148)",lineHighlight:"#44475a"},styles:[{tag:vn.comment,color:"#6272a4"},{tag:[vn.string,vn.special(vn.brace)],color:"#f1fa8c"},{tag:[vn.number,vn.self,vn.bool,vn.null],color:"#bd93f9"},{tag:[vn.keyword,vn.operator],color:"#ff79c6"},{tag:[vn.definitionKeyword,vn.typeName],color:"#8be9fd"},{tag:vn.definition(vn.typeName),color:"#f8f8f2"},{tag:[vn.className,vn.definition(vn.propertyName),vn.function(vn.variableName),vn.attributeName],color:"#50fa7b"}]}),Jm({variant:"light",settings:{background:"#FFFFFF",foreground:"#000000",caret:"#000000",selection:"#80C7FF",gutterBackground:"#FFFFFF",gutterForeground:"#00000070",lineHighlight:"#C1E2F8"},styles:[{tag:vn.comment,color:"#AAAAAA"},{tag:[vn.keyword,vn.operator,vn.typeName,vn.tagName,vn.propertyName],color:"#2F6F9F",fontWeight:"bold"},{tag:[vn.attributeName,vn.definition(vn.propertyName)],color:"#4F9FD0"},{tag:[vn.className,vn.string,vn.special(vn.brace)],color:"#CF4F5F"},{tag:vn.number,color:"#CF4F5F",fontWeight:"bold"},{tag:vn.variableName,fontWeight:"bold"}]}),Jm({variant:"light",settings:{background:"#f2f1f8",foreground:"#0c006b",caret:"#5c49e9",selection:"#d5d1f2",gutterBackground:"#f2f1f8",gutterForeground:"#0c006b70",lineHighlight:"#e1def3"},styles:[{tag:vn.comment,color:"#9995b7"},{tag:vn.keyword,color:"#ff5792",fontWeight:"bold"},{tag:[vn.definitionKeyword,vn.modifier],color:"#ff5792"},{tag:[vn.className,vn.tagName,vn.definition(vn.typeName)],color:"#0094f0"},{tag:[vn.number,vn.bool,vn.null,vn.special(vn.brace)],color:"#5842ff"},{tag:[vn.definition(vn.propertyName),vn.function(vn.variableName)],color:"#0095a8"},{tag:vn.typeName,color:"#b3694d"},{tag:[vn.propertyName,vn.variableName],color:"#fa8900"},{tag:vn.operator,color:"#ff5792"},{tag:vn.self,color:"#e64100"},{tag:[vn.string,vn.regexp],color:"#00b368"},{tag:[vn.paren,vn.bracket],color:"#0431fa"},{tag:vn.labelName,color:"#00bdd6"},{tag:vn.attributeName,color:"#e64100"},{tag:vn.angleBracket,color:"#9995b7"}]}),Jm({variant:"light",settings:{background:"#faf4ed",foreground:"#575279",caret:"#575279",selection:"#6e6a8614",gutterBackground:"#faf4ed",gutterForeground:"#57527970",lineHighlight:"#6e6a860d"},styles:[{tag:vn.comment,color:"#9893a5"},{tag:[vn.bool,vn.null],color:"#286983"},{tag:vn.number,color:"#d7827e"},{tag:vn.className,color:"#d7827e"},{tag:[vn.angleBracket,vn.tagName,vn.typeName],color:"#56949f"},{tag:vn.attributeName,color:"#907aa9"},{tag:vn.punctuation,color:"#797593"},{tag:[vn.keyword,vn.modifier],color:"#286983"},{tag:[vn.string,vn.regexp],color:"#ea9d34"},{tag:vn.variableName,color:"#d7827e"}]}),Jm({variant:"light",settings:{background:"#FFFFFF",foreground:"#000000",caret:"#000000",selection:"#FFFD0054",gutterBackground:"#FFFFFF",gutterForeground:"#00000070",lineHighlight:"#00000008"},styles:[{tag:vn.comment,color:"#CFCFCF"},{tag:[vn.number,vn.bool,vn.null],color:"#E66C29"},{tag:[vn.className,vn.definition(vn.propertyName),vn.function(vn.variableName),vn.labelName,vn.definition(vn.typeName)],color:"#2EB43B"},{tag:vn.keyword,color:"#D8B229"},{tag:vn.operator,color:"#4EA44E",fontWeight:"bold"},{tag:[vn.definitionKeyword,vn.modifier],color:"#925A47"},{tag:vn.string,color:"#704D3D"},{tag:vn.typeName,color:"#2F8996"},{tag:[vn.variableName,vn.propertyName],color:"#77ACB0"},{tag:vn.self,color:"#77ACB0",fontWeight:"bold"},{tag:vn.regexp,color:"#E3965E"},{tag:[vn.tagName,vn.angleBracket],color:"#BAA827"},{tag:vn.attributeName,color:"#B06520"},{tag:vn.derefOperator,color:"#000"}]}),Jm({variant:"light",settings:{background:"#fef7e5",foreground:"#586E75",caret:"#000000",selection:"#073642",gutterBackground:"#fef7e5",gutterForeground:"#586E7580",lineHighlight:"#EEE8D5"},styles:[{tag:vn.comment,color:"#93A1A1"},{tag:vn.string,color:"#2AA198"},{tag:vn.regexp,color:"#D30102"},{tag:vn.number,color:"#D33682"},{tag:vn.variableName,color:"#268BD2"},{tag:[vn.keyword,vn.operator,vn.punctuation],color:"#859900"},{tag:[vn.definitionKeyword,vn.modifier],color:"#073642",fontWeight:"bold"},{tag:[vn.className,vn.self,vn.definition(vn.propertyName)],color:"#268BD2"},{tag:vn.function(vn.variableName),color:"#268BD2"},{tag:[vn.bool,vn.null],color:"#B58900"},{tag:vn.tagName,color:"#268BD2",fontWeight:"bold"},{tag:vn.angleBracket,color:"#93A1A1"},{tag:vn.attributeName,color:"#93A1A1"},{tag:vn.typeName,color:"#859900"}]}),Jm({variant:"light",settings:{background:"#FFFFFF",foreground:"#4D4D4C",caret:"#AEAFAD",selection:"#D6D6D6",gutterBackground:"#FFFFFF",gutterForeground:"#4D4D4C80",lineHighlight:"#EFEFEF"},styles:[{tag:vn.comment,color:"#8E908C"},{tag:[vn.variableName,vn.self,vn.propertyName,vn.attributeName,vn.regexp],color:"#C82829"},{tag:[vn.number,vn.bool,vn.null],color:"#F5871F"},{tag:[vn.className,vn.typeName,vn.definition(vn.typeName)],color:"#C99E00"},{tag:[vn.string,vn.special(vn.brace)],color:"#718C00"},{tag:vn.operator,color:"#3E999F"},{tag:[vn.definition(vn.propertyName),vn.function(vn.variableName)],color:"#4271AE"},{tag:vn.keyword,color:"#8959A8"},{tag:vn.derefOperator,color:"#4D4D4C"}]});const Km=Jm({variant:"light",settings:{background:"#ffffff",foreground:"#000000",caret:"#000000",selection:"#d7d4f0",lineHighlight:"#f7f7f7",gutterBackground:"var(--color-background)",gutterForeground:"var(--gray-10)"},styles:[{tag:vn.comment,color:"#708090"},{tag:vn.variableName,color:"#000000"},{tag:[vn.string,vn.special(vn.brace)],color:"#a11"},{tag:vn.number,color:"#164"},{tag:vn.bool,color:"#219"},{tag:vn.null,color:"#219"},{tag:vn.keyword,color:"#708",fontWeight:500},{tag:vn.className,color:"#00f"},{tag:vn.definition(vn.typeName),color:"#00f"},{tag:vn.typeName,color:"#085"},{tag:vn.angleBracket,color:"#000000"},{tag:vn.tagName,color:"#170"},{tag:vn.attributeName,color:"#00c"},{tag:vn.operator,color:"#a2f",fontWeight:500},{tag:[vn.function(vn.variableName)],color:"#00c"},{tag:[vn.propertyName],color:"#05a"}]}),Xm=e=>{const{theme:t,hotkeys:n,completionConfig:o}=e;return[St.lineWrapping,kn(),Nn(),En(),Cn(),jn(),Sn(),In(),An({position:"fixed",parent:document.querySelector("#App")??void 0}),Tn(),"dark"===t?On:Km,Mn(),$m(o),_n(),Pn(),an.high(nn.of(Dn)),Fn(),Ln(),Rn.of("    "),yn(zn,{fallback:!0}),nn.of(Bn),Un(e),Vn.of($n()),Gn.allowMultipleSelections.of(!0),Id(n),nn.of([{key:"Tab",run:e=>Hn(e)||(e=>{const{from:t,to:n}=e.state.selection.main;if(t!==n)return!1;const o=e.state.doc.lineAt(n);return""!==o.text.slice(0,n-o.from).trim()&&Jn(e)})(e)||Wn(e),preventDefault:!0}]),nn.of([...qn,Yn])]};function Zm(e){const t=e.current;if(null===t)throw new ReferenceError("Attempting to dereference null object.");return t}const Qm="ContextMenu",[ep,tp]=Kn(Qm,[Xn]),np=Xn(),[op,rp]=ep(Qm),ap=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,disabled:o=!1,...r}=e,a=rp("ContextMenuTrigger",n),s=np(n),i=S.useRef({x:0,y:0}),l=S.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...i.current})}),c=S.useRef(0),d=S.useCallback((()=>window.clearTimeout(c.current)),[]),u=e=>{i.current={x:e.clientX,y:e.clientY},a.onOpenChange(!0)};return S.useEffect((()=>d),[d]),S.useEffect((()=>{o&&d()}),[o,d]),S.createElement(S.Fragment,null,S.createElement(ho,Qn({},s,{virtualRef:l})),S.createElement(fo.span,Qn({"data-state":a.open?"open":"closed","data-disabled":o?"":void 0},r,{ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:o?e.onContextMenu:mo(e.onContextMenu,(e=>{d(),u(e),e.preventDefault()})),onPointerDown:o?e.onPointerDown:mo(e.onPointerDown,sp((e=>{d(),c.current=window.setTimeout((()=>u(e)),700)}))),onPointerMove:o?e.onPointerMove:mo(e.onPointerMove,sp(d)),onPointerCancel:o?e.onPointerCancel:mo(e.onPointerCancel,sp(d)),onPointerUp:o?e.onPointerUp:mo(e.onPointerUp,sp(d))})))}));function sp(e){return t=>"mouse"!==t.pointerType?e(t):void 0}const ip=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=rp("ContextMenuContent",n),a=np(n),s=S.useRef(!1);return S.createElement(eo,Qn({},a,o,{ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),!t.defaultPrevented&&s.current&&t.preventDefault(),s.current=!1},onInteractOutside:t=>{var n;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||r.modal||(s.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))})),lp=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(to,Qn({},r,o,{ref:t}))})),cp=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(no,Qn({},r,o,{ref:t}))})),dp=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(oo,Qn({},r,o,{ref:t}))})),up=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(ro,Qn({},r,o,{ref:t}))})),hp=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(ao,Qn({},r,o,{ref:t}))})),fp=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(so,Qn({},r,o,{ref:t}))})),mp=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(io,Qn({},r,o,{ref:t}))})),pp=S.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...o}=e,r=np(n);return S.createElement(lo,Qn({},r,o,{ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))})),gp=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:o,dir:r,modal:a=!0}=e,[s,i]=S.useState(!1),l=np(t),c=co(o),d=S.useCallback((e=>{i(e),c(e)}),[c]);return S.createElement(op,{scope:t,open:s,onOpenChange:d,modal:a},S.createElement(uo,Qn({},l,{dir:r,open:s,onOpenChange:d,modal:a}),n))},xp=ap,yp=po((e=>{const{__scopeContextMenu:t,...n}=e,o=np(t);return S.createElement(Zn,Qn({},o,n))}));S.forwardRef((({className:e,inset:t,children:n,...o},r)=>a.jsxs(mp,{ref:r,className:go({className:e,inset:t}),...o,children:[n,a.jsx(xo,{className:"ml-auto h-4 w-4"})]}))).displayName=mp.displayName;const vp="data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2";S.forwardRef((({className:e,...t},n)=>a.jsx(pp,{ref:n,className:Lt(yo({subcontent:!0}),vp,e),...t}))).displayName=pp.displayName;const bp=S.forwardRef((({className:e,...t},n)=>a.jsx(yp,{children:a.jsx(ip,{ref:n,className:Lt(yo(),vp,e),...t})})));bp.displayName=ip.displayName;const wp=S.forwardRef((({className:e,inset:t,variant:n,...o},r)=>a.jsx(cp,{ref:r,className:vo({className:e,inset:t,variant:n}),...o})));wp.displayName=cp.displayName;S.forwardRef((({className:e,children:t,checked:n,...o},r)=>a.jsxs(dp,{ref:r,className:bo({className:e}),checked:n,...o,children:[a.jsx("span",{className:bo(),children:a.jsx(hp,{children:a.jsx(wo,{className:"h-4 w-4"})})}),t]}))).displayName=dp.displayName;S.forwardRef((({className:e,children:t,...n},o)=>a.jsxs(up,{ref:o,className:bo({className:e}),...n,children:[a.jsx("span",{className:bo(),children:a.jsx(hp,{children:a.jsx(ko,{className:"h-4 w-4 fill-current"})})}),t]}))).displayName=up.displayName;S.forwardRef((({className:e,inset:t,...n},o)=>a.jsx(lp,{ref:o,className:No({className:e,inset:t}),...n}))).displayName=lp.displayName;const kp=S.forwardRef((({className:e,...t},n)=>a.jsx(fp,{ref:n,className:Lt(Eo({className:e})),...t})));kp.displayName=fp.displayName;const Np=({appClosed:e,onClick:t,tooltipContent:n})=>a.jsx(Ep,{onClick:t,children:a.jsx(s,{content:n,usePortal:!1,children:a.jsx(Ts,{onClick:()=>null==t?void 0:t({code:""}),className:Lt("shoulder-button hover-action",e&&" inactive-button"),shape:"circle",size:"small",color:"hint-green","data-testid":"create-cell-button",children:a.jsx(Co,{strokeWidth:1.8})})})}),Ep=e=>{const{children:t,onClick:n}=e;return n?a.jsxs(gp,{children:[a.jsx(xp,{children:t}),a.jsxs(bp,{children:[a.jsxs(wp,{onSelect:e=>{e.stopPropagation(),n({code:""})},children:[a.jsx("div",{className:"mr-3",children:a.jsx(Ps,{})}),"Python cell"]},"python"),a.jsxs(wp,{onSelect:e=>{e.stopPropagation(),n({code:(new jo).defaultCode})},children:[a.jsx("div",{className:"mr-3",children:a.jsx(_s,{})}),"Markdown cell"]},"markdown"),a.jsxs(wp,{onSelect:e=>{e.stopPropagation(),n({code:(new So).defaultCode})},children:[a.jsx("div",{className:"mr-3",children:a.jsx(ae,{size:13,strokeWidth:1.5})}),"SQL cell"]},"sql")]})]}):t};const Cp=e=>{const{onClick:t,appClosed:n,needsRun:o,status:r,config:i,edited:l}=e,c="disabled-transitively"===r,d="running"===r||"queued"===r,u=n||d||!i.disabled&&c&&!l,h=function(e,t,n,o){return e?"disabled":t&&!n?"yellow":n||o?"disabled":"hint-green"}(n,o,d,u);if(i.disabled)return a.jsx(s,{content:"Add code to notebook",usePortal:!1,children:a.jsx(Ts,{className:Lt(!o&&"hover-action",u&&"inactive-button"),onClick:t,color:h,shape:"circle",size:"small","data-testid":"run-button",children:a.jsx(vl,{strokeWidth:1.8})})});if(!i.disabled&&c&&!l)return a.jsx(s,{content:"This cell can't be run because it has a disabled ancestor",usePortal:!1,children:a.jsx(Ts,{className:Lt(!o&&"hover-action",u&&"inactive-button"),onClick:t,color:h,shape:"circle",size:"small","data-testid":"run-button",children:a.jsx(Dl,{strokeWidth:1.8})})});let f="";return f=n?"App disconnected":"queued"===r?"This cell is already queued to run":"running"===r?"This cell is already running.":As("cell.run"),a.jsx(s,{content:f,usePortal:!1,children:a.jsx(Ts,{className:Lt(!o&&"running"!==r&&"hover-action",u&&"inactive-button"),onClick:t,color:h,shape:"circle",size:"small","data-testid":"run-button",children:a.jsx(Dl,{strokeWidth:1.8})})})},jp=e=>{const{status:t,appClosed:n,onClick:o}=e,r="running"===t||"queued"===t;let i=null;return i=n?"App disconnected":"running"===t?"A cell can't be deleted when it's running":"queued"===t?"A cell can't be deleted when it's queued to run":"Delete",a.jsx(s,{content:i,usePortal:!1,children:a.jsx(u,{variant:"ghost",size:"icon",onClick:o,"data-testid":"delete-button",className:Lt("hover:bg-transparent text-destructive/60 hover:text-destructive",{DeleteButton:!0,"inactive-button":n||r,running:r}),style:{boxShadow:"none"},children:a.jsx(he,{size:14})})})};const Sp=({editing:e,status:t,disabled:n,staleInputs:o,edited:r,interrupted:i,elapsedTime:l,runStartTimestamp:c,uninstantiated:d})=>{if(!e)return null;if(n&&"running"===t)return f.error("CellStatusComponent: disabled and running"),null;if(n&&o)return a.jsx(s,{content:"This cell is stale, but it's disabled and can't be run",usePortal:!1,children:a.jsx("div",{className:"cell-status-icon cell-status-stale","data-testid":"cell-status","data-status":"stale",children:a.jsxs(yc,{children:[a.jsx(Ki,{className:"h-5 w-5",strokeWidth:1.5}),a.jsx(Ao,{className:"h-3 w-3",strokeWidth:2.5})]})})});if(n)return a.jsx(s,{content:"This cell is disabled",usePortal:!1,children:a.jsx("div",{className:"cell-status-icon cell-status-disabled","data-testid":"cell-status","data-status":"disabled",children:a.jsx(Ki,{className:"h-5 w-5",strokeWidth:1.5})})});if(!o&&"disabled-transitively"===t)return a.jsx(s,{content:"An ancestor of this cell is disabled, so it can't be run",usePortal:!1,children:a.jsx("div",{className:"cell-status-icon cell-status-stale","data-testid":"cell-status","data-status":"disabled-transitively",children:a.jsxs(yc,{layerTop:!0,children:[a.jsx(rc,{className:"h-5 w-5",strokeWidth:1.5}),a.jsx(Ki,{className:"h-3 w-3",strokeWidth:2.5})]})})});if(o&&"disabled-transitively"===t)return a.jsx(s,{content:"This cell is stale, but an ancestor is disabled so it can't be run",usePortal:!1,children:a.jsx("div",{className:"cell-status-icon cell-status-stale","data-testid":"cell-status","data-status":"stale",children:a.jsxs(yc,{children:[a.jsx(Ao,{className:"h-5 w-5",strokeWidth:1}),a.jsx(Ki,{className:"h-3 w-3",strokeWidth:2.5})]})})});if("running"===t)return a.jsx(s,{content:"This cell is running",usePortal:!1,children:a.jsx("div",{className:"cell-status-icon elapsed-time running","data-testid":"cell-status","data-status":"running",children:a.jsx(Ap,{startTime:Io.fromSeconds(c)||Io.now()})})});if("queued"===t)return a.jsx(s,{content:"This cell is queued to run",usePortal:!1,children:a.jsx("div",{className:"cell-status-icon cell-status-queued","data-testid":"cell-status","data-status":"queued",children:a.jsx(yi,{className:"h-5 w-5",strokeWidth:1.5})})});if(r||i||o||d){const e=Ip(l);let t="",n="";return d?t="This cell has not yet been run":i?(t="This cell was interrupted when it was last run",n=`This cell ran for ${e} before being interrupted`):r?(t="This cell has been modified since it was last run",n=`This cell took ${e} to run`):(t="This cell has not been run with the latest inputs",n=`This cell took ${e} to run`),a.jsxs("div",{className:"cell-status-icon flex items-center gap-2",children:[a.jsx(s,{content:t,usePortal:!1,children:a.jsx("div",{className:"cell-status-stale","data-testid":"cell-status","data-status":"outdated",children:a.jsx(Ao,{className:"h-5 w-5",strokeWidth:1.5})})}),e&&a.jsx(s,{content:n,usePortal:!1,children:a.jsx("div",{className:"elapsed-time hover-action","data-testid":"cell-status","data-status":"outdated",children:a.jsx("span",{children:e})})})]})}if(null!==l){const e=Ip(l);return a.jsx(s,{content:`This cell took ${e} to run`,usePortal:!1,children:a.jsx("div",{className:"cell-status-icon elapsed-time hover-action","data-testid":"cell-status","data-status":"idle",children:a.jsx("span",{children:e})})})}return null};function Ip(e){if(null===e)return"";if(e>6e4){const t=(e/6e4).toFixed(0),n=(e%6e4/1e3).toFixed(0);return`${t.toString()}m${n.toString()}s`}return e>1e3?`${(e/1e3).toFixed(2).toString()}s`:`${e.toFixed(0).toString()}ms`}const Ap=e=>{const t=function(e){const t=S.useRef(e),[n,o]=S.useState(e);return S.useEffect((()=>{const e=setInterval((()=>{o(Io.now().toMilliseconds())}),17);return()=>clearInterval(e)}),[]),n-t.current}(e.startTime.toMilliseconds());return a.jsx("span",{children:Ip(t)})};function Tp(...e){return t=>{e.forEach((e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)}))}}const Op=T.createContext(null),Mp=S.memo((()=>S.useContext(Op)));Mp.displayName="DragHandle";const _p=T.forwardRef((({cellId:e,...t},n)=>{const{attributes:o,listeners:r,setNodeRef:s,transform:i,transition:l,isDragging:c}=To({id:e.toString()}),d={transform:i?Oo.Transform.toString({x:0,y:i.y,scaleX:1,scaleY:1}):void 0,transition:l,zIndex:c?2:void 0,position:"relative"},u=Tp(n,s),h=a.jsx("div",{...o,...r,"data-testid":"drag-button",className:"py-[1px] cursor-grab opacity-50 hover:opacity-100 hover-action hover:bg-muted rounded border border-transparent hover:border-border active:bg-accent",children:a.jsx(yl,{strokeWidth:1,size:20})}),f=Boolean(i);return a.jsx("div",{tabIndex:-1,ref:u,...t,className:Lt(t.className,f&&"is-moving"),style:d,children:a.jsx(Op.Provider,{value:h,children:t.children})})}));_p.displayName="SortableCell";const Pp=S.memo(_p),Dp=T.memo(T.forwardRef((({children:e,showTooltip:t=!0,...n},o)=>{const[r,s]=S.useState(!1),i=jc({cell:n}),l=Mo();S.useImperativeHandle(o,(()=>({toggle:()=>s((e=>!e))})));const c=a.jsx(Ht,{className:"w-[300px] p-0 pt-1",...l,children:a.jsxs($t,{children:[a.jsx(Ce,{placeholder:"Search actions...",className:"h-6 m-1"}),a.jsxs(_o,{children:[a.jsx(Se,{children:"No results"}),i.map(((e,t)=>a.jsxs(S.Fragment,{children:[a.jsx(Ie,{children:e.map((e=>a.jsx(Oe,{onSelect:()=>{e.disableClick||(e.handle(),s(!1))},variant:e.variant,children:a.jsxs("div",{className:"flex items-center flex-1",children:[e.icon&&a.jsx("div",{className:"mr-2 w-5",children:e.icon}),a.jsx("div",{className:"flex-1",children:e.label}),a.jsxs("div",{className:"flex-shrink-0 text-sm",children:[e.hotkey&&Ks(e.hotkey),e.rightElement]})]})},e.label)))},t),t<i.length-1&&a.jsx(Te,{})]},t)))]})]})});if(!t)return a.jsxs(Vt,{open:r,onOpenChange:s,children:[a.jsx(Po,{asChild:!0,children:e}),c]});const d=a.jsx(Lo,{className:"w-full bg-card",tabIndex:-1,children:a.jsxs("div",{className:"text-foreground-muted flex flex-col text-center",children:[a.jsxs("span",{children:[a.jsx("span",{className:"text-foreground font-semibold",children:"Drag "}),"to move cell"]}),a.jsxs("span",{children:[a.jsx("span",{className:"text-foreground font-semibold",children:"Click "}),"to open menu"]})]})});return a.jsxs(Vt,{open:r,onOpenChange:s,children:[a.jsxs(Do,{delayDuration:400,disableHoverableContent:!0,children:[!r&&d,a.jsx(Fo,{children:a.jsx(Po,{className:"flex",children:e})})]}),c]})}))),Fp=T.memo((({children:e,cellId:t})=>{const n=W(S.useMemo((()=>function(e){return L((t=>Tc(e,t($))))}(t)),[t]));return n?a.jsx(Dp,{showTooltip:!1,...n,children:e}):null}));Fp.displayName="ConnectionCellActionsDropdown";const Lp=({children:e,...t})=>{const n=jc({cell:t}),[o,r]=T.useState(),s=[{label:"Copy",icon:a.jsx(Fe,{size:13,strokeWidth:1.5}),handle:()=>{document.execCommand("copy")}},{label:"Cut",icon:a.jsx(Ul,{size:13,strokeWidth:1.5}),handle:()=>{document.execCommand("cut")}},{label:"Paste",icon:a.jsx(al,{size:13,strokeWidth:1.5}),handle:async()=>{const{getEditorView:e}=t,n=e();if(!n)return;const o=await navigator.clipboard.readText();if(o){const{from:e,to:t}=n.state.selection.main,r=n.state.update({changes:{from:e,to:t,insert:o}});n.dispatch(r)}}},{icon:a.jsx(ui,{size:13,strokeWidth:1.5}),label:"Download image",hidden:!o,handle:()=>{if(o){const e=document.createElement("a");e.download="image.png",e.href=o.src,e.click()}}},{label:"Go to Definition",icon:a.jsx(Ro,{size:13,strokeWidth:1.5}),handle:()=>{const{getEditorView:e}=t,n=e();n&&zo(n)}}];return a.jsxs(gp,{children:[a.jsx(xp,{onContextMenu:e=>{e.target instanceof HTMLImageElement?r(e.target):r(void 0)},asChild:!0,children:e}),a.jsx(bp,{className:"w-[300px]",children:[s,...n].map(((e,t)=>a.jsxs(S.Fragment,{children:[e.map((e=>e.hidden?null:a.jsx(wp,{onSelect:t=>{e.handle(t)},variant:e.variant,children:a.jsxs("div",{className:"flex items-center flex-1",children:[e.icon&&a.jsx("div",{className:"mr-2 w-5",children:e.icon}),a.jsx("div",{className:"flex-1",children:e.label}),a.jsxs("div",{className:"flex-shrink-0 text-sm",children:[e.hotkey&&Ks(e.hotkey),e.rightElement]})]})},e.label))),t<e.length-1&&a.jsx(kp,{})]},t)))})]})},Rp=({editorView:e,code:t,currentLanguageAdapter:n,onAfterToggle:o})=>{const r=S.useMemo((()=>(new jo).isSupported(t)),[t]),s=S.useMemo((()=>(new So).isSupported(t)),[t]);return a.jsxs("div",{className:"absolute right-2 top-0 z-20 flex hover-action",children:[a.jsx(zp,{editorView:e,currentLanguageAdapter:n,canSwitchToLanguage:s&&"python"===n&&!r,icon:a.jsx(ae,{color:"var(--sky-11)",strokeWidth:2.5,className:"w-4 h-4"}),toType:"sql",displayName:"SQL",onAfterToggle:o}),a.jsx(zp,{editorView:e,currentLanguageAdapter:n,canSwitchToLanguage:r&&"python"===n,icon:a.jsx(_s,{fill:"var(--sky-11)",color:"black",className:"w-4 h-4"}),toType:"markdown",displayName:"Markdown",onAfterToggle:o}),a.jsx(zp,{editorView:e,currentLanguageAdapter:n,canSwitchToLanguage:!0,icon:a.jsx(Ps,{fill:"var(--sky-11)",color:"black",className:"w-4 h-4"}),toType:"python",displayName:"Python",onAfterToggle:Rt.NOOP})]})},zp=({editorView:e,currentLanguageAdapter:t,canSwitchToLanguage:n,icon:o,toType:r,displayName:i,onAfterToggle:l})=>n?t===r?null:a.jsx(s,{content:`View as ${i}`,children:a.jsx(u,{"data-testid":"language-toggle-button",variant:"text",size:"xs",className:"opacity-80 px-1",onClick:()=>{e&&(Bo(e,r),l())},children:o})}):null;var Bp={modified:{doc:""},original:{doc:""}},Up=S.createContext(Bp);function Vp(e,t){return Uo({},e,t,{modified:Uo({},e.modified,t.modified),original:Uo({},e.original,t.original)})}var $p=()=>S.useContext(Up),Gp=e=>{var{children:t,theme:n}=e,[o,r]=S.useReducer(Vp,Uo({},Bp,{theme:n}));return S.useEffect((()=>r({theme:n})),[n]),a.jsx(Up.Provider,{value:Uo({},o,{dispatch:r}),children:t})},Hp=["extensions","value","selection","onChange"],Wp=e=>{var{extensions:t=[],value:n,selection:o,onChange:r}=e,a=Vo(e,Hp),{theme:s,dispatch:i}=$p(),l=$o(Uo({},a,{theme:s})),c=St.updateListener.of((e=>{if(e.docChanged&&"function"==typeof r){var t=e.state.doc.toString();r(t,e)}}));return S.useEffect((()=>i({original:{doc:n,selection:o,extensions:[c,...l,...t]},originalExtension:{onChange:r,option:a,extension:[t,c]}})),[e]),null};Wp.displayName="CodeMirrorMerge.Original";var qp=["extensions","value","selection","onChange"],Yp=e=>{var{extensions:t=[],value:n,selection:o,onChange:r}=e,a=Vo(e,qp),{theme:s,dispatch:i}=$p(),l=$o(Uo({},a,{theme:s})),c=St.updateListener.of((e=>{if(e.docChanged&&"function"==typeof r){var t=e.state.doc.toString();r(t,e)}}));return S.useEffect((()=>i({modified:{doc:n,selection:o,extensions:[c,...l,...t]},modifiedExtension:{onChange:r,option:a,extension:[c,t]}})),[e]),null};Yp.displayName="CodeMirrorMerge.Modified";class Jp{constructor(e,t,n,o){this.fromA=e,this.toA=t,this.fromB=n,this.toB=o}offset(e,t){return new Jp(this.fromA+e,this.toA+e,this.fromB+t,this.toB+t)}}function Kp(e,t,n,o,r,a){if(e==o)return[];let s=og(e,t,n,o,r,a),i=rg(e,t+s,n,o,r+s,a),l=(n-=i)-(t+=s),c=(a-=i)-(r+=s);if(!l||!c)return[new Jp(t,n,r,a)];if(l>c){let s=e.slice(t,n).indexOf(o.slice(r,a));if(s>-1)return[new Jp(t,t+s,r,r),new Jp(t+s+c,n,a,a)]}else if(c>l){let s=o.slice(r,a).indexOf(e.slice(t,n));if(s>-1)return[new Jp(t,t,r,r+s),new Jp(n,n,r+s+l,a)]}if(1==l||1==c)return[new Jp(t,n,r,a)];let d=sg(e,t,n,o,r,a);if(d){let[s,i,l]=d;return Kp(e,t,s,o,r,i).concat(Kp(e,s+l,n,o,i+l,a))}return function(e,t,n,o,r,a){let s=n-t,i=a-r;if(Xp<1e9&&Math.min(s,i)>16*Xp)return Math.min(s,i)>64*Xp?[new Jp(t,n,r,a)]:ig(e,t,n,o,r,a);let l=Math.ceil((s+i)/2);Qp.reset(l),eg.reset(l);let c=(n,a)=>e.charCodeAt(t+n)==o.charCodeAt(r+a),d=(t,r)=>e.charCodeAt(n-t-1)==o.charCodeAt(a-r-1),u=(s-i)%2!=0?eg:null,h=u?null:Qp;for(let f=0;f<l;f++){if(f>Xp)return ig(e,t,n,o,r,a);let m=Qp.advance(f,s,i,l,u,!1,c)||eg.advance(f,s,i,l,h,!0,d);if(m)return tg(e,t,n,t+m[0],o,r,a,r+m[1])}return[new Jp(t,n,r,a)]}(e,t,n,o,r,a)}let Xp=1e9;class Zp{constructor(){this.vec=[]}reset(e){this.len=e<<1;for(let t=0;t<this.len;t++)this.vec[t]=-1;this.vec[e+1]=0,this.start=this.end=0}advance(e,t,n,o,r,a,s){for(let i=-e+this.start;i<=e-this.end;i+=2){let l=o+i,c=i==-e||i!=e&&this.vec[l-1]<this.vec[l+1]?this.vec[l+1]:this.vec[l-1]+1,d=c-i;for(;c<t&&d<n&&s(c,d);)c++,d++;if(this.vec[l]=c,c>t)this.end+=2;else if(d>n)this.start+=2;else if(r){let e=o+(t-n)-i;if(e>=0&&e<this.len&&-1!=r.vec[e])if(a){let n=r.vec[e];if(n>=t-c)return[n,o+n-e]}else{if(c>=t-r.vec[e])return[c,d]}}}return null}}const Qp=new Zp,eg=new Zp;function tg(e,t,n,o,r,a,s,i){let l=!1;return yg(e,o)||++o!=n||(l=!0),yg(r,i)||++i!=s||(l=!0),l?[new Jp(t,n,a,s)]:Kp(e,t,o,r,a,i).concat(Kp(e,o,n,r,i,s))}function ng(e,t){let n=1,o=Math.min(e,t);for(;n<o;)n<<=1;return n}function og(e,t,n,o,r,a){if(t==n||t==a||e.charCodeAt(t)!=o.charCodeAt(r))return 0;let s=ng(n-t,a-r);for(let i=t,l=r;;){let r=i+s,c=l+s;if(r>n||c>a||e.slice(i,r)!=o.slice(l,c)){if(1==s)return i-t-(yg(e,i)?0:1);s>>=1}else{if(r==n||c==a)return r-t;i=r,l=c}}}function rg(e,t,n,o,r,a){if(t==n||r==a||e.charCodeAt(n-1)!=o.charCodeAt(a-1))return 0;let s=ng(n-t,a-r);for(let i=n,l=a;;){let a=i-s,c=l-s;if(a<t||c<r||e.slice(a,i)!=o.slice(c,l)){if(1==s)return n-i-(yg(e,i)?0:1);s>>=1}else{if(a==t||c==r)return n-a;i=a,l=c}}}function ag(e,t,n,o,r,a,s,i){let l=o.slice(r,a),c=null;for(;;){if(c||s<i)return c;for(let i=t+s;;){yg(e,i)||i++;let d=i+s;if(yg(e,d)||(d+=d==i+1?1:-1),d>=n)break;let u=e.slice(i,d),h=-1;for(;-1!=(h=l.indexOf(u,h+1));){let s=og(e,d,n,o,r+h+u.length,a),l=rg(e,t,i,o,r,r+h),f=u.length+s+l;(!c||c[2]<f)&&(c=[i-l,r+h-l,f])}i=d}if(i<0)return c;s>>=1}}function sg(e,t,n,o,r,a){let s=n-t,i=a-r;if(s<i){let s=sg(o,r,a,e,t,n);return s&&[s[1],s[0],s[2]]}return s<4||2*i<s?null:ag(e,t,n,o,r,a,Math.floor(s/4),-1)}function ig(e,t,n,o,r,a){let s,i=n-t,l=a-r;if(i<l){let l=ag(o,r,a,e,t,n,Math.floor(i/6),50);s=l&&[l[1],l[0],l[2]]}else s=ag(e,t,n,o,r,a,Math.floor(l/6),50);if(!s)return[new Jp(t,n,r,a)];let[c,d,u]=s;return Kp(e,t,c,o,r,d).concat(Kp(e,c+u,n,o,d+u,a))}function lg(e,t){for(let n=1;n<e.length;n++){let o=e[n-1],r=e[n];o.toA>r.fromA-t&&o.toB>r.fromB-t&&(e[n-1]=new Jp(o.fromA,r.toA,o.fromB,r.toB),e.splice(n--,1))}}let cg;try{cg=new RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch(rT){}function dg(e){return e>48&&e<58||e>64&&e<91||e>96&&e<123}function ug(e,t){if(t==e.length)return 0;let n=e.charCodeAt(t);return n<192?dg(n)?1:0:cg?gg(n)&&t!=e.length-1?cg.test(e.slice(t,t+2))?2:0:cg.test(String.fromCharCode(n))?1:0:0}function hg(e,t){if(!t)return 0;let n=e.charCodeAt(t-1);return n<192?dg(n)?1:0:cg?xg(n)&&1!=t?cg.test(e.slice(t-2,t))?2:0:cg.test(String.fromCharCode(n))?1:0:0}function fg(e,t,n){if(t==e.length||!hg(e,t))return t;for(let o=t,r=t+n;;){let n=ug(e,o);if(!n)return o;if(o+=n,o>r)return t}}function mg(e,t,n){if(!t||!ug(e,t))return t;for(let o=t,r=t-n;;){let n=hg(e,o);if(!n)return o;if(o-=n,o<r)return t}}function pg(e,t,n){for(let o=t,r=t-n;;){let n=o?e.charCodeAt(o-1):10;if(10==n)return o;if(o--,o<r||32!=n&&9!=n)return t}}const gg=e=>e>=55296&&e<=56319,xg=e=>e>=56320&&e<=57343;function yg(e,t){return!t||t==e.length||!gg(e.charCodeAt(t-1))||!xg(e.charCodeAt(t))}function vg(e,t,n){var o;return Xp=(null!==(o=null==n?void 0:n.scanLimit)&&void 0!==o?o:1e9)>>1,function(e,t,n){for(;;){lg(n,1);let o=!1;for(let r=0;r<n.length;r++){let a,s,i=n[r];(a=og(e,i.fromA,i.toA,t,i.fromB,i.toB))&&(i=n[r]=new Jp(i.fromA+a,i.toA,i.fromB+a,i.toB)),(s=rg(e,i.fromA,i.toA,t,i.fromB,i.toB))&&(i=n[r]=new Jp(i.fromA,i.toA-s,i.fromB,i.toB-s));let l=i.toA-i.fromA,c=i.toB-i.fromB;if(l&&c)continue;let d=i.fromA-(r?n[r-1].toA:0),u=(r<n.length-1?n[r+1].fromA:e.length)-i.toA;if(!d||!u)continue;let h=l?e.slice(i.fromA,i.toA):t.slice(i.fromB,i.toB);d<=h.length&&e.slice(i.fromA-d,i.fromA)==h.slice(h.length-d)?(n[r]=new Jp(i.fromA-d,i.toA-d,i.fromB-d,i.toB-d),o=!0):u<=h.length&&e.slice(i.toA,i.toA+u)==h.slice(0,u)&&(n[r]=new Jp(i.fromA+u,i.toA+u,i.fromB+u,i.toB+u),o=!0)}if(!o)break}return n}(e,t,Kp(e,0,e.length,t,0,t.length))}function bg(e,t,n){return function(e,t,n){for(let o=0,r=0;r<e.length;r++){let a=e[r],s=a.toA-a.fromA,i=a.toB-a.fromB;if(s&&i||s>3||i>3){let l=r==e.length-1?t.length:e[r+1].fromA,c=a.fromA-o,d=l-a.toA,u=mg(t,a.fromA,Math.min(c,5)),h=fg(t,a.toA,Math.min(d,5)),f=a.fromA-u,m=h-a.toA;if(!s||!i){let d,p,g=Math.max(s,i),[x,y,v]=s?[t,a.fromA,a.toA]:[n,a.fromB,a.toB];f&&m?(g>f&&t.slice(u,a.fromA)==x.slice(v-f,v)?(a=e[r]=new Jp(u,u+s,a.fromB-f,a.toB-f),u=a.fromA,h=fg(t,a.toA,Math.min(l-a.toA,5))):g>m&&t.slice(a.toA,h)==x.slice(y,y+m)&&(a=e[r]=new Jp(h-s,h,a.fromB+m,a.toB+m),h=a.toA,u=mg(t,a.fromA,Math.min(a.fromA-o,5))),f=a.fromA-u,m=h-a.toA):f||m||!(p=a.fromA-(d=pg(t,a.fromA,c)))||t.slice(d,a.fromA)!=x.slice(v-p,v)||(a=e[r]=new Jp(d,d+s,a.fromB-p,a.toB-p))}(f||m)&&(a=e[r]=new Jp(a.fromA-f,a.toA+m,a.fromB-f,a.toB+m)),o=a.toA}}return lg(e,3),e}(vg(e,t,n),e,t)}const wg=ln.define({combine:e=>e[0]}),kg=It.define(),Ng=At.define({create:e=>null,update(e,t){for(let n of t.effects)n.is(kg)&&(e=n.value);return e}});class Eg{constructor(e,t,n,o,r){this.changes=e,this.fromA=t,this.toA=n,this.fromB=o,this.toB=r}offset(e,t){return e||t?new Eg(this.changes,this.fromA+e,this.toA+e,this.fromB+t,this.toB+t):this}get endA(){return Math.max(this.fromA,this.toA-1)}get endB(){return Math.max(this.fromB,this.toB-1)}static build(e,t,n){return Sg(bg(e.toString(),t.toString(),n),e,t,0,0)}static updateA(e,t,n,o,r){return Og(Tg(e,o,!0,n.length),e,t,n,r)}static updateB(e,t,n,o,r){return Og(Tg(e,o,!1,t.length),e,t,n,r)}}function Cg(e,t,n,o){let r=n.lineAt(e),a=o.lineAt(t);return r.to==e&&a.to==t&&e<n.length&&t<o.length?[e+1,t+1]:[r.from,a.from]}function jg(e,t,n,o){let r=n.lineAt(e),a=o.lineAt(t);return r.from==e&&a.from==t?[e,t]:[r.to+1,a.to+1]}function Sg(e,t,n,o,r){let a=[];for(let s=0;s<e.length;s++){let i=e[s],[l,c]=Cg(i.fromA+o,i.fromB+r,t,n),[d,u]=jg(i.toA+o,i.toB+r,t,n),h=[i.offset(-l+o,-c+r)];for(;s<e.length-1;){let a=e[s+1],[i,f]=Cg(a.fromA+o,a.fromB+r,t,n);if(i>d+1&&f>u+1)break;h.push(a.offset(-l+o,-c+r)),[d,u]=jg(a.toA+o,a.toB+r,t,n),s++}a.push(new Eg(h,l,Math.max(l,d),c,Math.max(c,u)))}return a}const Ig=1e3;function Ag(e,t,n,o){let r=0,a=e.length;for(;;){if(r==a){let o=0,a=0;r&&({toA:o,toB:a}=e[r-1]);let s=t-(n?o:a);return[o+s,a+s]}let s=r+a>>1,i=e[s],[l,c]=n?[i.fromA,i.toA]:[i.fromB,i.toB];if(l>t)a=s;else{if(!(c<=t))return o?[i.fromA,i.fromB]:[i.toA,i.toB];r=s+1}}}function Tg(e,t,n,o){let r=[];return t.iterChangedRanges(((a,s,i,l)=>{let c=0,d=n?t.length:o,u=0,h=n?o:t.length;a>Ig&&([c,u]=Ag(e,a-Ig,n,!0)),s<t.length-Ig&&([d,h]=Ag(e,s+Ig,n,!1));let f,m=l-i-(s-a),[p,g]=n?[m,0]:[0,m];r.length&&(f=r[r.length-1]).toA>=c?r[r.length-1]={fromA:f.fromA,fromB:f.fromB,toA:d,toB:h,diffA:f.diffA+p,diffB:f.diffB+g}:r.push({fromA:c,toA:d,fromB:u,toB:h,diffA:p,diffB:g})})),r}function Og(e,t,n,o,r){if(!e.length)return t;let a=0,s=0,i=0,l=[];for(let c of e){let e=c.fromA+s,d=c.toA+s+c.diffA,u=c.fromB+i,h=c.toB+i+c.diffB;for(;a<t.length;){let n=t[a];if(n.toA+s<=e&&n.toB+i<=u)l.push(n.offset(s,i));else if(n.fromA+s>d)break;a++}for(let t of Sg(bg(n.sliceString(e,d),o.sliceString(u,h),r),n,o,e,u))l.push(t);for(s+=c.diffA,i+=c.diffB;a<t.length;){let e=t[a];if(e.fromA>d+s&&e.fromB>h+i)break;a++}}for(;a<t.length;)l.push(t[a++].offset(s,i));return l}const Mg=Ot.fromClass(class{constructor(e){({deco:this.deco,gutter:this.gutter}=Bg(e))}update(e){var t,n;(e.docChanged||e.viewportChanged||(t=e.startState,n=e.state,t.field(Ng,!1)!=n.field(Ng,!1))||function(e,t){return e.facet(wg)!=t.facet(wg)}(e.startState,e.state))&&({deco:this.deco,gutter:this.gutter}=Bg(e.view))}},{decorations:e=>e.deco}),_g=an.low(Go({class:"cm-changeGutter",markers:e=>{var t;return(null===(t=e.plugin(Mg))||void 0===t?void 0:t.gutter)||Ho.empty}}));const Pg=Tt.line({class:"cm-changedLine"}),Dg=Tt.mark({class:"cm-changedText"}),Fg=Tt.mark({tagName:"ins",class:"cm-insertedLine"}),Lg=Tt.mark({tagName:"del",class:"cm-deletedLine"}),Rg=new class extends Yo{constructor(){super(...arguments),this.elementClass="cm-changedLineGutter"}};function zg(e,t,n,o,r,a){let s=n?e.fromA:e.fromB,i=n?e.toA:e.toB,l=0;if(s!=i){r.add(s,s,Pg),r.add(s,i,n?Lg:Fg),a&&a.add(s,s,Rg);for(let c=t.iterRange(s,i-1),d=s;!c.next().done;){if(c.lineBreak){d++,r.add(d,d,Pg),a&&a.add(d,d,Rg);continue}let t=d+c.value.length;if(o)for(;l<e.changes.length;){let o=e.changes[l],a=s+(n?o.fromA:o.fromB),i=s+(n?o.toA:o.toB),c=Math.max(d,a),u=Math.min(t,i);if(c<u&&r.add(c,u,Dg),!(i<t))break;l++}d=t}}}function Bg(e){let t=e.state.field(Ng),{side:n,highlightChanges:o,markGutter:r}=e.state.facet(wg),a="a"==n,s=new Mt,i=r?new Mt:null,{from:l,to:c}=e.viewport;for(let d of t){if((a?d.fromA:d.fromB)>=c)break;(a?d.toA:d.toB)>l&&zg(d,e.state.doc,a,o,s,i)}return{deco:s.finish(),gutter:i&&i.finish()}}class Ug extends sn{constructor(e){super(),this.height=e}eq(e){return this.height==e.height}toDOM(){let e=document.createElement("div");return e.className="cm-mergeSpacer",e.style.height=this.height+"px",e}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}const Vg=It.define({map:(e,t)=>e.map(t)}),$g=At.define({create:()=>Tt.none,update:(e,t)=>{for(let n of t.effects)if(n.is(Vg))return n.value;return e.map(t.changes)},provide:e=>St.decorations.from(e)}),Gg=.01;const Hg=It.define({map:(e,t)=>t.mapPos(e)});class Wg extends sn{constructor(e){super(),this.lines=e}eq(e){return this.lines==e.lines}toDOM(e){let t=document.createElement("div");return t.className="cm-collapsedLines",t.textContent="⦚ "+e.state.phrase("$ unchanged lines",this.lines)+" ⦚",t.addEventListener("click",(t=>{let n=e.posAtDOM(t.target);e.dispatch({effects:Hg.of(n)});let{side:o,sibling:r}=e.state.facet(wg);r&&r().dispatch({effects:Hg.of(qg(n,e.state.field(Ng),"a"==o))})})),t}ignoreEvent(e){return e instanceof MouseEvent}get estimatedHeight(){return 27}}function qg(e,t,n){let o=0,r=0;for(let a=0;;a++){let s=a<t.length?t[a]:null;if(!s||(n?s.fromA:s.fromB)>=e)return r+(e-o);[o,r]=n?[s.toA,s.toB]:[s.toB,s.toA]}}const Yg=At.define({create:e=>Tt.none,update(e,t){e=e.map(t.changes);for(let n of t.effects)n.is(Hg)&&(e=e.update({filter:e=>e!=n.value}));return e},provide:e=>St.decorations.from(e)});function Jg({margin:e=3,minSize:t=4}){return Yg.init((n=>function(e,t,n){let o=new Mt,r="a"==e.facet(wg).side,a=e.field(Ng),s=1;for(let i=0;;i++){let l=i<a.length?a[i]:null,c=i?s+t:1,d=l?e.doc.lineAt(r?l.fromA:l.fromB).number-1-t:e.doc.lines,u=d-c+1;if(u>=n&&o.add(e.doc.line(c).from,e.doc.line(d).to,Tt.replace({widget:new Wg(u),block:!0})),!l)break;s=e.doc.lineAt(Math.min(e.doc.length,r?l.toA:l.toB)).number}return o.finish()}(n,e,t)))}const Kg=St.styleModule.of(new Wo({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}})),Xg=St.baseTheme({".cm-mergeView & .cm-scroller, .cm-mergeView &":{height:"auto !important",overflowY:"visible !important"},"&.cm-merge-a .cm-changedLine, .cm-deletedChunk":{backgroundColor:"rgba(160, 128, 100, .08)"},"&.cm-merge-b .cm-changedLine":{backgroundColor:"rgba(100, 160, 128, .08)"},"&light.cm-merge-a .cm-changedText, &light .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText, &dark .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb2266, #22bb2266) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff8866, #88ff8866) bottom/100% 2px no-repeat"},".cm-insertedLine, .cm-deletedLine":{textDecoration:"none"},".cm-deletedChunk":{paddingLeft:"6px","& .cm-chunkButtons":{position:"absolute",insetInlineEnd:"5px"},"& button":{border:"none",cursor:"pointer",color:"white",margin:"0 2px",borderRadius:"3px","&[name=accept]":{background:"#2a2"},"&[name=reject]":{background:"#d43"}}},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer"},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter, &light .cm-deletedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter, &dark .cm-deletedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"}}),Zg=new qo,Qg=new qo;class ex{constructor(e){this.revertDOM=null,this.revertToA=!1,this.revertToLeft=!1,this.measuring=-1,this.diffConf=e.diffConfig;let t=[an.low(Mg),Xg,Kg,$g,St.updateListener.of((e=>{this.measuring<0&&(e.heightChanged||e.viewportChanged)&&!e.transactions.some((e=>e.effects.some((e=>e.is(Vg)))))&&this.measure()}))],n=[wg.of({side:"a",sibling:()=>this.b,highlightChanges:!1!==e.highlightChanges,markGutter:!1!==e.gutter})];!1!==e.gutter&&n.push(_g);let o=Gn.create({doc:e.a.doc,selection:e.a.selection,extensions:[e.a.extensions||[],St.editorAttributes.of({class:"cm-merge-a"}),Qg.of(n),t]}),r=[wg.of({side:"b",sibling:()=>this.a,highlightChanges:!1!==e.highlightChanges,markGutter:!1!==e.gutter})];!1!==e.gutter&&r.push(_g);let a=Gn.create({doc:e.b.doc,selection:e.b.selection,extensions:[e.b.extensions||[],St.editorAttributes.of({class:"cm-merge-b"}),Qg.of(r),t]});this.chunks=Eg.build(o.doc,a.doc,this.diffConf);let s=[Ng.init((()=>this.chunks)),Zg.of(e.collapseUnchanged?Jg(e.collapseUnchanged):[])];o=o.update({effects:It.appendConfig.of(s)}).state,a=a.update({effects:It.appendConfig.of(s)}).state,this.dom=document.createElement("div"),this.dom.className="cm-mergeView",this.editorDOM=this.dom.appendChild(document.createElement("div")),this.editorDOM.className="cm-mergeViewEditors";let i=e.orientation||"a-b",l=document.createElement("div");l.className="cm-mergeViewEditor";let c=document.createElement("div");c.className="cm-mergeViewEditor",this.editorDOM.appendChild("a-b"==i?l:c),this.editorDOM.appendChild("a-b"==i?c:l),this.a=new St({state:o,parent:l,root:e.root,dispatchTransactions:e=>this.dispatch(e,this.a)}),this.b=new St({state:a,parent:c,root:e.root,dispatchTransactions:e=>this.dispatch(e,this.b)}),this.setupRevertControls(!!e.revertControls,"b-to-a"==e.revertControls,e.renderRevertControl),e.parent&&e.parent.appendChild(this.dom),this.scheduleMeasure()}dispatch(e,t){if(e.some((e=>e.docChanged))){let n=e[e.length-1],o=e.reduce(((e,t)=>e.compose(t.changes)),hn.empty(e[0].startState.doc.length));this.chunks=t==this.a?Eg.updateA(this.chunks,n.newDoc,this.b.state.doc,o,this.diffConf):Eg.updateB(this.chunks,this.a.state.doc,n.newDoc,o,this.diffConf),t.update([...e,n.state.update({effects:kg.of(this.chunks)})]);let r=t==this.a?this.b:this.a;r.update([r.state.update({effects:kg.of(this.chunks)})]),this.scheduleMeasure()}else t.update(e)}reconfigure(e){if("diffConfig"in e&&(this.diffConf=e.diffConfig),"orientation"in e){let t="b-a"!=e.orientation;if(t!=(this.editorDOM.firstChild==this.a.dom.parentNode)){let e=this.a.dom.parentNode,n=this.b.dom.parentNode;e.remove(),n.remove(),this.editorDOM.insertBefore(t?e:n,this.editorDOM.firstChild),this.editorDOM.appendChild(t?n:e),this.revertToLeft=!this.revertToLeft,this.revertDOM&&(this.revertDOM.textContent="")}}if("revertControls"in e||"renderRevertControl"in e){let t=!!this.revertDOM,n=this.revertToA,o=this.renderRevert;"revertControls"in e&&(t=!!e.revertControls,n="b-to-a"==e.revertControls),"renderRevertControl"in e&&(o=e.renderRevertControl),this.setupRevertControls(t,n,o)}let t="highlightChanges"in e,n="gutter"in e,o="collapseUnchanged"in e;if(t||n||o){let r=[],a=[];if(t||n){let o=this.a.state.facet(wg),s=n?!1!==e.gutter:o.markGutter,i=t?!1!==e.highlightChanges:o.highlightChanges;r.push(Qg.reconfigure([wg.of({side:"a",sibling:()=>this.b,highlightChanges:i,markGutter:s}),s?_g:[]])),a.push(Qg.reconfigure([wg.of({side:"b",sibling:()=>this.a,highlightChanges:i,markGutter:s}),s?_g:[]]))}if(o){let t=Zg.reconfigure(e.collapseUnchanged?Jg(e.collapseUnchanged):[]);r.push(t),a.push(t)}this.a.dispatch({effects:r}),this.b.dispatch({effects:a})}this.scheduleMeasure()}setupRevertControls(e,t,n){this.revertToA=t,this.revertToLeft=this.revertToA==(this.editorDOM.firstChild==this.a.dom.parentNode),this.renderRevert=n,!e&&this.revertDOM?(this.revertDOM.remove(),this.revertDOM=null):e&&!this.revertDOM?(this.revertDOM=this.editorDOM.insertBefore(document.createElement("div"),this.editorDOM.firstChild.nextSibling),this.revertDOM.addEventListener("mousedown",(e=>this.revertClicked(e))),this.revertDOM.className="cm-merge-revert"):this.revertDOM&&(this.revertDOM.textContent="")}scheduleMeasure(){if(this.measuring<0){let e=this.dom.ownerDocument.defaultView||window;this.measuring=e.requestAnimationFrame((()=>{this.measuring=-1,this.measure()}))}}measure(){!function(e,t,n){let o=new Mt,r=new Mt,a=e.state.field($g).iter(),s=t.state.field($g).iter(),i=0,l=0,c=0,d=0;for(let m=0;;m++){let u=m<n.length?n[m]:null;if(i<(u?u.fromA:e.state.doc.length)){let n=e.lineBlockAt(i).top+c-(t.lineBlockAt(l).top+d);n<-.01?(c-=n,o.add(i,i,Tt.widget({widget:new Ug(-n),block:!0,side:-1}))):n>Gg&&(d+=n,r.add(l,l,Tt.widget({widget:new Ug(n),block:!0,side:-1})))}if(!u)break;for(i=u.toA,l=u.toB;a.value&&a.from<i;)c-=a.value.spec.widget.height,a.next();for(;s.value&&s.from<l;)d-=s.value.spec.widget.height,s.next()}for(;a.value;)c-=a.value.spec.widget.height,a.next();for(;s.value;)d-=s.value.spec.widget.height,s.next();let u=e.contentHeight+c-(t.contentHeight+d);u<Gg?o.add(e.state.doc.length,e.state.doc.length,Tt.widget({widget:new Ug(-u),block:!0,side:1})):u>Gg&&r.add(t.state.doc.length,t.state.doc.length,Tt.widget({widget:new Ug(u),block:!0,side:1}));let h=o.finish(),f=r.finish();Ho.eq([h],[e.state.field($g)])||e.dispatch({effects:Vg.of(h)}),Ho.eq([f],[t.state.field($g)])||t.dispatch({effects:Vg.of(f)})}(this.a,this.b,this.chunks),this.revertDOM&&this.updateRevertButtons()}updateRevertButtons(){let e=this.revertDOM,t=e.firstChild,n=this.a.viewport,o=this.b.viewport;for(let r=0;r<this.chunks.length;r++){let a=this.chunks[r];if(a.fromA>n.to||a.fromB>o.to)break;if(a.fromA<n.from||a.fromB<o.from)continue;let s=this.a.lineBlockAt(a.fromA).top+"px";for(;t&&+t.dataset.chunk<r;)t=tx(t);t&&t.dataset.chunk==String(r)?(t.style.top!=s&&(t.style.top=s),t=t.nextSibling):e.insertBefore(this.renderRevertButton(s,r),t)}for(;t;)t=tx(t)}renderRevertButton(e,t){let n;if(this.renderRevert)n=this.renderRevert();else{n=document.createElement("button");let e=this.a.state.phrase("Revert this chunk");n.setAttribute("aria-label",e),n.setAttribute("title",e),n.textContent=this.revertToLeft?"⇜":"⇝"}return n.style.top=e,n.setAttribute("data-chunk",String(t)),n}revertClicked(e){let t,n=e.target;for(;n&&n.parentNode!=this.revertDOM;)n=n.parentNode;if(n&&(t=this.chunks[n.dataset.chunk])){let[n,o,r,a,s,i]=this.revertToA?[this.b,this.a,t.fromB,t.toB,t.fromA,t.toA]:[this.a,this.b,t.fromA,t.toA,t.fromB,t.toB],l=n.state.sliceDoc(r,Math.max(r,a-1));r!=a&&i<=o.state.doc.length&&(l+=n.state.lineBreak),o.dispatch({changes:{from:s,to:Math.min(o.state.doc.length,i),insert:l},userEvent:"revert"}),e.preventDefault()}}destroy(){this.a.destroy(),this.b.destroy(),this.measuring>-1&&(this.dom.ownerDocument.defaultView||window).cancelAnimationFrame(this.measuring),this.dom.remove()}}function tx(e){let t=e.nextSibling;return e.remove(),t}var nx=["className","children","orientation","revertControls","highlightChanges","gutter","collapseUnchanged","destroyRerender","renderRevertControl"],ox=["modified","modifiedExtension","original","originalExtension","theme","dispatch"],rx=T.forwardRef(((e,t)=>{var{className:n,children:o,orientation:r,revertControls:s,highlightChanges:i,gutter:l,collapseUnchanged:c,destroyRerender:d=!0,renderRevertControl:u}=e,h=Vo(e,nx),f=$p(),{modified:m,modifiedExtension:p,original:g,originalExtension:x,theme:y,dispatch:v}=f,b=Vo(f,ox),w=S.useRef(null),k=S.useRef(),N={orientation:r,revertControls:s,highlightChanges:i,gutter:l,collapseUnchanged:c,renderRevertControl:u};S.useImperativeHandle(t,(()=>({container:w.current,view:k.current,modified:m,original:g,config:Uo({a:g,b:m,parent:w.current},N)})),[w,k,m,g,N]),S.useEffect((()=>{!k.current&&w.current&&(k.current=new ex(Uo({a:Uo({},g,{extensions:[...(null==x?void 0:x.extension)||[],...$o(Uo({},null==x?void 0:x.option,{theme:y}))]}),b:Uo({},m,{extensions:[...(null==p?void 0:p.extension)||[],...$o(Uo({},null==p?void 0:p.option,{theme:y}))]}),parent:w.current},N)))}),[k,w]),S.useEffect((()=>{if(g&&g.doc&&k.current){var e,t,n=null==(e=k.current)?void 0:e.a.state.doc.toString();if(n!==g.doc)null==(t=k.current)||t.a.dispatch({changes:{from:0,to:n.length,insert:g.doc||""}})}if(m&&m.doc&&k.current){var o,r,a=null==(o=k.current)?void 0:o.b.state.doc.toString();if(a!==m.doc)null==(r=k.current)||r.b.dispatch({changes:{from:0,to:a.length,insert:m.doc||""}})}if(d&&k.current){var s=k.current.a.state.selection.ranges[0].from,i=k.current.b.state.selection.ranges[0].from;k.current.destroy(),k.current=new ex(Uo({a:Uo({},g,{extensions:[...(null==x?void 0:x.extension)||[],...$o(Uo({},null==x?void 0:x.option,{theme:y}))]}),b:Uo({},m,{extensions:[...(null==p?void 0:p.extension)||[],...$o(Uo({},null==p?void 0:p.option,{theme:y}))]}),parent:w.current},N)),s&&(k.current.a.focus(),k.current.a.dispatch({selection:{anchor:s,head:s}})),i&&(k.current.b.focus(),k.current.b.dispatch({selection:{anchor:i,head:i}}))}}),[k,y,w.current,g,m,x,p,d]),S.useEffect((()=>()=>k.current&&k.current.destroy()),[]),S.useEffect((()=>{if(k.current){var e={};b.orientation!==r&&(e.orientation=r),b.revertControls!==s&&(e.revertControls=s),b.highlightChanges!==i&&(e.highlightChanges=i),b.gutter!==l&&(e.gutter=l),b.collapseUnchanged!==c&&(e.collapseUnchanged=c),b.renderRevertControl!==u&&(e.collapseUnchanged=c),Object.keys(e).length&&v&&k.current&&(k.current.reconfigure(Uo({},e)),v(Uo({},e)))}}),[v,k,r,s,i,l,c,u]);return a.jsx("div",Uo({ref:w,className:"cm-merge-theme"+(n?" "+n:"")},h,{children:o}))}));rx.displayName="CodeMirrorMerge.Internal";var ax=["theme"],sx=T.forwardRef(((e,t)=>{var{theme:n}=e,o=Vo(e,ax);return a.jsx(Gp,{theme:n,children:a.jsx(rx,Uo({},o,{ref:t}))})}));sx.Original=Wp,sx.Modified=Yp,sx.displayName="CodeMirrorMerge";var ix={exports:{}};const lx="undefined"!=typeof Buffer,cx=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,dx=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function ux(e,t,n){null==n&&null!==t&&"object"==typeof t&&(n=t,t=void 0),lx&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));const o=JSON.parse(e,t);if(null===o||"object"!=typeof o)return o;const r=n&&n.protoAction||"error",a=n&&n.constructorAction||"error";if("ignore"===r&&"ignore"===a)return o;if("ignore"!==r&&"ignore"!==a){if(!1===cx.test(e)&&!1===dx.test(e))return o}else if("ignore"!==r&&"ignore"===a){if(!1===cx.test(e))return o}else if(!1===dx.test(e))return o;return hx(o,{protoAction:r,constructorAction:a,safe:n&&n.safe})}function hx(e,{protoAction:t="error",constructorAction:n="error",safe:o}={}){let r=[e];for(;r.length;){const e=r;r=[];for(const a of e){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(a,"__proto__")){if(!0===o)return null;if("error"===t)throw new SyntaxError("Object contains forbidden prototype property");delete a.__proto__}if("ignore"!==n&&Object.prototype.hasOwnProperty.call(a,"constructor")&&Object.prototype.hasOwnProperty.call(a.constructor,"prototype")){if(!0===o)return null;if("error"===n)throw new SyntaxError("Object contains forbidden prototype property");delete a.constructor}for(const e in a){const t=a[e];t&&"object"==typeof t&&r.push(t)}}}return e}function fx(e,t,n){const o=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ux(e,t,n)}finally{Error.stackTraceLimit=o}}ix.exports=fx,ix.exports.default=fx,ix.exports.parse=fx,ix.exports.safeParse=function(e,t){const n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ux(e,t,{safe:!0})}catch(o){return null}finally{Error.stackTraceLimit=n}},ix.exports.scan=hx;var mx={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},px={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw new Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},gx={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},xx={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},yx={code:"4",name:"assistant_message",parse:e=>{if(!(null!=e&&"object"==typeof e&&"id"in e&&"role"in e&&"content"in e&&"string"==typeof e.id&&"string"==typeof e.role&&"assistant"===e.role&&Array.isArray(e.content)&&e.content.every((e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},vx={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},bx={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},wx={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some((e=>!(null!=e&&"object"==typeof e&&"id"in e&&"string"==typeof e.id&&"type"in e&&"string"==typeof e.type&&"function"in e&&null!=e.function&&"object"==typeof e.function&&"arguments"in e.function&&"string"==typeof e.function.name&&"string"==typeof e.function.arguments))))throw new Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},kx={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Nx={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Ex={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},Cx={code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},jx={code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},Sx={code:"d",name:"finish_message",parse:e=>{if(!(null!=e&&"object"==typeof e&&"finishReason"in e&&"string"==typeof e.finishReason&&"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage))throw new Error('"finish_message" parts expect an object with a "finishReason" and "usage" property.');return"number"!=typeof e.usage.promptTokens&&(e.usage.promptTokens=Number.NaN),"number"!=typeof e.usage.completionTokens&&(e.usage.completionTokens=Number.NaN),{type:"finish_message",value:e}}},Ix=[mx,px,gx,xx,yx,vx,bx,wx,kx,Nx,Ex,Cx,jx,Sx],Ax={[mx.code]:mx,[px.code]:px,[gx.code]:gx,[xx.code]:xx,[yx.code]:yx,[vx.code]:vx,[bx.code]:bx,[wx.code]:wx,[kx.code]:kx,[Nx.code]:Nx,[Ex.code]:Ex,[Cx.code]:Cx,[jx.code]:jx,[Sx.code]:Sx},Tx=Ix.map((e=>e.code)),Ox=e=>{const t=e.indexOf(":");if(-1===t)throw new Error("Failed to parse stream string. No separator found.");const n=e.slice(0,t);if(!Tx.includes(n))throw new Error(`Failed to parse stream string. Invalid code ${n}.`);const o=n,r=e.slice(t+1),a=JSON.parse(r);return Ax[o].parse(a)},Mx="\n".charCodeAt(0);function _x(e,t){const n=new Uint8Array(t);let o=0;for(const r of e)n.set(r,o),o+=r.length;return e.length=0,n}var Px=()=>fetch;async function Dx({api:e,prompt:t,credentials:n,headers:o,body:r,streamProtocol:a="data",setCompletion:s,setLoading:i,setError:l,setAbortController:c,onResponse:d,onFinish:u,onError:h,onData:f,fetch:m=Px()}){try{i(!0),l(void 0);const h=new AbortController;c(h),s("");const g=await m(e,{method:"POST",body:JSON.stringify({prompt:t,...r}),credentials:n,headers:{"Content-Type":"application/json",...o},signal:h.signal}).catch((e=>{throw e}));if(d)try{await d(g)}catch(p){throw p}if(!g.ok)throw new Error(await g.text()||"Failed to fetch the chat response.");if(!g.body)throw new Error("The response body is empty.");let x="";const y=g.body.getReader();switch(a){case"text":{const e=function(e){const t=new TextDecoder;return function(e){return e?t.decode(e,{stream:!0}):""}}();for(;;){const{done:t,value:n}=await y.read();if(t)break;if(x+=e(n),s(x),null===h){y.cancel();break}}break}case"data":for await(const{type:e,value:t}of async function*(e,{isAborted:t}={}){const n=new TextDecoder,o=[];let r=0;for(;;){const{value:a}=await e.read();if(a&&(o.push(a),r+=a.length,a[a.length-1]!==Mx))continue;if(0===o.length)break;const s=_x(o,r);r=0;const i=n.decode(s,{stream:!0}).split("\n").filter((e=>""!==e)).map(Ox);for(const e of i)yield e;if(null==t?void 0:t()){e.cancel();break}}}(y,{isAborted:()=>null===h}))switch(e){case"text":x+=t,s(x);break;case"data":null==f||f(t)}break;default:throw new Error(`Unknown stream protocol: ${a}`)}return u&&u(t,x),c(null),x}catch(p){if("AbortError"===p.name)return c(null),null;p instanceof Error&&h&&h(p),l(p)}finally{i(!1)}}const Fx=()=>{},Lx=Fx(),Rx=Object,zx=e=>e===Lx,Bx=e=>"function"==typeof e,Ux=(e,t)=>({...e,...t}),Vx=new WeakMap;let $x=0;const Gx=e=>{const t=typeof e,n=e&&e.constructor,o=n==Date;let r,a;if(Rx(e)!==e||o||n==RegExp)r=o?e.toJSON():"symbol"==t?e.toString():"string"==t?JSON.stringify(e):""+e;else{if(r=Vx.get(e),r)return r;if(r=++$x+"~",Vx.set(e,r),n==Array){for(r="@",a=0;a<e.length;a++)r+=Gx(e[a])+",";Vx.set(e,r)}if(n==Rx){r="#";const t=Rx.keys(e).sort();for(;!zx(a=t.pop());)zx(e[a])||(r+=a+":"+Gx(e[a])+",");Vx.set(e,r)}}return r},Hx=new WeakMap,Wx={},qx={},Yx="undefined",Jx=typeof window!=Yx,Kx=typeof document!=Yx,Xx=(e,t)=>{const n=Hx.get(e);return[()=>!zx(t)&&e.get(t)||Wx,o=>{if(!zx(t)){const r=e.get(t);t in qx||(qx[t]=r),n[5](t,Ux(r,o),r||Wx)}},n[6],()=>!zx(t)&&t in qx?qx[t]:!zx(t)&&e.get(t)||Wx]};let Zx=!0;const[Qx,ey]=Jx&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Fx,Fx],ty={isOnline:()=>Zx,isVisible:()=>{const e=Kx&&document.visibilityState;return zx(e)||"hidden"!==e}},ny={initFocus:e=>(Kx&&document.addEventListener("visibilitychange",e),Qx("focus",e),()=>{Kx&&document.removeEventListener("visibilitychange",e),ey("focus",e)}),initReconnect:e=>{const t=()=>{Zx=!0,e()},n=()=>{Zx=!1};return Qx("online",t),Qx("offline",n),()=>{ey("online",t),ey("offline",n)}}},oy=!T.useId,ry=!Jx||"Deno"in window,ay=e=>Jx&&typeof window.requestAnimationFrame!=Yx?window.requestAnimationFrame(e):setTimeout(e,1),sy=ry?S.useEffect:S.useLayoutEffect,iy="undefined"!=typeof navigator&&navigator.connection,ly=!ry&&iy&&(["slow-2g","2g"].includes(iy.effectiveType)||iy.saveData),cy=e=>{if(Bx(e))try{e=e()}catch(n){e=""}const t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?Gx(e):"",t]};let dy=0;const uy=()=>++dy;var hy=3,fy=0,my=2,py=1;async function gy(...e){const[t,n,o,r]=e,a=Ux({populateCache:!0,throwOnError:!0},"boolean"==typeof r?{revalidate:r}:r||{});let s=a.populateCache;const i=a.rollbackOnError;let l=a.optimisticData;const c=a.throwOnError;if(Bx(n)){const e=n,o=[],r=t.keys();for(const n of r)!/^\$(inf|sub)\$/.test(n)&&e(t.get(n)._k)&&o.push(n);return Promise.all(o.map(d))}return d(n);async function d(n){const[r]=cy(n);if(!r)return;const[d,u]=Xx(t,r),[h,f,m,p]=Hx.get(t),g=()=>{const e=h[r];return(Bx(a.revalidate)?a.revalidate(d().data,n):!1!==a.revalidate)&&(delete m[r],delete p[r],e&&e[0])?e[0](2).then((()=>d().data)):d().data};if(e.length<3)return g();let x,y=o;const v=uy();f[r]=[v,0];const b=!zx(l),w=d(),k=w.data,N=w._c,E=zx(N)?k:N;if(b&&(l=Bx(l)?l(E,k):l,u({data:l,_c:E})),Bx(y))try{y=y(E)}catch(C){x=C}if(y&&Bx(y.then)){if(y=await y.catch((e=>{x=e})),v!==f[r][0]){if(x)throw x;return y}x&&b&&(e=>"function"==typeof i?i(e):!1!==i)(x)&&(s=!0,u({data:E,_c:Lx}))}if(s&&!x)if(Bx(s)){const e=s(y,E);u({data:e,error:Lx,_c:Lx})}else u({data:y,error:Lx,_c:Lx});if(f[r][1]=uy(),Promise.resolve(g()).then((()=>{u({_c:Lx})})),!x)return y;if(c)throw x}}const xy=(e,t)=>{for(const n in e)e[n][0]&&e[n][0](t)},[yy,vy]=((e,t)=>{if(!Hx.has(e)){const n=Ux(ny,t),o={},r=gy.bind(Lx,e);let a=Fx;const s={},i=(e,t)=>{const n=s[e]||[];return s[e]=n,n.push(t),()=>n.splice(n.indexOf(t),1)},l=(t,n,o)=>{e.set(t,n);const r=s[t];if(r)for(const e of r)e(n,o)},c=()=>{if(!Hx.has(e)&&(Hx.set(e,[o,{},{},{},r,l,i]),!ry)){const t=n.initFocus(setTimeout.bind(Lx,xy.bind(Lx,o,0))),r=n.initReconnect(setTimeout.bind(Lx,xy.bind(Lx,o,1)));a=()=>{t&&t(),r&&r(),Hx.delete(e)}}};return c(),[e,r,c,a]}return[e,Hx.get(e)[4]]})(new Map),by=Ux({onLoadingSlow:Fx,onSuccess:Fx,onError:Fx,onErrorRetry:(e,t,n,o,r)=>{const a=n.errorRetryCount,s=r.retryCount,i=~~((Math.random()+.5)*(1<<(s<8?s:8)))*n.errorRetryInterval;!zx(a)&&s>a||setTimeout(o,i,r)},onDiscarded:Fx,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:ly?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:ly?5e3:3e3,compare:(e,t)=>Gx(e)==Gx(t),isPaused:()=>!1,cache:yy,mutate:vy,fallback:{}},ty),wy=S.createContext({}),ky=Jx&&window.__SWR_DEVTOOLS_USE__,Ny=ky?window.__SWR_DEVTOOLS_USE__:[],Ey=Ny.concat((e=>(t,n,o)=>e(t,n&&((...e)=>{const[o]=cy(t),[,,,r]=Hx.get(yy);if(o.startsWith("$inf$"))return n(...e);const a=r[o];return zx(a)?n(...e):(delete r[o],a)}),o)));ky&&(window.__SWR_DEVTOOLS_REACT__=T);const Cy=T.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;throw"rejected"===e.status?e.reason:(e.status="pending",e.then((t=>{e.status="fulfilled",e.value=t}),(t=>{e.status="rejected",e.reason=t})),e)}),jy={dedupe:!0},Sy=(Iy=(e,t,n)=>{const{cache:o,compare:r,suspense:a,fallbackData:s,revalidateOnMount:i,revalidateIfStale:l,refreshInterval:c,refreshWhenHidden:d,refreshWhenOffline:u,keepPreviousData:h}=n,[f,m,p,g]=Hx.get(o),[x,y]=cy(e),v=S.useRef(!1),b=S.useRef(!1),w=S.useRef(x),k=S.useRef(t),N=S.useRef(n),E=()=>N.current,C=()=>E().isVisible()&&E().isOnline(),[j,I,A,T]=Xx(o,x),O=S.useRef({}).current,M=zx(s)?n.fallback[x]:s,_=(e,t)=>{for(const n in O){const o=n;if("data"===o){if(!r(e[o],t[o])){if(!zx(e[o]))return!1;if(!r(V,t[o]))return!1}}else if(t[o]!==e[o])return!1}return!0},P=S.useMemo((()=>{const e=!!x&&!!t&&(zx(i)?!E().isPaused()&&!a&&(!!zx(l)||l):i),n=t=>{const n=Ux(t);return delete n._k,e?{isValidating:!0,isLoading:!0,...n}:n},o=j(),r=T(),s=n(o),c=o===r?s:n(r);let d=s;return[()=>{const e=n(j());return _(e,d)?(d.data=e.data,d.isLoading=e.isLoading,d.isValidating=e.isValidating,d.error=e.error,d):(d=e,e)},()=>c]}),[o,x]),D=Jo.useSyncExternalStore(S.useCallback((e=>A(x,((t,n)=>{_(n,t)||e()}))),[o,x]),P[0],P[1]),F=!v.current,L=f[x]&&f[x].length>0,R=D.data,z=zx(R)?M:R,B=D.error,U=S.useRef(z),V=h?zx(R)?U.current:R:z,$=!(L&&!zx(B))&&(F&&!zx(i)?i:!E().isPaused()&&(a?!zx(z)&&l:zx(z)||l)),G=!!(x&&t&&F&&$),H=zx(D.isValidating)?G:D.isValidating,W=zx(D.isLoading)?G:D.isLoading,q=S.useCallback((async e=>{const t=k.current;if(!x||!t||b.current||E().isPaused())return!1;let o,a,s=!0;const i=e||{},l=!p[x]||!i.dedupe,c=()=>oy?!b.current&&x===w.current&&v.current:x===w.current,d={isValidating:!1,isLoading:!1},u=()=>{I(d)},h=()=>{const e=p[x];e&&e[1]===a&&delete p[x]},g={isValidating:!0};zx(j().data)&&(g.isLoading=!0);try{if(l&&(I(g),n.loadingTimeout&&zx(j().data)&&setTimeout((()=>{s&&c()&&E().onLoadingSlow(x,n)}),n.loadingTimeout),p[x]=[t(y),uy()]),[o,a]=p[x],o=await o,l&&setTimeout(h,n.dedupingInterval),!p[x]||p[x][1]!==a)return l&&c()&&E().onDiscarded(x),!1;d.error=Lx;const e=m[x];if(!zx(e)&&(a<=e[0]||a<=e[1]||0===e[1]))return u(),l&&c()&&E().onDiscarded(x),!1;const i=j().data;d.data=r(i,o)?i:o,l&&c()&&E().onSuccess(o,x,n)}catch(N){h();const e=E(),{shouldRetryOnError:t}=e;e.isPaused()||(d.error=N,l&&c()&&(e.onError(N,x,e),(!0===t||Bx(t)&&t(N))&&(E().revalidateOnFocus&&E().revalidateOnReconnect&&!C()||e.onErrorRetry(N,x,e,(e=>{const t=f[x];t&&t[0]&&t[0](hy,e)}),{retryCount:(i.retryCount||0)+1,dedupe:!0}))))}return s=!1,u(),!0}),[x,o]),Y=S.useCallback(((...e)=>gy(o,w.current,...e)),[]);if(sy((()=>{k.current=t,N.current=n,zx(R)||(U.current=R)})),sy((()=>{if(!x)return;const e=q.bind(Lx,jy);let t=0;const n=((e,t,n)=>{const o=t[e]||(t[e]=[]);return o.push(n),()=>{const e=o.indexOf(n);e>=0&&(o[e]=o[o.length-1],o.pop())}})(x,f,((n,o={})=>{if(n==fy){const n=Date.now();E().revalidateOnFocus&&n>t&&C()&&(t=n+E().focusThrottleInterval,e())}else if(n==py)E().revalidateOnReconnect&&C()&&e();else{if(n==my)return q();if(n==hy)return q(o)}}));return b.current=!1,w.current=x,v.current=!0,I({_k:y}),$&&(zx(z)||ry?e():ay(e)),()=>{b.current=!0,n()}}),[x]),sy((()=>{let e;function t(){const t=Bx(c)?c(j().data):c;t&&-1!==e&&(e=setTimeout(n,t))}function n(){j().error||!d&&!E().isVisible()||!u&&!E().isOnline()?t():q(jy).then(t)}return t(),()=>{e&&(clearTimeout(e),e=-1)}}),[c,d,u,x]),S.useDebugValue(V),a&&zx(z)&&x){if(!oy&&ry)throw new Error("Fallback data is required when using suspense in SSR.");k.current=t,N.current=n,b.current=!1;const e=g[x];if(!zx(e)){const t=Y(e);Cy(t)}if(!zx(B))throw B;{const e=q(jy);zx(V)||(e.status="fulfilled",e.value=!0),Cy(e)}}return{mutate:Y,get data(){return O.data=!0,V},get error(){return O.error=!0,B},get isValidating(){return O.isValidating=!0,H},get isLoading(){return O.isLoading=!0,W}}},function(...e){const t=Ux(by,S.useContext(wy)),[n,o,r]=(e=>Bx(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}])(e),a=((e,t)=>{const n=Ux(e,t);if(t){const{use:o,fallback:r}=e,{use:a,fallback:s}=t;o&&a&&(n.use=o.concat(a)),r&&s&&(n.fallback=Ux(r,s))}return n})(t,r);let s=Iy;const{use:i}=a,l=(i||[]).concat(Ey);for(let c=l.length;c--;)s=l[c](s);return s(n,o||a.fetcher||null,a)});var Iy;var Ay=function({api:e="/api/completion",id:t,initialCompletion:n="",initialInput:o="",credentials:r,headers:a,body:s,streamMode:i,streamProtocol:l,fetch:c,onResponse:d,onFinish:u,onError:h}={}){i&&(null!=l||(l="text"===i?"text":void 0));const f=S.useId(),m=t||f,{data:p,mutate:g}=Sy([e,m],null,{fallbackData:n}),{data:x=!1,mutate:y}=Sy([m,"loading"],null),{data:v,mutate:b}=Sy([m,"streamData"],null),[w,k]=S.useState(void 0),N=p,[E,C]=S.useState(null),j=S.useRef({credentials:r,headers:a,body:s});S.useEffect((()=>{j.current={credentials:r,headers:a,body:s}}),[r,a,s]);const I=S.useCallback((async(t,n)=>Dx({api:e,prompt:t,credentials:j.current.credentials,headers:{...j.current.headers,...null==n?void 0:n.headers},body:{...j.current.body,...null==n?void 0:n.body},streamProtocol:l,fetch:c,setCompletion:e=>g(e,!1),setLoading:y,setError:k,setAbortController:C,onResponse:d,onFinish:u,onError:h,onData:e=>{b([...v||[],...e||[]],!1)}})),[g,y,e,j,C,d,u,h,k,v,l,c,b]),A=S.useCallback((()=>{E&&(E.abort(),C(null))}),[E]),T=S.useCallback((e=>{g(e,!1)}),[g]),O=S.useCallback((async(e,t)=>I(e,t)),[I]),[M,_]=S.useState(o),P=S.useCallback((e=>{var t;return null==(t=null==e?void 0:e.preventDefault)||t.call(e),M?O(M):void 0}),[M,O]);return{completion:N,complete:O,error:w,setCompletion:T,stop:A,input:M,setInput:_,handleInputChange:e=>{_(e.target.value)},handleSubmit:P,isLoading:x,data:v}};const Ty=sx.Original,Oy=sx.Modified,My=[Ko(),St.lineWrapping],_y=({onChange:e,initialPrompt:t,currentLanguageAdapter:n,currentCode:o,declineChange:r,acceptChange:i,enabled:l,children:c})=>{const[d,h]=be(wc),{completion:f,input:m,stop:p,isLoading:g,setCompletion:x,setInput:y,handleInputChange:v,handleSubmit:b}=Ay({api:Xo("api/ai/completion").toString(),headers:Zo.headers(),initialInput:t,streamMode:"text",body:{includeOtherCode:d?$s(o):"",code:o,language:n},onError:e=>{U({title:"Completion failed",description:Qo(e)})}}),w=T.useRef(null);S.useEffect((()=>{l&&w.current&&(w.current.focus(),w.current.select())}),[l]),S.useEffect((()=>{l&&y(t||"")}),[l,t,y]);const{theme:k}=pe();return a.jsxs("div",{className:"flex flex-col w-full rounded-[inherit] overflow-hidden",children:[a.jsx("div",{className:Lt("flex items-center gap-2 border-b px-3 transition-[height] rounded-[inherit] rounded-b-none duration-300 overflow-hidden",l&&"h-10 visible",!l&&"h-0 invisible"),children:l&&a.jsxs(a.Fragment,{children:[a.jsx(Gl,{className:"text-[var(--blue-10)] flex-shrink-0",size:16}),a.jsx("input",{className:"h-8 outline-none px-2 focus-visible:shadow-none flex-1 rounded-none border-none focus:border-none",value:m,ref:w,onChange:v,placeholder:"Type for completion",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),b(e)),"Escape"===e.key&&(e.preventDefault(),r(),x(""))}}),g&&a.jsxs(u,{"data-testid":"stop-completion-button",variant:"text",size:"xs",className:"mb-0",onClick:p,children:[a.jsx(er,{className:"animate-spin mr-1",size:14}),"Stop"]}),!g&&f&&a.jsx(u,{"data-testid":"accept-completion-button",variant:"text",size:"xs",className:"mb-0",disabled:g,onClick:()=>{i(f),x("")},children:a.jsx("span",{className:"text-[var(--grass-11)] opacity-100",children:"Accept"})}),a.jsx("div",{className:"h-full w-px bg-border mx-2"}),a.jsx(s,{content:"Include code from other cells",children:a.jsxs("div",{className:"flex flex-row items-start gap-1 overflow-hidden",children:[a.jsx(tr,{"data-testid":"include-other-cells-checkbox",id:"include-other-cells",checked:d,onCheckedChange:e=>h(Boolean(e))}),a.jsx(ee,{htmlFor:"include-other-cells",className:"text-muted-foreground text-xs whitespace-nowrap ellipsis",children:"Include all code"})]})}),a.jsx(u,{"data-testid":"decline-completion-button",variant:"text",size:"icon",disabled:g,onClick:()=>{p(),r(),x("")},children:a.jsx(Pt,{className:"text-[var(--red-10)]",size:16})})]})}),f&&l&&a.jsxs(sx,{className:"cm",theme:k,children:[a.jsx(Ty,{onChange:e,value:o,extensions:My}),a.jsx(Oy,{value:f,editable:!1,readOnly:!0,extensions:My})]}),(!f||!l)&&c]})};const Py=T.forwardRef(((e,t)=>{const{className:n,editorView:o}=e,r=S.useRef(null);return S.useEffect((()=>{null!==o&&null!==r.current&&0===r.current.children.length&&r.current.append(o.dom)}),[o,r]),a.jsx("div",{className:Lt("cm",n),ref:Tp(t,r),"data-testid":"cell-editor"})}));Py.displayName="CellCodeMirrorEditor";const Dy=S.memo((({theme:e,showPlaceholder:t,allowFocus:n,id:o,code:r,status:s,serializedEditorState:i,runCell:l,updateCellCode:c,createNewCell:d,deleteCell:u,focusCell:h,moveCell:f,moveToNextCell:m,updateCellConfig:p,clearSerializedEditorState:g,userConfig:x,editorViewRef:y,hidden:v})=>{var b;const[w,k]=be(bc),[N,E]=S.useState(),C=function(){const e=Y(Sc);return t=>{me!==t&&e(t)}}(),j=S.useRef(null),I="running"===s||"queued"===s,{sendToTop:A,sendToBottom:T}=P(),O=function(){const{splitCell:e,undoSplitCell:t}=P();return M((n=>{const o=nr(n.cellId),r=(null==o?void 0:o.state.doc.toString())??"";e(n);const{dismiss:s}=U({title:"Cell split",action:a.jsx(kc,{"data-testid":"undo-split-button",size:"sm",variant:"outline",onClick:()=>{t({...n,snapshot:r}),s()},children:"Undo"})})}))}(),_=M((()=>!I&&(u({cellId:o}),!0))),D=S.useCallback((()=>d({cellId:o,before:!1})),[o,d]),F=S.useCallback((()=>d({cellId:o,before:!0})),[o,d]),L=S.useCallback((()=>f({cellId:o,before:!1})),[o,f]),R=S.useCallback((()=>f({cellId:o,before:!0})),[o,f]),z=S.useCallback((()=>h({cellId:o,before:!1})),[o,h]),B=S.useCallback((()=>h({cellId:o,before:!0})),[o,h]),V=M((()=>{const e=!v;return fe({configs:{[o]:{hide_code:e}}}),p({cellId:o,config:{hide_code:e}}),e})),$=W(K),G=M((()=>{Cc($,d)})),H=or(x),q=S.useMemo((()=>{const n=(e=>{const{cellId:t,cellMovementCallbacks:n,cellCodeCallbacks:o,keymapConfig:r,hotkeys:a}=e;return[Js(r,n),bn(t,n,a),wn(t,o,a),Xm(e),[qm,(s=(e,t)=>{gn(e,t)},Ot.define((e=>new Ym(e,s)))),St.baseTheme({".underline":{textDecoration:"underline",cursor:"pointer",color:"var(--link)"}})]];var s})({cellId:o,showPlaceholder:t,enableAI:H,cellCodeCallbacks:{updateCellCode:c,afterToggleMarkdown:G},cellMovementCallbacks:{onRun:l,deleteCell:_,createAbove:F,createBelow:D,moveUp:R,moveDown:L,focusUp:B,focusDown:z,sendToTop:A,sendToBottom:T,splitCell:O,moveToNextCell:m,toggleHideCode:V,aiCellCompletion:()=>{let e=!1;return k((t=>(null==t?void 0:t.cellId)===o?(e=!0,null):{cellId:o})),e}},completionConfig:x.completion,keymapConfig:x.keymap,theme:e,hotkeys:new rr(x.keymap.overrides)});return n.push(Ot.define((e=>{const t=e.state.field(ar);return E(t.type),{update(e){const t=e.state.field(ar);E(t.type)}}}))),n}),[o,x.keymap,x.completion,H,e,t,F,D,B,z,R,L,m,A,T,O,V,c,_,l,k,G]);S.useEffect((()=>{let e;null===i?null===y.current?(y.current=new St({state:Gn.create({doc:r,extensions:q})}),e=!0,Bo(y.current,sr(y.current.state).type)):(y.current.dispatch({effects:[It.reconfigure.of([q]),ir(y.current,x.completion,new rr(x.keymap.overrides))]}),e=!1):(y.current=new St({state:Gn.fromJSON(i,{doc:r,extensions:q},{history:lr})}),Bo(y.current,sr(y.current.state).type),e=!0,g({cellId:o})),null!==y.current&&null!==j.current&&j.current.replaceChildren(y.current.dom),e&&n&&requestAnimationFrame((()=>{var e,t;null==(e=y.current)||e.focus(),null==(t=y.current)||t.dom.scrollIntoView({behavior:"smooth",block:"nearest"})}))}),[y,q,x.completion,x.keymap,g,o,i]),S.useEffect((()=>()=>{var e;null==(e=y.current)||e.destroy()}),[y]);return a.jsx(_y,{enabled:(null==w?void 0:w.cellId)===o,initialPrompt:null==w?void 0:w.initialPrompt,currentCode:(null==(b=y.current)?void 0:b.state.doc.toString())??r,currentLanguageAdapter:N,declineChange:()=>{var e;k(null),null==(e=y.current)||e.focus()},onChange:e=>{var t;null==(t=y.current)||t.dispatch({changes:{from:0,to:y.current.state.doc.length,insert:e}})},acceptChange:e=>{var t,n;null==(t=y.current)||t.dispatch({changes:{from:0,to:y.current.state.doc.length,insert:e}}),null==(n=y.current)||n.focus(),k(null)},children:a.jsxs("div",{className:"relative w-full",onFocus:()=>C(o),children:[!v&&a.jsx("div",{className:"absolute top-1 right-5",children:a.jsx(Rp,{code:r,editorView:y.current,currentLanguageAdapter:N,onAfterToggle:G})}),v&&a.jsx(cr,{onClick:async()=>{var e;v&&(await fe({configs:{[o]:{hide_code:!1}}}),p({cellId:o,config:{hide_code:!1}}),null==(e=y.current)||e.focus())}}),a.jsx(Py,{className:Lt(v&&"opacity-20 h-8 overflow-hidden"),editorView:y.current,ref:j})]})})})),Fy=e=>a.jsxs("div",{className:"flex items-center gap-2 w-full px-3",children:[a.jsx("div",{className:"flex-1 flex item-center gap-2",children:e.left}),a.jsx("div",{className:"flex-1 flex item-center gap-2 justify-center",children:e.center}),a.jsx("div",{className:"flex-1 flex item-center gap-2 justify-end",children:e.right})]}),Ly=e=>e.canCollapse||e.isCollapsed?a.jsx(u,{variant:"text",size:"icon",onClick:e.onClick,children:a.jsx(s,{content:e.isCollapsed?"Expand":"Collapse",children:a.jsx(Ry,{isCollapsed:e.isCollapsed})})}):null,Ry=({isCollapsed:e})=>e?a.jsx(dr,{className:"w-5 h-5 flex-shrink-0"}):a.jsx(ue,{className:"w-5 h-5 flex-shrink-0"}),zy=S.memo((({onClick:e,count:t,cellId:n})=>{const o=O(),r=ur(o,n);return a.jsx("div",{onClick:e,className:Lt("flex items-center justify-between w-[calc(100%-2rem)] h-9 bg-muted rounded-b mx-4 opacity-80 hover:opacity-100 cursor-pointer"),children:a.jsx(Fy,{center:a.jsxs(a.Fragment,{children:[a.jsx(hr,{className:"w-4 h-4 flex-shrink-0"}),a.jsxs("span",{className:"text-sm text-gray-500",children:[t," ",1===t?"cell":"cells"," collapsed"]})]}),right:a.jsxs(a.Fragment,{children:[r.errored&&a.jsx(s,{content:"Has errors",delayDuration:100,children:a.jsx(Al,{className:"w-4 h-4 flex-shrink-0 text-destructive"})}),r.stale&&a.jsx(s,{content:"Has stale cells",delayDuration:100,children:a.jsx(fr,{className:"w-4 h-4 flex-shrink-0 text-[var(--yellow-11)]"})}),r.runningOrQueued&&a.jsx(s,{content:"Running",delayDuration:100,children:a.jsx(er,{className:"w-4 h-4 flex-shrink-0 animate-spin"})})]})})})}));zy.displayName="CollapsedCellBanner";const By=e=>{const{appClosed:t,status:n}=e,o=pd("running"===n);return a.jsx(s,{content:As("global.interrupt"),usePortal:!1,children:a.jsx(Ts,{className:Lt(!o&&"hover-action",(t||!o)&&"inactive-button active:shadow-xsSolid"),onClick:o?mr:Rt.NOOP,color:o?"yellow":"disabled",shape:"circle",size:"small","data-testid":"run-button",children:a.jsx(x,{strokeWidth:1.5})})})},Uy=S.memo(S.forwardRef((({theme:e,showPlaceholder:t,allowFocus:n,id:o,code:r,output:s,consoleOutputs:i,status:l,runStartTimestamp:c,runElapsedTimeMs:d,edited:u,interrupted:h,errored:m,stopped:p,staleInputs:g,serializedEditorState:x,mode:y,debuggerActive:v,appClosed:b,showDeleteButton:w,updateCellCode:k,prepareForRun:N,createNewCell:E,deleteCell:C,focusCell:j,moveCell:I,setStdinResponse:A,moveToNextCell:T,updateCellConfig:O,clearSerializedEditorState:_,sendToBottom:P,sendToTop:L,collapseCell:R,expandCell:z,userConfig:B,outline:U,isCollapsed:V,collapseCount:$,config:G,name:H},W)=>{f.debug("Rendering Cell",o);const q=S.useRef(null),J=S.useRef(null),K=S.useRef(null),X=Y(bc),Z=G.disabled||"disabled-transitively"===l,Q=pr(B.runtime.auto_instantiate,d,l,m,h,p),ee=Q||u||h||g&&!Z,te="running"===l||"queued"===l,ne=gr({status:l,output:s,runStartTimestamp:c,interrupted:h,staleInputs:g},u),oe=("queued"===l||u||g)&&!h,re="edit"===y,ae=S.useCallback((()=>{const e=D(Zm(K));return xr(Zm(K)),N({cellId:o}),e}),[o,K,N]);S.useImperativeHandle(W,(()=>({get editorView(){return Zm(K)},registerRun:ae})),[K,ae]);const se=S.useCallback((()=>K.current),[K]),ie=M((async()=>{if(te)return;const e=ae();await F({cellIds:[o],codes:[e]}).catch((e=>{f.error("Error running cell",e)}))})),le=S.useCallback(((e={})=>E({cellId:o,before:!1,...e})),[o,E]),ce=S.useCallback(((e={})=>E({cellId:o,before:!0,...e})),[o,E]),de=S.useCallback((e=>{null===q.current||q.current.contains(e.relatedTarget)||null===K.current||xr(K.current)}),[]),ue=S.useCallback((e=>{if(q.current===document.activeElement&&null!==K.current&&"active"===un(K.current.state)){for(const t of yr)if(e.key===t.key&&t.run){t.run(K.current),e.preventDefault(),e.stopPropagation();break}K.current.focus()}}),[q,K]),he=!vr(s),me=he&&a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute top-5 -left-8 z-10 print:hidden",children:a.jsx(Ly,{isCollapsed:V,onClick:()=>{V?z({cellId:o}):R({cellId:o})},canCollapse:br(U)})}),a.jsx(wr,{allowExpand:re,output:s,className:"output-area",cellId:o,stale:ne})]}),pe=kr("Cell","hover-actions-parent z-10",{published:!re,interactive:re,"needs-run":ee,"has-error":m,stopped:p,disabled:G.disabled,stale:"disabled-transitively"===l}),ge=qe.create(o);if(Xs(re?q.current:null,{"cell.run":ie,"cell.runAndNewBelow":()=>{ie(),T({cellId:o,before:!1})},"cell.runAndNewAbove":()=>{ie(),T({cellId:o,before:!0})},"cell.createAbove":ce,"cell.createBelow":le,"cell.moveUp":()=>I({cellId:o,before:!0}),"cell.moveDown":()=>I({cellId:o,before:!1}),"cell.hideCode":()=>{var e,t,n;const r=!G.hide_code;fe({configs:{[o]:{hide_code:r}}}),O({cellId:o,config:{hide_code:r}}),r?(null==(e=K.current)||e.contentDOM.blur(),null==(t=q.current)||t.focus()):null==(n=K.current)||n.focus()},"cell.focusDown":()=>T({cellId:o,before:!1}),"cell.focusUp":()=>T({cellId:o,before:!0}),"cell.sendToBottom":()=>P({cellId:o}),"cell.sendToTop":()=>L({cellId:o}),"cell.aiCompletion":()=>{let e=!1;X((t=>(null==t?void 0:t.cellId)===o?(e=!0,null):{cellId:o})),e&&Zm(K).focus()},"cell.cellActions":()=>{var e;null==(e=J.current)||e.toggle()}}),Zs(re?q.current:null,{ArrowDown:()=>(T({cellId:o,before:!1,noCreate:!0}),!0),ArrowUp:()=>(T({cellId:o,before:!0,noCreate:!0}),!0),..."vim"===B.keymap.preset&&G.hide_code?{j:()=>(T({cellId:o,before:!1,noCreate:!0}),!0),k:()=>(T({cellId:o,before:!0,noCreate:!0}),!0)}:{}}),!re){return m||h||p?null:a.jsx("div",{tabIndex:-1,id:ge,ref:q,className:pe,children:me})}return a.jsx(Lp,{cellId:o,config:G,status:l,getEditorView:se,hasOutput:he,name:H,children:a.jsxs(Pp,{tabIndex:-1,ref:q,"data-status":l,onBlur:de,onKeyDown:ue,cellId:o,title:G.disabled?"This cell is disabled":"disabled-transitively"===l?"This cell has a disabled ancestor":void 0,children:[a.jsxs("div",{className:pe,id:ge,children:["above"===B.display.cell_output&&me,a.jsxs("div",{className:"tray",children:[a.jsxs("div",{className:"absolute flex flex-col gap-[2px] justify-center h-full left-[-34px] z-2",children:[a.jsx(Np,{tooltipContent:As("cell.createAbove"),appClosed:b,onClick:b?void 0:ce}),a.jsx("div",{className:"flex-1"}),a.jsx(Np,{tooltipContent:As("cell.createBelow"),appClosed:b,onClick:b?void 0:le})]}),a.jsx(Dy,{theme:e,showPlaceholder:t,allowFocus:n,id:o,code:r,status:l,serializedEditorState:x,runCell:ie,updateCellCode:k,createNewCell:E,deleteCell:C,focusCell:j,moveCell:I,moveToNextCell:T,updateCellConfig:O,clearSerializedEditorState:_,userConfig:B,editorViewRef:K,hidden:G.hide_code}),a.jsxs("div",{className:"shoulder-right",children:[a.jsx(Sp,{status:l,staleInputs:g,interrupted:h,editing:re,edited:u,disabled:G.disabled??!1,elapsedTime:d,runStartTimestamp:c,uninstantiated:Q}),a.jsxs("div",{className:"flex gap-2 align-bottom",children:[a.jsx(Cp,{edited:u,onClick:b?Rt.NOOP:ie,appClosed:b,status:l,config:G,needsRun:ee}),a.jsx(By,{status:l,appClosed:b}),a.jsx(Dp,{ref:J,cellId:o,status:l,getEditorView:se,name:H,config:G,hasOutput:he,children:a.jsx(Mp,{})})]})]}),a.jsx("div",{className:"shoulder-bottom hover-action",children:w?a.jsx(jp,{appClosed:b,status:l,onClick:()=>{te||b||C({cellId:o})}}):null})]}),"below"===B.display.cell_output&&me,a.jsx(vi,{consoleOutputs:i,stale:oe,cellName:H,onRefactorWithAI:e=>{X({cellId:o,initialPrompt:e.prompt})},onSubmitDebugger:(e,t)=>{A({cellId:o,response:e,outputIndex:t}),Nr({text:e})},cellId:o,debuggerActive:v})]}),V&&a.jsx(zy,{onClick:()=>z({cellId:o}),count:$,cellId:o})]})})}))),Vy=e=>{const{banners:t}=bi(),{removeBanner:n}=wi();return 0===t.length?null:a.jsx("div",{className:"flex flex-col gap-4 mb-5 print:hidden",children:t.map((e=>a.jsxs(Er,{kind:e.variant||"info",className:"flex flex-col rounded p-3",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"font-bold text-lg flex items-center mb-2",children:[a.jsx(Cr,{className:"w-5 h-5 inline-block mr-2"}),e.title]}),a.jsx(u,{"data-testid":"remove-banner-button",variant:"text",size:"icon",onClick:()=>n(e.id),children:a.jsx(Pt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"flex justify-between items-end",children:[a.jsx("span",{children:jr({html:e.description})}),"restart"===e.action&&a.jsx($y,{})]})]},e.id)))})},$y=()=>{const e=Lc();return a.jsxs(u,{"data-testid":"restart-session-button",variant:"link",size:"xs",onClick:e,children:[a.jsx(Rl,{className:"w-3 h-3 mr-2"}),"Restart"]})},Gy=e=>{const{packageAlert:t}=ki(),{clearPackageAlert:n}=Ni(),[o]=ge();if(null===t)return null;if(Ei(t))return a.jsx("div",{className:"flex flex-col gap-4 mb-5 fixed top-5 left-12 w-[400px] z-[200] opacity-95",children:a.jsxs(Er,{kind:"danger",className:"flex flex-col rounded py-3 px-5 animate-in slide-in-from-left",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"font-bold text-lg flex items-center mb-2",children:[a.jsx(Ol,{className:"w-5 h-5 inline-block mr-2"}),"Missing packages"]}),a.jsx(u,{variant:"text","data-testid":"remove-banner-button",size:"icon",onClick:()=>n(t.id),children:a.jsx(Pt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"flex flex-col gap-4 justify-between items-start text-muted-foreground text-base",children:[a.jsxs("div",{children:[a.jsx("p",{children:"The following packages were not found:"}),a.jsx("ul",{className:"list-disc ml-4 mt-1",children:t.packages.map(((e,t)=>a.jsxs("li",{className:"flex items-center gap-1 font-mono text-sm",children:[a.jsx(Qi,{size:"1rem"}),e]},t)))})]}),a.jsx("div",{className:"ml-auto flex flex-row items-baseline",children:t.isolated?a.jsxs(a.Fragment,{children:[a.jsx(Wy,{manager:o.package_management.manager,clearPackageAlert:()=>n(t.id)}),v()?null:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"px-2 text-sm",children:"with"})," ",a.jsx(qy,{})]})]}):a.jsxs("p",{children:["If you set up a"," ",a.jsx("a",{href:"https://docs.python.org/3/tutorial/venv.html#creating-virtual-environments",className:"text-accent-foreground hover:underline",target:"_blank",rel:"noreferrer",children:"virtual environment"}),", marimo can install these packages for you."]})})]})]})});if(Ci(t)){const{status:e,title:o,titleIcon:r,description:s}=function(e){const t=new Set(Object.values(e)),n=t.has("queued")||t.has("installing")?"installing":t.has("failed")?"failed":"installed";if("installing"===n)return{status:"installing",title:"Installing packages",titleIcon:a.jsx(sl,{className:"w-5 h-5 inline-block mr-2"}),description:"Installing packages:"};if("installed"===n)return{status:"installed",title:"All packages installed!",titleIcon:a.jsx(Tl,{className:"w-5 h-5 inline-block mr-2"}),description:"Installed packages:"};return{status:"failed",title:"Some packages failed to install",titleIcon:a.jsx(Ol,{className:"w-5 h-5 inline-block mr-2"}),description:"See terminal for error logs."}}(t.packages);return"installed"===e&&setTimeout((()=>n(t.id)),1e4),a.jsx("div",{className:"flex flex-col gap-4 mb-5 fixed top-5 left-12 w-[400px] z-[200] opacity-95",children:a.jsxs(Er,{kind:"failed"===e?"danger":"info",className:"flex flex-col rounded pt-3 pb-4 px-5",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"font-bold text-lg flex items-center mb-2",children:[r,o]}),a.jsx(u,{variant:"text","data-testid":"remove-banner-button",size:"icon",onClick:()=>n(t.id),children:a.jsx(Pt,{className:"w-5 h-5"})})]}),a.jsx("div",{className:Lt("flex flex-col gap-4 justify-between items-start text-muted-foreground text-base","installed"===e&&"text-accent-foreground"),children:a.jsxs("div",{children:[a.jsx("p",{children:s}),a.jsx("ul",{className:"list-disc ml-4 mt-1",children:Object.entries(t.packages).map((([t,n],o)=>a.jsxs("li",{className:Lt("flex items-center gap-1 font-mono text-sm","installing"===n&&"font-semibold","failed"===n&&"text-destructive","installed"===n&&"text-accent-foreground","installed"===n&&"failed"===e&&"text-muted-foreground"),children:[a.jsx(Hy,{status:n}),t]},o)))})]})})]})})}return g(t),null};const Hy=({status:e})=>{switch(e){case"queued":return a.jsx(Qi,{size:"1rem"});case"installing":return a.jsx(sl,{size:"1rem"});case"installed":return a.jsx(dt,{size:"1rem"});case"failed":return a.jsx(Pt,{size:"1rem"});default:return g(e),null}};const Wy=({manager:e,clearPackageAlert:t})=>a.jsxs(u,{variant:"outline","data-testid":"install-packages-button",size:"sm",onClick:()=>async function(e,t){t(),await Lr({manager:e}).catch((e=>{f.error(e)}))}(e,t),children:[a.jsx(sl,{className:"w-4 h-4 mr-2"}),a.jsx("span",{className:"font-semibold",children:"Install"})]}),qy=()=>{const[e,t]=ge(),n=Sr({resolver:Ir(Ar),defaultValues:e});return a.jsx(Tr,{...n,children:a.jsx("form",{onChange:n.handleSubmit((async e=>{await p({config:e}).then((()=>{t(e)}))})),className:"flex flex-col gap-5",children:a.jsx("div",{className:"flex flex-col gap-3",children:a.jsx(Or,{control:n.control,name:"package_management.manager",render:({field:e})=>a.jsxs(Mr,{children:[a.jsx(_r,{children:a.jsx(Pr,{"data-testid":"install-package-manager-select",onChange:t=>e.onChange(t.target.value),value:e.value,disabled:e.disabled,className:"inline-flex mr-2",children:Dr.map((e=>a.jsx("option",{value:e,children:e},e)))})}),a.jsx(Fr,{})]})})})})})};function Yy(e){return void 0===e&&(e=[]),Rr({override:[t=>{var n=t.matchBefore(/@(\w+)?/);return n?n&&n.from==n.to&&!t.explicit?null:{from:null==n?void 0:n.from,options:[...e]}:null}]})}Yy();const Jy=[Ko(),St.lineWrapping],Ky=[zr(),St.lineWrapping];function Xy(e){const t=function(e){const t=G.get(Vr),n=Gr.keyBy(t,(e=>e.name)),o=e.match(/@(\w+)/g)||[];return o.map((e=>e.slice(1))).map((e=>n.get(e))).filter(Boolean)}(e);return f.debug("Included datasets",t),{includeOtherCode:$s(""),context:{schema:t.map((e=>({name:e.name,columns:e.columns.map((e=>({name:e.name,type:e.type})))})))},code:""}}const Zy=Br("marimo:ai-language","python"),Qy=({onClose:e})=>{const{createNewCell:t}=P(),[n,o]=S.useState({}),[r,s]=be(Zy),{theme:i}=pe(),{completion:l,input:c,stop:d,isLoading:h,setCompletion:f,setInput:m,handleSubmit:p}=Ay({api:Xo("api/ai/completion").toString(),headers:Zo.headers(),streamMode:"text",body:{...n,language:r},onError:e=>{U({title:"Generate with AI failed",description:Qo(e)})}}),g=a.jsxs("div",{className:"flex items-center px-3",children:[a.jsx(Gl,{className:"size-4 text-[var(--blue-11)]"}),a.jsxs(ht,{modal:!1,children:[a.jsx(ft,{asChild:!0,children:a.jsxs(u,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:["python"===r?"Python":"SQL",a.jsx(hr,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"})]})}),a.jsxs(mt,{align:"center",children:[a.jsx(wt,{onClick:()=>s("python"),children:"Python"}),a.jsx(wt,{onClick:()=>s("sql"),children:"SQL"})]})]}),a.jsx(ev,{theme:i,onClose:()=>{f(""),e()},value:c,onChange:e=>{m(e),o(Xy(e))},onSubmit:p}),h&&a.jsxs(u,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:d,children:[a.jsx(er,{className:"animate-spin mr-1",size:14}),"Stop"]}),!h&&l&&a.jsx(u,{"data-testid":"accept-completion-button",variant:"text",size:"sm",className:"mb-0",disabled:h,onClick:()=>{t({cellId:"__end__",before:!1,code:"python"===r?l:So.fromQuery(l)}),f(""),e()},children:a.jsx("span",{className:"text-[var(--grass-11)] opacity-100",children:"Accept"})}),a.jsx(u,{variant:"text",size:"sm",className:"mb-0",onClick:e,children:a.jsx(Pt,{className:"size-4"})})]});return a.jsxs("div",{className:Lt("flex flex-col w-full gap-2 py-2"),children:[g,!l&&a.jsxs("span",{className:"text-xs text-muted-foreground px-3",children:["You can mention"," ",a.jsx("span",{className:"text-[var(--cyan-11)]",children:"@dataframe"})," or"," ",a.jsx("span",{className:"text-[var(--cyan-11)]",children:"@sql_table"})," to pull additional context such as column names."]}),l&&a.jsx(Ur,{value:l,className:"cm border-t",onChange:f,theme:"dark"===i?"dark":"light",extensions:"python"===r?Jy:Ky})]})},ev=({value:e,onChange:t,onSubmit:n,onClose:o,theme:r})=>{const s=n,i=o,l=W(Vr),c=S.useMemo((()=>[Yy(l.map((e=>({label:`@${e.name}`,info:()=>{const t=[null==e.num_rows?void 0:`${e.num_rows} rows`,null==e.num_columns?void 0:`${e.num_columns} columns`].filter(Boolean).join(", "),n=document.createElement("div");if(n.classList.add("prose","prose-sm","dark:prose-invert"),t){const e=document.createElement("div");e.textContent=t,e.style.fontWeight="bold",n.append(e)}if(e.source){const t=document.createElement("figcaption");t.textContent=`Source: ${e.source}`,n.append(t)}if(e.columns){const t=document.createElement("table"),o=t.insertRow(),r=o.insertCell();r.textContent="Column",r.style.fontWeight="bold";const a=o.insertCell();a.textContent="Type",a.style.fontWeight="bold",e.columns.forEach((e=>{const n=t.insertRow();n.insertCell().textContent=e.name;n.insertCell().textContent=e.type})),n.append(t)}return n}})))),St.lineWrapping,$r(),an.highest(nn.of([{key:"Enter",preventDefault:!0,stopPropagation:!0,run:()=>(s(),!0)}])),nn.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(i(),!0)}])]),[l,s,i]);return a.jsx(Ur,{className:"flex-1 font-sans",autoFocus:!0,width:"100%",value:e,basicSetup:!1,extensions:c,onChange:t,theme:"dark"===r?"dark":"light",placeholder:"Generate with AI"})},tv=({notebook:e,mode:t,userConfig:n,appConfig:o,connStatus:r})=>{const s=P(),{theme:i}=pe(),{toggleSidebarPanel:l}=Gc(),{invisible:c}=ji(e.cellIds.length,t);Is("global.focusTop",s.focusTopCell),Is("global.focusBottom",s.focusBottomCell),Is("global.toggleSidebar",l),Is("global.foldCode",s.foldAll),Is("global.unfoldCode",s.unfoldAll),Is("global.formatAll",(()=>{Hr(s.updateCellCode)})),Is("cell.hideCode",Rt.NOOP),Is("cell.format",Rt.NOOP);const d=Nc(),u=s.scrollToTarget;S.useEffect((()=>{null!==e.scrollKey&&u()}),[e.cellIds,e.scrollKey,u]);const h=Wr(e);return a.jsxs(Si,{className:"pb-[40vh]",invisible:c,appConfig:o,children:[a.jsx(Gy,{}),a.jsx(Vy,{}),a.jsx("div",{className:"flex flex-col gap-5",children:h.map((o=>a.jsx(Uy,{theme:i,showPlaceholder:1===h.length,allowFocus:!c&&!e.scrollKey,id:o.id,code:o.code,outline:o.outline,output:o.output,consoleOutputs:o.consoleOutputs,status:o.status,edited:o.edited,interrupted:o.interrupted,errored:o.errored,stopped:o.stopped,staleInputs:o.staleInputs,runStartTimestamp:o.runStartTimestamp,runElapsedTimeMs:o.runElapsedTimeMs??o.lastExecutionTime,serializedEditorState:o.serializedEditorState,showDeleteButton:h.length>1&&!o.config.hide_code,mode:t,appClosed:r.state!==mi.OPEN,ref:e.cellHandles[o.id],userConfig:n,debuggerActive:o.debuggerActive,config:o.config,name:o.name,isCollapsed:e.cellIds.isCollapsed(o.id),collapseCount:e.cellIds.getCount(o.id),...s,deleteCell:d},o.id.toString())))}),a.jsx(nv,{}),a.jsx(Ii,{})]})},nv=()=>{const{createNewCell:e}=P(),t=W(K),[n,o]=qr(!1),r=W(J),i=W(Yr).sql,l=Lt("mb-0 rounded-none sm:px-4 md:px-5 lg:px-8 tracking-wide no-wrap whitespace-nowrap","hover:bg-accent hover:text-accent-foreground font-semibold uppercase text-xs");return a.jsx("div",{className:"flex justify-center mt-4 pt-6 pb-32 group gap-4 w-full print:hidden",children:a.jsx("div",{className:Lt("shadow-sm border border-border rounded transition-all duration-200 overflow-hidden divide-x divide-border flex",!n&&"w-fit",n&&"opacity-100 w-full max-w-4xl shadow-lg shadow-[var(--blue-3)]"),children:n?a.jsx(Qy,{onClose:o.toggle}):a.jsxs(a.Fragment,{children:[a.jsxs(u,{className:l,variant:"text",size:"sm",onClick:()=>e({cellId:"__end__",before:!1}),children:[a.jsx(Hl,{className:"mr-2 size-4 flex-shrink-0"}),"Python"]}),a.jsxs(u,{className:l,variant:"text",size:"sm",onClick:()=>{Cc(t,e),e({cellId:"__end__",before:!1,code:(new jo).defaultCode})},children:[a.jsx(Yl,{className:"mr-2 size-4 flex-shrink-0"}),"Markdown"]}),a.jsx(s,{content:i?null:a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("span",{children:["Additional dependencies required:",a.jsx(Qs,{className:"inline",children:"pip install marimo[sql]"}),"."]}),a.jsx("span",{children:"You will need to restart the notebook after installing."})]}),delayDuration:100,asChild:!1,children:a.jsxs(u,{className:l,variant:"text",size:"sm",disabled:!i,onClick:()=>{Cc(t,e),e({cellId:"__end__",before:!1,code:(new So).defaultCode})},children:[a.jsx(ae,{className:"mr-2 size-4 flex-shrink-0"}),"SQL"]})}),a.jsx(s,{content:r?null:a.jsx("span",{children:"Enable via settings under AI Assist"}),delayDuration:100,asChild:!1,children:a.jsxs(u,{className:l,variant:"text",size:"sm",disabled:!r,onClick:o.toggle,children:[a.jsx(Gl,{className:"mr-2 size-4 flex-shrink-0"}),"Generate with AI"]})})]})})})};const ov=({userConfig:e,appConfig:t})=>{const n=O();Zr(ua,da.onCellIdsChange);const{setCells:o,updateCellCode:s}=P(),i=W(We),[l,c]=Ze(),[d,u]=S.useState(),h=ii(),{openModal:m,closeModal:p,openAlert:g}=r(),x="edit"===i.mode,y="present"===i.mode,v=W(Qr),b=W(Z);function w(){g("Failed to save notebook: not connected to a kernel.")}S.useEffect((()=>(Ai.INSTANCE.start(ea),()=>{Ai.INSTANCE.stop()})),[]);const{connection:k}=Ti({autoInstantiate:e.runtime.auto_instantiate,setCells:(e,t)=>{o(e);const n=e.map((e=>e.name)),r=e.map((e=>e.code)),a=e.map((e=>e.config));u({names:n,codes:r,configs:a,layout:t})},sessionId:ta()}),N=M((async e=>k.state!==mi.OPEN?(w(),null):(na((t=>{null===e?t.delete(oa.filePath):t.set(oa.filePath,e)})),ra({filename:e}).then((()=>(c(e),document.title=t.app_title||Ke.basename(e)||"Untitled Notebook",e))).catch((e=>(g(e.message),null))))));S.useEffect((()=>{document.title=t.app_title||Ke.basename(l??"")||"Untitled Notebook"}),[t.app_title,l]);const E=aa(n),C=E.map((e=>e.id)),j=E.map((e=>e.code)),I=E.map((e=>e.name)),A=E.map((e=>e.config)),T=sa(n,h,d),D=M(((t,n)=>{b||0!==j.length&&(k.state===mi.OPEN?(f.log("saving to ",t),ia({cellIds:C,codes:j,names:I,filename:t,configs:A,layout:Oi(),persist:!0}).then((()=>{n&&(U({title:"Notebook saved"}),e.save.format_on_save&&Hr(s)),u({names:I,codes:j,configs:A,layout:h})}))):w())})),F=M(((e=!1)=>{null!==l&&k.state===mi.OPEN&&D(l,e)})),L=M((()=>{F(!0),null===l&&k.state!==mi.CLOSED&&m(a.jsx(rv,{onClose:p,onSave:z}))}));!function(e){const{codes:t,cellConfigs:n,config:o,connStatus:r,cellNames:a,needsSave:s,kioskMode:i,onSave:l}=e,c=S.useRef(null);S.useEffect((()=>{if(!i)return"after_delay"===o.save.autosave&&(null!==c.current&&clearTimeout(c.current),s&&r.state===mi.OPEN&&(c.current=setTimeout(l,o.save.autosave_delay))),()=>{null!==c.current&&clearTimeout(c.current)}}),[t,n,a,o.save,r.state,l,i,s])}({onSave:F,needsSave:T,codes:j,cellConfigs:A,cellNames:I,connStatus:k,config:e,kioskMode:b}),function(){const e=W(Jr),{state:t}=W(fi),n=e.auto_download.includes("markdown"),o=e.auto_download.includes("html"),r=!n||t!==mi.OPEN,a=!o||t!==mi.OPEN;ei((async()=>{await Kr({download:!1})}),{delayMs:5e3,whenVisible:!0,disabled:r}),ei((async()=>{await Xr({download:!1,includeCode:!0,files:hi.INSTANCE.filenames()})}),{delayMs:5e3,whenVisible:!0,disabled:a})}(),R(window,"beforeunload",(e=>{if(!la())return T?(e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to quit?"):void 0}));const z=e=>{N(e).then((e=>{null!==e&&D(e,!0)}))},B=function(){const e=O(),t=vc();return M((()=>t(_(e))))}(),V=Wc();Is("global.runStale",(()=>{B()})),Is("global.save",L),Is("global.interrupt",(()=>{mr()})),Is("global.hideCode",(()=>{V()}));const $=M((()=>JSON.stringify({filename:l,cells:E.map((e=>({name:e.name,code:e.code})))},null,2))),G=a.jsx(tv,{notebook:n,connStatus:k,mode:i.mode,userConfig:e,appConfig:t});return a.jsxs(a.Fragment,{children:[a.jsxs(Mi,{connectionState:k.state,isRunning:v,width:t.width,children:[a.jsx(_i,{connection:k,className:Lt("pt-4 sm:pt-12 pb-2 mb-4 print:hidden"),children:x&&a.jsx("div",{className:"flex items-center justify-center container",children:a.jsx(Cd,{filename:l,setFilename:N})})}),E.length>0&&a.jsx(Pi,{appConfig:t,mode:i.mode,children:a.jsx(Sd,{disabled:!x,children:G})})]}),a.jsx(vd,{filename:l,needsSave:T,onSaveNotebook:L,getCellsAsJSON:$,presenting:y,onTogglePresenting:V,onInterrupt:mr,onRun:B,closed:k.state===mi.CLOSED,running:v,needsRun:ca(n),undoAvailable:ut(n),appWidth:t.width})]})},rv=e=>{const{onClose:t,onSave:n}=e,[o,r]=S.useState();return a.jsxs(i,{children:[a.jsx(l,{children:"Save notebook"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx(ee,{className:"text-md pt-6 px-1",children:"Save as"}),a.jsx(Ed,{onNameChange:e=>{r(e),e.trim()&&(n(e),t())},placeholderText:"filename",className:"missing-filename"})]}),a.jsxs(d,{children:[a.jsx(u,{"data-testid":"cancel-save-dialog-button","aria-label":"Cancel",variant:"secondary",onClick:t,children:"Cancel"}),a.jsx(u,{"data-testid":"submit-save-dialog-button","aria-label":"Save",variant:"default",disabled:!o,type:"submit",children:"Save"})]})]})},{createElement:av,createContext:sv,createRef:iv,forwardRef:lv,useCallback:cv,useContext:dv,useEffect:uv,useImperativeHandle:hv,useLayoutEffect:fv,useMemo:mv,useRef:pv,useState:gv}=ha,xv=ha["useId".toString()],yv=fv,vv=sv(null);vv.displayName="PanelGroupContext";const bv=yv,wv="function"==typeof xv?xv:()=>null;let kv=0;function Nv(e=null){const t=wv(),n=pv(e||t||null);return null===n.current&&(n.current=""+kv++),null!=e?e:n.current}function Ev({children:e,className:t="",collapsedSize:n,collapsible:o,defaultSize:r,forwardedRef:a,id:s,maxSize:i,minSize:l,onCollapse:c,onExpand:d,onResize:u,order:h,style:f,tagName:m="div",...p}){const g=dv(vv);if(null===g)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:x,expandPanel:y,getPanelSize:v,getPanelStyle:b,groupId:w,isPanelCollapsed:k,reevaluatePanelConstraints:N,registerPanel:E,resizePanel:C,unregisterPanel:j}=g,S=Nv(s),I=pv({callbacks:{onCollapse:c,onExpand:d,onResize:u},constraints:{collapsedSize:n,collapsible:o,defaultSize:r,maxSize:i,minSize:l},id:S,idIsFromProps:void 0!==s,order:h});pv({didLogMissingDefaultSizeWarning:!1}),bv((()=>{const{callbacks:e,constraints:t}=I.current,a={...t};I.current.id=S,I.current.idIsFromProps=void 0!==s,I.current.order=h,e.onCollapse=c,e.onExpand=d,e.onResize=u,t.collapsedSize=n,t.collapsible=o,t.defaultSize=r,t.maxSize=i,t.minSize=l,a.collapsedSize===t.collapsedSize&&a.collapsible===t.collapsible&&a.maxSize===t.maxSize&&a.minSize===t.minSize||N(I.current,a)})),bv((()=>{const e=I.current;return E(e),()=>{j(e)}}),[h,S,E,j]),hv(a,(()=>({collapse:()=>{x(I.current)},expand:e=>{y(I.current,e)},getId:()=>S,getSize:()=>v(I.current),isCollapsed:()=>k(I.current),isExpanded:()=>!k(I.current),resize:e=>{C(I.current,e)}})),[x,y,v,k,S,C]);const A=b(I.current,r);return av(m,{...p,children:e,className:t,id:s,style:{...A,...f},"data-panel":"","data-panel-collapsible":o||void 0,"data-panel-group-id":w,"data-panel-id":S,"data-panel-size":parseFloat(""+A.flexGrow).toFixed(1)})}const Cv=lv(((e,t)=>av(Ev,{...e,forwardedRef:t})));Ev.displayName="Panel",Cv.displayName="forwardRef(Panel)";let jv=null,Sv=null;function Iv(e,t){const n=function(e,t){if(t){const e=!!(t&Uv),n=!!(t&Vv);if(t&zv)return e?"se-resize":n?"ne-resize":"e-resize";if(t&Bv)return e?"sw-resize":n?"nw-resize":"w-resize";if(e)return"s-resize";if(n)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}(e,t);jv!==n&&(jv=n,null===Sv&&(Sv=document.createElement("style"),document.head.appendChild(Sv)),Sv.innerHTML=`*{cursor: ${n}!important;}`)}function Av(e){return"keydown"===e.type}function Tv(e){return e.type.startsWith("pointer")}function Ov(e){return e.type.startsWith("mouse")}function Mv(e){if(Tv(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(Ov(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}const _v=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function Pv(e){const t=getComputedStyle(e);return"fixed"===t.position||(!("auto"===t.zIndex||"static"===t.position&&!function(e){var t;const n=getComputedStyle(null!==(t=Rv(e))&&void 0!==t?t:e).display;return"flex"===n||"inline-flex"===n}(e))||(+t.opacity<1||("transform"in t&&"none"!==t.transform||("webkitTransform"in t&&"none"!==t.webkitTransform||("mixBlendMode"in t&&"normal"!==t.mixBlendMode||("filter"in t&&"none"!==t.filter||("webkitFilter"in t&&"none"!==t.webkitFilter||("isolation"in t&&"isolate"===t.isolation||(!!_v.test(t.willChange)||"touch"===t.webkitOverflowScrolling)))))))))}function Dv(e){let t=e.length;for(;t--;){const n=e[t];if(ob(n,"Missing node"),Pv(n))return n}return null}function Fv(e){return e&&Number(getComputedStyle(e).zIndex)||0}function Lv(e){const t=[];for(;e;)t.push(e),e=Rv(e);return t}function Rv(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const zv=1,Bv=2,Uv=4,Vv=8,$v="coarse"===function(){if("function"==typeof matchMedia)return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}();let Gv=[],Hv=!1,Wv=new Map,qv=new Map;const Yv=new Set;function Jv(e){const{target:t}=e,{x:n,y:o}=Mv(e);Hv=!0,Zv({target:t,x:n,y:o}),tb(),Gv.length>0&&(nb("down",e),e.preventDefault(),e.stopPropagation())}function Kv(e){const{x:t,y:n}=Mv(e);if(!Hv){const{target:o}=e;Zv({target:o,x:t,y:n})}nb("move",e),eb(),Gv.length>0&&e.preventDefault()}function Xv(e){const{target:t}=e,{x:n,y:o}=Mv(e);qv.clear(),Hv=!1,Gv.length>0&&e.preventDefault(),nb("up",e),Zv({target:t,x:n,y:o}),eb(),tb()}function Zv({target:e,x:t,y:n}){Gv.splice(0);let o=null;e instanceof HTMLElement&&(o=e),Yv.forEach((e=>{const{element:r,hitAreaMargins:a}=e,s=r.getBoundingClientRect(),{bottom:i,left:l,right:c,top:d}=s,u=$v?a.coarse:a.fine;if(t>=l-u&&t<=c+u&&n>=d-u&&n<=i+u){if(null!==o&&r!==o&&!r.contains(o)&&!o.contains(r)&&function(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:Lv(e),b:Lv(t)};let o;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),o=e;ob(o,"Stacking order can only be calculated for elements with a common ancestor");const r=Fv(Dv(n.a)),a=Fv(Dv(n.b));if(r===a){const e=o.childNodes,t={a:n.a.at(-1),b:n.b.at(-1)};let r=e.length;for(;r--;){const n=e[r];if(n===t.a)return 1;if(n===t.b)return-1}}return Math.sign(r-a)}(o,r)>0){let e=o,t=!1;for(;e&&!e.contains(r);){if(h=e.getBoundingClientRect(),f=s,h.x<f.x+f.width&&h.x+h.width>f.x&&h.y<f.y+f.height&&h.y+h.height>f.y){t=!0;break}e=e.parentElement}if(t)return}Gv.push(e)}var h,f}))}function Qv(e,t){qv.set(e,t)}function eb(){let e=!1,t=!1;Gv.forEach((n=>{const{direction:o}=n;"horizontal"===o?e=!0:t=!0}));let n=0;qv.forEach((e=>{n|=e})),e&&t?Iv("intersection",n):e?Iv("horizontal",n):t?Iv("vertical",n):null!==Sv&&(document.head.removeChild(Sv),jv=null,Sv=null)}function tb(){Wv.forEach(((e,t)=>{const{body:n}=t;n.removeEventListener("contextmenu",Xv),n.removeEventListener("pointerdown",Jv),n.removeEventListener("pointerleave",Kv),n.removeEventListener("pointermove",Kv)})),window.removeEventListener("pointerup",Xv),window.removeEventListener("pointercancel",Xv),Yv.size>0&&(Hv?(Gv.length>0&&Wv.forEach(((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("contextmenu",Xv),n.addEventListener("pointerleave",Kv),n.addEventListener("pointermove",Kv))})),window.addEventListener("pointerup",Xv),window.addEventListener("pointercancel",Xv)):Wv.forEach(((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("pointerdown",Jv,{capture:!0}),n.addEventListener("pointermove",Kv))})))}function nb(e,t){Yv.forEach((n=>{const{setResizeHandlerState:o}=n,r=Gv.includes(n);o(e,r,t)}))}function ob(e,t){if(!e)throw console.error(t),Error(t)}const rb=10;function ab(e,t,n=rb){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function sb(e,t,n=rb){return 0===ab(e,t,n)}function ib(e,t,n){return 0===ab(e,t,n)}function lb({panelConstraints:e,panelIndex:t,size:n}){const o=e[t];ob(null!=o,`Panel constraints not found for index ${t}`);let{collapsedSize:r=0,collapsible:a,maxSize:s=100,minSize:i=0}=o;if(ab(n,i)<0)if(a){n=ab(n,(r+i)/2)<0?r:i}else n=i;return n=Math.min(s,n),n=parseFloat(n.toFixed(rb))}function cb({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:o,prevLayout:r,trigger:a}){if(ib(e,0))return t;const s=[...t],[i,l]=o;ob(null!=i,"Invalid first pivot index"),ob(null!=l,"Invalid second pivot index");let c=0;if("keyboard"===a){{const o=e<0?l:i,r=n[o];ob(r,`Panel constraints not found for index ${o}`);const{collapsedSize:a=0,collapsible:s,minSize:c=0}=r;if(s){const n=t[o];if(ob(null!=n,`Previous layout not found for panel index ${o}`),ib(n,a)){const t=c-n;ab(t,Math.abs(e))>0&&(e=e<0?0-t:t)}}}{const o=e<0?i:l,r=n[o];ob(r,`No panel constraints found for index ${o}`);const{collapsedSize:a=0,collapsible:s,minSize:c=0}=r;if(s){const n=t[o];if(ob(null!=n,`Previous layout not found for panel index ${o}`),ib(n,c)){const t=n-a;ab(t,Math.abs(e))>0&&(e=e<0?0-t:t)}}}}{const o=e<0?1:-1;let r=e<0?l:i,a=0;for(;;){const e=t[r];ob(null!=e,`Previous layout not found for panel index ${r}`);if(a+=lb({panelConstraints:n,panelIndex:r,size:100})-e,r+=o,r<0||r>=n.length)break}const s=Math.min(Math.abs(e),Math.abs(a));e=e<0?0-s:s}{let o=e<0?i:l;for(;o>=0&&o<n.length;){const r=Math.abs(e)-Math.abs(c),a=t[o];ob(null!=a,`Previous layout not found for panel index ${o}`);const i=lb({panelConstraints:n,panelIndex:o,size:a-r});if(!ib(a,i)&&(c+=a-i,s[o]=i,c.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?o--:o++}}if(function(e,t,n){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!ib(e[o],t[o],n))return!1;return!0}(r,s))return r;{const o=e<0?l:i,r=t[o];ob(null!=r,`Previous layout not found for panel index ${o}`);const a=r+c,d=lb({panelConstraints:n,panelIndex:o,size:a});if(s[o]=d,!ib(d,a)){let t=a-d;let o=e<0?l:i;for(;o>=0&&o<n.length;){const r=s[o];ob(null!=r,`Previous layout not found for panel index ${o}`);const a=lb({panelConstraints:n,panelIndex:o,size:r+t});if(ib(r,a)||(t-=a-r,s[o]=a),ib(t,0))break;e>0?o--:o++}}}return ib(s.reduce(((e,t)=>t+e),0),100)?s:r}function db({layout:e,panelsArray:t,pivotIndices:n}){let o=0,r=100,a=0,s=0;const i=n[0];ob(null!=i,"No pivot index found"),t.forEach(((e,t)=>{const{constraints:n}=e,{maxSize:l=100,minSize:c=0}=n;t===i?(o=c,r=l):(a+=c,s+=l)}));return{valueMax:Math.min(r,100-a),valueMin:Math.max(o,100-s),valueNow:e[i]}}function ub(e,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${e}"]`))}function hb(e,t,n=document){const o=ub(e,n).findIndex((e=>e.getAttribute("data-panel-resize-handle-id")===t));return null!=o?o:null}function fb(e,t,n){const o=hb(e,t,n);return null!=o?[o,o+1]:[-1,-1]}function mb(e,t=document){var n;if(t instanceof HTMLElement&&(null==t||null===(n=t.dataset)||void 0===n?void 0:n.panelGroupId)==e)return t;const o=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return o||null}function pb(e,t=document){const n=t.querySelector(`[data-panel-resize-handle-id="${e}"]`);return n||null}function gb({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:o,panelDataArray:r,panelGroupElement:a,setLayout:s}){pv({didWarnAboutMissingResizeHandle:!1}),bv((()=>{if(!a)return;const e=ub(n,a);for(let t=0;t<r.length-1;t++){const{valueMax:n,valueMin:a,valueNow:s}=db({layout:o,panelsArray:r,pivotIndices:[t,t+1]}),i=e[t];if(null==i);else{const e=r[t];ob(e,`No panel data found for index "${t}"`),i.setAttribute("aria-controls",e.id),i.setAttribute("aria-valuemax",""+Math.round(n)),i.setAttribute("aria-valuemin",""+Math.round(a)),i.setAttribute("aria-valuenow",null!=s?""+Math.round(s):"")}}return()=>{e.forEach(((e,t)=>{e.removeAttribute("aria-controls"),e.removeAttribute("aria-valuemax"),e.removeAttribute("aria-valuemin"),e.removeAttribute("aria-valuenow")}))}}),[n,o,r,a]),uv((()=>{if(!a)return;const e=t.current;ob(e,"Eager values not found");const{panelDataArray:r}=e;ob(null!=mb(n,a),`No group found for id "${n}"`);const i=ub(n,a);ob(i,`No resize handles found for group id "${n}"`);const l=i.map((e=>{const t=e.getAttribute("data-panel-resize-handle-id");ob(t,"Resize handle element has no handle id attribute");const[i,l]=function(e,t,n,o=document){var r,a,s,i;const l=pb(t,o),c=ub(e,o),d=l?c.indexOf(l):-1;return[null!==(r=null===(a=n[d])||void 0===a?void 0:a.id)&&void 0!==r?r:null,null!==(s=null===(i=n[d+1])||void 0===i?void 0:i.id)&&void 0!==s?s:null]}(n,t,r,a);if(null==i||null==l)return()=>{};const c=e=>{if(!e.defaultPrevented)switch(e.key){case"Enter":{e.preventDefault();const l=r.findIndex((e=>e.id===i));if(l>=0){const e=r[l];ob(e,`No panel data found for index ${l}`);const i=o[l],{collapsedSize:c=0,collapsible:d,minSize:u=0}=e.constraints;if(null!=i&&d){const e=cb({delta:ib(i,c)?u-c:c-i,initialLayout:o,panelConstraints:r.map((e=>e.constraints)),pivotIndices:fb(n,t,a),prevLayout:o,trigger:"keyboard"});o!==e&&s(e)}}break}}};return e.addEventListener("keydown",c),()=>{e.removeEventListener("keydown",c)}}));return()=>{l.forEach((e=>e()))}}),[a,e,t,n,o,r,s])}function xb(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function yb(e,t){const n="horizontal"===e,{x:o,y:r}=Mv(t);return n?o:r}function vb(e,t,n,o,r,a){if(Av(e)){const t="horizontal"===n;let o=0;o=e.shiftKey?100:null!=r?r:10;let a=0;switch(e.key){case"ArrowDown":a=t?0:o;break;case"ArrowLeft":a=t?-o:0;break;case"ArrowRight":a=t?o:0;break;case"ArrowUp":a=t?0:-o;break;case"End":a=100;break;case"Home":a=-100}return a}return null==o?0:function(e,t,n,o,r){const a="horizontal"===n,s=pb(t,r);ob(s,`No resize handle element found for id "${t}"`);const i=s.getAttribute("data-panel-group-id");ob(i,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=o;const c=yb(n,e),d=mb(i,r);ob(d,`No group element found for id "${i}"`);const u=d.getBoundingClientRect();return(c-l)/(a?u.width:u.height)*100}(e,t,n,o,a)}function bb(e,t,n){t.forEach(((t,o)=>{const r=e[o];ob(r,`Panel data not found for index ${o}`);const{callbacks:a,constraints:s,id:i}=r,{collapsedSize:l=0,collapsible:c}=s,d=n[i];if(null==d||t!==d){n[i]=t;const{onCollapse:e,onExpand:o,onResize:r}=a;r&&r(t,d),c&&(e||o)&&(!o||null!=d&&!sb(d,l)||sb(t,l)||o(),!e||null!=d&&sb(d,l)||!sb(t,l)||e())}}))}function wb(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function kb(e){try{if("undefined"==typeof localStorage)throw new Error("localStorage not supported in this environment");e.getItem=e=>localStorage.getItem(e),e.setItem=(e,t)=>{localStorage.setItem(e,t)}}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function Nb(e){return`react-resizable-panels:${e}`}function Eb(e){return e.map((e=>{const{constraints:t,id:n,idIsFromProps:o,order:r}=e;return o?n:r?`${r}:${JSON.stringify(t)}`:JSON.stringify(t)})).sort(((e,t)=>e.localeCompare(t))).join(",")}function Cb(e,t){try{const n=Nb(e),o=t.getItem(n);if(o){const e=JSON.parse(o);if("object"==typeof e&&null!=e)return e}}catch(n){}return null}function jb(e,t,n,o,r){var a;const s=Nb(e),i=Eb(t),l=null!==(a=Cb(e,r))&&void 0!==a?a:{};l[i]={expandToSizes:Object.fromEntries(n.entries()),layout:o};try{r.setItem(s,JSON.stringify(l))}catch(c){console.error(c)}}function Sb({layout:e,panelConstraints:t}){const n=[...e],o=n.reduce(((e,t)=>e+t),0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map((e=>`${e}%`)).join(", ")}`);if(!ib(o,100))for(let a=0;a<t.length;a++){const e=n[a];ob(null!=e,`No layout data found for index ${a}`);const t=100/o*e;n[a]=t}let r=0;for(let a=0;a<t.length;a++){const e=n[a];ob(null!=e,`No layout data found for index ${a}`);const o=lb({panelConstraints:t,panelIndex:a,size:e});e!=o&&(r+=e-o,n[a]=o)}if(!ib(r,0))for(let a=0;a<t.length;a++){const e=n[a];ob(null!=e,`No layout data found for index ${a}`);const o=lb({panelConstraints:t,panelIndex:a,size:e+r});if(e!==o&&(r-=o-e,n[a]=o,ib(r,0)))break}return n}const Ib={getItem:e=>(kb(Ib),Ib.getItem(e)),setItem:(e,t)=>{kb(Ib),Ib.setItem(e,t)}},Ab={};function Tb({autoSaveId:e=null,children:t,className:n="",direction:o,forwardedRef:r,id:a=null,onLayout:s=null,keyboardResizeBy:i=null,storage:l=Ib,style:c,tagName:d="div",...u}){const h=Nv(a),f=pv(null),[m,p]=gv(null),[g,x]=gv([]),y=pv({}),v=pv(new Map),b=pv(0),w=pv({autoSaveId:e,direction:o,dragState:m,id:h,keyboardResizeBy:i,onLayout:s,storage:l}),k=pv({layout:g,panelDataArray:[],panelDataArrayChanged:!1});pv({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),hv(r,(()=>({getId:()=>w.current.id,getLayout:()=>{const{layout:e}=k.current;return e},setLayout:e=>{const{onLayout:t}=w.current,{layout:n,panelDataArray:o}=k.current,r=Sb({layout:e,panelConstraints:o.map((e=>e.constraints))});xb(n,r)||(x(r),k.current.layout=r,t&&t(r),bb(o,r,y.current))}})),[]),bv((()=>{w.current.autoSaveId=e,w.current.direction=o,w.current.dragState=m,w.current.id=h,w.current.onLayout=s,w.current.storage=l})),gb({committedValuesRef:w,eagerValuesRef:k,groupId:h,layout:g,panelDataArray:k.current.panelDataArray,setLayout:x,panelGroupElement:f.current}),uv((()=>{const{panelDataArray:t}=k.current;if(e){if(0===g.length||g.length!==t.length)return;let n=Ab[e];null==n&&(n=function(e,t=10){let n=null;return(...o)=>{null!==n&&clearTimeout(n),n=setTimeout((()=>{e(...o)}),t)}}(jb,100),Ab[e]=n);const o=[...t],r=new Map(v.current);n(e,o,r,g,l)}}),[e,g,l]),uv((()=>{}));const N=cv((e=>{const{onLayout:t}=w.current,{layout:n,panelDataArray:o}=k.current;if(e.constraints.collapsible){const r=o.map((e=>e.constraints)),{collapsedSize:a=0,panelSize:s,pivotIndices:i}=_b(o,e,n);if(ob(null!=s,`Panel size not found for panel "${e.id}"`),!sb(s,a)){v.current.set(e.id,s);const l=cb({delta:Mb(o,e)===o.length-1?s-a:a-s,initialLayout:n,panelConstraints:r,pivotIndices:i,prevLayout:n,trigger:"imperative-api"});wb(n,l)||(x(l),k.current.layout=l,t&&t(l),bb(o,l,y.current))}}}),[]),E=cv(((e,t)=>{const{onLayout:n}=w.current,{layout:o,panelDataArray:r}=k.current;if(e.constraints.collapsible){const a=r.map((e=>e.constraints)),{collapsedSize:s=0,panelSize:i=0,minSize:l=0,pivotIndices:c}=_b(r,e,o),d=null!=t?t:l;if(sb(i,s)){const t=v.current.get(e.id),s=null!=t&&t>=d?t:d,l=cb({delta:Mb(r,e)===r.length-1?i-s:s-i,initialLayout:o,panelConstraints:a,pivotIndices:c,prevLayout:o,trigger:"imperative-api"});wb(o,l)||(x(l),k.current.layout=l,n&&n(l),bb(r,l,y.current))}}}),[]),C=cv((e=>{const{layout:t,panelDataArray:n}=k.current,{panelSize:o}=_b(n,e,t);return ob(null!=o,`Panel size not found for panel "${e.id}"`),o}),[]),j=cv(((e,t)=>{const{panelDataArray:n}=k.current,o=Mb(n,e);return function({defaultSize:e,dragState:t,layout:n,panelData:o,panelIndex:r,precision:a=3}){const s=n[r];let i;return i=null==s?null!=e?e.toPrecision(a):"1":1===o.length?"1":s.toPrecision(a),{flexBasis:0,flexGrow:i,flexShrink:1,overflow:"hidden",pointerEvents:null!==t?"none":void 0}}({defaultSize:t,dragState:m,layout:g,panelData:n,panelIndex:o})}),[m,g]),S=cv((e=>{const{layout:t,panelDataArray:n}=k.current,{collapsedSize:o=0,collapsible:r,panelSize:a}=_b(n,e,t);return ob(null!=a,`Panel size not found for panel "${e.id}"`),!0===r&&sb(a,o)}),[]),I=cv((e=>{const{layout:t,panelDataArray:n}=k.current,{collapsedSize:o=0,collapsible:r,panelSize:a}=_b(n,e,t);return ob(null!=a,`Panel size not found for panel "${e.id}"`),!r||ab(a,o)>0}),[]),A=cv((e=>{const{panelDataArray:t}=k.current;t.push(e),t.sort(((e,t)=>{const n=e.order,o=t.order;return null==n&&null==o?0:null==n?-1:null==o?1:n-o})),k.current.panelDataArrayChanged=!0}),[]);bv((()=>{if(k.current.panelDataArrayChanged){k.current.panelDataArrayChanged=!1;const{autoSaveId:e,onLayout:t,storage:n}=w.current,{layout:o,panelDataArray:r}=k.current;let a=null;if(e){const t=function(e,t,n){var o,r;return null!==(r=(null!==(o=Cb(e,n))&&void 0!==o?o:{})[Eb(t)])&&void 0!==r?r:null}(e,r,n);t&&(v.current=new Map(Object.entries(t.expandToSizes)),a=t.layout)}null==a&&(a=function({panelDataArray:e}){const t=Array(e.length),n=e.map((e=>e.constraints));let o=0,r=100;for(let a=0;a<e.length;a++){const e=n[a];ob(e,`Panel constraints not found for index ${a}`);const{defaultSize:s}=e;null!=s&&(o++,t[a]=s,r-=s)}for(let a=0;a<e.length;a++){const s=n[a];ob(s,`Panel constraints not found for index ${a}`);const{defaultSize:i}=s;if(null!=i)continue;const l=r/(e.length-o);o++,t[a]=l,r-=l}return t}({panelDataArray:r}));const s=Sb({layout:a,panelConstraints:r.map((e=>e.constraints))});xb(o,s)||(x(s),k.current.layout=s,t&&t(s),bb(r,s,y.current))}})),bv((()=>{const e=k.current;return()=>{e.layout=[]}}),[]);const T=cv((e=>function(t){t.preventDefault();const n=f.current;if(!n)return()=>null;const{direction:o,dragState:r,id:a,keyboardResizeBy:s,onLayout:i}=w.current,{layout:l,panelDataArray:c}=k.current,{initialLayout:d}=null!=r?r:{},u=fb(a,e,n);let h=vb(t,e,o,r,s,n);if(0===h)return;const m="horizontal"===o;"rtl"===document.dir&&m&&(h=-h);const p=cb({delta:h,initialLayout:null!=d?d:l,panelConstraints:c.map((e=>e.constraints)),pivotIndices:u,prevLayout:l,trigger:Av(t)?"keyboard":"mouse-or-touch"}),g=!wb(l,p);(Tv(t)||Ov(t))&&b.current!=h&&(b.current=h,Qv(e,g?0:m?h<0?zv:Bv:h<0?Uv:Vv)),g&&(x(p),k.current.layout=p,i&&i(p),bb(c,p,y.current))}),[]),O=cv(((e,t)=>{const{onLayout:n}=w.current,{layout:o,panelDataArray:r}=k.current,a=r.map((e=>e.constraints)),{panelSize:s,pivotIndices:i}=_b(r,e,o);ob(null!=s,`Panel size not found for panel "${e.id}"`);const l=cb({delta:Mb(r,e)===r.length-1?s-t:t-s,initialLayout:o,panelConstraints:a,pivotIndices:i,prevLayout:o,trigger:"imperative-api"});wb(o,l)||(x(l),k.current.layout=l,n&&n(l),bb(r,l,y.current))}),[]),M=cv(((e,t)=>{const{layout:n,panelDataArray:o}=k.current,{collapsedSize:r=0,collapsible:a}=t,{collapsedSize:s=0,collapsible:i,maxSize:l=100,minSize:c=0}=e.constraints,{panelSize:d}=_b(o,e,n);null!=d&&(a&&i&&sb(d,r)?sb(r,s)||O(e,s):d<c?O(e,c):d>l&&O(e,l))}),[O]),_=cv(((e,t)=>{const{direction:n}=w.current,{layout:o}=k.current;if(!f.current)return;const r=pb(e,f.current);ob(r,`Drag handle element not found for id "${e}"`);const a=yb(n,t);p({dragHandleId:e,dragHandleRect:r.getBoundingClientRect(),initialCursorPosition:a,initialLayout:o})}),[]),P=cv((()=>{p(null)}),[]),D=cv((e=>{const{panelDataArray:t}=k.current,n=Mb(t,e);n>=0&&(t.splice(n,1),delete y.current[e.id],k.current.panelDataArrayChanged=!0)}),[]),F=mv((()=>({collapsePanel:N,direction:o,dragState:m,expandPanel:E,getPanelSize:C,getPanelStyle:j,groupId:h,isPanelCollapsed:S,isPanelExpanded:I,reevaluatePanelConstraints:M,registerPanel:A,registerResizeHandle:T,resizePanel:O,startDragging:_,stopDragging:P,unregisterPanel:D,panelGroupElement:f.current})),[N,m,o,E,C,j,h,S,I,M,A,T,O,_,P,D]),L={display:"flex",flexDirection:"horizontal"===o?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return av(vv.Provider,{value:F},av(d,{...u,children:t,className:n,id:a,ref:f,style:{...L,...c},"data-panel-group":"","data-panel-group-direction":o,"data-panel-group-id":h}))}const Ob=lv(((e,t)=>av(Tb,{...e,forwardedRef:t})));function Mb(e,t){return e.findIndex((e=>e===t||e.id===t.id))}function _b(e,t,n){const o=Mb(e,t),r=o===e.length-1?[o-1,o]:[o,o+1],a=n[o];return{...t.constraints,panelSize:a,pivotIndices:r}}function Pb({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:o,id:r,onDragging:a,style:s={},tabIndex:i=0,tagName:l="div",...c}){var d,u;const h=pv(null),f=pv({onDragging:a});uv((()=>{f.current.onDragging=a}));const m=dv(vv);if(null===m)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:p,groupId:g,registerResizeHandle:x,startDragging:y,stopDragging:v,panelGroupElement:b}=m,w=Nv(r),[k,N]=gv("inactive"),[E,C]=gv(!1),[j,S]=gv(null),I=pv({state:k});bv((()=>{I.current.state=k})),uv((()=>{if(n)S(null);else{const e=x(w);S((()=>e))}}),[n,w,x]);const A=null!==(d=null==o?void 0:o.coarse)&&void 0!==d?d:15,T=null!==(u=null==o?void 0:o.fine)&&void 0!==u?u:5;uv((()=>{if(n||null==j)return;const e=h.current;ob(e,"Element ref not attached");return function(e,t,n,o,r){var a;const{ownerDocument:s}=t,i={direction:n,element:t,hitAreaMargins:o,setResizeHandlerState:r},l=null!==(a=Wv.get(s))&&void 0!==a?a:0;return Wv.set(s,l+1),Yv.add(i),tb(),function(){var t;qv.delete(e),Yv.delete(i);const n=null!==(t=Wv.get(s))&&void 0!==t?t:1;Wv.set(s,n-1),tb(),1===n&&Wv.delete(s)}}(w,e,p,{coarse:A,fine:T},((e,t,n)=>{if(t)switch(e){case"down":{N("drag"),y(w,n);const{onDragging:e}=f.current;e&&e(!0);break}case"move":{const{state:e}=I.current;"drag"!==e&&N("hover"),j(n);break}case"up":{N("hover"),v();const{onDragging:e}=f.current;e&&e(!1);break}}else N("inactive")}))}),[A,p,n,T,x,w,j,y,v]),function({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:o}){uv((()=>{if(e||null==n||null==o)return;const r=pb(t,o);if(null==r)return;const a=e=>{if(!e.defaultPrevented)switch(e.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":e.preventDefault(),n(e);break;case"F6":{e.preventDefault();const n=r.getAttribute("data-panel-group-id");ob(n,`No group element found for id "${n}"`);const a=ub(n,o),s=hb(n,t,o);ob(null!==s,`No resize element found for id "${t}"`),a[e.shiftKey?s>0?s-1:a.length-1:s+1<a.length?s+1:0].focus();break}}};return r.addEventListener("keydown",a),()=>{r.removeEventListener("keydown",a)}}),[o,e,t,n])}({disabled:n,handleId:w,resizeHandler:j,panelGroupElement:b});return av(l,{...c,children:e,className:t,id:r,onBlur:()=>C(!1),onFocus:()=>C(!0),ref:h,role:"separator",style:{touchAction:"none",userSelect:"none",...s},tabIndex:i,"data-panel-group-direction":p,"data-panel-group-id":g,"data-resize-handle":"","data-resize-handle-active":"drag"===k?"pointer":E?"keyboard":void 0,"data-resize-handle-state":k,"data-panel-resize-handle-enabled":!n,"data-panel-resize-handle-id":w})}Tb.displayName="PanelGroup",Ob.displayName="forwardRef(PanelGroup)",Pb.displayName="PanelResizeHandle";const Db=e=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.24em",height:"1em",viewBox:"0 0 256 208",fill:"currentColor",...e,children:a.jsx("path",{d:"M205.28 31.36c14.096 14.88 20.016 35.2 22.512 63.68c6.626 0 12.805 1.47 16.976 7.152l7.792 10.56A17.55 17.55 0 0 1 256 123.2v28.688c-.008 3.704-1.843 7.315-4.832 9.504C215.885 187.222 172.35 208 128 208c-49.066 0-98.19-28.273-123.168-46.608c-2.989-2.189-4.825-5.8-4.832-9.504V123.2c0-3.776 1.2-7.424 3.424-10.464l7.792-10.544c4.173-5.657 10.38-7.152 16.992-7.152c2.496-28.48 8.4-48.8 22.512-63.68C77.331 3.165 112.567.06 127.552 0H128c14.72 0 50.4 2.88 77.28 31.36m-77.264 47.376c-3.04 0-6.544.176-10.272.544c-1.312 4.896-3.248 9.312-6.08 12.128c-11.2 11.2-24.704 12.928-31.936 12.928c-6.802 0-13.927-1.42-19.744-5.088c-5.502 1.808-10.786 4.415-11.136 10.912c-.586 12.28-.637 24.55-.688 36.824c-.026 6.16-.05 12.322-.144 18.488c.024 3.579 2.182 6.903 5.44 8.384C79.936 185.92 104.976 192 128.016 192c23.008 0 48.048-6.08 74.512-18.144c3.258-1.48 5.415-4.805 5.44-8.384c.317-18.418.062-36.912-.816-55.312h.016c-.342-6.534-5.648-9.098-11.168-10.912c-5.82 3.652-12.927 5.088-19.728 5.088c-7.232 0-20.72-1.728-31.936-12.928c-2.832-2.816-4.768-7.232-6.08-12.128a106 106 0 0 0-10.24-.544m-26.941 43.93c5.748 0 10.408 4.66 10.408 10.409v19.183c0 5.749-4.66 10.409-10.408 10.409s-10.408-4.66-10.408-10.409v-19.183c0-5.748 4.66-10.408 10.408-10.408m53.333 0c5.749 0 10.409 4.66 10.409 10.409v19.183c0 5.749-4.66 10.409-10.409 10.409c-5.748 0-10.408-4.66-10.408-10.409v-19.183c0-5.748 4.66-10.408 10.408-10.408M81.44 28.32c-11.2 1.12-20.64 4.8-25.44 9.92c-10.4 11.36-8.16 40.16-2.24 46.24c4.32 4.32 12.48 7.2 21.28 7.2c6.72 0 19.52-1.44 30.08-12.16c4.64-4.48 7.52-15.68 7.2-27.04c-.32-9.12-2.88-16.64-6.72-19.84c-4.16-3.68-13.6-5.28-24.16-4.32m68.96 4.32c-3.84 3.2-6.4 10.72-6.72 19.84c-.32 11.36 2.56 22.56 7.2 27.04c10.56 10.72 23.36 12.16 30.08 12.16c8.8 0 16.96-2.88 21.28-7.2c5.92-6.08 8.16-34.88-2.24-46.24c-4.8-5.12-14.24-8.8-25.44-9.92c-10.56-.96-20 .64-24.16 4.32M128 56c-2.56 0-5.6.16-8.96.48c.32 1.76.48 3.68.64 5.76c0 1.44 0 2.88-.16 4.48c3.2-.32 5.92-.32 8.48-.32s5.28 0 8.48.32c-.16-1.6-.16-3.04-.16-4.48c.16-2.08.32-4 .64-5.76c-3.36-.32-6.4-.48-8.96-.48"})}),Fb=L((e=>e(fa).completion.copilot)),Lb=()=>"github"===W(Fb)?a.jsx(Rb,{}):null,Rb=()=>{const e=W(ti),t=null!==W(ni),n=e?"Ready":"Not connected";return a.jsx(s,{content:`GitHub Copilot: ${n}`,children:a.jsx("span",{children:t?a.jsx(ma,{className:"h-4 w-4"}):a.jsx(Db,{className:Lt("h-4 w-4",!e&&"opacity-60")})})})},zb=e=>{const[t,n]=S.useState(0),o=W(fi);ei((()=>n((e=>e+1))),{delayMs:1e4,whenVisible:!0});const{data:r}=zt((async()=>v()||o.state!==mi.OPEN?null:pa()),[t,o.state]);return a.jsxs("div",{className:"flex gap-3",children:[r&&a.jsx(Ub,{memory:r.memory,kernel:r.kernel,server:r.server}),r&&a.jsx(Vb,{cpu:r.cpu}),a.jsx(Lb,{}),a.jsx(Bb,{connection:o.state})]})},Bb=({connection:e})=>a.jsx(s,{delayDuration:200,content:y(e.toLowerCase()),children:a.jsxs("div",{children:[e===mi.OPEN&&a.jsx(nl,{className:"w-4 h-4"}),e===mi.CLOSED&&a.jsx(oi,{className:"w-4 h-4"}),e===mi.CONNECTING&&a.jsx(ma,{size:"small"}),e===mi.CLOSING&&a.jsx(ma,{className:"text-destructive",size:"small"})]})}),Ub=({memory:e,kernel:t,server:n})=>{const{percent:o,total:r,used:i}=e,l=Math.round(o);return a.jsx(s,{delayDuration:200,content:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("span",{children:[a.jsx("b",{children:"computer memory:"})," ",Hb(i)," / ",Hb(r)," GB (",l,"%)"]}),(null==n?void 0:n.memory)&&a.jsxs("span",{children:[a.jsx("b",{children:"marimo server:"})," ",Gb(n.memory)]}),(null==t?void 0:t.memory)&&a.jsxs("span",{children:[a.jsx("b",{children:"kernel:"})," ",Gb(t.memory)]})]}),children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Cl,{className:"w-4 h-4"}),a.jsx($b,{percent:l})]})})},Vb=({cpu:e})=>{const{percent:t}=e,n=Math.round(t);return a.jsx(s,{delayDuration:200,content:a.jsxs("span",{children:[a.jsx("b",{children:"CPU:"})," ",n,"%"]}),children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(dl,{className:"w-4 h-4"}),a.jsx($b,{percent:n})]})})},$b=({percent:e})=>a.jsx("div",{className:"h-3 w-20 bg-[var(--slate-4)] rounded-lg overflow-hidden border",children:a.jsx("div",{className:"h-full bg-primary",style:{width:`${e}%`}})});function Gb(e){return e>1073741824?`${Hb(e)} GB`:`${function(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e/1048576)}(e)} MB`}function Hb(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(e/1073741824)}const Wb=e=>W(Yr)[e.capability]?e.children:null,qb=()=>{const{selectedPanel:e,isTerminalOpen:t}=$c(),{openApplication:n,toggleTerminal:o}=Gc(),[r,i]=ge(),l=W(ga),c=Hc.find((e=>"errors"===e.type));return Nt(c,"Error panel not found"),a.jsxs("footer",{className:"h-10 py-2 bg-background flex items-center text-muted-foreground text-md pl-1 pr-4 border-t border-border select-none no-print text-sm shadow-[0_0_4px_1px_rgba(0,0,0,0.1)] z-50 print:hidden",children:[a.jsxs(Yb,{tooltip:c.tooltip,selected:e===c.type,onClick:()=>n(c.type),children:[(({Icon:e},t)=>a.jsx(e,{className:Lt("h-5 w-5",t)}))(c,l>0?"text-destructive":""),a.jsx("span",{className:"ml-1 font-mono mt-[0.125rem]",children:l})]}),a.jsx(Wb,{capability:"terminal",children:a.jsx(Yb,{tooltip:"Open terminal",selected:t,onClick:()=>o(),children:a.jsx(Zl,{className:"h-5 w-5"})})}),a.jsx(Yb,{tooltip:r.runtime.auto_instantiate?"Disable autorun on startup":"Enable autorun on startup",selected:!1,onClick:async()=>{const e={...r,runtime:{...r.runtime,auto_instantiate:!r.runtime.auto_instantiate}};await p({config:e}).then((()=>i(e)))},children:a.jsxs("div",{className:"font-prose text-sm flex items-center gap-1",children:[a.jsx("span",{children:"on startup: "}),r.runtime.auto_instantiate?a.jsx(sc,{size:14}):a.jsx(ac,{size:16}),a.jsx("span",{children:r.runtime.auto_instantiate?"autorun":"lazy"})]})}),a.jsx("div",{className:"border-r border-border h-6 mx-1"}),a.jsx(Yb,{tooltip:"autorun"===r.runtime.on_cell_change?"Disable autorun":"Enable autorun",selected:!1,onClick:async()=>{const e={...r,runtime:{...r.runtime,on_cell_change:"autorun"===r.runtime.on_cell_change?"lazy":"autorun"}};await p({config:e}).then((()=>i(e)))},children:a.jsxs("div",{className:"font-prose text-sm flex items-center gap-1",children:[a.jsx("span",{children:"on cell change: "}),"autorun"===r.runtime.on_cell_change?a.jsx(sc,{size:14}):a.jsx(ac,{size:16}),a.jsx("span",{children:r.runtime.on_cell_change})]})}),a.jsx("div",{className:"mx-auto"}),a.jsx(yd,{children:a.jsx(s,{content:a.jsx("div",{className:"w-[200px]",children:"Kiosk mode is enabled. This allows you to view the outputs of the cells without the ability to edit them."}),children:a.jsx("span",{className:"text-muted-foreground text-sm mr-4",children:"kiosk mode"})})}),a.jsx(zb,{})]})},Yb=({children:e,tooltip:t,selected:n,className:o,...r})=>a.jsx(s,{content:t,side:"top",delayDuration:200,children:a.jsx("div",{className:Lt("h-full flex items-center p-2 text-sm mx-[1px] shadow-inset font-mono cursor-pointer rounded",!n&&"hover:bg-[var(--sage-3)]",n&&"bg-[var(--sage-4)]",o),...r,children:e})}),Jb=({children:e})=>{const{openModal:t,closeModal:n}=r();return a.jsx(xa,{onClick:()=>t(a.jsx(Xb,{onClose:n})),children:e})},Kb={"😡":1,"🙁":2,"😐":3,"🙂":4,"😍":5},Xb=({onClose:e})=>a.jsx(i,{className:"w-fit",children:a.jsxs("form",{onSubmit:async t=>{t.preventDefault();const n=new FormData(t.target),o=n.get("rating"),r=n.get("message");fetch("https://marimo.io/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:o,message:r})}),e(),U({title:"Feedback sent!",description:"Thank you for your feedback!"})},children:[a.jsxs(Q,{children:[a.jsx(l,{children:"Send Feedback"}),a.jsxs(c,{children:["Let us know what you think about marimo! If you have a bug that you would like to report, please use the"," ",a.jsx("a",{href:Pe.issuesPage,target:"_blank",rel:"noreferrer",className:"underline",children:"GitHub issue tracker"}),"."]}),a.jsx(c,{children:"Your feedback is anonymous and will help us improve marimo. Thank you!"})]}),a.jsxs("div",{className:"flex flex-col gap-6 py-4",children:[a.jsx("div",{className:"flex gap-5 justify-center",children:Object.entries(Kb).map((([e,t])=>a.jsxs("label",{className:"flex flex-col items-center select-none",children:[a.jsx("input",{type:"radio",className:"peer hidden",name:"rating",value:t,"aria-label":e},e),a.jsx("span",{className:"text-4xl peer-checked:opacity-100 opacity-40 cursor-pointer",children:e})]},e)))}),a.jsx(ya,{id:"message",name:"message",autoFocus:!0,placeholder:"Your feedback; if you'd like us to respond, please include your email!",rows:5,required:!0,autoComplete:"off"})]}),a.jsxs(d,{children:[a.jsx(u,{"data-testid":"feedback-cancel-button",variant:"secondary",onClick:e,children:"Cancel"}),a.jsx(u,{"data-testid":"feedback-send-button","aria-label":"Save",variant:"default",type:"submit",children:"Send"})]})]})}),Zb=()=>{const{selectedPanel:e}=$c(),{openApplication:t}=Gc(),n=({Icon:e},t)=>a.jsx(e,{className:Lt("h-5 w-5",t)}),o=Hc.filter((e=>!e.hidden&&"sidebar"===e.position));return a.jsxs("div",{className:"h-full pt-4 pb-1 px-1 flex flex-col items-start text-muted-foreground text-md select-none no-print text-sm z-50 dark:bg-background print:hidden",children:[o.map((o=>a.jsx(ew,{tooltip:o.tooltip,selected:e===o.type,onClick:()=>t(o.type),children:n(o)},o.type))),a.jsx(Jb,{children:a.jsx(ew,{tooltip:"Send feedback!",selected:!1,children:a.jsx(jl,{className:"h-5 w-5"})})}),a.jsx("div",{className:"flex-1"}),a.jsx(Qb,{})]})},Qb=()=>{const e=W(va);return a.jsx(s,{content:e>0?a.jsxs("span",{children:[e," cell",e>1?"s":""," queued or running"]}):"No cells queued or running",side:"right",delayDuration:200,children:a.jsx("div",{className:"flex flex-col-reverse gap-[1px] overflow-hidden",children:Array.from({length:e}).map(((e,t)=>a.jsx("div",{className:"flex-shrink-0 h-1 w-2 bg-[var(--grass-6)] border border-[var(--grass-7)]"},t.toString())))})})},ew=({children:e,tooltip:t,selected:n,className:o,...r})=>a.jsx(s,{content:t,side:"right",delayDuration:200,children:a.jsx("div",{className:Lt("flex items-center p-2 text-sm mx-[1px] shadow-inset font-mono cursor-pointer rounded",!n&&"hover:bg-[var(--sage-3)]",n&&"bg-[var(--sage-4)]",o),...r,children:e})});Ue.record(Ue.tuple([Ue.number(),Ue.number()]));let tw=null;const nw=({title:e,description:t,color:n,icon:o})=>a.jsxs("div",{className:"mx-6 my-6 flex flex-col gap-2",children:[a.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[o&&T.cloneElement(o,{className:"text-accent-foreground"}),a.jsx("span",{className:"mt-1 text-accent-foreground",children:e})]}),a.jsx("span",{className:"text-muted-foreground text-sm",children:t})]}),ow=()=>{const e=ba();return 0===e.length?a.jsx(nw,{title:"No errors!",icon:a.jsx(_l,{})}):a.jsx("div",{className:"flex flex-col overflow-auto",children:e.map((e=>a.jsxs("div",{children:[a.jsx("div",{className:"text-xs font-mono font-semibold bg-muted border-y px-2 py-1",children:a.jsx(wa,{cellId:e.cellId})}),a.jsx("div",{className:"px-2",children:a.jsx(ka,{errors:e.output.data},e.cellId)},e.cellId)]},e.cellId)))})},rw=()=>{const{items:e}=W(Na),t=S.useMemo((()=>Di(e)),[e]),{activeHeaderId:n}=Fi(t);return 0===e.length?a.jsx(nw,{title:"No outline",description:"Add markdown headings to your notebook to create an outline.",icon:a.jsx(Vl,{})}):a.jsx(Li,{items:e,activeHeaderId:n})};function aw(e){if("string"==typeof e||"number"==typeof e)return""+e;let t="";if(Array.isArray(e))for(let n,o=0;o<e.length;o++)""!==(n=aw(e[o]))&&(t+=(t&&" ")+n);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const{useDebugValue:sw}=T,{useSyncExternalStoreWithSelector:iw}=Ea,lw=e=>e;function cw(e,t=lw,n){const o=iw(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return sw(o),o}const dw=(e,t)=>{const n=Ca(e),o=(e,o=t)=>cw(n,e,o);return Object.assign(o,n),o};function uw(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,o]of e)if(!Object.is(o,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}function hw(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var o=n.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,[(o=o.matrixTransform(t.getScreenCTM().inverse())).x,o.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const fw={passive:!1},mw={capture:!0,passive:!1};function pw(e){e.stopImmediatePropagation()}function gw(e){e.preventDefault(),e.stopImmediatePropagation()}function xw(e){var t=e.document.documentElement,n=zi(e).on("dragstart.drag",gw,mw);"onselectstart"in t?n.on("selectstart.drag",gw,mw):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function yw(e,t){var n=e.document.documentElement,o=zi(e).on("dragstart.drag",null);t&&(o.on("click.drag",gw,mw),setTimeout((function(){o.on("click.drag",null)}),0)),"onselectstart"in n?o.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const vw=e=>()=>e;function bw(e,{sourceEvent:t,subject:n,target:o,identifier:r,active:a,x:s,y:i,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:i,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}function ww(e){return!e.ctrlKey&&!e.button}function kw(){return this.parentNode}function Nw(e,t){return null==t?{x:e.x,y:e.y}:t}function Ew(){return navigator.maxTouchPoints||"ontouchstart"in this}bw.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};const Cw=e=>()=>e;function jw(e,{sourceEvent:t,target:n,transform:o,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:r}})}function Sw(e){e.stopImmediatePropagation()}function Iw(e){e.preventDefault(),e.stopImmediatePropagation()}function Aw(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function Tw(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Ow(){return this.__zoom||Bi}function Mw(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function _w(){return navigator.maxTouchPoints||"ontouchstart"in this}function Pw(e,t,n){var o=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],a=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(r>o?(o+r)/2:Math.min(0,o)||Math.max(0,r),s>a?(a+s)/2:Math.min(0,a)||Math.max(0,s))}const Dw=S.createContext(null),Fw=Dw.Provider,Lw={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},Rw=Lw.error001();function zw(e,t){const n=S.useContext(Dw);if(null===n)throw new Error(Rw);return cw(n,e,t)}const Bw=()=>{const e=S.useContext(Dw);if(null===e)throw new Error(Rw);return S.useMemo((()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy})),[e])},Uw=e=>e.userSelectionActive?"none":"all";function Vw({position:e,children:t,className:n,style:o,...r}){const a=zw(Uw),s=`${e}`.split("-");return T.createElement("div",{className:aw(["react-flow__panel",n,...s]),style:{...o,pointerEvents:a},...r},t)}function $w({proOptions:e,position:t="bottom-right"}){return(null==e?void 0:e.hideAttribution)?null:T.createElement(Vw,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},T.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}var Gw=S.memo((({x:e,y:t,label:n,labelStyle:o={},labelShowBg:r=!0,labelBgStyle:a={},labelBgPadding:s=[2,4],labelBgBorderRadius:i=2,children:l,className:c,...d})=>{const u=S.useRef(null),[h,f]=S.useState({x:0,y:0,width:0,height:0}),m=aw(["react-flow__edge-textwrapper",c]);return S.useEffect((()=>{if(u.current){const e=u.current.getBBox();f({x:e.x,y:e.y,width:e.width,height:e.height})}}),[n]),void 0!==n&&n?T.createElement("g",{transform:`translate(${e-h.width/2} ${t-h.height/2})`,className:m,visibility:h.width?"visible":"hidden",...d},r&&T.createElement("rect",{width:h.width+2*s[0],x:-s[0],y:-s[1],height:h.height+2*s[1],className:"react-flow__edge-textbg",style:a,rx:i,ry:i}),T.createElement("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:u,style:o},n),l):null}));const Hw=e=>({width:e.offsetWidth,height:e.offsetHeight}),Ww=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),qw=(e={x:0,y:0},t)=>({x:Ww(e.x,t[0][0],t[1][0]),y:Ww(e.y,t[0][1],t[1][1])}),Yw=(e,t,n)=>e<t?Ww(Math.abs(e-t),1,50)/50:e>n?-Ww(Math.abs(e-n),1,50)/50:0,Jw=(e,t)=>[20*Yw(e.x,35,t.width-35),20*Yw(e.y,35,t.height-35)],Kw=e=>{var t;return(null==(t=e.getRootNode)?void 0:t.call(e))||(null==window?void 0:window.document)},Xw=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),Zw=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),Qw=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},ek=e=>tk(e.width)&&tk(e.height)&&tk(e.x)&&tk(e.y),tk=e=>!isNaN(e)&&isFinite(e),nk=Symbol.for("internals"),ok=["Enter"," ","Escape"];function rk(e){var t,n;const o=(e=>"nativeEvent"in e)(e)?e.nativeEvent:e,r=(null==(n=null==(t=o.composedPath)?void 0:t.call(o))?void 0:n[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(null==r?void 0:r.nodeName)||(null==r?void 0:r.hasAttribute("contenteditable"))||!!(null==r?void 0:r.closest(".nokey"))}const ak=e=>"clientX"in e,sk=(e,t)=>{var n,o;const r=ak(e),a=r?e.clientX:null==(n=e.touches)?void 0:n[0].clientX,s=r?e.clientY:null==(o=e.touches)?void 0:o[0].clientY;return{x:a-((null==t?void 0:t.left)??0),y:s-((null==t?void 0:t.top)??0)}},ik=()=>{var e;return"undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.indexOf("Mac"))>=0},lk=({id:e,path:t,labelX:n,labelY:o,label:r,labelStyle:a,labelShowBg:s,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,style:d,markerEnd:u,markerStart:h,interactionWidth:f=20})=>T.createElement(T.Fragment,null,T.createElement("path",{id:e,style:d,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:u,markerStart:h}),f&&T.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),r&&tk(n)&&tk(o)?T.createElement(Gw,{x:n,y:o,label:r,labelStyle:a,labelShowBg:s,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c}):null);function ck(e,t,n){return void 0===n?n:o=>{const r=t().edges.find((t=>t.id===e));r&&n(o,{...r})}}function dk({sourceX:e,sourceY:t,targetX:n,targetY:o}){const r=Math.abs(n-e)/2,a=n<e?n+r:n-r,s=Math.abs(o-t)/2;return[a,o<t?o+s:o-s,r,s]}function uk({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:r,sourceControlY:a,targetControlX:s,targetControlY:i}){const l=.125*e+.375*r+.375*s+.125*n,c=.125*t+.375*a+.375*i+.125*o;return[l,c,Math.abs(l-e),Math.abs(c-t)]}var hk,fk,mk,pk,gk,xk,yk,vk,bk,wk,kk,Nk;function Ek({pos:e,x1:t,y1:n,x2:o,y2:r}){return e===kk.Left||e===kk.Right?[.5*(t+o),n]:[t,.5*(n+r)]}function Ck({sourceX:e,sourceY:t,sourcePosition:n=kk.Bottom,targetX:o,targetY:r,targetPosition:a=kk.Top}){const[s,i]=Ek({pos:n,x1:e,y1:t,x2:o,y2:r}),[l,c]=Ek({pos:a,x1:o,y1:r,x2:e,y2:t}),[d,u,h,f]=uk({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:s,sourceControlY:i,targetControlX:l,targetControlY:c});return[`M${e},${t} C${s},${i} ${l},${c} ${o},${r}`,d,u,h,f]}lk.displayName="BaseEdge",(fk=hk||(hk={})).Strict="strict",fk.Loose="loose",(pk=mk||(mk={})).Free="free",pk.Vertical="vertical",pk.Horizontal="horizontal",(xk=gk||(gk={})).Partial="partial",xk.Full="full",(vk=yk||(yk={})).Bezier="default",vk.Straight="straight",vk.Step="step",vk.SmoothStep="smoothstep",vk.SimpleBezier="simplebezier",(wk=bk||(bk={})).Arrow="arrow",wk.ArrowClosed="arrowclosed",(Nk=kk||(kk={})).Left="left",Nk.Top="top",Nk.Right="right",Nk.Bottom="bottom";const jk=S.memo((({sourceX:e,sourceY:t,targetX:n,targetY:o,sourcePosition:r=kk.Bottom,targetPosition:a=kk.Top,label:s,labelStyle:i,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:m,interactionWidth:p})=>{const[g,x,y]=Ck({sourceX:e,sourceY:t,sourcePosition:r,targetX:n,targetY:o,targetPosition:a});return T.createElement(lk,{path:g,labelX:x,labelY:y,label:s,labelStyle:i,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:m,interactionWidth:p})}));jk.displayName="SimpleBezierEdge";const Sk={[kk.Left]:{x:-1,y:0},[kk.Right]:{x:1,y:0},[kk.Top]:{x:0,y:-1},[kk.Bottom]:{x:0,y:1}},Ik=({source:e,sourcePosition:t=kk.Bottom,target:n})=>t===kk.Left||t===kk.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},Ak=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Tk({sourceX:e,sourceY:t,sourcePosition:n=kk.Bottom,targetX:o,targetY:r,targetPosition:a=kk.Top,borderRadius:s=5,centerX:i,centerY:l,offset:c=20}){const[d,u,h,f,m]=function({source:e,sourcePosition:t=kk.Bottom,target:n,targetPosition:o=kk.Top,center:r,offset:a}){const s=Sk[t],i=Sk[o],l={x:e.x+s.x*a,y:e.y+s.y*a},c={x:n.x+i.x*a,y:n.y+i.y*a},d=Ik({source:l,sourcePosition:t,target:c}),u=0!==d.x?"x":"y",h=d[u];let f,m,p=[];const g={x:0,y:0},x={x:0,y:0},[y,v,b,w]=dk({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(s[u]*i[u]==-1){f=r.x??y,m=r.y??v;const e=[{x:f,y:l.y},{x:f,y:c.y}],t=[{x:l.x,y:m},{x:c.x,y:m}];p=s[u]===h?"x"===u?e:t:"x"===u?t:e}else{const r=[{x:l.x,y:c.y}],d=[{x:c.x,y:l.y}];if(p="x"===u?s.x===h?d:r:s.y===h?r:d,t===o){const t=Math.abs(e[u]-n[u]);if(t<=a){const o=Math.min(a-1,a-t);s[u]===h?g[u]=(l[u]>e[u]?-1:1)*o:x[u]=(c[u]>n[u]?-1:1)*o}}if(t!==o){const e="x"===u?"y":"x",t=s[u]===i[e],n=l[e]>c[e],o=l[e]<c[e];(1===s[u]&&(!t&&n||t&&o)||1!==s[u]&&(!t&&o||t&&n))&&(p="x"===u?r:d)}const y={x:l.x+g.x,y:l.y+g.y},v={x:c.x+x.x,y:c.y+x.y};Math.max(Math.abs(y.x-p[0].x),Math.abs(v.x-p[0].x))>=Math.max(Math.abs(y.y-p[0].y),Math.abs(v.y-p[0].y))?(f=(y.x+v.x)/2,m=p[0].y):(f=p[0].x,m=(y.y+v.y)/2)}return[[e,{x:l.x+g.x,y:l.y+g.y},...p,{x:c.x+x.x,y:c.y+x.y},n],f,m,b,w]}({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:r},targetPosition:a,center:{x:i,y:l},offset:c});return[d.reduce(((e,t,n)=>{let o="";return o=n>0&&n<d.length-1?function(e,t,n,o){const r=Math.min(Ak(e,t)/2,Ak(t,n)/2,o),{x:a,y:s}=t;if(e.x===a&&a===n.x||e.y===s&&s===n.y)return`L${a} ${s}`;if(e.y===s)return`L ${a+r*(e.x<n.x?-1:1)},${s}Q ${a},${s} ${a},${s+r*(e.y<n.y?1:-1)}`;const i=e.x<n.x?1:-1;return`L ${a},${s+r*(e.y<n.y?-1:1)}Q ${a},${s} ${a+r*i},${s}`}(d[n-1],t,d[n+1],s):`${0===n?"M":"L"}${t.x} ${t.y}`,e+=o}),""),u,h,f,m]}const Ok=S.memo((({sourceX:e,sourceY:t,targetX:n,targetY:o,label:r,labelStyle:a,labelShowBg:s,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,style:d,sourcePosition:u=kk.Bottom,targetPosition:h=kk.Top,markerEnd:f,markerStart:m,pathOptions:p,interactionWidth:g})=>{const[x,y,v]=Tk({sourceX:e,sourceY:t,sourcePosition:u,targetX:n,targetY:o,targetPosition:h,borderRadius:null==p?void 0:p.borderRadius,offset:null==p?void 0:p.offset});return T.createElement(lk,{path:x,labelX:y,labelY:v,label:r,labelStyle:a,labelShowBg:s,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,style:d,markerEnd:f,markerStart:m,interactionWidth:g})}));Ok.displayName="SmoothStepEdge";const Mk=S.memo((e=>{var t;return T.createElement(Ok,{...e,pathOptions:S.useMemo((()=>{var t;return{borderRadius:0,offset:null==(t=e.pathOptions)?void 0:t.offset}}),[null==(t=e.pathOptions)?void 0:t.offset])})}));Mk.displayName="StepEdge";const _k=S.memo((({sourceX:e,sourceY:t,targetX:n,targetY:o,label:r,labelStyle:a,labelShowBg:s,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,style:d,markerEnd:u,markerStart:h,interactionWidth:f})=>{const[m,p,g]=function({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[r,a,s,i]=dk({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,r,a,s,i]}({sourceX:e,sourceY:t,targetX:n,targetY:o});return T.createElement(lk,{path:m,labelX:p,labelY:g,label:r,labelStyle:a,labelShowBg:s,labelBgStyle:i,labelBgPadding:l,labelBgBorderRadius:c,style:d,markerEnd:u,markerStart:h,interactionWidth:f})}));function Pk(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function Dk({pos:e,x1:t,y1:n,x2:o,y2:r,c:a}){switch(e){case kk.Left:return[t-Pk(t-o,a),n];case kk.Right:return[t+Pk(o-t,a),n];case kk.Top:return[t,n-Pk(n-r,a)];case kk.Bottom:return[t,n+Pk(r-n,a)]}}function Fk({sourceX:e,sourceY:t,sourcePosition:n=kk.Bottom,targetX:o,targetY:r,targetPosition:a=kk.Top,curvature:s=.25}){const[i,l]=Dk({pos:n,x1:e,y1:t,x2:o,y2:r,c:s}),[c,d]=Dk({pos:a,x1:o,y1:r,x2:e,y2:t,c:s}),[u,h,f,m]=uk({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:i,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${e},${t} C${i},${l} ${c},${d} ${o},${r}`,u,h,f,m]}_k.displayName="StraightEdge";const Lk=S.memo((({sourceX:e,sourceY:t,targetX:n,targetY:o,sourcePosition:r=kk.Bottom,targetPosition:a=kk.Top,label:s,labelStyle:i,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:m,pathOptions:p,interactionWidth:g})=>{const[x,y,v]=Fk({sourceX:e,sourceY:t,sourcePosition:r,targetX:n,targetY:o,targetPosition:a,curvature:null==p?void 0:p.curvature});return T.createElement(lk,{path:x,labelX:y,labelY:v,label:s,labelStyle:i,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:m,interactionWidth:g})}));Lk.displayName="BezierEdge";const Rk=S.createContext(null),zk=Rk.Provider;Rk.Consumer;const Bk=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`reactflow__edge-${e}${t||""}-${n}${o||""}`,Uk=(e,t)=>{if(void 0===e)return"";if("string"==typeof e)return e;return`${t?`${t}__`:""}${Object.keys(e).sort().map((t=>`${t}=${e[t]}`)).join("&")}`},Vk=({x:e,y:t},[n,o,r],a,[s,i])=>{const l={x:(e-n)/r,y:(t-o)/r};return a?{x:s*Math.round(l.x/s),y:i*Math.round(l.y/i)}:l},$k=({x:e,y:t},[n,o,r])=>({x:e*r+n,y:t*r+o}),Gk=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(e.width??0)*t[0],o=(e.height??0)*t[1],r={x:e.position.x-n,y:e.position.y-o};return{...r,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-o}:r}},Hk=(e,t=[0,0])=>{if(0===e.length)return{x:0,y:0,width:0,height:0};return(({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}))(e.reduce(((e,n)=>{const{x:o,y:r}=Gk(n,t).positionAbsolute;return a=e,s=Xw({x:o,y:r,width:n.width||0,height:n.height||0}),{x:Math.min(a.x,s.x),y:Math.min(a.y,s.y),x2:Math.max(a.x2,s.x2),y2:Math.max(a.y2,s.y2)};var a,s}),{x:1/0,y:1/0,x2:-1/0,y2:-1/0}))},Wk=(e,t,[n,o,r]=[0,0,1],a=!1,s=!1,i=[0,0])=>{const l={x:(t.x-n)/r,y:(t.y-o)/r,width:t.width/r,height:t.height/r},c=[];return e.forEach((e=>{const{width:t,height:n,selectable:o=!0,hidden:r=!1}=e;if(s&&!o||r)return!1;const{positionAbsolute:d}=Gk(e,i),u={x:d.x,y:d.y,width:t||0,height:n||0},h=Qw(l,u);(void 0===t||void 0===n||null===t||null===n||a&&h>0||h>=(t||0)*(n||0)||e.dragging)&&c.push(e)})),c},qk=(e,t)=>{const n=e.map((e=>e.id));return t.filter((e=>n.includes(e.source)||n.includes(e.target)))},Yk=(e,t,n,o,r,a=.1)=>{const s=t/(e.width*(1+a)),i=n/(e.height*(1+a)),l=Math.min(s,i),c=Ww(l,o,r);return{x:t/2-(e.x+e.width/2)*c,y:n/2-(e.y+e.height/2)*c,zoom:c}},Jk=(e,t=0)=>e.transition().duration(t);function Kk(e,t,n,o){return(t[n]||[]).reduce(((t,r)=>{var a,s;return`${e.id}-${r.id}-${n}`!==o&&t.push({id:r.id||null,type:n,nodeId:e.id,x:((null==(a=e.positionAbsolute)?void 0:a.x)??0)+r.x+r.width/2,y:((null==(s=e.positionAbsolute)?void 0:s.y)??0)+r.y+r.height/2}),t}),[])}const Xk={source:null,target:null,sourceHandle:null,targetHandle:null},Zk=()=>({handleDomNode:null,isValid:!1,connection:Xk,endHandle:null});function Qk(e,t,n,o,r,a,s){const i="target"===r,l=s.querySelector(`.react-flow__handle[data-id="${null==e?void 0:e.nodeId}-${null==e?void 0:e.id}-${null==e?void 0:e.type}"]`),c={...Zk(),handleDomNode:l};if(l){const e=eN(void 0,l),r=l.getAttribute("data-nodeid"),s=l.getAttribute("data-handleid"),d=l.classList.contains("connectable"),u=l.classList.contains("connectableend"),h={source:i?r:n,sourceHandle:i?s:o,target:i?n:r,targetHandle:i?o:s};c.connection=h;d&&u&&(t===hk.Strict?i&&"source"===e||!i&&"target"===e:r!==n||s!==o)&&(c.endHandle={nodeId:r,handleId:s,type:e},c.isValid=a(h))}return c}function eN(e,t){return e||((null==t?void 0:t.classList.contains("target"))?"target":(null==t?void 0:t.classList.contains("source"))?"source":null)}function tN(e){null==e||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function nN(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function oN({event:e,handleId:t,nodeId:n,onConnect:o,isTarget:r,getState:a,setState:s,isValidConnection:i,edgeUpdaterType:l,onReconnectEnd:c}){const d=Kw(e.target),{connectionMode:u,domNode:h,autoPanOnConnect:f,connectionRadius:m,onConnectStart:p,panBy:g,getNodes:x,cancelConnection:y}=a();let v,b=0;const{x:w,y:k}=sk(e),N=null==d?void 0:d.elementFromPoint(w,k),E=eN(l,N),C=null==h?void 0:h.getBoundingClientRect();if(!C||!E)return;let j,S=sk(e,C),I=!1,A=null,T=!1,O=null;const M=function({nodes:e,nodeId:t,handleId:n,handleType:o}){return e.reduce(((e,r)=>{if(r[nk]){const{handleBounds:a}=r[nk];let s=[],i=[];a&&(s=Kk(r,a,"source",`${t}-${n}-${o}`),i=Kk(r,a,"target",`${t}-${n}-${o}`)),e.push(...s,...i)}return e}),[])}({nodes:x(),nodeId:n,handleId:t,handleType:E}),_=()=>{if(!f)return;const[e,t]=Jw(S,C);g({x:e,y:t}),b=requestAnimationFrame(_)};function P(e){const{transform:o}=a();S=sk(e,C);const{handle:l,validHandleResult:c}=function(e,t,n,o,r,a){const{x:s,y:i}=sk(e),l=t.elementsFromPoint(s,i).find((e=>e.classList.contains("react-flow__handle")));if(l){const e=l.getAttribute("data-nodeid");if(e){const t=eN(void 0,l),o=l.getAttribute("data-handleid"),s=a({nodeId:e,id:o,type:t});if(s){const a=r.find((n=>n.nodeId===e&&n.type===t&&n.id===o));return{handle:{id:o,type:t,nodeId:e,x:(null==a?void 0:a.x)||n.x,y:(null==a?void 0:a.y)||n.y},validHandleResult:s}}}}let c=[],d=1/0;if(r.forEach((e=>{const t=Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2);if(t<=o){const n=a(e);t<=d&&(t<d?c=[{handle:e,validHandleResult:n}]:t===d&&c.push({handle:e,validHandleResult:n}),d=t)}})),!c.length)return{handle:null,validHandleResult:Zk()};if(1===c.length)return c[0];const u=c.some((({validHandleResult:e})=>e.isValid)),h=c.some((({handle:e})=>"target"===e.type));return c.find((({handle:e,validHandleResult:t})=>h?"target"===e.type:!u||t.isValid))||c[0]}(e,d,Vk(S,o,!1,[1,1]),m,M,(e=>Qk(e,u,n,t,r?"target":"source",i,d)));if(v=l,I||(_(),I=!0),O=c.handleDomNode,A=c.connection,T=c.isValid,s({connectionPosition:v&&T?$k({x:v.x,y:v.y},o):S,connectionStatus:nN(!!v,T),connectionEndHandle:c.endHandle}),!v&&!T&&!O)return tN(j);A.source!==A.target&&O&&(tN(j),j=O,O.classList.add("connecting","react-flow__handle-connecting"),O.classList.toggle("valid",T),O.classList.toggle("react-flow__handle-valid",T))}function D(e){var t,n;(v||O)&&A&&T&&(null==o||o(A)),null==(n=(t=a()).onConnectEnd)||n.call(t,e),l&&(null==c||c(e)),tN(j),y(),cancelAnimationFrame(b),I=!1,T=!1,A=null,O=null,d.removeEventListener("mousemove",P),d.removeEventListener("mouseup",D),d.removeEventListener("touchmove",P),d.removeEventListener("touchend",D)}s({connectionPosition:S,connectionStatus:null,connectionNodeId:n,connectionHandleId:t,connectionHandleType:E,connectionStartHandle:{nodeId:n,handleId:t,type:E},connectionEndHandle:null}),null==p||p(e,{nodeId:n,handleId:t,handleType:E}),d.addEventListener("mousemove",P),d.addEventListener("mouseup",D),d.addEventListener("touchmove",P),d.addEventListener("touchend",D)}const rN=()=>!0,aN=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),sN=S.forwardRef((({type:e="source",position:t=kk.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:r=!0,isConnectableEnd:a=!0,id:s,onConnect:i,children:l,className:c,onMouseDown:d,onTouchStart:u,...h},f)=>{var m,p;const g=s||null,x="target"===e,y=Bw(),v=S.useContext(Rk),{connectOnClick:b,noPanClassName:w}=zw(aN,uw),{connecting:k,clickConnecting:N}=zw(((e,t,n)=>o=>{const{connectionStartHandle:r,connectionEndHandle:a,connectionClickStartHandle:s}=o;return{connecting:(null==r?void 0:r.nodeId)===e&&(null==r?void 0:r.handleId)===t&&(null==r?void 0:r.type)===n||(null==a?void 0:a.nodeId)===e&&(null==a?void 0:a.handleId)===t&&(null==a?void 0:a.type)===n,clickConnecting:(null==s?void 0:s.nodeId)===e&&(null==s?void 0:s.handleId)===t&&(null==s?void 0:s.type)===n}})(v,g,e),uw);v||null==(p=(m=y.getState()).onError)||p.call(m,"010",Lw.error010());const E=e=>{const{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:o}=y.getState(),r={...t,...e};if(o){const{edges:e,setEdges:t}=y.getState();t(((e,t)=>{if(!e.source||!e.target)return t;let n;var o;return n="id"in(o=e)&&"source"in o&&"target"in o?{...e}:{...e,id:Bk(e)},((e,t)=>t.some((t=>!(t.source!==e.source||t.target!==e.target||t.sourceHandle!==e.sourceHandle&&(t.sourceHandle||e.sourceHandle)||t.targetHandle!==e.targetHandle&&(t.targetHandle||e.targetHandle)))))(n,t)?t:t.concat(n)})(r,e))}null==n||n(r),null==i||i(r)},C=e=>{if(!v)return;const t=ak(e);r&&(t&&0===e.button||!t)&&oN({event:e,handleId:g,nodeId:v,onConnect:E,isTarget:x,getState:y.getState,setState:y.setState,isValidConnection:n||y.getState().isValidConnection||rN}),t?null==d||d(e):null==u||u(e)};return T.createElement("div",{"data-handleid":g,"data-nodeid":v,"data-handlepos":t,"data-id":`${v}-${g}-${e}`,className:aw(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",w,c,{source:!x,target:x,connectable:o,connectablestart:r,connectableend:a,connecting:N,connectionindicator:o&&(r&&!k||a&&k)}]),onMouseDown:C,onTouchStart:C,onClick:b?t=>{const{onClickConnectStart:o,onClickConnectEnd:a,connectionClickStartHandle:s,connectionMode:i,isValidConnection:l}=y.getState();if(!v||!s&&!r)return;if(!s)return null==o||o(t,{nodeId:v,handleId:g,handleType:e}),void y.setState({connectionClickStartHandle:{nodeId:v,type:e,handleId:g}});const c=Kw(t.target),d=n||l||rN,{connection:u,isValid:h}=Qk({nodeId:v,id:g,type:e},i,s.nodeId,s.handleId||null,s.type,d,c);h&&E(u),null==a||a(t),y.setState({connectionClickStartHandle:null})}:void 0,ref:f,...h},l)}));sN.displayName="Handle";var iN=S.memo(sN);const lN=({data:e,isConnectable:t,targetPosition:n=kk.Top,sourcePosition:o=kk.Bottom})=>T.createElement(T.Fragment,null,T.createElement(iN,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label,T.createElement(iN,{type:"source",position:o,isConnectable:t}));lN.displayName="DefaultNode";var cN=S.memo(lN);const dN=({data:e,isConnectable:t,sourcePosition:n=kk.Bottom})=>T.createElement(T.Fragment,null,null==e?void 0:e.label,T.createElement(iN,{type:"source",position:n,isConnectable:t}));dN.displayName="InputNode";var uN=S.memo(dN);const hN=({data:e,isConnectable:t,targetPosition:n=kk.Top})=>T.createElement(T.Fragment,null,T.createElement(iN,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label);hN.displayName="OutputNode";var fN=S.memo(hN);const mN=()=>null;mN.displayName="GroupNode";const pN=e=>({selectedNodes:e.getNodes().filter((e=>e.selected)),selectedEdges:e.edges.filter((e=>e.selected)).map((e=>({...e})))}),gN=e=>e.id;function xN(e,t){return uw(e.selectedNodes.map(gN),t.selectedNodes.map(gN))&&uw(e.selectedEdges.map(gN),t.selectedEdges.map(gN))}const yN=S.memo((({onSelectionChange:e})=>{const t=Bw(),{selectedNodes:n,selectedEdges:o}=zw(pN,xN);return S.useEffect((()=>{const r={nodes:n,edges:o};null==e||e(r),t.getState().onSelectionChange.forEach((e=>e(r)))}),[n,o,e]),null}));yN.displayName="SelectionListener";const vN=e=>!!e.onSelectionChange;function bN({onSelectionChange:e}){const t=zw(vN);return e||t?T.createElement(yN,{onSelectionChange:e}):null}const wN=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function kN(e,t){S.useEffect((()=>{void 0!==e&&t(e)}),[e])}function NN(e,t,n){S.useEffect((()=>{void 0!==t&&n({[e]:t})}),[t])}const EN=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:r,onConnectStart:a,onConnectEnd:s,onClickConnectStart:i,onClickConnectEnd:l,nodesDraggable:c,nodesConnectable:d,nodesFocusable:u,edgesFocusable:h,edgesUpdatable:f,elevateNodesOnSelect:m,minZoom:p,maxZoom:g,nodeExtent:x,onNodesChange:y,onEdgesChange:v,elementsSelectable:b,connectionMode:w,snapGrid:k,snapToGrid:N,translateExtent:E,connectOnClick:C,defaultEdgeOptions:j,fitView:I,fitViewOptions:A,onNodesDelete:T,onEdgesDelete:O,onNodeDrag:M,onNodeDragStart:_,onNodeDragStop:P,onSelectionDrag:D,onSelectionDragStart:F,onSelectionDragStop:L,noPanClassName:R,nodeOrigin:z,rfId:B,autoPanOnConnect:U,autoPanOnNodeDrag:V,onError:$,connectionRadius:G,isValidConnection:H,nodeDragThreshold:W})=>{const{setNodes:q,setEdges:Y,setDefaultNodesAndEdges:J,setMinZoom:K,setMaxZoom:X,setTranslateExtent:Z,setNodeExtent:Q,reset:ee}=zw(wN,uw),te=Bw();return S.useEffect((()=>{const e=null==o?void 0:o.map((e=>({...e,...j})));return J(n,e),()=>{ee()}}),[]),NN("defaultEdgeOptions",j,te.setState),NN("connectionMode",w,te.setState),NN("onConnect",r,te.setState),NN("onConnectStart",a,te.setState),NN("onConnectEnd",s,te.setState),NN("onClickConnectStart",i,te.setState),NN("onClickConnectEnd",l,te.setState),NN("nodesDraggable",c,te.setState),NN("nodesConnectable",d,te.setState),NN("nodesFocusable",u,te.setState),NN("edgesFocusable",h,te.setState),NN("edgesUpdatable",f,te.setState),NN("elementsSelectable",b,te.setState),NN("elevateNodesOnSelect",m,te.setState),NN("snapToGrid",N,te.setState),NN("snapGrid",k,te.setState),NN("onNodesChange",y,te.setState),NN("onEdgesChange",v,te.setState),NN("connectOnClick",C,te.setState),NN("fitViewOnInit",I,te.setState),NN("fitViewOnInitOptions",A,te.setState),NN("onNodesDelete",T,te.setState),NN("onEdgesDelete",O,te.setState),NN("onNodeDrag",M,te.setState),NN("onNodeDragStart",_,te.setState),NN("onNodeDragStop",P,te.setState),NN("onSelectionDrag",D,te.setState),NN("onSelectionDragStart",F,te.setState),NN("onSelectionDragStop",L,te.setState),NN("noPanClassName",R,te.setState),NN("nodeOrigin",z,te.setState),NN("rfId",B,te.setState),NN("autoPanOnConnect",U,te.setState),NN("autoPanOnNodeDrag",V,te.setState),NN("onError",$,te.setState),NN("connectionRadius",G,te.setState),NN("isValidConnection",H,te.setState),NN("nodeDragThreshold",W,te.setState),kN(e,q),kN(t,Y),kN(p,K),kN(g,X),kN(E,Z),kN(x,Q),null},CN={display:"none"},jN={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},SN="react-flow__node-desc",IN="react-flow__edge-desc",AN="react-flow__aria-live",TN=e=>e.ariaLiveMessage;function ON({rfId:e}){const t=zw(TN);return T.createElement("div",{id:`${AN}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:jN},t)}function MN({rfId:e,disableKeyboardA11y:t}){return T.createElement(T.Fragment,null,T.createElement("div",{id:`${SN}-${e}`,style:CN},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),T.createElement("div",{id:`${IN}-${e}`,style:CN},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&T.createElement(ON,{rfId:e}))}var _N=(e=null,t={actInsideInputWithModifier:!0})=>{const[n,o]=S.useState(!1),r=S.useRef(!1),a=S.useRef(new Set([])),[s,i]=S.useMemo((()=>{if(null!==e){const t=(Array.isArray(e)?e:[e]).filter((e=>"string"==typeof e)).map((e=>e.split("+"))),n=t.reduce(((e,t)=>e.concat(...t)),[]);return[t,n]}return[[],[]]}),[e]);return S.useEffect((()=>{const n="undefined"!=typeof document?document:null,l=(null==t?void 0:t.target)||n;if(null!==e){const e=e=>{r.current=e.ctrlKey||e.metaKey||e.shiftKey;if((!r.current||r.current&&!t.actInsideInputWithModifier)&&rk(e))return!1;const n=DN(e.code,i);a.current.add(e[n]),PN(s,a.current,!1)&&(e.preventDefault(),o(!0))},n=e=>{if((!r.current||r.current&&!t.actInsideInputWithModifier)&&rk(e))return!1;const n=DN(e.code,i);PN(s,a.current,!0)?(o(!1),a.current.clear()):a.current.delete(e[n]),"Meta"===e.key&&a.current.clear(),r.current=!1},c=()=>{a.current.clear(),o(!1)};return null==l||l.addEventListener("keydown",e),null==l||l.addEventListener("keyup",n),window.addEventListener("blur",c),()=>{null==l||l.removeEventListener("keydown",e),null==l||l.removeEventListener("keyup",n),window.removeEventListener("blur",c)}}}),[e,o]),n};function PN(e,t,n){return e.filter((e=>n||e.length===t.size)).some((e=>e.every((e=>t.has(e)))))}function DN(e,t){return t.includes(e)?"code":"key"}function FN(e,t,n,o){var r,a;const s=e.parentNode||e.parentId;if(!s)return n;const i=t.get(s),l=Gk(i,o);return FN(i,t,{x:(n.x??0)+l.x,y:(n.y??0)+l.y,z:((null==(r=i[nk])?void 0:r.z)??0)>(n.z??0)?(null==(a=i[nk])?void 0:a.z)??0:n.z??0},o)}function LN(e,t,n){e.forEach((o=>{var r;const a=o.parentNode||o.parentId;if(a&&!e.has(a))throw new Error(`Parent node ${a} not found`);if(a||(null==n?void 0:n[o.id])){const{x:a,y:s,z:i}=FN(o,e,{...o.position,z:(null==(r=o[nk])?void 0:r.z)??0},t);o.positionAbsolute={x:a,y:s},o[nk].z=i,(null==n?void 0:n[o.id])&&(o[nk].isParent=!0)}}))}function RN(e,t,n,o){const r=new Map,a={},s=o?1e3:0;return e.forEach((e=>{var n;const o=(tk(e.zIndex)?e.zIndex:0)+(e.selected?s:0),i=t.get(e.id),l={...e,positionAbsolute:{x:e.position.x,y:e.position.y}},c=e.parentNode||e.parentId;c&&(a[c]=!0);const d=(null==i?void 0:i.type)&&(null==i?void 0:i.type)!==e.type;Object.defineProperty(l,nk,{enumerable:!1,value:{handleBounds:d||null==(n=null==i?void 0:i[nk])?void 0:n.handleBounds,z:o}}),r.set(e.id,l)})),LN(r,n,a),r}function zN(e,t={}){const{getNodes:n,width:o,height:r,minZoom:a,maxZoom:s,d3Zoom:i,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:d,nodeOrigin:u}=e(),h=t.initial&&!c&&d;if(i&&l&&(h||!t.initial)){const e=n().filter((e=>{var n;const o=t.includeHiddenNodes?e.width&&e.height:!e.hidden;return(null==(n=t.nodes)?void 0:n.length)?o&&t.nodes.some((t=>t.id===e.id)):o})),c=e.every((e=>e.width&&e.height));if(e.length>0&&c){const n=Hk(e,u),{x:c,y:d,zoom:h}=Yk(n,o,r,t.minZoom??a,t.maxZoom??s,t.padding??.1),f=Bi.translate(c,d).scale(h);return"number"==typeof t.duration&&t.duration>0?i.transform(Jk(l,t.duration),f):i.transform(l,f),!0}}return!1}function BN(e,t){return e.forEach((e=>{const n=t.get(e.id);n&&t.set(n.id,{...n,[nk]:n[nk],selected:e.selected})})),new Map(t)}function UN(e,t){return t.map((t=>{const n=e.find((e=>e.id===t.id));return n&&(t.selected=n.selected),t}))}function VN({changedNodes:e,changedEdges:t,get:n,set:o}){const{nodeInternals:r,edges:a,onNodesChange:s,onEdgesChange:i,hasDefaultNodes:l,hasDefaultEdges:c}=n();(null==e?void 0:e.length)&&(l&&o({nodeInternals:BN(e,r)}),null==s||s(e)),(null==t?void 0:t.length)&&(c&&o({edges:UN(t,a)}),null==i||i(t))}const $N=()=>{},GN={zoomIn:$N,zoomOut:$N,zoomTo:$N,getZoom:()=>1,setViewport:$N,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:$N,fitBounds:$N,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},HN=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),WN=()=>{const e=Bw(),{d3Zoom:t,d3Selection:n}=zw(HN,uw);return S.useMemo((()=>n&&t?{zoomIn:e=>t.scaleBy(Jk(n,null==e?void 0:e.duration),1.2),zoomOut:e=>t.scaleBy(Jk(n,null==e?void 0:e.duration),1/1.2),zoomTo:(e,o)=>t.scaleTo(Jk(n,null==o?void 0:o.duration),e),getZoom:()=>e.getState().transform[2],setViewport:(o,r)=>{const[a,s,i]=e.getState().transform,l=Bi.translate(o.x??a,o.y??s).scale(o.zoom??i);t.transform(Jk(n,null==r?void 0:r.duration),l)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},fitView:t=>zN(e.getState,t),setCenter:(o,r,a)=>{const{width:s,height:i,maxZoom:l}=e.getState(),c=void 0!==(null==a?void 0:a.zoom)?a.zoom:l,d=s/2-o*c,u=i/2-r*c,h=Bi.translate(d,u).scale(c);t.transform(Jk(n,null==a?void 0:a.duration),h)},fitBounds:(o,r)=>{const{width:a,height:s,minZoom:i,maxZoom:l}=e.getState(),{x:c,y:d,zoom:u}=Yk(o,a,s,i,l,(null==r?void 0:r.padding)??.1),h=Bi.translate(c,d).scale(u);t.transform(Jk(n,null==r?void 0:r.duration),h)},project:t=>{const{transform:n,snapToGrid:o,snapGrid:r}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),Vk(t,n,o,r)},screenToFlowPosition:t=>{const{transform:n,snapToGrid:o,snapGrid:r,domNode:a}=e.getState();if(!a)return t;const{x:s,y:i}=a.getBoundingClientRect(),l={x:t.x-s,y:t.y-i};return Vk(l,n,o,r)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:r,y:a}=o.getBoundingClientRect(),s=$k(t,n);return{x:s.x+r,y:s.y+a}},viewportInitialized:!0}:GN),[t,n])};function qN(){const e=WN(),t=Bw(),n=S.useCallback((()=>t.getState().getNodes().map((e=>({...e})))),[]),o=S.useCallback((e=>t.getState().nodeInternals.get(e)),[]),r=S.useCallback((()=>{const{edges:e=[]}=t.getState();return e.map((e=>({...e})))}),[]),a=S.useCallback((e=>{const{edges:n=[]}=t.getState();return n.find((t=>t.id===e))}),[]),s=S.useCallback((e=>{const{getNodes:n,setNodes:o,hasDefaultNodes:r,onNodesChange:a}=t.getState(),s=n(),i="function"==typeof e?e(s):e;if(r)o(i);else if(a){a(0===i.length?s.map((e=>({type:"remove",id:e.id}))):i.map((e=>({item:e,type:"reset"}))))}}),[]),i=S.useCallback((e=>{const{edges:n=[],setEdges:o,hasDefaultEdges:r,onEdgesChange:a}=t.getState(),s="function"==typeof e?e(n):e;if(r)o(s);else if(a){a(0===s.length?n.map((e=>({type:"remove",id:e.id}))):s.map((e=>({item:e,type:"reset"}))))}}),[]),l=S.useCallback((e=>{const n=Array.isArray(e)?e:[e],{getNodes:o,setNodes:r,hasDefaultNodes:a,onNodesChange:s}=t.getState();if(a){r([...o(),...n])}else if(s){s(n.map((e=>({item:e,type:"add"}))))}}),[]),c=S.useCallback((e=>{const n=Array.isArray(e)?e:[e],{edges:o=[],setEdges:r,hasDefaultEdges:a,onEdgesChange:s}=t.getState();if(a)r([...o,...n]);else if(s){s(n.map((e=>({item:e,type:"add"}))))}}),[]),d=S.useCallback((()=>{const{getNodes:e,edges:n=[],transform:o}=t.getState(),[r,a,s]=o;return{nodes:e().map((e=>({...e}))),edges:n.map((e=>({...e}))),viewport:{x:r,y:a,zoom:s}}}),[]),u=S.useCallback((({nodes:e,edges:n})=>{const{nodeInternals:o,getNodes:r,edges:a,hasDefaultNodes:s,hasDefaultEdges:i,onNodesDelete:l,onEdgesDelete:c,onNodesChange:d,onEdgesChange:u}=t.getState(),h=(e||[]).map((e=>e.id)),f=(n||[]).map((e=>e.id)),m=r().reduce(((e,t)=>{const n=t.parentNode||t.parentId,o=!h.includes(t.id)&&n&&e.find((e=>e.id===n));return("boolean"!=typeof t.deletable||t.deletable)&&(h.includes(t.id)||o)&&e.push(t),e}),[]),p=a.filter((e=>"boolean"!=typeof e.deletable||e.deletable)),g=p.filter((e=>f.includes(e.id)));if(m||g){const e=qk(m,p),n=[...g,...e],r=n.reduce(((e,t)=>(e.includes(t.id)||e.push(t.id),e)),[]);if((i||s)&&(i&&t.setState({edges:a.filter((e=>!r.includes(e.id)))}),s&&(m.forEach((e=>{o.delete(e.id)})),t.setState({nodeInternals:new Map(o)}))),r.length>0&&(null==c||c(n),u&&u(r.map((e=>({id:e,type:"remove"}))))),m.length>0&&(null==l||l(m),d)){d(m.map((e=>({id:e.id,type:"remove"}))))}}}),[]),h=S.useCallback((e=>{const n=ek(e),o=n?null:t.getState().nodeInternals.get(e.id);if(!n&&!o)return[null,null,n];return[n?e:Zw(o),o,n]}),[]),f=S.useCallback(((e,n=!0,o)=>{const[r,a,s]=h(e);return r?(o||t.getState().getNodes()).filter((e=>{if(!(s||e.id!==a.id&&e.positionAbsolute))return!1;const t=Zw(e),o=Qw(t,r);return n&&o>0||o>=r.width*r.height})):[]}),[]),m=S.useCallback(((e,t,n=!0)=>{const[o]=h(e);if(!o)return!1;const r=Qw(o,t);return n&&r>0||r>=o.width*o.height}),[]);return S.useMemo((()=>({...e,getNodes:n,getNode:o,getEdges:r,getEdge:a,setNodes:s,setEdges:i,addNodes:l,addEdges:c,toObject:d,deleteElements:u,getIntersectingNodes:f,isNodeIntersecting:m})),[e,n,o,r,a,s,i,l,c,d,u,f,m])}const YN={actInsideInputWithModifier:!1};const JN={position:"absolute",width:"100%",height:"100%",top:0,left:0},KN=e=>({x:e.x,y:e.y,zoom:e.k}),XN=(e,t)=>e.target.closest(`.${t}`),ZN=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),QN=e=>{const t=e.ctrlKey&&ik()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t},eE=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),tE=({onMove:e,onMoveStart:t,onMoveEnd:n,onPaneContextMenu:o,zoomOnScroll:r=!0,zoomOnPinch:a=!0,panOnScroll:s=!1,panOnScrollSpeed:i=.5,panOnScrollMode:l=mk.Free,zoomOnDoubleClick:c=!0,elementsSelectable:d,panOnDrag:u=!0,defaultViewport:h,translateExtent:f,minZoom:m,maxZoom:p,zoomActivationKeyCode:g,preventScrolling:x=!0,children:y,noWheelClassName:v,noPanClassName:b})=>{const w=S.useRef(),k=Bw(),N=S.useRef(!1),E=S.useRef(!1),C=S.useRef(null),j=S.useRef({x:0,y:0,zoom:0}),{d3Zoom:I,d3Selection:A,d3ZoomHandler:O,userSelectionActive:M}=zw(eE,uw),_=_N(g),P=S.useRef(0),D=S.useRef(!1),F=S.useRef();return function(e){const t=Bw();S.useEffect((()=>{let n;const o=()=>{var n,o;if(!e.current)return;const r=Hw(e.current);0!==r.height&&0!==r.width||null==(o=(n=t.getState()).onError)||o.call(n,"004",Lw.error004()),t.setState({width:r.width||500,height:r.height||500})};return o(),window.addEventListener("resize",o),e.current&&(n=new ResizeObserver((()=>o())),n.observe(e.current)),()=>{window.removeEventListener("resize",o),n&&e.current&&n.unobserve(e.current)}}),[])}(C),S.useEffect((()=>{if(C.current){const e=C.current.getBoundingClientRect(),t=function(){var e,t,n,o=Aw,r=Tw,a=Pw,s=Mw,i=_w,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],d=250,u=Gi,h=$i("start","zoom","end"),f=500,m=150,p=0,g=10;function x(e){e.property("__zoom",Ow).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",j).filter(i).on("touchstart.zoom",S).on("touchmove.zoom",I).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new Ui(t,e.x,e.y)}function v(e,t,n){var o=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return o===e.x&&r===e.y?e:new Ui(e.k,o,r)}function b(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function w(e,t,n,o){e.on("start.zoom",(function(){k(this,arguments).event(o).start()})).on("interrupt.zoom end.zoom",(function(){k(this,arguments).event(o).end()})).tween("zoom",(function(){var e=this,a=arguments,s=k(e,a).event(o),i=r.apply(e,a),l=null==n?b(i):"function"==typeof n?n.apply(e,a):n,c=Math.max(i[1][0]-i[0][0],i[1][1]-i[0][1]),d=e.__zoom,h="function"==typeof t?t.apply(e,a):t,f=u(d.invert(l).concat(c/d.k),h.invert(l).concat(c/h.k));return function(e){if(1===e)e=h;else{var t=f(e),n=c/t[2];e=new Ui(n,l[0]-t[0]*n,l[1]-t[1]*n)}s.zoom(null,e)}}))}function k(e,t,n){return!n&&e.__zooming||new N(e,t)}function N(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=r.apply(e,t),this.taps=0}function E(e,...t){if(o.apply(this,arguments)){var n=k(this,t).event(e),r=this.__zoom,i=Math.max(l[0],Math.min(l[1],r.k*Math.pow(2,s.apply(this,arguments)))),d=hw(e);if(n.wheel)n.mouse[0][0]===d[0]&&n.mouse[0][1]===d[1]||(n.mouse[1]=r.invert(n.mouse[0]=d)),clearTimeout(n.wheel);else{if(r.k===i)return;n.mouse=[d,r.invert(d)],Vi(this),n.start()}Iw(e),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),m),n.zoom("mouse",a(v(y(r,i),n.mouse[0],n.mouse[1]),n.extent,c))}}function C(e,...t){if(!n&&o.apply(this,arguments)){var r=e.currentTarget,s=k(this,t,!0).event(e),i=zi(e.view).on("mousemove.zoom",(function(e){if(Iw(e),!s.moved){var t=e.clientX-d,n=e.clientY-u;s.moved=t*t+n*n>p}s.event(e).zoom("mouse",a(v(s.that.__zoom,s.mouse[0]=hw(e,r),s.mouse[1]),s.extent,c))}),!0).on("mouseup.zoom",(function(e){i.on("mousemove.zoom mouseup.zoom",null),yw(e.view,s.moved),Iw(e),s.event(e).end()}),!0),l=hw(e,r),d=e.clientX,u=e.clientY;xw(e.view),Sw(e),s.mouse=[l,this.__zoom.invert(l)],Vi(this),s.start()}}function j(e,...t){if(o.apply(this,arguments)){var n=this.__zoom,s=hw(e.changedTouches?e.changedTouches[0]:e,this),i=n.invert(s),l=n.k*(e.shiftKey?.5:2),u=a(v(y(n,l),s,i),r.apply(this,t),c);Iw(e),d>0?zi(this).transition().duration(d).call(w,u,s,e):zi(this).call(x.transform,u,s,e)}}function S(n,...r){if(o.apply(this,arguments)){var a,s,i,l,c=n.touches,d=c.length,u=k(this,r,n.changedTouches.length===d).event(n);for(Sw(n),s=0;s<d;++s)l=[l=hw(i=c[s],this),this.__zoom.invert(l),i.identifier],u.touch0?u.touch1||u.touch0[2]===l[2]||(u.touch1=l,u.taps=0):(u.touch0=l,a=!0,u.taps=1+!!e);e&&(e=clearTimeout(e)),a&&(u.taps<2&&(t=l[0],e=setTimeout((function(){e=null}),f)),Vi(this),u.start())}}function I(e,...t){if(this.__zooming){var n,o,r,s,i=k(this,t).event(e),l=e.changedTouches,d=l.length;for(Iw(e),n=0;n<d;++n)r=hw(o=l[n],this),i.touch0&&i.touch0[2]===o.identifier?i.touch0[0]=r:i.touch1&&i.touch1[2]===o.identifier&&(i.touch1[0]=r);if(o=i.that.__zoom,i.touch1){var u=i.touch0[0],h=i.touch0[1],f=i.touch1[0],m=i.touch1[1],p=(p=f[0]-u[0])*p+(p=f[1]-u[1])*p,g=(g=m[0]-h[0])*g+(g=m[1]-h[1])*g;o=y(o,Math.sqrt(p/g)),r=[(u[0]+f[0])/2,(u[1]+f[1])/2],s=[(h[0]+m[0])/2,(h[1]+m[1])/2]}else{if(!i.touch0)return;r=i.touch0[0],s=i.touch0[1]}i.zoom("touch",a(v(o,r,s),i.extent,c))}}function A(e,...o){if(this.__zooming){var r,a,s=k(this,o).event(e),i=e.changedTouches,l=i.length;for(Sw(e),n&&clearTimeout(n),n=setTimeout((function(){n=null}),f),r=0;r<l;++r)a=i[r],s.touch0&&s.touch0[2]===a.identifier?delete s.touch0:s.touch1&&s.touch1[2]===a.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(a=hw(a,this),Math.hypot(t[0]-a[0],t[1]-a[1])<g)){var c=zi(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return x.transform=function(e,t,n,o){var r=e.selection?e.selection():e;r.property("__zoom",Ow),e!==r?w(e,t,n,o):r.interrupt().each((function(){k(this,arguments).event(o).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()}))},x.scaleBy=function(e,t,n,o){x.scaleTo(e,(function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)}),n,o)},x.scaleTo=function(e,t,n,o){x.transform(e,(function(){var e=r.apply(this,arguments),o=this.__zoom,s=null==n?b(e):"function"==typeof n?n.apply(this,arguments):n,i=o.invert(s),l="function"==typeof t?t.apply(this,arguments):t;return a(v(y(o,l),s,i),e,c)}),n,o)},x.translateBy=function(e,t,n,o){x.transform(e,(function(){return a(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}),null,o)},x.translateTo=function(e,t,n,o,s){x.transform(e,(function(){var e=r.apply(this,arguments),s=this.__zoom,i=null==o?b(e):"function"==typeof o?o.apply(this,arguments):o;return a(Bi.translate(i[0],i[1]).scale(s.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)}),o,s)},N.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=zi(this.that).datum();h.call(e,this.that,new jw(e,{sourceEvent:this.sourceEvent,target:x,type:e,transform:this.that.__zoom,dispatch:h}),t)}},x.wheelDelta=function(e){return arguments.length?(s="function"==typeof e?e:Cw(+e),x):s},x.filter=function(e){return arguments.length?(o="function"==typeof e?e:Cw(!!e),x):o},x.touchable=function(e){return arguments.length?(i="function"==typeof e?e:Cw(!!e),x):i},x.extent=function(e){return arguments.length?(r="function"==typeof e?e:Cw([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),x):r},x.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],x):[l[0],l[1]]},x.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],x):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},x.constrain=function(e){return arguments.length?(a=e,x):a},x.duration=function(e){return arguments.length?(d=+e,x):d},x.interpolate=function(e){return arguments.length?(u=e,x):u},x.on=function(){var e=h.on.apply(h,arguments);return e===h?x:e},x.clickDistance=function(e){return arguments.length?(p=(e=+e)*e,x):Math.sqrt(p)},x.tapDistance=function(e){return arguments.length?(g=+e,x):g},x}().scaleExtent([m,p]).translateExtent(f),n=zi(C.current).call(t),o=Bi.translate(h.x,h.y).scale(Ww(h.zoom,m,p)),r=[[0,0],[e.width,e.height]],a=t.constrain()(o,r,f);t.transform(n,a),t.wheelDelta(QN),k.setState({d3Zoom:t,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[a.x,a.y,a.k],domNode:C.current.closest(".react-flow")})}}),[]),S.useEffect((()=>{A&&I&&(!s||_||M?void 0!==O&&A.on("wheel.zoom",(function(e,t){if(!x&&"wheel"===e.type&&!e.ctrlKey||XN(e,v))return null;e.preventDefault(),O.call(this,e,t)}),{passive:!1}):A.on("wheel.zoom",(o=>{if(XN(o,v))return!1;o.preventDefault(),o.stopImmediatePropagation();const r=A.property("__zoom").k||1;if(o.ctrlKey&&a){const e=hw(o),t=QN(o),n=r*Math.pow(2,t);return void I.scaleTo(A,n,e,o)}const s=1===o.deltaMode?20:1;let c=l===mk.Vertical?0:o.deltaX*s,d=l===mk.Horizontal?0:o.deltaY*s;!ik()&&o.shiftKey&&l!==mk.Vertical&&(c=o.deltaY*s,d=0),I.translateBy(A,-c/r*i,-d/r*i,{internal:!0});const u=KN(A.property("__zoom")),{onViewportChangeStart:h,onViewportChange:f,onViewportChangeEnd:m}=k.getState();clearTimeout(F.current),D.current||(D.current=!0,null==t||t(o,u),null==h||h(u)),D.current&&(null==e||e(o,u),null==f||f(u),F.current=setTimeout((()=>{null==n||n(o,u),null==m||m(u),D.current=!1}),150))}),{passive:!1}))}),[M,s,l,A,I,O,_,a,x,v,t,e,n]),S.useEffect((()=>{I&&I.on("start",(e=>{var n,o;if(!e.sourceEvent||e.sourceEvent.internal)return null;P.current=null==(n=e.sourceEvent)?void 0:n.button;const{onViewportChangeStart:r}=k.getState(),a=KN(e.transform);N.current=!0,j.current=a,"mousedown"===(null==(o=e.sourceEvent)?void 0:o.type)&&k.setState({paneDragging:!0}),null==r||r(a),null==t||t(e.sourceEvent,a)}))}),[I,t]),S.useEffect((()=>{I&&(M&&!N.current?I.on("zoom",null):M||I.on("zoom",(t=>{var n;const{onViewportChange:r}=k.getState();if(k.setState({transform:[t.transform.x,t.transform.y,t.transform.k]}),E.current=!(!o||!ZN(u,P.current??0)),(e||r)&&!(null==(n=t.sourceEvent)?void 0:n.internal)){const n=KN(t.transform);null==r||r(n),null==e||e(t.sourceEvent,n)}})))}),[M,I,e,u,o]),S.useEffect((()=>{I&&I.on("end",(e=>{if(!e.sourceEvent||e.sourceEvent.internal)return null;const{onViewportChangeEnd:t}=k.getState();if(N.current=!1,k.setState({paneDragging:!1}),o&&ZN(u,P.current??0)&&!E.current&&o(e.sourceEvent),E.current=!1,(n||t)&&(r=j.current,a=e.transform,r.x!==a.x||r.y!==a.y||r.zoom!==a.k)){const o=KN(e.transform);j.current=o,clearTimeout(w.current),w.current=setTimeout((()=>{null==t||t(o),null==n||n(e.sourceEvent,o)}),s?150:0)}var r,a}))}),[I,s,u,n,o]),S.useEffect((()=>{I&&I.filter((e=>{const t=_||r,n=a&&e.ctrlKey;if((!0===u||Array.isArray(u)&&u.includes(1))&&1===e.button&&"mousedown"===e.type&&(XN(e,"react-flow__node")||XN(e,"react-flow__edge")))return!0;if(!(u||t||s||c||a))return!1;if(M)return!1;if(!c&&"dblclick"===e.type)return!1;if(XN(e,v)&&"wheel"===e.type)return!1;if(XN(e,b)&&("wheel"!==e.type||s&&"wheel"===e.type&&!_))return!1;if(!a&&e.ctrlKey&&"wheel"===e.type)return!1;if(!t&&!s&&!n&&"wheel"===e.type)return!1;if(!u&&("mousedown"===e.type||"touchstart"===e.type))return!1;if(Array.isArray(u)&&!u.includes(e.button)&&"mousedown"===e.type)return!1;const o=Array.isArray(u)&&u.includes(e.button)||!e.button||e.button<=1;return(!e.ctrlKey||"wheel"===e.type)&&o}))}),[M,I,r,a,s,c,u,d,_]),T.createElement("div",{className:"react-flow__renderer",ref:C,style:JN},y)},nE=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function oE(){const{userSelectionActive:e,userSelectionRect:t}=zw(nE,uw);return e&&t?T.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function rE(e,t){const n=t.parentNode||t.parentId,o=e.find((e=>e.id===n));if(o){const e=t.position.x+t.width-o.width,n=t.position.y+t.height-o.height;if(e>0||n>0||t.position.x<0||t.position.y<0){if(o.style={...o.style},o.style.width=o.style.width??o.width,o.style.height=o.style.height??o.height,e>0&&(o.style.width+=e),n>0&&(o.style.height+=n),t.position.x<0){const e=Math.abs(t.position.x);o.position.x=o.position.x-e,o.style.width+=e,t.position.x=0}if(t.position.y<0){const e=Math.abs(t.position.y);o.position.y=o.position.y-e,o.style.height+=e,t.position.y=0}o.width=o.style.width,o.height=o.style.height}}}function aE(e,t){if(e.some((e=>"reset"===e.type)))return e.filter((e=>"reset"===e.type)).map((e=>e.item));const n=e.filter((e=>"add"===e.type)).map((e=>e.item));return t.reduce(((t,n)=>{const o=e.filter((e=>e.id===n.id));if(0===o.length)return t.push(n),t;const r={...n};for(const e of o)if(e)switch(e.type){case"select":r.selected=e.selected;break;case"position":void 0!==e.position&&(r.position=e.position),void 0!==e.positionAbsolute&&(r.positionAbsolute=e.positionAbsolute),void 0!==e.dragging&&(r.dragging=e.dragging),r.expandParent&&rE(t,r);break;case"dimensions":void 0!==e.dimensions&&(r.width=e.dimensions.width,r.height=e.dimensions.height),void 0!==e.updateStyle&&(r.style={...r.style||{},...e.dimensions}),"boolean"==typeof e.resizing&&(r.resizing=e.resizing),r.expandParent&&rE(t,r);break;case"remove":return t}return t.push(r),t}),n)}function sE(e,t){return aE(e,t)}const iE=(e,t)=>({id:e,type:"select",selected:t});function lE(e,t){return e.reduce(((e,n)=>{const o=t.includes(n.id);return!n.selected&&o?(n.selected=!0,e.push(iE(n.id,!0))):n.selected&&!o&&(n.selected=!1,e.push(iE(n.id,!1))),e}),[])}const cE=(e,t)=>n=>{n.target===t.current&&(null==e||e(n))},dE=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),uE=S.memo((({isSelecting:e,selectionMode:t=gk.Full,panOnDrag:n,onSelectionStart:o,onSelectionEnd:r,onPaneClick:a,onPaneContextMenu:s,onPaneScroll:i,onPaneMouseEnter:l,onPaneMouseMove:c,onPaneMouseLeave:d,children:u})=>{const h=S.useRef(null),f=Bw(),m=S.useRef(0),p=S.useRef(0),g=S.useRef(),{userSelectionActive:x,elementsSelectable:y,dragging:v}=zw(dE,uw),b=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),m.current=0,p.current=0},w=e=>{null==a||a(e),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},k=i?e=>i(e):void 0,N=y&&(e||x);return T.createElement("div",{className:aw(["react-flow__pane",{dragging:v,selection:e}]),onClick:N?void 0:cE(w,h),onContextMenu:cE((e=>{Array.isArray(n)&&(null==n?void 0:n.includes(2))?e.preventDefault():null==s||s(e)}),h),onWheel:cE(k,h),onMouseEnter:N?void 0:l,onMouseDown:N?t=>{const{resetSelectedElements:n,domNode:r}=f.getState();if(g.current=null==r?void 0:r.getBoundingClientRect(),!y||!e||0!==t.button||t.target!==h.current||!g.current)return;const{x:a,y:s}=sk(t,g.current);n(),f.setState({userSelectionRect:{width:0,height:0,startX:a,startY:s,x:a,y:s}}),null==o||o(t)}:void 0,onMouseMove:N?n=>{const{userSelectionRect:o,nodeInternals:r,edges:a,transform:s,onNodesChange:i,onEdgesChange:l,nodeOrigin:c,getNodes:d}=f.getState();if(!e||!g.current||!o)return;f.setState({userSelectionActive:!0,nodesSelectionActive:!1});const u=sk(n,g.current),h=o.startX??0,x=o.startY??0,y={...o,x:u.x<h?u.x:h,y:u.y<x?u.y:x,width:Math.abs(u.x-h),height:Math.abs(u.y-x)},v=d(),b=Wk(r,y,s,t===gk.Partial,!0,c),w=qk(b,a).map((e=>e.id)),k=b.map((e=>e.id));if(m.current!==k.length){m.current=k.length;const e=lE(v,k);e.length&&(null==i||i(e))}if(p.current!==w.length){p.current=w.length;const e=lE(a,w);e.length&&(null==l||l(e))}f.setState({userSelectionRect:y})}:c,onMouseUp:N?e=>{if(0!==e.button)return;const{userSelectionRect:t}=f.getState();!x&&t&&e.target===h.current&&(null==w||w(e)),f.setState({nodesSelectionActive:m.current>0}),b(),null==r||r(e)}:void 0,onMouseLeave:N?e=>{x&&(f.setState({nodesSelectionActive:m.current>0}),null==r||r(e)),b()}:d,ref:h,style:JN},u,T.createElement(oE,null))}));function hE(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const o=t.get(n);return!!o&&(!!o.selected||hE(o,t))}function fE(e,t,n){let o=e;do{if(null==o?void 0:o.matches(t))return!0;if(o===n.current)return!1;o=o.parentElement}while(o);return!1}function mE(e,t,n,o){return Array.from(e.values()).filter((n=>(n.selected||n.id===o)&&(!n.parentNode||n.parentId||!hE(n,e))&&(n.draggable||t&&void 0===n.draggable))).map((e=>{var t,o;return{id:e.id,position:e.position||{x:0,y:0},positionAbsolute:e.positionAbsolute||{x:0,y:0},distance:{x:n.x-((null==(t=e.positionAbsolute)?void 0:t.x)??0),y:n.y-((null==(o=e.positionAbsolute)?void 0:o.y)??0)},delta:{x:0,y:0},extent:e.extent,parentNode:e.parentNode||e.parentId,parentId:e.parentNode||e.parentId,width:e.width,height:e.height,expandParent:e.expandParent}}))}function pE(e,t,n,o,r=[0,0],a){const s=function(e,t){return t&&"parent"!==t?[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]:t}(e,e.extent||o);let i=s;const l=e.parentNode||e.parentId;if("parent"!==e.extent||e.expandParent){if(e.extent&&l&&"parent"!==e.extent){const t=n.get(l),{x:o,y:a}=Gk(t,r).positionAbsolute;i=[[e.extent[0][0]+o,e.extent[0][1]+a],[e.extent[1][0]+o,e.extent[1][1]+a]]}}else if(l&&e.width&&e.height){const t=n.get(l),{x:o,y:a}=Gk(t,r).positionAbsolute;i=t&&tk(o)&&tk(a)&&tk(t.width)&&tk(t.height)?[[o+e.width*r[0],a+e.height*r[1]],[o+t.width-e.width+e.width*r[0],a+t.height-e.height+e.height*r[1]]]:i}else null==a||a("005",Lw.error005()),i=s;let c={x:0,y:0};if(l){const e=n.get(l);c=Gk(e,r).positionAbsolute}const d=i&&"parent"!==i?qw(t,i):t;return{position:{x:d.x-c.x,y:d.y-c.y},positionAbsolute:d}}function gE({nodeId:e,dragItems:t,nodeInternals:n}){const o=t.map((e=>({...n.get(e.id),position:e.position,positionAbsolute:e.positionAbsolute})));return[e?o.find((t=>t.id===e)):o[0],o]}uE.displayName="Pane";const xE=(e,t,n,o)=>{const r=t.querySelectorAll(e);if(!r||!r.length)return null;const a=Array.from(r),s=t.getBoundingClientRect(),i=s.width*o[0],l=s.height*o[1];return a.map((e=>{const t=e.getBoundingClientRect();return{id:e.getAttribute("data-handleid"),position:e.getAttribute("data-handlepos"),x:(t.left-s.left-i)/n,y:(t.top-s.top-l)/n,...Hw(e)}}))};function yE(e,t,n){return void 0===n?n:o=>{const r=t().nodeInternals.get(e);r&&n(o,{...r})}}function vE({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:r,unselectNodesAndEdges:a,multiSelectionActive:s,nodeInternals:i,onError:l}=t.getState(),c=i.get(e);c?(t.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&s)&&(a({nodes:[c],edges:[]}),requestAnimationFrame((()=>{var e;return null==(e=null==o?void 0:o.current)?void 0:e.blur()}))):r([e])):null==l||l("012",Lw.error012(e))}function bE(e){return(t,n,o)=>null==e?void 0:e(t,o)}function wE({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:r,isSelectable:a,selectNodesOnDrag:s}){const i=Bw(),[l,c]=S.useState(!1),d=S.useRef([]),u=S.useRef({x:null,y:null}),h=S.useRef(0),f=S.useRef(null),m=S.useRef({x:0,y:0}),p=S.useRef(null),g=S.useRef(!1),x=S.useRef(!1),y=S.useRef(!1),v=function(){const e=Bw();return S.useCallback((({sourceEvent:t})=>{const{transform:n,snapGrid:o,snapToGrid:r}=e.getState(),a=t.touches?t.touches[0].clientX:t.clientX,s=t.touches?t.touches[0].clientY:t.clientY,i={x:(a-n[0])/n[2],y:(s-n[1])/n[2]};return{xSnapped:r?o[0]*Math.round(i.x/o[0]):i.x,ySnapped:r?o[1]*Math.round(i.y/o[1]):i.y,...i}}),[])}();return S.useEffect((()=>{if(null==e?void 0:e.current){const l=zi(e.current),b=({x:e,y:t})=>{const{nodeInternals:n,onNodeDrag:o,onSelectionDrag:a,updateNodePositions:s,nodeExtent:l,snapGrid:h,snapToGrid:f,nodeOrigin:m,onError:g}=i.getState();u.current={x:e,y:t};let x=!1,y={x:0,y:0,x2:0,y2:0};if(d.current.length>1&&l){const e=Hk(d.current,m);y=Xw(e)}if(d.current=d.current.map((o=>{const r={x:e-o.distance.x,y:t-o.distance.y};f&&(r.x=h[0]*Math.round(r.x/h[0]),r.y=h[1]*Math.round(r.y/h[1]));const a=[[l[0][0],l[0][1]],[l[1][0],l[1][1]]];d.current.length>1&&l&&!o.extent&&(a[0][0]=o.positionAbsolute.x-y.x+l[0][0],a[1][0]=o.positionAbsolute.x+(o.width??0)-y.x2+l[1][0],a[0][1]=o.positionAbsolute.y-y.y+l[0][1],a[1][1]=o.positionAbsolute.y+(o.height??0)-y.y2+l[1][1]);const s=pE(o,r,n,a,m,g);return x=x||o.position.x!==s.position.x||o.position.y!==s.position.y,o.position=s.position,o.positionAbsolute=s.positionAbsolute,o})),!x)return;s(d.current,!0,!0),c(!0);const v=r?o:bE(a);if(v&&p.current){const[e,t]=gE({nodeId:r,dragItems:d.current,nodeInternals:n});v(p.current,e,t)}},w=()=>{if(!f.current)return;const[e,t]=Jw(m.current,f.current);if(0!==e||0!==t){const{transform:n,panBy:o}=i.getState();u.current.x=(u.current.x??0)-e/n[2],u.current.y=(u.current.y??0)-t/n[2],o({x:e,y:t})&&b(u.current)}h.current=requestAnimationFrame(w)},k=t=>{var n;const{nodeInternals:o,multiSelectionActive:l,nodesDraggable:c,unselectNodesAndEdges:h,onNodeDragStart:f,onSelectionDragStart:m}=i.getState();x.current=!0;const p=r?f:bE(m);s&&a||l||!r||(null==(n=o.get(r))?void 0:n.selected)||h(),r&&a&&s&&vE({id:r,store:i,nodeRef:e});const g=v(t);if(u.current=g,d.current=mE(o,c,g,r),p&&d.current){const[e,n]=gE({nodeId:r,dragItems:d.current,nodeInternals:o});p(t.sourceEvent,e,n)}};if(!t){const t=function(){var e,t,n,o,r=ww,a=kw,s=Nw,i=Ew,l={},c=$i("start","drag","end"),d=0,u=0;function h(e){e.on("mousedown.drag",f).filter(i).on("touchstart.drag",g).on("touchmove.drag",x,fw).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(s,i){if(!o&&r.call(this,s,i)){var l=v(this,a.call(this,s,i),s,i,"mouse");l&&(zi(s.view).on("mousemove.drag",m,mw).on("mouseup.drag",p,mw),xw(s.view),pw(s),n=!1,e=s.clientX,t=s.clientY,l("start",s))}}function m(o){if(gw(o),!n){var r=o.clientX-e,a=o.clientY-t;n=r*r+a*a>u}l.mouse("drag",o)}function p(e){zi(e.view).on("mousemove.drag mouseup.drag",null),yw(e.view,n),gw(e),l.mouse("end",e)}function g(e,t){if(r.call(this,e,t)){var n,o,s=e.changedTouches,i=a.call(this,e,t),l=s.length;for(n=0;n<l;++n)(o=v(this,i,e,t,s[n].identifier,s[n]))&&(pw(e),o("start",e,s[n]))}}function x(e){var t,n,o=e.changedTouches,r=o.length;for(t=0;t<r;++t)(n=l[o[t].identifier])&&(gw(e),n("drag",e,o[t]))}function y(e){var t,n,r=e.changedTouches,a=r.length;for(o&&clearTimeout(o),o=setTimeout((function(){o=null}),500),t=0;t<a;++t)(n=l[r[t].identifier])&&(pw(e),n("end",e,r[t]))}function v(e,t,n,o,r,a){var i,u,f,m=c.copy(),p=hw(a||n,t);if(null!=(f=s.call(e,new bw("beforestart",{sourceEvent:n,target:h,identifier:r,active:d,x:p[0],y:p[1],dx:0,dy:0,dispatch:m}),o)))return i=f.x-p[0]||0,u=f.y-p[1]||0,function n(a,s,c){var g,x=p;switch(a){case"start":l[r]=n,g=d++;break;case"end":delete l[r],--d;case"drag":p=hw(c||s,t),g=d}m.call(a,e,new bw(a,{sourceEvent:s,subject:f,target:h,identifier:r,active:g,x:p[0]+i,y:p[1]+u,dx:p[0]-x[0],dy:p[1]-x[1],dispatch:m}),o)}}return h.filter=function(e){return arguments.length?(r="function"==typeof e?e:vw(!!e),h):r},h.container=function(e){return arguments.length?(a="function"==typeof e?e:vw(e),h):a},h.subject=function(e){return arguments.length?(s="function"==typeof e?e:vw(e),h):s},h.touchable=function(e){return arguments.length?(i="function"==typeof e?e:vw(!!e),h):i},h.on=function(){var e=c.on.apply(c,arguments);return e===c?h:e},h.clickDistance=function(e){return arguments.length?(u=(e=+e)*e,h):Math.sqrt(u)},h}().on("start",(e=>{const{domNode:t,nodeDragThreshold:n}=i.getState();0===n&&k(e),y.current=!1;const o=v(e);u.current=o,f.current=(null==t?void 0:t.getBoundingClientRect())||null,m.current=sk(e.sourceEvent,f.current)})).on("drag",(e=>{var t,n;const o=v(e),{autoPanOnNodeDrag:r,nodeDragThreshold:a}=i.getState();if("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1&&(y.current=!0),!y.current){if(!g.current&&x.current&&r&&(g.current=!0,w()),!x.current){const r=o.xSnapped-((null==(t=null==u?void 0:u.current)?void 0:t.x)??0),s=o.ySnapped-((null==(n=null==u?void 0:u.current)?void 0:n.y)??0);Math.sqrt(r*r+s*s)>a&&k(e)}(u.current.x!==o.xSnapped||u.current.y!==o.ySnapped)&&d.current&&x.current&&(p.current=e.sourceEvent,m.current=sk(e.sourceEvent,f.current),b(o))}})).on("end",(e=>{if(x.current&&!y.current&&(c(!1),g.current=!1,x.current=!1,cancelAnimationFrame(h.current),d.current)){const{updateNodePositions:t,nodeInternals:n,onNodeDragStop:o,onSelectionDragStop:a}=i.getState(),s=r?o:bE(a);if(t(d.current,!1,!1),s){const[t,o]=gE({nodeId:r,dragItems:d.current,nodeInternals:n});s(e.sourceEvent,t,o)}}})).filter((t=>{const r=t.target;return!t.button&&(!n||!fE(r,`.${n}`,e))&&(!o||fE(r,o,e))}));return l.call(t),()=>{l.on(".drag",null)}}l.on(".drag",null)}}),[e,t,n,o,a,i,r,s,v]),l}function kE(){const e=Bw();return S.useCallback((t=>{const{nodeInternals:n,nodeExtent:o,updateNodePositions:r,getNodes:a,snapToGrid:s,snapGrid:i,onError:l,nodesDraggable:c}=e.getState(),d=a().filter((e=>e.selected&&(e.draggable||c&&void 0===e.draggable))),u=s?i[0]:5,h=s?i[1]:5,f=t.isShiftPressed?4:1,m=t.x*u*f,p=t.y*h*f;r(d.map((e=>{if(e.positionAbsolute){const t={x:e.positionAbsolute.x+m,y:e.positionAbsolute.y+p};s&&(t.x=i[0]*Math.round(t.x/i[0]),t.y=i[1]*Math.round(t.y/i[1]));const{positionAbsolute:r,position:a}=pE(e,t,n,o,void 0,l);e.position=a,e.positionAbsolute=r}return e})),!0,!1)}),[])}const NE={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var EE=e=>{const t=({id:t,type:n,data:o,xPos:r,yPos:a,xPosOrigin:s,yPosOrigin:i,selected:l,onClick:c,onMouseEnter:d,onMouseMove:u,onMouseLeave:h,onContextMenu:f,onDoubleClick:m,style:p,className:g,isDraggable:x,isSelectable:y,isConnectable:v,isFocusable:b,selectNodesOnDrag:w,sourcePosition:k,targetPosition:N,hidden:E,resizeObserver:C,dragHandle:j,zIndex:I,isParent:A,noDragClassName:O,noPanClassName:M,initialized:_,disableKeyboardA11y:P,ariaLabel:D,rfId:F,hasHandleBounds:L})=>{const R=Bw(),z=S.useRef(null),B=S.useRef(null),U=S.useRef(k),V=S.useRef(N),$=S.useRef(n),G=y||x||c||d||u||h,H=kE(),W=yE(t,R.getState,d),q=yE(t,R.getState,u),Y=yE(t,R.getState,h),J=yE(t,R.getState,f),K=yE(t,R.getState,m);S.useEffect((()=>()=>{B.current&&(null==C||C.unobserve(B.current),B.current=null)}),[]),S.useEffect((()=>{if(z.current&&!E){const e=z.current;_&&L&&B.current===e||(B.current&&(null==C||C.unobserve(B.current)),null==C||C.observe(e),B.current=e)}}),[E,_,L]),S.useEffect((()=>{const e=$.current!==n,o=U.current!==k,r=V.current!==N;z.current&&(e||o||r)&&(e&&($.current=n),o&&(U.current=k),r&&(V.current=N),R.getState().updateNodeDimensions([{id:t,nodeElement:z.current,forceUpdate:!0}]))}),[t,n,k,N]);const X=wE({nodeRef:z,disabled:E||!x,noDragClassName:O,handleSelector:j,nodeId:t,isSelectable:y,selectNodesOnDrag:w});return E?null:T.createElement("div",{className:aw(["react-flow__node",`react-flow__node-${n}`,{[M]:x},g,{selected:l,selectable:y,parent:A,dragging:X}]),ref:z,style:{zIndex:I,transform:`translate(${s}px,${i}px)`,pointerEvents:G?"all":"none",visibility:_?"visible":"hidden",...p},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:W,onMouseMove:q,onMouseLeave:Y,onContextMenu:J,onClick:e=>{const{nodeDragThreshold:n}=R.getState();if(y&&(!w||!x||n>0)&&vE({id:t,store:R,nodeRef:z}),c){const n=R.getState().nodeInternals.get(t);n&&c(e,{...n})}},onDoubleClick:K,onKeyDown:b?e=>{if(!rk(e)&&!P)if(ok.includes(e.key)&&y){const n="Escape"===e.key;vE({id:t,store:R,unselect:n,nodeRef:z})}else x&&l&&Object.prototype.hasOwnProperty.call(NE,e.key)&&(R.setState({ariaLiveMessage:`Moved selected node ${e.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~r}, y: ${~~a}`}),H({x:NE[e.key].x,y:NE[e.key].y,isShiftPressed:e.shiftKey}))}:void 0,tabIndex:b?0:void 0,role:b?"button":void 0,"aria-describedby":P?void 0:`${SN}-${F}`,"aria-label":D},T.createElement(zk,{value:t},T.createElement(e,{id:t,data:o,type:n,xPos:r,yPos:a,selected:l,isConnectable:v,sourcePosition:k,targetPosition:N,dragging:X,dragHandle:j,zIndex:I})))};return t.displayName="NodeWrapper",S.memo(t)};const CE=e=>{const t=e.getNodes().filter((e=>e.selected));return{...Hk(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};var jE=S.memo((function({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=Bw(),{width:r,height:a,x:s,y:i,transformString:l,userSelectionActive:c}=zw(CE,uw),d=kE(),u=S.useRef(null);if(S.useEffect((()=>{var e;n||null==(e=u.current)||e.focus({preventScroll:!0})}),[n]),wE({nodeRef:u}),c||!r||!a)return null;const h=e?t=>{const n=o.getState().getNodes().filter((e=>e.selected));e(t,n)}:void 0;return T.createElement("div",{className:aw(["react-flow__nodesselection","react-flow__container",t]),style:{transform:l}},T.createElement("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:n?void 0:-1,onKeyDown:n?void 0:e=>{Object.prototype.hasOwnProperty.call(NE,e.key)&&d({x:NE[e.key].x,y:NE[e.key].y,isShiftPressed:e.shiftKey})},style:{width:r,height:a,top:i,left:s}}))}));const SE=e=>e.nodesSelectionActive,IE=({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:a,onPaneScroll:s,deleteKeyCode:i,onMove:l,onMoveStart:c,onMoveEnd:d,selectionKeyCode:u,selectionOnDrag:h,selectionMode:f,onSelectionStart:m,onSelectionEnd:p,multiSelectionKeyCode:g,panActivationKeyCode:x,zoomActivationKeyCode:y,elementsSelectable:v,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:k,panOnScrollSpeed:N,panOnScrollMode:E,zoomOnDoubleClick:C,panOnDrag:j,defaultViewport:I,translateExtent:A,minZoom:O,maxZoom:M,preventScrolling:_,onSelectionContextMenu:P,noWheelClassName:D,noPanClassName:F,disableKeyboardA11y:L})=>{const R=zw(SE),z=_N(u),B=_N(x),U=B||j,V=B||k,$=z||h&&!0!==U;return(({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const n=Bw(),{deleteElements:o}=qN(),r=_N(e,YN),a=_N(t);S.useEffect((()=>{if(r){const{edges:e,getNodes:t}=n.getState(),r=t().filter((e=>e.selected)),a=e.filter((e=>e.selected));o({nodes:r,edges:a}),n.setState({nodesSelectionActive:!1})}}),[r]),S.useEffect((()=>{n.setState({multiSelectionActive:a})}),[a])})({deleteKeyCode:i,multiSelectionKeyCode:g}),T.createElement(tE,{onMove:l,onMoveStart:c,onMoveEnd:d,onPaneContextMenu:a,elementsSelectable:v,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:V,panOnScrollSpeed:N,panOnScrollMode:E,zoomOnDoubleClick:C,panOnDrag:!z&&U,defaultViewport:I,translateExtent:A,minZoom:O,maxZoom:M,zoomActivationKeyCode:y,preventScrolling:_,noWheelClassName:D,noPanClassName:F},T.createElement(uE,{onSelectionStart:m,onSelectionEnd:p,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:a,onPaneScroll:s,panOnDrag:U,isSelecting:!!$,selectionMode:f},e,R&&T.createElement(jE,{onSelectionContextMenu:P,noPanClassName:F,disableKeyboardA11y:L})))};IE.displayName="FlowRenderer";var AE=S.memo(IE);function TE(e){return{...{input:EE(e.input||uN),default:EE(e.default||cN),output:EE(e.output||fN),group:EE(e.group||mN)},...Object.keys(e).filter((e=>!["input","default","output","group"].includes(e))).reduce(((t,n)=>(t[n]=EE(e[n]||cN),t)),{})}}const OE=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),ME=e=>{const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:r,updateNodeDimensions:a,onError:s}=zw(OE,uw),i=(l=e.onlyRenderVisibleElements,zw(S.useCallback((e=>l?Wk(e.nodeInternals,{x:0,y:0,width:e.width,height:e.height},e.transform,!0):e.getNodes()),[l])));var l;const c=S.useRef(),d=S.useMemo((()=>{if("undefined"==typeof ResizeObserver)return null;const e=new ResizeObserver((e=>{const t=e.map((e=>({id:e.target.getAttribute("data-id"),nodeElement:e.target,forceUpdate:!0})));a(t)}));return c.current=e,e}),[]);return S.useEffect((()=>()=>{var e;null==(e=null==c?void 0:c.current)||e.disconnect()}),[]),T.createElement("div",{className:"react-flow__nodes",style:JN},i.map((a=>{var i,l,c;let u=a.type||"default";e.nodeTypes[u]||(null==s||s("003",Lw.error003(u)),u="default");const h=e.nodeTypes[u]||e.nodeTypes.default,f=!!(a.draggable||t&&void 0===a.draggable),m=!!(a.selectable||r&&void 0===a.selectable),p=!!(a.connectable||n&&void 0===a.connectable),g=!!(a.focusable||o&&void 0===a.focusable),x=e.nodeExtent?qw(a.positionAbsolute,e.nodeExtent):a.positionAbsolute,y=(null==x?void 0:x.x)??0,v=(null==x?void 0:x.y)??0,b=(({x:e,y:t,width:n,height:o,origin:r})=>n&&o?r[0]<0||r[1]<0||r[0]>1||r[1]>1?{x:e,y:t}:{x:e-n*r[0],y:t-o*r[1]}:{x:e,y:t})({x:y,y:v,width:a.width??0,height:a.height??0,origin:e.nodeOrigin});return T.createElement(h,{key:a.id,id:a.id,className:a.className,style:a.style,type:u,data:a.data,sourcePosition:a.sourcePosition||kk.Bottom,targetPosition:a.targetPosition||kk.Top,hidden:a.hidden,xPos:y,yPos:v,xPosOrigin:b.x,yPosOrigin:b.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!a.selected,isDraggable:f,isSelectable:m,isConnectable:p,isFocusable:g,resizeObserver:d,dragHandle:a.dragHandle,zIndex:(null==(i=a[nk])?void 0:i.z)??0,isParent:!!(null==(l=a[nk])?void 0:l.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!a.width&&!!a.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:a.ariaLabel,hasHandleBounds:!!(null==(c=a[nk])?void 0:c.handleBounds)})})))};ME.displayName="NodeRenderer";var _E=S.memo(ME);const PE=(e,t,n)=>n===kk.Left?e-t:n===kk.Right?e+t:e,DE=(e,t,n)=>n===kk.Top?e-t:n===kk.Bottom?e+t:e,FE="react-flow__edgeupdater",LE=({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:r,onMouseEnter:a,onMouseOut:s,type:i})=>T.createElement("circle",{onMouseDown:r,onMouseEnter:a,onMouseOut:s,className:aw([FE,`${FE}-${i}`]),cx:PE(t,o,e),cy:DE(n,o,e),r:o,stroke:"transparent",fill:"transparent"}),RE=()=>!0;var zE=e=>{const t=({id:t,className:n,type:o,data:r,onClick:a,onEdgeDoubleClick:s,selected:i,animated:l,label:c,labelStyle:d,labelShowBg:u,labelBgStyle:h,labelBgPadding:f,labelBgBorderRadius:m,style:p,source:g,target:x,sourceX:y,sourceY:v,targetX:b,targetY:w,sourcePosition:k,targetPosition:N,elementsSelectable:E,hidden:C,sourceHandleId:j,targetHandleId:I,onContextMenu:A,onMouseEnter:O,onMouseMove:M,onMouseLeave:_,reconnectRadius:P,onReconnect:D,onReconnectStart:F,onReconnectEnd:L,markerEnd:R,markerStart:z,rfId:B,ariaLabel:U,isFocusable:V,isReconnectable:$,pathOptions:G,interactionWidth:H,disableKeyboardA11y:W})=>{const q=S.useRef(null),[Y,J]=S.useState(!1),[K,X]=S.useState(!1),Z=Bw(),Q=S.useMemo((()=>`url('#${Uk(z,B)}')`),[z,B]),ee=S.useMemo((()=>`url('#${Uk(R,B)}')`),[R,B]);if(C)return null;const te=ck(t,Z.getState,s),ne=ck(t,Z.getState,A),oe=ck(t,Z.getState,O),re=ck(t,Z.getState,M),ae=ck(t,Z.getState,_),se=(e,n)=>{if(0!==e.button)return;const{edges:o,isValidConnection:r}=Z.getState(),a=n?x:g,s=(n?I:j)||null,i=n?"target":"source",l=r||RE,c=n,d=o.find((e=>e.id===t));X(!0),null==F||F(e,d,i);oN({event:e,handleId:s,nodeId:a,onConnect:e=>null==D?void 0:D(d,e),isTarget:c,getState:Z.getState,setState:Z.setState,isValidConnection:l,edgeUpdaterType:i,onReconnectEnd:e=>{X(!1),null==L||L(e,d,i)}})},ie=()=>J(!0),le=()=>J(!1),ce=!E&&!a;return T.createElement("g",{className:aw(["react-flow__edge",`react-flow__edge-${o}`,n,{selected:i,animated:l,inactive:ce,updating:Y}]),onClick:e=>{var n;const{edges:o,addSelectedEdges:r,unselectNodesAndEdges:s,multiSelectionActive:i}=Z.getState(),l=o.find((e=>e.id===t));l&&(E&&(Z.setState({nodesSelectionActive:!1}),l.selected&&i?(s({nodes:[],edges:[l]}),null==(n=q.current)||n.blur()):r([t])),a&&a(e,l))},onDoubleClick:te,onContextMenu:ne,onMouseEnter:oe,onMouseMove:re,onMouseLeave:ae,onKeyDown:V?e=>{var n;if(!W&&ok.includes(e.key)&&E){const{unselectNodesAndEdges:o,addSelectedEdges:r,edges:a}=Z.getState();"Escape"===e.key?(null==(n=q.current)||n.blur(),o({edges:[a.find((e=>e.id===t))]})):r([t])}}:void 0,tabIndex:V?0:void 0,role:V?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":null===U?void 0:U||`Edge from ${g} to ${x}`,"aria-describedby":V?`${IN}-${B}`:void 0,ref:q},!K&&T.createElement(e,{id:t,source:g,target:x,selected:i,animated:l,label:c,labelStyle:d,labelShowBg:u,labelBgStyle:h,labelBgPadding:f,labelBgBorderRadius:m,data:r,style:p,sourceX:y,sourceY:v,targetX:b,targetY:w,sourcePosition:k,targetPosition:N,sourceHandleId:j,targetHandleId:I,markerStart:Q,markerEnd:ee,pathOptions:G,interactionWidth:H}),$&&T.createElement(T.Fragment,null,("source"===$||!0===$)&&T.createElement(LE,{position:k,centerX:y,centerY:v,radius:P,onMouseDown:e=>se(e,!0),onMouseEnter:ie,onMouseOut:le,type:"source"}),("target"===$||!0===$)&&T.createElement(LE,{position:N,centerX:b,centerY:w,radius:P,onMouseDown:e=>se(e,!1),onMouseEnter:ie,onMouseOut:le,type:"target"})))};return t.displayName="EdgeWrapper",S.memo(t)};function BE(e){return{...{default:zE(e.default||Lk),straight:zE(e.bezier||_k),step:zE(e.step||Mk),smoothstep:zE(e.step||Ok),simplebezier:zE(e.simplebezier||jk)},...Object.keys(e).filter((e=>!["default","bezier"].includes(e))).reduce(((t,n)=>(t[n]=zE(e[n]||Lk),t)),{})}}function UE(e,t,n=null){const o=((null==n?void 0:n.x)||0)+t.x,r=((null==n?void 0:n.y)||0)+t.y,a=(null==n?void 0:n.width)||t.width,s=(null==n?void 0:n.height)||t.height;switch(e){case kk.Top:return{x:o+a/2,y:r};case kk.Right:return{x:o+a,y:r+s/2};case kk.Bottom:return{x:o+a/2,y:r+s};case kk.Left:return{x:o,y:r+s/2}}}function VE(e,t){return e?1!==e.length&&t?t&&e.find((e=>e.id===t))||null:e[0]:null}function $E(e){var t,n,o,r,a;const s=(null==(t=null==e?void 0:e[nk])?void 0:t.handleBounds)||null,i=s&&(null==e?void 0:e.width)&&(null==e?void 0:e.height)&&void 0!==(null==(n=null==e?void 0:e.positionAbsolute)?void 0:n.x)&&void 0!==(null==(o=null==e?void 0:e.positionAbsolute)?void 0:o.y);return[{x:(null==(r=null==e?void 0:e.positionAbsolute)?void 0:r.x)||0,y:(null==(a=null==e?void 0:e.positionAbsolute)?void 0:a.y)||0,width:(null==e?void 0:e.width)||0,height:(null==e?void 0:e.height)||0},s,!!i]}const GE=[{level:0,isMaxLevel:!0,edges:[]}];function HE(e,t,n){return function(e,t,n=!1){let o=-1;const r=e.reduce(((e,r)=>{var a,s;const i=tk(r.zIndex);let l=i?r.zIndex:0;if(n){const e=t.get(r.target),n=t.get(r.source),o=r.selected||(null==e?void 0:e.selected)||(null==n?void 0:n.selected),c=Math.max((null==(a=null==n?void 0:n[nk])?void 0:a.z)||0,(null==(s=null==e?void 0:e[nk])?void 0:s.z)||0,1e3);l=(i?r.zIndex:0)+(o?c:0)}return e[l]?e[l].push(r):e[l]=[r],o=l>o?l:o,e}),{}),a=Object.entries(r).map((([e,t])=>{const n=+e;return{edges:t,level:n,isMaxLevel:n===o}}));return 0===a.length?GE:a}(zw(S.useCallback((n=>e?n.edges.filter((e=>{const o=t.get(e.source),r=t.get(e.target);return(null==o?void 0:o.width)&&(null==o?void 0:o.height)&&(null==r?void 0:r.width)&&(null==r?void 0:r.height)&&function({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:o,targetWidth:r,targetHeight:a,width:s,height:i,transform:l}){const c={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+r),y2:Math.max(e.y+o,t.y+a)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);const d=Xw({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:s/l[2],height:i/l[2]}),u=Math.max(0,Math.min(d.x2,c.x2)-Math.max(d.x,c.x)),h=Math.max(0,Math.min(d.y2,c.y2)-Math.max(d.y,c.y));return Math.ceil(u*h)>0}({sourcePos:o.positionAbsolute||{x:0,y:0},targetPos:r.positionAbsolute||{x:0,y:0},sourceWidth:o.width,sourceHeight:o.height,targetWidth:r.width,targetHeight:r.height,width:n.width,height:n.height,transform:n.transform})})):n.edges),[e,t])),t,n)}const WE={[bk.Arrow]:({color:e="none",strokeWidth:t=1})=>T.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),[bk.ArrowClosed]:({color:e="none",strokeWidth:t=1})=>T.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})};const qE=({id:e,type:t,color:n,width:o=12.5,height:r=12.5,markerUnits:a="strokeWidth",strokeWidth:s,orient:i="auto-start-reverse"})=>{const l=function(e){const t=Bw();return S.useMemo((()=>{var n,o;return Object.prototype.hasOwnProperty.call(WE,e)?WE[e]:(null==(o=(n=t.getState()).onError)||o.call(n,"009",Lw.error009(e)),null)}),[e])}(t);return l?T.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:i,refX:"0",refY:"0"},T.createElement(l,{color:n,strokeWidth:s})):null},YE=({defaultColor:e,rfId:t})=>{const n=zw(S.useCallback((({defaultColor:e,rfId:t})=>n=>{const o=[];return n.edges.reduce(((n,r)=>([r.markerStart,r.markerEnd].forEach((r=>{if(r&&"object"==typeof r){const a=Uk(r,t);o.includes(a)||(n.push({id:a,color:r.color||e,...r}),o.push(a))}})),n)),[]).sort(((e,t)=>e.id.localeCompare(t.id)))})({defaultColor:e,rfId:t}),[e,t]),((e,t)=>!(e.length!==t.length||e.some(((e,n)=>e.id!==t[n].id)))));return T.createElement("defs",null,n.map((e=>T.createElement(qE,{id:e.id,key:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient}))))};YE.displayName="MarkerDefinitions";var JE=S.memo(YE);const KE=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),XE=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:n,rfId:o,edgeTypes:r,noPanClassName:a,onEdgeContextMenu:s,onEdgeMouseEnter:i,onEdgeMouseMove:l,onEdgeMouseLeave:c,onEdgeClick:d,onEdgeDoubleClick:u,onReconnect:h,onReconnectStart:f,onReconnectEnd:m,reconnectRadius:p,children:g,disableKeyboardA11y:x})=>{const{edgesFocusable:y,edgesUpdatable:v,elementsSelectable:b,width:w,height:k,connectionMode:N,nodeInternals:E,onError:C}=zw(KE,uw),j=HE(t,E,n);return w?T.createElement(T.Fragment,null,j.map((({level:t,edges:n,isMaxLevel:g})=>T.createElement("svg",{key:t,style:{zIndex:t},width:w,height:k,className:"react-flow__edges react-flow__container"},g&&T.createElement(JE,{defaultColor:e,rfId:o}),T.createElement("g",null,n.map((e=>{const[t,n,g]=$E(E.get(e.source)),[w,k,j]=$E(E.get(e.target));if(!g||!j)return null;let S=e.type||"default";r[S]||(null==C||C("011",Lw.error011(S)),S="default");const I=r[S]||r.default,A=N===hk.Strict?k.target:(k.target??[]).concat(k.source??[]),O=VE(n.source,e.sourceHandle),M=VE(A,e.targetHandle),_=(null==O?void 0:O.position)||kk.Bottom,P=(null==M?void 0:M.position)||kk.Top,D=!!(e.focusable||y&&void 0===e.focusable),F=e.reconnectable||e.updatable,L=void 0!==h&&(F||v&&void 0===F);if(!O||!M)return null==C||C("008",Lw.error008(O,e)),null;const{sourceX:R,sourceY:z,targetX:B,targetY:U}=((e,t,n,o,r,a)=>{const s=UE(n,e,t),i=UE(a,o,r);return{sourceX:s.x,sourceY:s.y,targetX:i.x,targetY:i.y}})(t,O,_,w,M,P);return T.createElement(I,{key:e.id,id:e.id,className:aw([e.className,a]),type:S,data:e.data,selected:!!e.selected,animated:!!e.animated,hidden:!!e.hidden,label:e.label,labelStyle:e.labelStyle,labelShowBg:e.labelShowBg,labelBgStyle:e.labelBgStyle,labelBgPadding:e.labelBgPadding,labelBgBorderRadius:e.labelBgBorderRadius,style:e.style,source:e.source,target:e.target,sourceHandleId:e.sourceHandle,targetHandleId:e.targetHandle,markerEnd:e.markerEnd,markerStart:e.markerStart,sourceX:R,sourceY:z,targetX:B,targetY:U,sourcePosition:_,targetPosition:P,elementsSelectable:b,onContextMenu:s,onMouseEnter:i,onMouseMove:l,onMouseLeave:c,onClick:d,onEdgeDoubleClick:u,onReconnect:h,onReconnectStart:f,onReconnectEnd:m,reconnectRadius:p,rfId:o,ariaLabel:e.ariaLabel,isFocusable:D,isReconnectable:L,pathOptions:"pathOptions"in e?e.pathOptions:void 0,interactionWidth:e.interactionWidth,disableKeyboardA11y:x})})))))),g):null};XE.displayName="EdgeRenderer";var ZE=S.memo(XE);const QE=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function eC({children:e}){const t=zw(QE);return T.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}const tC={[kk.Left]:kk.Right,[kk.Right]:kk.Left,[kk.Top]:kk.Bottom,[kk.Bottom]:kk.Top},nC=({nodeId:e,handleType:t,style:n,type:o=yk.Bezier,CustomComponent:r,connectionStatus:a})=>{var s,i,l;const{fromNode:c,handleId:d,toX:u,toY:h,connectionMode:f}=zw(S.useCallback((t=>({fromNode:t.nodeInternals.get(e),handleId:t.connectionHandleId,toX:(t.connectionPosition.x-t.transform[0])/t.transform[2],toY:(t.connectionPosition.y-t.transform[1])/t.transform[2],connectionMode:t.connectionMode})),[e]),uw),m=null==(s=null==c?void 0:c[nk])?void 0:s.handleBounds;let p=null==m?void 0:m[t];if(f===hk.Loose&&(p=p||(null==m?void 0:m["source"===t?"target":"source"])),!c||!p)return null;const g=d?p.find((e=>e.id===d)):p[0],x=g?g.x+g.width/2:(c.width??0)/2,y=g?g.y+g.height/2:c.height??0,v=((null==(i=c.positionAbsolute)?void 0:i.x)??0)+x,b=((null==(l=c.positionAbsolute)?void 0:l.y)??0)+y,w=null==g?void 0:g.position,k=w?tC[w]:null;if(!w||!k)return null;if(r)return T.createElement(r,{connectionLineType:o,connectionLineStyle:n,fromNode:c,fromHandle:g,fromX:v,fromY:b,toX:u,toY:h,fromPosition:w,toPosition:k,connectionStatus:a});let N="";const E={sourceX:v,sourceY:b,sourcePosition:w,targetX:u,targetY:h,targetPosition:k};return o===yk.Bezier?[N]=Fk(E):o===yk.Step?[N]=Tk({...E,borderRadius:0}):o===yk.SmoothStep?[N]=Tk(E):o===yk.SimpleBezier?[N]=Ck(E):N=`M${v},${b} ${u},${h}`,T.createElement("path",{d:N,fill:"none",className:"react-flow__connection-path",style:n})};nC.displayName="ConnectionLine";const oC=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function rC({containerStyle:e,style:t,type:n,component:o}){const{nodeId:r,handleType:a,nodesConnectable:s,width:i,height:l,connectionStatus:c}=zw(oC,uw);return!!(r&&a&&i&&s)?T.createElement("svg",{style:e,width:i,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},T.createElement("g",{className:aw(["react-flow__connection",c])},T.createElement(nC,{nodeId:r,handleType:a,style:t,type:n,CustomComponent:o,connectionStatus:c}))):null}function aC(e,t){S.useRef(null),Bw();return S.useMemo((()=>t(e)),[e])}const sC=({nodeTypes:e,edgeTypes:t,onMove:n,onMoveStart:o,onMoveEnd:r,onInit:a,onNodeClick:s,onEdgeClick:i,onNodeDoubleClick:l,onEdgeDoubleClick:c,onNodeMouseEnter:d,onNodeMouseMove:u,onNodeMouseLeave:h,onNodeContextMenu:f,onSelectionContextMenu:m,onSelectionStart:p,onSelectionEnd:g,connectionLineType:x,connectionLineStyle:y,connectionLineComponent:v,connectionLineContainerStyle:b,selectionKeyCode:w,selectionOnDrag:k,selectionMode:N,multiSelectionKeyCode:E,panActivationKeyCode:C,zoomActivationKeyCode:j,deleteKeyCode:I,onlyRenderVisibleElements:A,elementsSelectable:O,selectNodesOnDrag:M,defaultViewport:_,translateExtent:P,minZoom:D,maxZoom:F,preventScrolling:L,defaultMarkerColor:R,zoomOnScroll:z,zoomOnPinch:B,panOnScroll:U,panOnScrollSpeed:V,panOnScrollMode:$,zoomOnDoubleClick:G,panOnDrag:H,onPaneClick:W,onPaneMouseEnter:q,onPaneMouseMove:Y,onPaneMouseLeave:J,onPaneScroll:K,onPaneContextMenu:X,onEdgeContextMenu:Z,onEdgeMouseEnter:Q,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:oe,onReconnectEnd:re,reconnectRadius:ae,noDragClassName:se,noWheelClassName:ie,noPanClassName:le,elevateEdgesOnSelect:ce,disableKeyboardA11y:de,nodeOrigin:ue,nodeExtent:he,rfId:fe})=>{const me=aC(e,TE),pe=aC(t,BE);return function(e){const t=qN(),n=S.useRef(!1);S.useEffect((()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout((()=>e(t)),1),n.current=!0)}),[e,t.viewportInitialized])}(a),T.createElement(AE,{onPaneClick:W,onPaneMouseEnter:q,onPaneMouseMove:Y,onPaneMouseLeave:J,onPaneContextMenu:X,onPaneScroll:K,deleteKeyCode:I,selectionKeyCode:w,selectionOnDrag:k,selectionMode:N,onSelectionStart:p,onSelectionEnd:g,multiSelectionKeyCode:E,panActivationKeyCode:C,zoomActivationKeyCode:j,elementsSelectable:O,onMove:n,onMoveStart:o,onMoveEnd:r,zoomOnScroll:z,zoomOnPinch:B,zoomOnDoubleClick:G,panOnScroll:U,panOnScrollSpeed:V,panOnScrollMode:$,panOnDrag:H,defaultViewport:_,translateExtent:P,minZoom:D,maxZoom:F,onSelectionContextMenu:m,preventScrolling:L,noDragClassName:se,noWheelClassName:ie,noPanClassName:le,disableKeyboardA11y:de},T.createElement(eC,null,T.createElement(ZE,{edgeTypes:pe,onEdgeClick:i,onEdgeDoubleClick:c,onlyRenderVisibleElements:A,onEdgeContextMenu:Z,onEdgeMouseEnter:Q,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:oe,onReconnectEnd:re,reconnectRadius:ae,defaultMarkerColor:R,noPanClassName:le,elevateEdgesOnSelect:!!ce,disableKeyboardA11y:de,rfId:fe},T.createElement(rC,{style:y,type:x,component:v,containerStyle:b})),T.createElement("div",{className:"react-flow__edgelabel-renderer"}),T.createElement(_E,{nodeTypes:me,onNodeClick:s,onNodeDoubleClick:l,onNodeMouseEnter:d,onNodeMouseMove:u,onNodeMouseLeave:h,onNodeContextMenu:f,selectNodesOnDrag:M,onlyRenderVisibleElements:A,noPanClassName:le,noDragClassName:se,disableKeyboardA11y:de,nodeOrigin:ue,nodeExtent:he,rfId:fe})))};sC.displayName="GraphView";var iC=S.memo(sC);const lC=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],cC={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:lC,nodeExtent:lC,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:hk.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:(e,t)=>{},isValidConnection:void 0},dC=()=>{return e=(e,t)=>({...cC,setNodes:n=>{const{nodeInternals:o,nodeOrigin:r,elevateNodesOnSelect:a}=t();e({nodeInternals:RN(n,o,r,a)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:o={}}=t();e({edges:n.map((e=>({...o,...e})))})},setDefaultNodesAndEdges:(n,o)=>{const r=void 0!==n,a=void 0!==o,s=r?RN(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:s,edges:a?o:[],hasDefaultNodes:r,hasDefaultEdges:a})},updateNodeDimensions:n=>{const{onNodesChange:o,nodeInternals:r,fitViewOnInit:a,fitViewOnInitDone:s,fitViewOnInitOptions:i,domNode:l,nodeOrigin:c}=t(),d=null==l?void 0:l.querySelector(".react-flow__viewport");if(!d)return;const u=window.getComputedStyle(d),{m22:h}=new window.DOMMatrixReadOnly(u.transform),f=n.reduce(((e,t)=>{const n=r.get(t.id);if(null==n?void 0:n.hidden)r.set(n.id,{...n,[nk]:{...n[nk],handleBounds:void 0}});else if(n){const o=Hw(t.nodeElement);o.width&&o.height&&(n.width!==o.width||n.height!==o.height||t.forceUpdate)&&(r.set(n.id,{...n,[nk]:{...n[nk],handleBounds:{source:xE(".source",t.nodeElement,h,c),target:xE(".target",t.nodeElement,h,c)}},...o}),e.push({id:n.id,type:"dimensions",dimensions:o}))}return e}),[]);LN(r,c);const m=s||a&&!s&&zN(t,{initial:!0,...i});e({nodeInternals:new Map(r),fitViewOnInitDone:m}),(null==f?void 0:f.length)>0&&(null==o||o(f))},updateNodePositions:(e,n=!0,o=!1)=>{const{triggerNodeChanges:r}=t();r(e.map((e=>{const t={id:e.id,type:"position",dragging:o};return n&&(t.positionAbsolute=e.positionAbsolute,t.position=e.position),t})))},triggerNodeChanges:n=>{const{onNodesChange:o,nodeInternals:r,hasDefaultNodes:a,nodeOrigin:s,getNodes:i,elevateNodesOnSelect:l}=t();if(null==n?void 0:n.length){if(a){const t=RN(sE(n,i()),r,s,l);e({nodeInternals:t})}null==o||o(n)}},addSelectedNodes:n=>{const{multiSelectionActive:o,edges:r,getNodes:a}=t();let s,i=null;o?s=n.map((e=>iE(e,!0))):(s=lE(a(),n),i=lE(r,[])),VN({changedNodes:s,changedEdges:i,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:o,edges:r,getNodes:a}=t();let s,i=null;o?s=n.map((e=>iE(e,!0))):(s=lE(r,n),i=lE(a(),[])),VN({changedNodes:i,changedEdges:s,get:t,set:e})},unselectNodesAndEdges:({nodes:n,edges:o}={})=>{const{edges:r,getNodes:a}=t(),s=o||r;VN({changedNodes:(n||a()).map((e=>(e.selected=!1,iE(e.id,!1)))),changedEdges:s.map((e=>iE(e.id,!1))),get:t,set:e})},setMinZoom:n=>{const{d3Zoom:o,maxZoom:r}=t();null==o||o.scaleExtent([n,r]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:o,minZoom:r}=t();null==o||o.scaleExtent([r,n]),e({maxZoom:n})},setTranslateExtent:n=>{var o;null==(o=t().d3Zoom)||o.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:o}=t();VN({changedNodes:o().filter((e=>e.selected)).map((e=>iE(e.id,!1))),changedEdges:n.filter((e=>e.selected)).map((e=>iE(e.id,!1))),get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:o}=t();o.forEach((e=>{e.positionAbsolute=qw(e.position,n)})),e({nodeExtent:n,nodeInternals:new Map(o)})},panBy:e=>{const{transform:n,width:o,height:r,d3Zoom:a,d3Selection:s,translateExtent:i}=t();if(!a||!s||!e.x&&!e.y)return!1;const l=Bi.translate(n[0]+e.x,n[1]+e.y).scale(n[2]),c=[[0,0],[o,r]],d=null==a?void 0:a.constrain()(l,c,i);return a.transform(s,d),n[0]!==d.x||n[1]!==d.y||n[2]!==d.k},cancelConnection:()=>e({connectionNodeId:cC.connectionNodeId,connectionHandleId:cC.connectionHandleId,connectionHandleType:cC.connectionHandleType,connectionStatus:cC.connectionStatus,connectionStartHandle:cC.connectionStartHandle,connectionEndHandle:cC.connectionEndHandle}),reset:()=>e({...cC})}),t=Object.is,e?dw(e,t):dw;var e,t},uC=({children:e})=>{const t=S.useRef(null);return t.current||(t.current=dC()),T.createElement(Fw,{value:t.current},e)};uC.displayName="ReactFlowProvider";const hC=({children:e})=>S.useContext(Dw)?T.createElement(T.Fragment,null,e):T.createElement(uC,null,e);hC.displayName="ReactFlowWrapper";const fC={input:uN,default:cN,output:fN,group:mN},mC={default:Lk,straight:_k,step:Mk,smoothstep:Ok,simplebezier:jk},pC=[0,0],gC=[15,15],xC={x:0,y:0,zoom:1},yC={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},vC=S.forwardRef((({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:r,nodeTypes:a=fC,edgeTypes:s=mC,onNodeClick:i,onEdgeClick:l,onInit:c,onMove:d,onMoveStart:u,onMoveEnd:h,onConnect:f,onConnectStart:m,onConnectEnd:p,onClickConnectStart:g,onClickConnectEnd:x,onNodeMouseEnter:y,onNodeMouseMove:v,onNodeMouseLeave:b,onNodeContextMenu:w,onNodeDoubleClick:k,onNodeDragStart:N,onNodeDrag:E,onNodeDragStop:C,onNodesDelete:j,onEdgesDelete:S,onSelectionChange:I,onSelectionDragStart:A,onSelectionDrag:O,onSelectionDragStop:M,onSelectionContextMenu:_,onSelectionStart:P,onSelectionEnd:D,connectionMode:F=hk.Strict,connectionLineType:L=yk.Bezier,connectionLineStyle:R,connectionLineComponent:z,connectionLineContainerStyle:B,deleteKeyCode:U="Backspace",selectionKeyCode:V="Shift",selectionOnDrag:$=!1,selectionMode:G=gk.Full,panActivationKeyCode:H="Space",multiSelectionKeyCode:W=(ik()?"Meta":"Control"),zoomActivationKeyCode:q=(ik()?"Meta":"Control"),snapToGrid:Y=!1,snapGrid:J=gC,onlyRenderVisibleElements:K=!1,selectNodesOnDrag:X=!0,nodesDraggable:Z,nodesConnectable:Q,nodesFocusable:ee,nodeOrigin:te=pC,edgesFocusable:ne,edgesUpdatable:oe,elementsSelectable:re,defaultViewport:ae=xC,minZoom:se=.5,maxZoom:ie=2,translateExtent:le=lC,preventScrolling:ce=!0,nodeExtent:de,defaultMarkerColor:ue="#b1b1b7",zoomOnScroll:he=!0,zoomOnPinch:fe=!0,panOnScroll:me=!1,panOnScrollSpeed:pe=.5,panOnScrollMode:ge=mk.Free,zoomOnDoubleClick:xe=!0,panOnDrag:ye=!0,onPaneClick:ve,onPaneMouseEnter:be,onPaneMouseMove:we,onPaneMouseLeave:ke,onPaneScroll:Ne,onPaneContextMenu:Ee,children:Ce,onEdgeContextMenu:je,onEdgeDoubleClick:Se,onEdgeMouseEnter:Ie,onEdgeMouseMove:Ae,onEdgeMouseLeave:Te,onEdgeUpdate:Oe,onEdgeUpdateStart:Me,onEdgeUpdateEnd:_e,onReconnect:Pe,onReconnectStart:De,onReconnectEnd:Fe,reconnectRadius:Le=10,edgeUpdaterRadius:Re=10,onNodesChange:ze,onEdgesChange:Be,noDragClassName:Ue="nodrag",noWheelClassName:Ve="nowheel",noPanClassName:$e="nopan",fitView:Ge=!1,fitViewOptions:He,connectOnClick:We=!0,attributionPosition:qe,proOptions:Ye,defaultEdgeOptions:Je,elevateNodesOnSelect:Ke=!0,elevateEdgesOnSelect:Xe=!1,disableKeyboardA11y:Ze=!1,autoPanOnConnect:Qe=!0,autoPanOnNodeDrag:et=!0,connectionRadius:tt=20,isValidConnection:nt,onError:ot,style:rt,id:at,nodeDragThreshold:st,...it},lt)=>{const ct=at||"1";return T.createElement("div",{...it,style:{...rt,...yC},ref:lt,className:aw(["react-flow",r]),"data-testid":"rf__wrapper",id:at},T.createElement(hC,null,T.createElement(iC,{onInit:c,onMove:d,onMoveStart:u,onMoveEnd:h,onNodeClick:i,onEdgeClick:l,onNodeMouseEnter:y,onNodeMouseMove:v,onNodeMouseLeave:b,onNodeContextMenu:w,onNodeDoubleClick:k,nodeTypes:a,edgeTypes:s,connectionLineType:L,connectionLineStyle:R,connectionLineComponent:z,connectionLineContainerStyle:B,selectionKeyCode:V,selectionOnDrag:$,selectionMode:G,deleteKeyCode:U,multiSelectionKeyCode:W,panActivationKeyCode:H,zoomActivationKeyCode:q,onlyRenderVisibleElements:K,selectNodesOnDrag:X,defaultViewport:ae,translateExtent:le,minZoom:se,maxZoom:ie,preventScrolling:ce,zoomOnScroll:he,zoomOnPinch:fe,zoomOnDoubleClick:xe,panOnScroll:me,panOnScrollSpeed:pe,panOnScrollMode:ge,panOnDrag:ye,onPaneClick:ve,onPaneMouseEnter:be,onPaneMouseMove:we,onPaneMouseLeave:ke,onPaneScroll:Ne,onPaneContextMenu:Ee,onSelectionContextMenu:_,onSelectionStart:P,onSelectionEnd:D,onEdgeContextMenu:je,onEdgeDoubleClick:Se,onEdgeMouseEnter:Ie,onEdgeMouseMove:Ae,onEdgeMouseLeave:Te,onReconnect:Pe??Oe,onReconnectStart:De??Me,onReconnectEnd:Fe??_e,reconnectRadius:Le??Re,defaultMarkerColor:ue,noDragClassName:Ue,noWheelClassName:Ve,noPanClassName:$e,elevateEdgesOnSelect:Xe,rfId:ct,disableKeyboardA11y:Ze,nodeOrigin:te,nodeExtent:de}),T.createElement(EN,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:f,onConnectStart:m,onConnectEnd:p,onClickConnectStart:g,onClickConnectEnd:x,nodesDraggable:Z,nodesConnectable:Q,nodesFocusable:ee,edgesFocusable:ne,edgesUpdatable:oe,elementsSelectable:re,elevateNodesOnSelect:Ke,minZoom:se,maxZoom:ie,nodeExtent:de,onNodesChange:ze,onEdgesChange:Be,snapToGrid:Y,snapGrid:J,connectionMode:F,translateExtent:le,connectOnClick:We,defaultEdgeOptions:Je,fitView:Ge,fitViewOptions:He,onNodesDelete:j,onEdgesDelete:S,onNodeDragStart:N,onNodeDrag:E,onNodeDragStop:C,onSelectionDrag:O,onSelectionDragStart:A,onSelectionDragStop:M,noPanClassName:$e,nodeOrigin:te,rfId:ct,autoPanOnConnect:Qe,autoPanOnNodeDrag:et,onError:ot,connectionRadius:tt,isValidConnection:nt,nodeDragThreshold:st}),T.createElement(bN,{onSelectionChange:I}),Ce,T.createElement($w,{proOptions:Ye,position:qe}),T.createElement(MN,{rfId:ct,disableKeyboardA11y:Ze})))}));function bC(e){return t=>{const[n,o]=S.useState(t),r=S.useCallback((t=>o((n=>e(t,n)))),[]);return[n,o,r]}}vC.displayName="ReactFlow";const wC=bC(sE),kC=bC((function(e,t){return aE(e,t)}));function NC(){return T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},T.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function EC(){return T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},T.createElement("path",{d:"M0 0h32v4.2H0z"}))}function CC(){return T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},T.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function jC(){return T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},T.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function SC(){return T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},T.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const IC=({children:e,className:t,...n})=>T.createElement("button",{type:"button",className:aw(["react-flow__controls-button",t]),...n},e);IC.displayName="ControlButton";const AC=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),TC=({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:r,onZoomIn:a,onZoomOut:s,onFitView:i,onInteractiveChange:l,className:c,children:d,position:u="bottom-left"})=>{const h=Bw(),[f,m]=S.useState(!1),{isInteractive:p,minZoomReached:g,maxZoomReached:x}=zw(AC,uw),{zoomIn:y,zoomOut:v,fitView:b}=qN();if(S.useEffect((()=>{m(!0)}),[]),!f)return null;return T.createElement(Vw,{className:aw(["react-flow__controls",c]),position:u,style:e,"data-testid":"rf__controls"},t&&T.createElement(T.Fragment,null,T.createElement(IC,{onClick:()=>{y(),null==a||a()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:x},T.createElement(NC,null)),T.createElement(IC,{onClick:()=>{v(),null==s||s()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:g},T.createElement(EC,null))),n&&T.createElement(IC,{className:"react-flow__controls-fitview",onClick:()=>{b(r),null==i||i()},title:"fit view","aria-label":"fit view"},T.createElement(CC,null)),o&&T.createElement(IC,{className:"react-flow__controls-interactive",onClick:()=>{h.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),null==l||l(!p)},title:"toggle interactivity","aria-label":"toggle interactivity"},p?T.createElement(SC,null):T.createElement(jC,null)),d)};TC.displayName="Controls";var OC,MC,_C=S.memo(TC);function PC({color:e,dimensions:t,lineWidth:n}){return T.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function DC({color:e,radius:t}){return T.createElement("circle",{cx:t,cy:t,r:t,fill:e})}(MC=OC||(OC={})).Lines="lines",MC.Dots="dots",MC.Cross="cross";const FC={[OC.Dots]:"#91919a",[OC.Lines]:"#eee",[OC.Cross]:"#e2e2e2"},LC={[OC.Dots]:1,[OC.Lines]:1,[OC.Cross]:6},RC=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function zC({id:e,variant:t=OC.Dots,gap:n=20,size:o,lineWidth:r=1,offset:a=2,color:s,style:i,className:l}){const c=S.useRef(null),{transform:d,patternId:u}=zw(RC,uw),h=s||FC[t],f=o||LC[t],m=t===OC.Dots,p=t===OC.Cross,g=Array.isArray(n)?n:[n,n],x=[g[0]*d[2]||1,g[1]*d[2]||1],y=f*d[2],v=p?[y,y]:x,b=m?[y/a,y/a]:[v[0]/a,v[1]/a];return T.createElement("svg",{className:aw(["react-flow__background",l]),style:{...i,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},T.createElement("pattern",{id:u+e,x:d[0]%x[0],y:d[1]%x[1],width:x[0],height:x[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${b[0]},-${b[1]})`},m?T.createElement(DC,{color:h,radius:y/a}):T.createElement(PC,{dimensions:v,color:h,lineWidth:r})),T.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${u+e})`}))}zC.displayName="Background";var BC=S.memo(zC);function UC(e){return Math.min(11*e+35,200)}const VC=T.createContext("LR"),$C=S.memo((e=>{const{data:t,selected:n}=e,o=W(t.atom),r=X().inOrderIds.indexOf(o.id),s=n?"var(--gray-9)":"var(--gray-3)",i=zw((({width:e})=>e)),l=S.useContext(VC),c=o.code.split("\n").length;return a.jsxs("div",{children:[a.jsx(iN,{type:"target",id:"inputs",position:"LR"===l?kk.Left:kk.Top,style:{background:s}}),a.jsx(iN,{type:"source",id:"inputs",position:"LR"===l?kk.Left:kk.Top,style:{background:s}}),a.jsxs("div",{className:Lt("flex flex-col bg-card border border-input/50 rounded-md mx-[2px] overflow-hidden",n&&"border-primary"),style:{height:UC(c),width:t.forceWidth||(d=i,Math.min(Math.max(d-100,100),400))},children:[a.jsx("div",{className:"text-muted-foreground font-semibold text-xs py-1 px-2 bg-muted border-b",children:Sa(o.name,r)}),a.jsx(Ri,{code:o.code})]}),a.jsx(iN,{type:"source",id:"outputs",position:"LR"===l?kk.Right:kk.Bottom,style:{background:s}}),a.jsx(iN,{type:"target",id:"outputs",position:"LR"===l?kk.Right:kk.Bottom,style:{background:s}})]});var d}),((e,t)=>["data","selected","id"].every((n=>e[n]===t[n]))));$C.displayName="CustomNode";const GC={custom:$C},HC=({maxCount:e,cellIds:t,onClick:n,skipScroll:o})=>{const r=X(),s=[...t].sort(((e,t)=>r.inOrderIds.indexOf(e)-r.inOrderIds.indexOf(t)));return 0===t.length?a.jsx("div",{className:"text-muted-foreground",children:"--"}):a.jsxs(a.Fragment,{children:[s.slice(0,e).map(((e,r)=>a.jsxs("span",{className:"truncate",children:[a.jsx(Ia,{variant:"focus",cellId:e,skipScroll:o,className:"whitespace-nowrap",onClick:n?()=>n(e):void 0},e),r<t.length-1&&", "]},e))),t.length>e&&a.jsxs(Vt,{children:[a.jsx(Po,{asChild:!0,children:a.jsxs("span",{className:"whitespace-nowrap text-muted-foreground text-xs hover:underline cursor-pointer",children:["+",t.length-e," more"]})}),a.jsx(Ht,{className:"w-auto",children:a.jsx("div",{className:"flex flex-col gap-1 py-1",children:s.slice(e).map((e=>a.jsx(Ia,{variant:"focus",cellId:e,className:"whitespace-nowrap",onClick:n?()=>n(e):void 0},e)))})})]})]})},WC=({name:e,declaredBy:t,onClick:n,...o})=>a.jsx("div",{className:"max-w-[130px]",...o,children:a.jsx(Aa,{title:e,variant:t.length>1?"destructive":"outline",className:"rounded-sm text-ellipsis block overflow-hidden max-w-fit cursor-pointer font-medium",onClick:t=>{n?n(t):(navigator.clipboard.writeText(e),U({title:"Copied to clipboard"}))},children:e})}),qC=S.memo((({onChange:e,view:t,settings:n,onSettingsChange:o})=>{const r=a.jsxs(Vt,{children:[a.jsx(Po,{asChild:!0,children:a.jsx(u,{variant:"text",size:"xs",children:a.jsx(ri,{className:"w-4 h-4"})})}),a.jsxs(Ht,{className:"w-auto p-2 text-muted-foreground",children:[a.jsx("div",{className:"font-semibold pb-4",children:"Settings"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(tr,{"data-testid":"hide-pure-markdown-checkbox",id:"hide-pure-markdown",checked:n.hidePureMarkdown,onCheckedChange:e=>{return t="hidePureMarkdown",r=Boolean(e),void o({...n,[t]:r});var t,r}}),a.jsx(ee,{htmlFor:"hide-pure-markdown",children:"Hide pure markdown"})]})]})]});return a.jsxs(Vw,{position:"top-right",className:"flex flex-col items-end gap-2",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(u,{variant:"outline",className:"bg-background","aria-selected":"_minimap_"===t,size:"xs",onClick:()=>e("_minimap_"),children:[a.jsx(zl,{className:"w-4 h-4 mr-1"}),"Mini Map"]}),a.jsxs(u,{variant:"outline",className:"bg-background","aria-selected":"TB"===t,size:"xs",onClick:()=>e("TB"),children:[a.jsx(Sl,{className:"w-4 h-4 mr-1"}),"Vertical Tree"]}),a.jsxs(u,{variant:"outline",className:"bg-background","aria-selected":"LR"===t,size:"xs",onClick:()=>e("LR"),children:[a.jsx(Sl,{className:"w-4 h-4 mr-1 transform -rotate-90"})," ","Horizontal Tree"]})]}),"_minimap_"!==t&&r]})}));qC.displayName="GraphToolbar";const YC=S.memo((({selection:e,edges:t,variables:n})=>{if(!e)return null;const o=(e,t)=>{const n=nr(e);n&&Ta(n,t)};return a.jsx(Vw,{position:"bottom-left",className:"max-h-[90%] flex flex-col",children:a.jsx("div",{className:"min-h-[100px] shadow-md rounded-md border max-w-[550px] border-primary/40 my-4 min-w-[240px] bg-[var(--slate-1)] text-muted-foreground/80 flex flex-col overflow-y-auto",children:(()=>{if("node"===e.type){const t=Object.values(n).filter((t=>t.usedBy.includes(e.id))),r=Object.values(n).filter((t=>t.declaredBy.includes(e.id))),s=(e,t)=>a.jsxs(a.Fragment,{children:[0===e.length&&a.jsx("div",{className:"text-muted-foreground text-sm text-center",children:"--"}),a.jsx("div",{className:"grid grid-cols-5 gap-3 items-center text-sm py-1 flex-1 empty:hidden",children:e.map((e=>a.jsxs(T.Fragment,{children:[a.jsx(WC,{declaredBy:e.declaredBy,name:e.name}),a.jsxs("div",{className:"truncate col-span-2",title:e.value??"",children:[e.value,a.jsxs("span",{className:"ml-1 truncate text-foreground/60 font-mono",children:["(",e.dataType,")"]})]}),a.jsx("div",{className:"truncate col-span-2 gap-1 items-center",children:a.jsx(HC,{skipScroll:!0,onClick:()=>o("in"===t?e.declaredBy[0]:e.usedBy[0],e.name),maxCount:3,cellIds:e.usedBy})})]},e.name)))})]});return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"font-bold py-2 flex items-center gap-2 border-b px-3",children:[a.jsx($e,{className:"w-5 h-5"}),a.jsx(Ia,{cellId:e.id}),a.jsx("div",{className:"flex-1"}),a.jsx(Fp,{cellId:e.id,children:a.jsx(u,{variant:"ghost",size:"icon",children:a.jsx(ul,{className:"w-4 h-4"})})})]}),a.jsxs("div",{className:"text-sm flex flex-col py-3 pl-2 pr-4 flex-1 justify-center",children:[a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("span",{className:"flex items-center gap-2 font-semibold",children:[a.jsx(qi,{className:"w-4 h-4"}),"Outputs"]}),s(r,"out")]}),a.jsx("hr",{className:"border-divider my-3"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("span",{className:"flex items-center gap-2 font-semibold",children:[a.jsx(Yi,{className:"w-4 h-4"}),"Inputs"]}),s(t,"in")]})]})]})}if("edge"===e.type){const t=Object.values(n).filter((t=>t.declaredBy.includes(e.source)&&t.usedBy.includes(e.target)));return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"font-bold py-2 flex items-center gap-2 border-b px-3",children:[a.jsx(rc,{className:"w-4 h-4"}),a.jsx(Ia,{cellId:e.source}),a.jsx(Ji,{className:"w-4 h-4"}),a.jsx(Ia,{cellId:e.target})]}),a.jsx("div",{className:"grid grid-cols-4 gap-3 max-w-[350px] items-center text-sm p-3 flex-1",children:t.map((e=>a.jsxs(T.Fragment,{children:[a.jsx(WC,{declaredBy:e.declaredBy,name:e.name,onClick:()=>{o(e.declaredBy[0],e.name)}}),a.jsx("div",{className:"truncate text-foreground/60 font-mono",children:e.dataType}),a.jsx("div",{className:"truncate col-span-2",title:e.value??"",children:e.value})]},e.name)))})]})}})()})})}));function JC(){const e=qN(),t=zw((({width:e})=>e)),n=zw((({height:e})=>e)),o=Oa((()=>{e.fitView({duration:100})}),100);S.useEffect((()=>{t&&n&&o()}),[t,n,o])}YC.displayName="GraphSelectionPanel";const KC=new class{createEdge(e,t,n){return{type:"smoothstep",pathOptions:{offset:20,borderRadius:100},data:{direction:n},markerEnd:{type:bk.Arrow},id:`${e}-${t}-${n}`,source:e,sourceHandle:n,targetHandle:n,target:t}}createNode(e,t,n){return{id:e,data:{atom:t},width:250,type:"custom",height:UC(G.get(t).code.trim().split("\n").length),position:{x:0,y:n+20}}}createElements(e,t,n,o){let r=0;const a=[],s=[];for(const[l,c]of ja.zip(e,t)){const e=this.createNode(l,c,r);a.push(e),r=e.position.y+(e.height||0)}const i=new Set;for(const l of Object.values(n)){const{declaredBy:e,usedBy:t}=l;for(const n of e)for(const e of t){const t=`${n}-${e}`;i.has(t)||(i.add(t),s.push(this.createEdge(n,e,"inputs"),this.createEdge(n,e,"outputs")))}}return{nodes:a,edges:s}}},XC=({cellIds:e,variables:t,cellAtoms:n,children:o})=>{const{nodes:r,edges:s}=KC.createElements(e,n,t,!1),[i,l]=kC([]),[c,d]=wC(r),[u,h]=S.useState(),[f,m]=S.useState(),p=S.useRef(!1);JC();const g=zw((({height:e})=>e)),x=M((e=>{d(e.nodes),l([])}));S.useEffect((()=>{p.current?x(KC.createElements(e,n,t,!1)):p.current=!0}),[e,t,n,x]),S.useEffect((()=>{if(u){const e=s.filter((e=>{const{source:t,target:n,data:o}=e;return t===u&&"outputs"===o.direction||n===u&&"inputs"===o.direction}));l(e)}}),[u,l,s]);const y=function(e,t){const n=10;return S.useMemo((()=>{const o=e.reduce(((e,{position:o})=>Math.min(e,o.y-t/2-n)),Number.POSITIVE_INFINITY),r=e.reduce(((e,{position:o})=>Math.max(e,o.y+t/2+n)),Number.NEGATIVE_INFINITY);return[[Number.NEGATIVE_INFINITY,o],[Number.POSITIVE_INFINITY,r]]}),[e,t])}(c,g);return a.jsxs(vC,{nodes:c,edges:i,nodeTypes:GC,translateExtent:y,onNodeClick:(e,t)=>{const n=t.id;h(n),m(void 0),l([])},onNodeDoubleClick:(e,t)=>{Ma(t.id,"focus")},onEdgeClick:(e,t)=>{m(t)},snapToGrid:!0,fitView:!0,elementsSelectable:!0,minZoom:1,maxZoom:1,draggable:!1,panOnScrollMode:mk.Vertical,zoomOnDoubleClick:!1,nodesDraggable:!1,nodesConnectable:!1,nodesFocusable:!1,edgesFocusable:!1,selectNodesOnDrag:!1,panOnDrag:!1,preventScrolling:!1,zoomOnPinch:!1,panOnScroll:!0,autoPanOnNodeDrag:!1,autoPanOnConnect:!1,children:[f?a.jsx(YC,{selection:{type:"edge",source:f.source,target:f.target},variables:t,edges:i}):u?a.jsx(YC,{selection:{type:"node",id:u},variables:t,edges:i}):null,o]})};var ZC="\0",QC="\0",ej="";function tj(e,t){e[t]?e[t]++:e[t]=1}function nj(e,t){--e[t]||delete e[t]}function oj(e,t,n,o){var r=""+t,a=""+n;if(!e&&r>a){var s=r;r=a,a=s}return r+ej+a+ej+(void 0===o?ZC:o)}function rj(e,t){return oj(e,t.v,t.w,t.name)}var aj=class{constructor(e){n(this,"_isDirected",!0),n(this,"_isMultigraph",!1),n(this,"_isCompound",!1),n(this,"_label"),n(this,"_defaultNodeLabelFn",(()=>{})),n(this,"_defaultEdgeLabelFn",(()=>{})),n(this,"_nodes",{}),n(this,"_in",{}),n(this,"_preds",{}),n(this,"_out",{}),n(this,"_sucs",{}),n(this,"_edgeObjs",{}),n(this,"_edgeLabels",{}),n(this,"_nodeCount",0),n(this,"_edgeCount",0),n(this,"_parent"),n(this,"_children"),e&&(this._isDirected=!Object.hasOwn(e,"directed")||e.directed,this._isMultigraph=!!Object.hasOwn(e,"multigraph")&&e.multigraph,this._isCompound=!!Object.hasOwn(e,"compound")&&e.compound),this._isCompound&&(this._parent={},this._children={},this._children[QC]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(e){return this._label=e,this}graph(){return this._label}setDefaultNodeLabel(e){return this._defaultNodeLabelFn=e,"function"!=typeof e&&(this._defaultNodeLabelFn=()=>e),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var e=this;return this.nodes().filter((t=>0===Object.keys(e._in[t]).length))}sinks(){var e=this;return this.nodes().filter((t=>0===Object.keys(e._out[t]).length))}setNodes(e,t){var n=arguments,o=this;return e.forEach((function(e){n.length>1?o.setNode(e,t):o.setNode(e)})),this}setNode(e,t){return Object.hasOwn(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=QC,this._children[e]={},this._children[QC][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)}node(e){return this._nodes[e]}hasNode(e){return Object.hasOwn(this._nodes,e)}removeNode(e){var t=this;if(Object.hasOwn(this._nodes,e)){var n=e=>t.removeEdge(t._edgeObjs[e]);delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],this.children(e).forEach((function(e){t.setParent(e)})),delete this._children[e]),Object.keys(this._in[e]).forEach(n),delete this._in[e],delete this._preds[e],Object.keys(this._out[e]).forEach(n),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this}setParent(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(void 0===t)t=QC;else{for(var n=t+="";void 0!==n;n=this.parent(n))if(n===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this}_removeFromParentsChildList(e){delete this._children[this._parent[e]][e]}parent(e){if(this._isCompound){var t=this._parent[e];if(t!==QC)return t}}children(e=QC){if(this._isCompound){var t=this._children[e];if(t)return Object.keys(t)}else{if(e===QC)return this.nodes();if(this.hasNode(e))return[]}}predecessors(e){var t=this._preds[e];if(t)return Object.keys(t)}successors(e){var t=this._sucs[e];if(t)return Object.keys(t)}neighbors(e){var t=this.predecessors(e);if(t){const o=new Set(t);for(var n of this.successors(e))o.add(n);return Array.from(o.values())}}isLeaf(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length}filterNodes(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var n=this;Object.entries(this._nodes).forEach((function([n,o]){e(n)&&t.setNode(n,o)})),Object.values(this._edgeObjs).forEach((function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,n.edge(e))}));var o={};function r(e){var a=n.parent(e);return void 0===a||t.hasNode(a)?(o[e]=a,a):a in o?o[a]:r(a)}return this._isCompound&&t.nodes().forEach((e=>t.setParent(e,r(e)))),t}setDefaultEdgeLabel(e){return this._defaultEdgeLabelFn=e,"function"!=typeof e&&(this._defaultEdgeLabelFn=()=>e),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(e,t){var n=this,o=arguments;return e.reduce((function(e,r){return o.length>1?n.setEdge(e,r,t):n.setEdge(e,r),r})),this}setEdge(){var e,t,n,o,r=!1,a=arguments[0];"object"==typeof a&&null!==a&&"v"in a?(e=a.v,t=a.w,n=a.name,2===arguments.length&&(o=arguments[1],r=!0)):(e=a,t=arguments[1],n=arguments[3],arguments.length>2&&(o=arguments[2],r=!0)),e=""+e,t=""+t,void 0!==n&&(n=""+n);var s=oj(this._isDirected,e,t,n);if(Object.hasOwn(this._edgeLabels,s))return r&&(this._edgeLabels[s]=o),this;if(void 0!==n&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[s]=r?o:this._defaultEdgeLabelFn(e,t,n);var i=function(e,t,n,o){var r=""+t,a=""+n;if(!e&&r>a){var s=r;r=a,a=s}var i={v:r,w:a};o&&(i.name=o);return i}(this._isDirected,e,t,n);return e=i.v,t=i.w,Object.freeze(i),this._edgeObjs[s]=i,tj(this._preds[t],e),tj(this._sucs[e],t),this._in[t][s]=i,this._out[e][s]=i,this._edgeCount++,this}edge(e,t,n){var o=1===arguments.length?rj(this._isDirected,arguments[0]):oj(this._isDirected,e,t,n);return this._edgeLabels[o]}edgeAsObj(){const e=this.edge(...arguments);return"object"!=typeof e?{label:e}:e}hasEdge(e,t,n){var o=1===arguments.length?rj(this._isDirected,arguments[0]):oj(this._isDirected,e,t,n);return Object.hasOwn(this._edgeLabels,o)}removeEdge(e,t,n){var o=1===arguments.length?rj(this._isDirected,arguments[0]):oj(this._isDirected,e,t,n),r=this._edgeObjs[o];return r&&(e=r.v,t=r.w,delete this._edgeLabels[o],delete this._edgeObjs[o],nj(this._preds[t],e),nj(this._sucs[e],t),delete this._in[t][o],delete this._out[e][o],this._edgeCount--),this}inEdges(e,t){var n=this._in[e];if(n){var o=Object.values(n);return t?o.filter((e=>e.v===t)):o}}outEdges(e,t){var n=this._out[e];if(n){var o=Object.values(n);return t?o.filter((e=>e.w===t)):o}}nodeEdges(e,t){var n=this.inEdges(e,t);if(n)return n.concat(this.outEdges(e,t))}},sj={Graph:aj,version:"2.2.4"},ij=aj,lj={write:function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:cj(e),edges:dj(e)};void 0!==e.graph()&&(t.value=structuredClone(e.graph()));return t},read:function(e){var t=new ij(e.options).setGraph(e.value);return e.nodes.forEach((function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)})),e.edges.forEach((function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)})),t}};function cj(e){return e.nodes().map((function(t){var n=e.node(t),o=e.parent(t),r={v:t};return void 0!==n&&(r.value=n),void 0!==o&&(r.parent=o),r}))}function dj(e){return e.edges().map((function(t){var n=e.edge(t),o={v:t.v,w:t.w};return void 0!==t.name&&(o.name=t.name),void 0!==n&&(o.value=n),o}))}var uj=function(e){var t,n={},o=[];function r(o){Object.hasOwn(n,o)||(n[o]=!0,t.push(o),e.successors(o).forEach(r),e.predecessors(o).forEach(r))}return e.nodes().forEach((function(e){t=[],r(e),t.length&&o.push(t)})),o};var hj=class{constructor(){n(this,"_arr",[]),n(this,"_keyIndices",{})}size(){return this._arr.length}keys(){return this._arr.map((function(e){return e.key}))}has(e){return Object.hasOwn(this._keyIndices,e)}priority(e){var t=this._keyIndices[e];if(void 0!==t)return this._arr[t].priority}min(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key}add(e,t){var n=this._keyIndices;if(e=String(e),!Object.hasOwn(n,e)){var o=this._arr,r=o.length;return n[e]=r,o.push({key:e,priority:t}),this._decrease(r),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key}decrease(e,t){var n=this._keyIndices[e];if(t>this._arr[n].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[n].priority+" New: "+t);this._arr[n].priority=t,this._decrease(n)}_heapify(e){var t=this._arr,n=2*e,o=n+1,r=e;n<t.length&&(r=t[n].priority<t[r].priority?n:r,o<t.length&&(r=t[o].priority<t[r].priority?o:r),r!==e&&(this._swap(e,r),this._heapify(r)))}_decrease(e){for(var t,n=this._arr,o=n[e].priority;0!==e&&!(n[t=e>>1].priority<o);)this._swap(e,t),e=t}_swap(e,t){var n=this._arr,o=this._keyIndices,r=n[e],a=n[t];n[e]=a,n[t]=r,o[a.key]=e,o[r.key]=t}},fj=hj,mj=function(e,t,n,o){return function(e,t,n,o){var r,a,s={},i=new fj,l=function(e){var t=e.v!==r?e.v:e.w,o=s[t],l=n(e),c=a.distance+l;if(l<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+l);c<o.distance&&(o.distance=c,o.predecessor=r,i.decrease(t,c))};e.nodes().forEach((function(e){var n=e===t?0:Number.POSITIVE_INFINITY;s[e]={distance:n},i.add(e,n)}));for(;i.size()>0&&(r=i.removeMin(),(a=s[r]).distance!==Number.POSITIVE_INFINITY);)o(r).forEach(l);return s}(e,String(t),n||pj,o||function(t){return e.outEdges(t)})},pj=()=>1;var gj=mj,xj=function(e,t,n){return e.nodes().reduce((function(o,r){return o[r]=gj(e,r,t,n),o}),{})};var yj=function(e){var t=0,n=[],o={},r=[];function a(s){var i=o[s]={onStack:!0,lowlink:t,index:t++};if(n.push(s),e.successors(s).forEach((function(e){Object.hasOwn(o,e)?o[e].onStack&&(i.lowlink=Math.min(i.lowlink,o[e].index)):(a(e),i.lowlink=Math.min(i.lowlink,o[e].lowlink))})),i.lowlink===i.index){var l,c=[];do{l=n.pop(),o[l].onStack=!1,c.push(l)}while(s!==l);r.push(c)}}return e.nodes().forEach((function(e){Object.hasOwn(o,e)||a(e)})),r};var vj=yj,bj=function(e){return vj(e).filter((function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])}))};var wj=function(e,t,n){return function(e,t,n){var o={},r=e.nodes();return r.forEach((function(e){o[e]={},o[e][e]={distance:0},r.forEach((function(t){e!==t&&(o[e][t]={distance:Number.POSITIVE_INFINITY})})),n(e).forEach((function(n){var r=n.v===e?n.w:n.v,a=t(n);o[e][r]={distance:a,predecessor:e}}))})),r.forEach((function(e){var t=o[e];r.forEach((function(n){var a=o[n];r.forEach((function(n){var o=a[e],r=t[n],s=a[n],i=o.distance+r.distance;i<s.distance&&(s.distance=i,s.predecessor=r.predecessor)}))}))})),o}(e,t||kj,n||function(t){return e.outEdges(t)})},kj=()=>1;function Nj(e){var t={},n={},o=[];if(e.sinks().forEach((function r(a){if(Object.hasOwn(n,a))throw new Ej;Object.hasOwn(t,a)||(n[a]=!0,t[a]=!0,e.predecessors(a).forEach(r),delete n[a],o.push(a))})),Object.keys(t).length!==e.nodeCount())throw new Ej;return o}class Ej extends Error{constructor(){super(...arguments)}}var Cj=Nj;Nj.CycleException=Ej;var jj=Cj;var Sj=function(e,t,n){Array.isArray(t)||(t=[t]);var o=e.isDirected()?t=>e.successors(t):t=>e.neighbors(t),r="post"===n?Ij:Aj,a=[],s={};return t.forEach((t=>{if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);r(t,o,s,a)})),a};function Ij(e,t,n,o){for(var r=[[e,!1]];r.length>0;){var a=r.pop();a[1]?o.push(a[0]):Object.hasOwn(n,a[0])||(n[a[0]]=!0,r.push([a[0],!0]),Tj(t(a[0]),(e=>r.push([e,!1]))))}}function Aj(e,t,n,o){for(var r=[e];r.length>0;){var a=r.pop();Object.hasOwn(n,a)||(n[a]=!0,o.push(a),Tj(t(a),(e=>r.push(e))))}}function Tj(e,t){for(var n=e.length;n--;)t(e[n],n,e);return e}var Oj=Sj;var Mj=Sj;var _j=aj,Pj=hj;var Dj={Graph:sj.Graph,json:lj,alg:{components:uj,dijkstra:mj,dijkstraAll:xj,findCycles:bj,floydWarshall:wj,isAcyclic:function(e){try{jj(e)}catch(t){if(t instanceof jj.CycleException)return!1;throw t}return!0},postorder:function(e,t){return Oj(e,t,"post")},preorder:function(e,t){return Mj(e,t,"pre")},prim:function(e,t){var n,o=new _j,r={},a=new Pj;function s(e){var o=e.v===n?e.w:e.v,s=a.priority(o);if(void 0!==s){var i=t(e);i<s&&(r[o]=n,a.decrease(o,i))}}if(0===e.nodeCount())return o;e.nodes().forEach((function(e){a.add(e,Number.POSITIVE_INFINITY),o.setNode(e)})),a.decrease(e.nodes()[0],0);var i=!1;for(;a.size()>0;){if(n=a.removeMin(),Object.hasOwn(r,n))o.setEdge(n,r[n]);else{if(i)throw new Error("Input graph is not connected: "+e);i=!0}e.nodeEdges(n).forEach(s)}return o},tarjan:yj,topsort:Cj},version:sj.version};function Fj(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function Lj(e,t){if("_next"!==e&&"_prev"!==e)return t}let Rj=Dj.Graph,zj=class{constructor(){let e={};e._next=e._prev=e,this._sentinel=e}dequeue(){let e=this._sentinel,t=e._prev;if(t!==e)return Fj(t),t}enqueue(e){let t=this._sentinel;e._prev&&e._next&&Fj(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t}toString(){let e=[],t=this._sentinel,n=t._prev;for(;n!==t;)e.push(JSON.stringify(n,Lj)),n=n._prev;return"["+e.join(", ")+"]"}};var Bj=function(e,t){if(e.nodeCount()<=1)return[];let n=function(e,t){let n=new Rj,o=0,r=0;e.nodes().forEach((e=>{n.setNode(e,{v:e,in:0,out:0})})),e.edges().forEach((e=>{let a=n.edge(e.v,e.w)||0,s=t(e),i=a+s;n.setEdge(e.v,e.w,i),r=Math.max(r,n.node(e.v).out+=s),o=Math.max(o,n.node(e.w).in+=s)}));let a=function(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}(r+o+3).map((()=>new zj)),s=o+1;return n.nodes().forEach((e=>{$j(a,s,n.node(e))})),{graph:n,buckets:a,zeroIdx:s}}(e,t||Uj);return function(e,t,n){let o,r=[],a=t[t.length-1],s=t[0];for(;e.nodeCount();){for(;o=s.dequeue();)Vj(e,t,n,o);for(;o=a.dequeue();)Vj(e,t,n,o);if(e.nodeCount())for(let a=t.length-2;a>0;--a)if(o=t[a].dequeue(),o){r=r.concat(Vj(e,t,n,o,!0));break}}return r}(n.graph,n.buckets,n.zeroIdx).flatMap((t=>e.outEdges(t.v,t.w)))};let Uj=()=>1;function Vj(e,t,n,o,r){let a=r?[]:void 0;return e.inEdges(o.v).forEach((o=>{let s=e.edge(o),i=e.node(o.v);r&&a.push({v:o.v,w:o.w}),i.out-=s,$j(t,n,i)})),e.outEdges(o.v).forEach((o=>{let r=e.edge(o),a=o.w,s=e.node(a);s.in-=r,$j(t,n,s)})),e.removeNode(o.v),a}function $j(e,t,n){n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)}let Gj=Dj.Graph;var Hj={addBorderNode:function(e,t,n,o){let r={width:0,height:0};arguments.length>=4&&(r.rank=n,r.order=o);return Wj(e,"border",r,t)},addDummyNode:Wj,applyWithChunking:Yj,asNonCompoundGraph:function(e){let t=new Gj({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach((n=>{e.children(n).length||t.setNode(n,e.node(n))})),e.edges().forEach((n=>{t.setEdge(n,e.edge(n))})),t},buildLayerMatrix:function(e){let t=Zj(Jj(e)+1).map((()=>[]));return e.nodes().forEach((n=>{let o=e.node(n),r=o.rank;void 0!==r&&(t[r][o.order]=n)})),t},intersectRect:function(e,t){let n,o,r=e.x,a=e.y,s=t.x-r,i=t.y-a,l=e.width/2,c=e.height/2;if(!s&&!i)throw new Error("Not possible to find intersection inside of the rectangle");Math.abs(i)*l>Math.abs(s)*c?(i<0&&(c=-c),n=c*s/i,o=c):(s<0&&(l=-l),n=l,o=l*i/s);return{x:r+n,y:a+o}},mapValues:function(e,t){let n=t;"string"==typeof t&&(n=e=>e[t]);return Object.entries(e).reduce(((e,[t,o])=>(e[t]=n(o,t),e)),{})},maxRank:Jj,normalizeRanks:function(e){let t=e.nodes().map((t=>{let n=e.node(t).rank;return void 0===n?Number.MAX_VALUE:n})),n=Yj(Math.min,t);e.nodes().forEach((t=>{let o=e.node(t);Object.hasOwn(o,"rank")&&(o.rank-=n)}))},notime:function(e,t){return t()},partition:function(e,t){let n={lhs:[],rhs:[]};return e.forEach((e=>{t(e)?n.lhs.push(e):n.rhs.push(e)})),n},pick:function(e,t){const n={};for(const o of t)void 0!==e[o]&&(n[o]=e[o]);return n},predecessorWeights:function(e){let t=e.nodes().map((t=>{let n={};return e.inEdges(t).forEach((t=>{n[t.v]=(n[t.v]||0)+e.edge(t).weight})),n}));return Qj(e.nodes(),t)},range:Zj,removeEmptyRanks:function(e){let t=e.nodes().map((t=>e.node(t).rank)),n=Yj(Math.min,t),o=[];e.nodes().forEach((t=>{let r=e.node(t).rank-n;o[r]||(o[r]=[]),o[r].push(t)}));let r=0,a=e.graph().nodeRankFactor;Array.from(o).forEach(((t,n)=>{void 0===t&&n%a!=0?--r:void 0!==t&&r&&t.forEach((t=>e.node(t).rank+=r))}))},simplify:function(e){let t=(new Gj).setGraph(e.graph());return e.nodes().forEach((n=>t.setNode(n,e.node(n)))),e.edges().forEach((n=>{let o=t.edge(n.v,n.w)||{weight:0,minlen:1},r=e.edge(n);t.setEdge(n.v,n.w,{weight:o.weight+r.weight,minlen:Math.max(o.minlen,r.minlen)})})),t},successorWeights:function(e){let t=e.nodes().map((t=>{let n={};return e.outEdges(t).forEach((t=>{n[t.w]=(n[t.w]||0)+e.edge(t).weight})),n}));return Qj(e.nodes(),t)},time:function(e,t){let n=Date.now();try{return t()}finally{console.log(e+" time: "+(Date.now()-n)+"ms")}},uniqueId:Xj,zipObject:Qj};function Wj(e,t,n,o){let r;do{r=Xj(o)}while(e.hasNode(r));return n.dummy=t,e.setNode(r,n),r}const qj=65535;function Yj(e,t){if(t.length>qj){const n=function(e,t=qj){const n=[];for(let o=0;o<e.length;o+=t){const r=e.slice(o,o+t);n.push(r)}return n}(t);return e.apply(null,n.map((t=>e.apply(null,t))))}return e.apply(null,t)}function Jj(e){const t=e.nodes().map((t=>{let n=e.node(t).rank;return void 0===n?Number.MIN_VALUE:n}));return Yj(Math.max,t)}let Kj=0;function Xj(e){var t=++Kj;return toString(e)+t}function Zj(e,t,n=1){null==t&&(t=e,e=0);let o=e=>e<t;n<0&&(o=e=>t<e);const r=[];for(let a=e;o(a);a+=n)r.push(a);return r}function Qj(e,t){return e.reduce(((e,n,o)=>(e[n]=t[o],e)),{})}let eS=Bj,tS=Hj.uniqueId;var nS={run:function(e){("greedy"===e.graph().acyclicer?eS(e,(t=e,e=>t.edge(e).weight)):function(e){let t=[],n={},o={};function r(a){Object.hasOwn(o,a)||(o[a]=!0,n[a]=!0,e.outEdges(a).forEach((e=>{Object.hasOwn(n,e.w)?t.push(e):r(e.w)})),delete n[a])}return e.nodes().forEach(r),t}(e)).forEach((t=>{let n=e.edge(t);e.removeEdge(t),n.forwardName=t.name,n.reversed=!0,e.setEdge(t.w,t.v,n,tS("rev"))}));var t},undo:function(e){e.edges().forEach((t=>{let n=e.edge(t);if(n.reversed){e.removeEdge(t);let o=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,o)}}))}};let oS=Hj;var rS={run:function(e){e.graph().dummyChains=[],e.edges().forEach((t=>function(e,t){let n,o,r,a=t.v,s=e.node(a).rank,i=t.w,l=e.node(i).rank,c=t.name,d=e.edge(t),u=d.labelRank;if(l===s+1)return;for(e.removeEdge(t),r=0,++s;s<l;++r,++s)d.points=[],o={width:0,height:0,edgeLabel:d,edgeObj:t,rank:s},n=oS.addDummyNode(e,"edge",o,"_d"),s===u&&(o.width=d.width,o.height=d.height,o.dummy="edge-label",o.labelpos=d.labelpos),e.setEdge(a,n,{weight:d.weight},c),0===r&&e.graph().dummyChains.push(n),a=n;e.setEdge(a,i,{weight:d.weight},c)}(e,t)))},undo:function(e){e.graph().dummyChains.forEach((t=>{let n,o=e.node(t),r=o.edgeLabel;for(e.setEdge(o.edgeObj,r);o.dummy;)n=e.successors(t)[0],e.removeNode(t),r.points.push({x:o.x,y:o.y}),"edge-label"===o.dummy&&(r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height),t=n,o=e.node(t)}))}};const{applyWithChunking:aS}=Hj;var sS={longestPath:function(e){var t={};e.sources().forEach((function n(o){var r=e.node(o);if(Object.hasOwn(t,o))return r.rank;t[o]=!0;let a=e.outEdges(o).map((t=>null==t?Number.POSITIVE_INFINITY:n(t.w)-e.edge(t).minlen));var s=aS(Math.min,a);return s===Number.POSITIVE_INFINITY&&(s=0),r.rank=s}))},slack:function(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}};var iS=Dj.Graph,lS=sS.slack,cS=function(e){var t,n,o=new iS({directed:!1}),r=e.nodes()[0],a=e.nodeCount();o.setNode(r,{});for(;dS(o,e)<a;)t=uS(o,e),n=o.hasNode(t.v)?lS(e,t):-lS(e,t),hS(o,e,n);return o};function dS(e,t){return e.nodes().forEach((function n(o){t.nodeEdges(o).forEach((r=>{var a=r.v,s=o===a?r.w:a;e.hasNode(s)||lS(t,r)||(e.setNode(s,{}),e.setEdge(o,s,{}),n(s))}))})),e.nodeCount()}function uS(e,t){return t.edges().reduce(((n,o)=>{let r=Number.POSITIVE_INFINITY;return e.hasNode(o.v)!==e.hasNode(o.w)&&(r=lS(t,o)),r<n[0]?[r,o]:n}),[Number.POSITIVE_INFINITY,null])[1]}function hS(e,t,n){e.nodes().forEach((e=>t.node(e).rank+=n))}var fS=cS,mS=sS.slack,pS=sS.longestPath,gS=Dj.alg.preorder,xS=Dj.alg.postorder,yS=Hj.simplify,vS=bS;function bS(e){e=yS(e),pS(e);var t,n=fS(e);for(NS(n),wS(n,e);t=CS(n);)SS(n,e,t,jS(n,e,t))}function wS(e,t){var n=xS(e,e.nodes());(n=n.slice(0,n.length-1)).forEach((n=>function(e,t,n){var o=e.node(n),r=o.parent;e.edge(n,r).cutvalue=kS(e,t,n)}(e,t,n)))}function kS(e,t,n){var o=e.node(n).parent,r=!0,a=t.edge(n,o),s=0;return a||(r=!1,a=t.edge(o,n)),s=a.weight,t.nodeEdges(n).forEach((a=>{var i,l,c=a.v===n,d=c?a.w:a.v;if(d!==o){var u=c===r,h=t.edge(a).weight;if(s+=u?h:-h,i=n,l=d,e.hasEdge(i,l)){var f=e.edge(n,d).cutvalue;s+=u?-f:f}}})),s}function NS(e,t){arguments.length<2&&(t=e.nodes()[0]),ES(e,{},1,t)}function ES(e,t,n,o,r){var a=n,s=e.node(o);return t[o]=!0,e.neighbors(o).forEach((r=>{Object.hasOwn(t,r)||(n=ES(e,t,n,r,o))})),s.low=a,s.lim=n++,r?s.parent=r:delete s.parent,n}function CS(e){return e.edges().find((t=>e.edge(t).cutvalue<0))}function jS(e,t,n){var o=n.v,r=n.w;t.hasEdge(o,r)||(o=n.w,r=n.v);var a=e.node(o),s=e.node(r),i=a,l=!1;return a.lim>s.lim&&(i=s,l=!0),t.edges().filter((t=>l===IS(e,e.node(t.v),i)&&l!==IS(e,e.node(t.w),i))).reduce(((e,n)=>mS(t,n)<mS(t,e)?n:e))}function SS(e,t,n,o){var r=n.v,a=n.w;e.removeEdge(r,a),e.setEdge(o.v,o.w,{}),NS(e),wS(e,t),function(e,t){var n=e.nodes().find((e=>!t.node(e).parent)),o=gS(e,n);(o=o.slice(1)).forEach((n=>{var o=e.node(n).parent,r=t.edge(n,o),a=!1;r||(r=t.edge(o,n),a=!0),t.node(n).rank=t.node(o).rank+(a?r.minlen:-r.minlen)}))}(e,t)}function IS(e,t,n){return n.low<=t.lim&&t.lim<=n.lim}bS.initLowLimValues=NS,bS.initCutValues=wS,bS.calcCutValue=kS,bS.leaveEdge=CS,bS.enterEdge=jS,bS.exchangeEdges=SS;var AS=sS.longestPath,TS=cS,OS=vS,MS=function(e){switch(e.graph().ranker){case"network-simplex":default:PS(e);break;case"tight-tree":!function(e){AS(e),TS(e)}(e);break;case"longest-path":_S(e)}};var _S=AS;function PS(e){OS(e)}let DS=Hj;function FS(e,t,n,o,r,a,s){let i=e.children(s);if(!i.length)return void(s!==t&&e.setEdge(t,s,{weight:0,minlen:n}));let l=DS.addBorderNode(e,"_bt"),c=DS.addBorderNode(e,"_bb"),d=e.node(s);e.setParent(l,s),d.borderTop=l,e.setParent(c,s),d.borderBottom=c,i.forEach((i=>{FS(e,t,n,o,r,a,i);let d=e.node(i),u=d.borderTop?d.borderTop:i,h=d.borderBottom?d.borderBottom:i,f=d.borderTop?o:2*o,m=u!==h?1:r-a[s]+1;e.setEdge(l,u,{weight:f,minlen:m,nestingEdge:!0}),e.setEdge(h,c,{weight:f,minlen:m,nestingEdge:!0})})),e.parent(s)||e.setEdge(t,l,{weight:0,minlen:r+a[s]})}let LS=Hj;function RS(e,t,n,o,r,a){let s={width:0,height:0,rank:a,borderType:t},i=r[t][a-1],l=LS.addDummyNode(e,"border",s,n);r[t][a]=l,e.setParent(l,o),i&&e.setEdge(i,l,{weight:1})}function zS(e){e.nodes().forEach((t=>BS(e.node(t)))),e.edges().forEach((t=>BS(e.edge(t))))}function BS(e){let t=e.width;e.width=e.height,e.height=t}function US(e){e.y=-e.y}function VS(e){let t=e.x;e.x=e.y,e.y=t}let $S=Hj;let GS=Hj.zipObject;function HS(e,t,n){let o=GS(n,n.map(((e,t)=>t))),r=t.flatMap((t=>e.outEdges(t).map((t=>({pos:o[t.w],weight:e.edge(t).weight}))).sort(((e,t)=>e.pos-t.pos)))),a=1;for(;a<n.length;)a<<=1;let s=2*a-1;a-=1;let i=new Array(s).fill(0),l=0;return r.forEach((e=>{let t=e.pos+a;i[t]+=e.weight;let n=0;for(;t>0;)t%2&&(n+=i[t+1]),t=t-1>>1,i[t]+=e.weight;l+=e.weight*n})),l}let WS=Hj;let qS=Hj;function YS(e,t,n){let o;for(;t.length&&(o=t[t.length-1]).i<=n;)t.pop(),e.push(o.vs),n++;return n}let JS=function(e,t=[]){return t.map((t=>{let n=e.inEdges(t);if(n.length){let o=n.reduce(((t,n)=>{let o=e.edge(n),r=e.node(n.v);return{sum:t.sum+o.weight*r.order,weight:t.weight+o.weight}}),{sum:0,weight:0});return{v:t,barycenter:o.sum/o.weight,weight:o.weight}}return{v:t}}))},KS=function(e,t){let n={};return e.forEach(((e,t)=>{let o=n[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};void 0!==e.barycenter&&(o.barycenter=e.barycenter,o.weight=e.weight)})),t.edges().forEach((e=>{let t=n[e.v],o=n[e.w];void 0!==t&&void 0!==o&&(o.indegree++,t.out.push(n[e.w]))})),function(e){let t=[];function n(e){return t=>{t.merged||(void 0===t.barycenter||void 0===e.barycenter||t.barycenter>=e.barycenter)&&function(e,t){let n=0,o=0;e.weight&&(n+=e.barycenter*e.weight,o+=e.weight);t.weight&&(n+=t.barycenter*t.weight,o+=t.weight);e.vs=t.vs.concat(e.vs),e.barycenter=n/o,e.weight=o,e.i=Math.min(t.i,e.i),t.merged=!0}(e,t)}}function o(t){return n=>{n.in.push(t),0==--n.indegree&&e.push(n)}}for(;e.length;){let r=e.pop();t.push(r),r.in.reverse().forEach(n(r)),r.out.forEach(o(r))}return t.filter((e=>!e.merged)).map((e=>WS.pick(e,["vs","i","barycenter","weight"])))}(Object.values(n).filter((e=>!e.indegree)))},XS=function(e,t){let n=qS.partition(e,(e=>Object.hasOwn(e,"barycenter"))),o=n.lhs,r=n.rhs.sort(((e,t)=>t.i-e.i)),a=[],s=0,i=0,l=0;o.sort((c=!!t,(e,t)=>e.barycenter<t.barycenter?-1:e.barycenter>t.barycenter?1:c?t.i-e.i:e.i-t.i)),l=YS(a,r,l),o.forEach((e=>{l+=e.vs.length,a.push(e.vs),s+=e.barycenter*e.weight,i+=e.weight,l=YS(a,r,l)}));var c;let d={vs:a.flat(!0)};i&&(d.barycenter=s/i,d.weight=i);return d};var ZS=function e(t,n,o,r){let a=t.children(n),s=t.node(n),i=s?s.borderLeft:void 0,l=s?s.borderRight:void 0,c={};i&&(a=a.filter((e=>e!==i&&e!==l)));let d=JS(t,a);d.forEach((n=>{if(t.children(n.v).length){let i=e(t,n.v,o,r);c[n.v]=i,Object.hasOwn(i,"barycenter")&&(s=i,void 0!==(a=n).barycenter?(a.barycenter=(a.barycenter*a.weight+s.barycenter*s.weight)/(a.weight+s.weight),a.weight+=s.weight):(a.barycenter=s.barycenter,a.weight=s.weight))}var a,s}));let u=KS(d,o);!function(e,t){e.forEach((e=>{e.vs=e.vs.flatMap((e=>t[e]?t[e].vs:e))}))}(u,c);let h=XS(u,r);if(i&&(h.vs=[i,h.vs,l].flat(!0),t.predecessors(i).length)){let e=t.node(t.predecessors(i)[0]),n=t.node(t.predecessors(l)[0]);Object.hasOwn(h,"barycenter")||(h.barycenter=0,h.weight=0),h.barycenter=(h.barycenter*h.weight+e.order+n.order)/(h.weight+2),h.weight+=2}return h};let QS=Dj.Graph,eI=Hj;let tI=function(e){let t={},n=e.nodes().filter((t=>!e.children(t).length)),o=n.map((t=>e.node(t).rank)),r=$S.applyWithChunking(Math.max,o),a=$S.range(r+1).map((()=>[]));return n.sort(((t,n)=>e.node(t).rank-e.node(n).rank)).forEach((function n(o){if(t[o])return;t[o]=!0;let r=e.node(o);a[r.rank].push(o),e.successors(o).forEach(n)})),a},nI=function(e,t){let n=0;for(let o=1;o<t.length;++o)n+=HS(e,t[o-1],t[o]);return n},oI=ZS,rI=function(e,t,n){let o=function(e){var t;for(;e.hasNode(t=eI.uniqueId("_root")););return t}(e),r=new QS({compound:!0}).setGraph({root:o}).setDefaultNodeLabel((t=>e.node(t)));return e.nodes().forEach((a=>{let s=e.node(a),i=e.parent(a);(s.rank===t||s.minRank<=t&&t<=s.maxRank)&&(r.setNode(a),r.setParent(a,i||o),e[n](a).forEach((t=>{let n=t.v===a?t.w:t.v,o=r.edge(n,a),s=void 0!==o?o.weight:0;r.setEdge(n,a,{weight:e.edge(t).weight+s})})),Object.hasOwn(s,"minRank")&&r.setNode(a,{borderLeft:s.borderLeft[t],borderRight:s.borderRight[t]}))})),r},aI=function(e,t,n){let o,r={};n.forEach((n=>{let a,s,i=e.parent(n);for(;i;){if(a=e.parent(i),a?(s=r[a],r[a]=i):(s=o,o=i),s&&s!==i)return void t.setEdge(s,i);i=a}}))},sI=Dj.Graph,iI=Hj;var lI=function e(t,n){if(n&&"function"==typeof n.customOrder)return void n.customOrder(t,e);let o=iI.maxRank(t),r=cI(t,iI.range(1,o+1),"inEdges"),a=cI(t,iI.range(o-1,-1,-1),"outEdges"),s=tI(t);if(uI(t,s),n&&n.disableOptimalOrderHeuristic)return;let i,l=Number.POSITIVE_INFINITY;for(let c=0,d=0;d<4;++c,++d){dI(c%2?r:a,c%4>=2),s=iI.buildLayerMatrix(t);let e=nI(t,s);e<l&&(d=0,i=Object.assign({},s),l=e)}uI(t,i)};function cI(e,t,n){return t.map((function(t){return rI(e,t,n)}))}function dI(e,t){let n=new sI;e.forEach((function(e){let o=e.graph().root,r=oI(e,o,n,t);r.vs.forEach(((t,n)=>e.node(t).order=n)),aI(e,n,r.vs)}))}function uI(e,t){Object.values(t).forEach((t=>t.forEach(((t,n)=>e.node(t).order=n))))}let hI=Dj.Graph,fI=Hj;var mI=function(e){let t,n=fI.buildLayerMatrix(e),o=Object.assign(pI(e,n),gI(e,n)),r={};["u","d"].forEach((a=>{t="u"===a?n:Object.values(n).reverse(),["l","r"].forEach((n=>{"r"===n&&(t=t.map((e=>Object.values(e).reverse())));let s=("u"===a?e.predecessors:e.successors).bind(e),i=vI(e,t,o,s),l=bI(e,t,i.root,i.align,"r"===n);"r"===n&&(l=fI.mapValues(l,(e=>-e))),r[a+n]=l}))}));let a=wI(e,r);return kI(r,a),NI(r,e.graph().align)};function pI(e,t){let n={};return t.length&&t.reduce((function(t,o){let r=0,a=0,s=t.length,i=o[o.length-1];return o.forEach(((t,l)=>{let c=function(e,t){if(e.node(t).dummy)return e.predecessors(t).find((t=>e.node(t).dummy))}(e,t),d=c?e.node(c).order:s;(c||t===i)&&(o.slice(a,l+1).forEach((t=>{e.predecessors(t).forEach((o=>{let a=e.node(o),s=a.order;!(s<r||d<s)||a.dummy&&e.node(t).dummy||xI(n,o,t)}))})),a=l+1,r=d)})),o})),n}function gI(e,t){let n={};function o(t,o,r,a,s){let i;fI.range(o,r).forEach((o=>{i=t[o],e.node(i).dummy&&e.predecessors(i).forEach((t=>{let o=e.node(t);o.dummy&&(o.order<a||o.order>s)&&xI(n,t,i)}))}))}return t.length&&t.reduce((function(t,n){let r,a=-1,s=0;return n.forEach(((i,l)=>{if("border"===e.node(i).dummy){let t=e.predecessors(i);t.length&&(r=e.node(t[0]).order,o(n,s,l,a,r),s=l,a=r)}o(n,s,n.length,r,t.length)})),n})),n}function xI(e,t,n){if(t>n){let e=t;t=n,n=e}let o=e[t];o||(e[t]=o={}),o[n]=!0}function yI(e,t,n){if(t>n){let e=t;t=n,n=e}return!!e[t]&&Object.hasOwn(e[t],n)}function vI(e,t,n,o){let r={},a={},s={};return t.forEach((e=>{e.forEach(((e,t)=>{r[e]=e,a[e]=e,s[e]=t}))})),t.forEach((e=>{let t=-1;e.forEach((e=>{let i=o(e);if(i.length){i=i.sort(((e,t)=>s[e]-s[t]));let o=(i.length-1)/2;for(let l=Math.floor(o),c=Math.ceil(o);l<=c;++l){let o=i[l];a[e]===e&&t<s[o]&&!yI(n,e,o)&&(a[o]=e,a[e]=r[e]=r[o],t=s[o])}}}))})),{root:r,align:a}}function bI(e,t,n,o,r){let a={},s=function(e,t,n,o){let r=new hI,a=e.graph(),s=function(e,t,n){return(o,r,a)=>{let s,i=o.node(r),l=o.node(a),c=0;if(c+=i.width/2,Object.hasOwn(i,"labelpos"))switch(i.labelpos.toLowerCase()){case"l":s=-i.width/2;break;case"r":s=i.width/2}if(s&&(c+=n?s:-s),s=0,c+=(i.dummy?t:e)/2,c+=(l.dummy?t:e)/2,c+=l.width/2,Object.hasOwn(l,"labelpos"))switch(l.labelpos.toLowerCase()){case"l":s=l.width/2;break;case"r":s=-l.width/2}return s&&(c+=n?s:-s),s=0,c}}(a.nodesep,a.edgesep,o);return t.forEach((t=>{let o;t.forEach((t=>{let a=n[t];if(r.setNode(a),o){var i=n[o],l=r.edge(i,a);r.setEdge(i,a,Math.max(s(e,t,o),l||0))}o=t}))})),r}(e,t,n,r),i=r?"borderLeft":"borderRight";function l(e,t){let n=s.nodes(),o=n.pop(),r={};for(;o;)r[o]?e(o):(r[o]=!0,n.push(o),n=n.concat(t(o))),o=n.pop()}return l((function(e){a[e]=s.inEdges(e).reduce(((e,t)=>Math.max(e,a[t.v]+s.edge(t))),0)}),s.predecessors.bind(s)),l((function(t){let n=s.outEdges(t).reduce(((e,t)=>Math.min(e,a[t.w]-s.edge(t))),Number.POSITIVE_INFINITY),o=e.node(t);n!==Number.POSITIVE_INFINITY&&o.borderType!==i&&(a[t]=Math.max(a[t],n))}),s.successors.bind(s)),Object.keys(o).forEach((e=>a[e]=a[n[e]])),a}function wI(e,t){return Object.values(t).reduce(((t,n)=>{let o=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;Object.entries(n).forEach((([t,n])=>{let a=function(e,t){return e.node(t).width}(e,t)/2;o=Math.max(n+a,o),r=Math.min(n-a,r)}));const a=o-r;return a<t[0]&&(t=[a,n]),t}),[Number.POSITIVE_INFINITY,null])[1]}function kI(e,t){let n=Object.values(t),o=fI.applyWithChunking(Math.min,n),r=fI.applyWithChunking(Math.max,n);["u","d"].forEach((n=>{["l","r"].forEach((a=>{let s=n+a,i=e[s];if(i===t)return;let l=Object.values(i),c=o-fI.applyWithChunking(Math.min,l);"l"!==a&&(c=r-fI.applyWithChunking(Math.max,l)),c&&(e[s]=fI.mapValues(i,(e=>e+c)))}))}))}function NI(e,t){return fI.mapValues(e.ul,((n,o)=>{if(t)return e[t.toLowerCase()][o];{let t=Object.values(e).map((e=>e[o])).sort(((e,t)=>e-t));return(t[1]+t[2])/2}}))}let EI=Hj,CI=mI;let jI=nS,SI=rS,II=MS,AI=Hj.normalizeRanks,TI=function(e){let t=function(e){let t={},n=0;function o(r){let a=n;e.children(r).forEach(o),t[r]={low:a,lim:n++}}return e.children().forEach(o),t}(e);e.graph().dummyChains.forEach((n=>{let o=e.node(n),r=o.edgeObj,a=function(e,t,n,o){let r,a,s=[],i=[],l=Math.min(t[n].low,t[o].low),c=Math.max(t[n].lim,t[o].lim);r=n;do{r=e.parent(r),s.push(r)}while(r&&(t[r].low>l||c>t[r].lim));a=r,r=o;for(;(r=e.parent(r))!==a;)i.push(r);return{path:s.concat(i.reverse()),lca:a}}(e,t,r.v,r.w),s=a.path,i=a.lca,l=0,c=s[l],d=!0;for(;n!==r.w;){if(o=e.node(n),d){for(;(c=s[l])!==i&&e.node(c).maxRank<o.rank;)l++;c===i&&(d=!1)}if(!d){for(;l<s.length-1&&e.node(c=s[l+1]).minRank<=o.rank;)l++;c=s[l]}e.setParent(n,c),n=e.successors(n)[0]}}))},OI=Hj.removeEmptyRanks,MI={run:function(e){let t=DS.addDummyNode(e,"root",{},"_root"),n=function(e){var t={};function n(o,r){var a=e.children(o);a&&a.length&&a.forEach((e=>n(e,r+1))),t[o]=r}return e.children().forEach((e=>n(e,1))),t}(e),o=Object.values(n),r=DS.applyWithChunking(Math.max,o)-1,a=2*r+1;e.graph().nestingRoot=t,e.edges().forEach((t=>e.edge(t).minlen*=a));let s=function(e){return e.edges().reduce(((t,n)=>t+e.edge(n).weight),0)}(e)+1;e.children().forEach((o=>FS(e,t,a,s,r,n,o))),e.graph().nodeRankFactor=a},cleanup:function(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach((t=>{e.edge(t).nestingEdge&&e.removeEdge(t)}))}},_I=function(e){e.children().forEach((function t(n){let o=e.children(n),r=e.node(n);if(o.length&&o.forEach(t),Object.hasOwn(r,"minRank")){r.borderLeft=[],r.borderRight=[];for(let t=r.minRank,o=r.maxRank+1;t<o;++t)RS(e,"borderLeft","_bl",n,r,t),RS(e,"borderRight","_br",n,r,t)}}))},PI={adjust:function(e){let t=e.graph().rankdir.toLowerCase();"lr"!==t&&"rl"!==t||zS(e)},undo:function(e){let t=e.graph().rankdir.toLowerCase();"bt"!==t&&"rl"!==t||function(e){e.nodes().forEach((t=>US(e.node(t)))),e.edges().forEach((t=>{let n=e.edge(t);n.points.forEach(US),Object.hasOwn(n,"y")&&US(n)}))}(e);"lr"!==t&&"rl"!==t||(!function(e){e.nodes().forEach((t=>VS(e.node(t)))),e.edges().forEach((t=>{let n=e.edge(t);n.points.forEach(VS),Object.hasOwn(n,"x")&&VS(n)}))}(e),zS(e))}},DI=lI,FI=function(e){(function(e){let t=EI.buildLayerMatrix(e),n=e.graph().ranksep,o=0;t.forEach((t=>{const r=t.reduce(((t,n)=>{const o=e.node(n).height;return t>o?t:o}),0);t.forEach((t=>e.node(t).y=o+r/2)),o+=r+n}))})(e=EI.asNonCompoundGraph(e)),Object.entries(CI(e)).forEach((([t,n])=>e.node(t).x=n))},LI=Hj,RI=Dj.Graph;var zI=function(e,t){let n=t&&t.debugTiming?LI.time:LI.notime;n("layout",(()=>{let o=n("  buildLayoutGraph",(()=>function(e){let t=new RI({multigraph:!0,compound:!0}),n=JI(e.graph());return t.setGraph(Object.assign({},UI,YI(n,BI),LI.pick(n,VI))),e.nodes().forEach((n=>{const o=YI(JI(e.node(n)),$I);Object.keys(GI).forEach((e=>{void 0===o[e]&&(o[e]=GI[e])})),t.setNode(n,o),t.setParent(n,e.parent(n))})),e.edges().forEach((n=>{let o=JI(e.edge(n));t.setEdge(n,Object.assign({},WI,YI(o,HI),LI.pick(o,qI)))})),t}(e)));n("  runLayout",(()=>function(e,t,n){t("    makeSpaceForEdgeLabels",(()=>function(e){let t=e.graph();t.ranksep/=2,e.edges().forEach((n=>{let o=e.edge(n);o.minlen*=2,"c"!==o.labelpos.toLowerCase()&&("TB"===t.rankdir||"BT"===t.rankdir?o.width+=o.labeloffset:o.height+=o.labeloffset)}))}(e))),t("    removeSelfEdges",(()=>function(e){e.edges().forEach((t=>{if(t.v===t.w){var n=e.node(t.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}}))}(e))),t("    acyclic",(()=>jI.run(e))),t("    nestingGraph.run",(()=>MI.run(e))),t("    rank",(()=>II(LI.asNonCompoundGraph(e)))),t("    injectEdgeLabelProxies",(()=>function(e){e.edges().forEach((t=>{let n=e.edge(t);if(n.width&&n.height){let n=e.node(t.v),o={rank:(e.node(t.w).rank-n.rank)/2+n.rank,e:t};LI.addDummyNode(e,"edge-proxy",o,"_ep")}}))}(e))),t("    removeEmptyRanks",(()=>OI(e))),t("    nestingGraph.cleanup",(()=>MI.cleanup(e))),t("    normalizeRanks",(()=>AI(e))),t("    assignRankMinMax",(()=>function(e){let t=0;e.nodes().forEach((n=>{let o=e.node(n);o.borderTop&&(o.minRank=e.node(o.borderTop).rank,o.maxRank=e.node(o.borderBottom).rank,t=Math.max(t,o.maxRank))})),e.graph().maxRank=t}(e))),t("    removeEdgeLabelProxies",(()=>function(e){e.nodes().forEach((t=>{let n=e.node(t);"edge-proxy"===n.dummy&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))}))}(e))),t("    normalize.run",(()=>SI.run(e))),t("    parentDummyChains",(()=>TI(e))),t("    addBorderSegments",(()=>_I(e))),t("    order",(()=>DI(e,n))),t("    insertSelfEdges",(()=>function(e){var t=LI.buildLayerMatrix(e);t.forEach((t=>{var n=0;t.forEach(((t,o)=>{var r=e.node(t);r.order=o+n,(r.selfEdges||[]).forEach((t=>{LI.addDummyNode(e,"selfedge",{width:t.label.width,height:t.label.height,rank:r.rank,order:o+ ++n,e:t.e,label:t.label},"_se")})),delete r.selfEdges}))}))}(e))),t("    adjustCoordinateSystem",(()=>PI.adjust(e))),t("    position",(()=>FI(e))),t("    positionSelfEdges",(()=>function(e){e.nodes().forEach((t=>{var n=e.node(t);if("selfedge"===n.dummy){var o=e.node(n.e.v),r=o.x+o.width/2,a=o.y,s=n.x-r,i=o.height/2;e.setEdge(n.e,n.label),e.removeNode(t),n.label.points=[{x:r+2*s/3,y:a-i},{x:r+5*s/6,y:a-i},{x:r+s,y:a},{x:r+5*s/6,y:a+i},{x:r+2*s/3,y:a+i}],n.label.x=n.x,n.label.y=n.y}}))}(e))),t("    removeBorderNodes",(()=>function(e){e.nodes().forEach((t=>{if(e.children(t).length){let n=e.node(t),o=e.node(n.borderTop),r=e.node(n.borderBottom),a=e.node(n.borderLeft[n.borderLeft.length-1]),s=e.node(n.borderRight[n.borderRight.length-1]);n.width=Math.abs(s.x-a.x),n.height=Math.abs(r.y-o.y),n.x=a.x+n.width/2,n.y=o.y+n.height/2}})),e.nodes().forEach((t=>{"border"===e.node(t).dummy&&e.removeNode(t)}))}(e))),t("    normalize.undo",(()=>SI.undo(e))),t("    fixupEdgeLabelCoords",(()=>function(e){e.edges().forEach((t=>{let n=e.edge(t);if(Object.hasOwn(n,"x"))switch("l"!==n.labelpos&&"r"!==n.labelpos||(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset}}))}(e))),t("    undoCoordinateSystem",(()=>PI.undo(e))),t("    translateGraph",(()=>function(e){let t=Number.POSITIVE_INFINITY,n=0,o=Number.POSITIVE_INFINITY,r=0,a=e.graph(),s=a.marginx||0,i=a.marginy||0;function l(e){let a=e.x,s=e.y,i=e.width,l=e.height;t=Math.min(t,a-i/2),n=Math.max(n,a+i/2),o=Math.min(o,s-l/2),r=Math.max(r,s+l/2)}e.nodes().forEach((t=>l(e.node(t)))),e.edges().forEach((t=>{let n=e.edge(t);Object.hasOwn(n,"x")&&l(n)})),t-=s,o-=i,e.nodes().forEach((n=>{let r=e.node(n);r.x-=t,r.y-=o})),e.edges().forEach((n=>{let r=e.edge(n);r.points.forEach((e=>{e.x-=t,e.y-=o})),Object.hasOwn(r,"x")&&(r.x-=t),Object.hasOwn(r,"y")&&(r.y-=o)})),a.width=n-t+s,a.height=r-o+i}(e))),t("    assignNodeIntersects",(()=>function(e){e.edges().forEach((t=>{let n,o,r=e.edge(t),a=e.node(t.v),s=e.node(t.w);r.points?(n=r.points[0],o=r.points[r.points.length-1]):(r.points=[],n=s,o=a),r.points.unshift(LI.intersectRect(a,n)),r.points.push(LI.intersectRect(s,o))}))}(e))),t("    reversePoints",(()=>function(e){e.edges().forEach((t=>{let n=e.edge(t);n.reversed&&n.points.reverse()}))}(e))),t("    acyclic.undo",(()=>jI.undo(e)))}(o,n,t))),n("  updateInputGraph",(()=>function(e,t){e.nodes().forEach((n=>{let o=e.node(n),r=t.node(n);o&&(o.x=r.x,o.y=r.y,o.rank=r.rank,t.children(n).length&&(o.width=r.width,o.height=r.height))})),e.edges().forEach((n=>{let o=e.edge(n),r=t.edge(n);o.points=r.points,Object.hasOwn(r,"x")&&(o.x=r.x,o.y=r.y)})),e.graph().width=t.graph().width,e.graph().height=t.graph().height}(e,o)))}))};let BI=["nodesep","edgesep","ranksep","marginx","marginy"],UI={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},VI=["acyclicer","ranker","rankdir","align"],$I=["width","height"],GI={width:0,height:0},HI=["minlen","weight","width","height","labeloffset"],WI={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},qI=["labelpos"];function YI(e,t){return LI.mapValues(LI.pick(e,t),Number)}function JI(e){var t={};return e&&Object.entries(e).forEach((([e,n])=>{"string"==typeof e&&(e=e.toLowerCase()),t[e]=n})),t}let KI=Hj,XI=Dj.Graph;var ZI={graphlib:Dj,layout:zI,debug:{debugOrdering:function(e){let t=KI.buildLayerMatrix(e),n=new XI({compound:!0,multigraph:!0}).setGraph({});return e.nodes().forEach((t=>{n.setNode(t,{label:t}),n.setParent(t,"layer"+e.node(t).rank)})),e.edges().forEach((e=>n.setEdge(e.v,e.w,{},e.name))),t.forEach(((e,t)=>{let o="layer"+t;n.setNode(o,{rank:"same"}),e.reduce(((e,t)=>(n.setEdge(e,t,{style:"invis"}),t)))})),n}},util:{time:Hj.time,notime:Hj.notime},version:"1.1.4"};const QI=(new ZI.graphlib.Graph).setDefaultEdgeLabel((()=>({}))),eA=(e,t,n)=>(QI.setGraph({rankdir:n.direction,nodesep:150,ranksep:200,ranker:"longest-path"}),t.forEach((e=>QI.setEdge(e.source,e.target))),e.forEach((e=>QI.setNode(e.id,{...e,width:e.width??0,height:e.height??0}))),ZI.layout(QI),{nodes:e.map((e=>{const{x:t,y:n}=QI.node(e.id);return{...e,position:{x:t,y:n}}})),edges:t}),tA=new class{createEdge(e,t){return{animated:!0,markerEnd:{type:bk.ArrowClosed},id:`${e}-${t}`,style:{strokeWidth:2},source:e,sourceHandle:"outputs",targetHandle:"inputs",target:t}}createNode(e,t){return{id:e,data:{atom:t,forceWidth:300},width:300,type:"custom",height:UC(G.get(t).code.trim().split("\n").length),position:{x:0,y:0}}}createElements(e,t,n,o){const r=[],a=[],s=new Set,i=new Set;for(const l of Object.values(n)){if("marimo"===l.value&&"mo"===l.name)continue;const{declaredBy:e,usedBy:t}=l;for(const n of e)for(const e of t){const t=`${n}-${e}`;i.has(t)||(i.add(t),s.add(n),s.add(e),a.push(this.createEdge(n,e)))}}for(const[l,c]of ja.zip(e,t)){o||r.push(this.createNode(l,c));const e=s.has(l),t=G.get(c).code.trim().startsWith("mo.md");!e&&t||r.push(this.createNode(l,c))}return{nodes:r,edges:a}}},nA=({cellIds:e,variables:t,cellAtoms:n,children:o,layoutDirection:r,settings:s})=>{const i=S.useMemo((()=>{let o=tA.createElements(e,n,t,s.hidePureMarkdown);return o=eA(o.nodes,o.edges,{direction:r}),o}),[]),[l,c,d]=wC(i.nodes),[u,h,f]=kC(i.edges),m=M((e=>{const t=eA(e.nodes,e.edges,{direction:r});c(t.nodes),h(t.edges)}));S.useEffect((()=>{m(tA.createElements(e,n,t,s.hidePureMarkdown))}),[e,t,n,m,s.hidePureMarkdown]);const[p,g]=S.useState();return JC(),a.jsx(VC.Provider,{value:r,children:a.jsxs(vC,{nodes:l,edges:u,nodeTypes:GC,minZoom:.2,fitViewOptions:{minZoom:.5,maxZoom:1.5},onNodeClick:(e,t)=>{g({type:"node",id:t.id})},onEdgeClick:(e,t)=>{const{source:n,target:o}=t;g({type:"edge",source:n,target:o})},onNodeDoubleClick:(e,t)=>{Ma(t.id,"focus")},fitView:!0,onNodesChange:d,onEdgesChange:f,zoomOnDoubleClick:!1,nodesConnectable:!1,children:[a.jsx(BC,{color:"#ccc",variant:OC.Dots}),a.jsx(_C,{position:"bottom-right",showInteractive:!1}),a.jsx(YC,{selection:p,variables:t,edges:u}),o]})})},oA=L("_minimap_"),rA=L({hidePureMarkdown:!0}),aA=e=>{const[t,n]=be(oA),[o,r]=be(rA);return a.jsx(uC,{children:"_minimap_"===t?a.jsx(XC,{...e,children:a.jsx(qC,{settings:o,onSettingsChange:r,view:t,onChange:n})}):a.jsx(nA,{...e,settings:o,layoutDirection:t,children:a.jsx(qC,{settings:o,onSettingsChange:r,view:t,onChange:n})})},t)},sA=()=>{const e=_a(),t=X(),[n]=Pa();return a.jsx("div",{className:Lt("w-full h-full flex-1 mx-auto -mb-4 relative"),children:a.jsx(aA,{cellAtoms:n,variables:e,cellIds:t.inOrderIds})})};const iA="name",lA="type-value",cA="defs-refs",dA=[{id:iA,accessorFn:e=>[e.name,e.declaredBy],enableSorting:!0,sortingFn:"alphanumeric",header:({column:e})=>a.jsx(Ja,{header:"Name",column:e}),cell:({getValue:e})=>{const[t,n]=e();return a.jsx(WC,{name:t,declaredBy:n})}},{id:lA,accessorFn:e=>[e.dataType,e.value],enableSorting:!0,sortingFn:"alphanumeric",header:({column:e})=>a.jsx(Ja,{header:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{children:"Type"}),a.jsx("span",{children:"Value"})]}),column:e}),cell:({getValue:e})=>{const[t,n]=e();return a.jsxs("div",{className:"max-w-[150px]",children:[a.jsx("div",{className:"text-ellipsis overflow-hidden whitespace-nowrap text-muted-foreground font-mono text-xs",children:t}),a.jsx("div",{className:"text-ellipsis overflow-hidden whitespace-nowrap",title:n??"",children:n})]})}},{id:cA,accessorFn:e=>[e.declaredBy,e.usedBy,e.name,e.declaredByNames,e.usedByNames],enableSorting:!0,sortingFn:"basic",header:({column:e})=>a.jsx(Ja,{header:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{children:"Declared By"}),a.jsx("span",{children:"Used By"})]}),column:e}),cell:({getValue:e})=>{const[t,n,o]=e(),r=e=>{const t=nr(e);t&&Ta(t,o)};return a.jsxs("div",{className:"flex flex-col gap-1 py-1",children:[a.jsxs("div",{className:"flex flex-row overflow-auto gap-2 items-center",children:[a.jsx("span",{title:"Declared by",children:a.jsx(ql,{className:"w-3.5 h-3.5 text-muted-foreground"})}),1===t.length?a.jsx(Ia,{variant:"focus",cellId:t[0],skipScroll:!0,onClick:()=>r(t[0])}):a.jsx("div",{className:"text-destructive flex flex-row gap-2",children:t.slice(0,3).map(((e,n)=>a.jsxs("span",{className:"flex",children:[a.jsx(Ia,{variant:"focus",cellId:e,skipScroll:!0,className:"whitespace-nowrap text-destructive",onClick:()=>r(e)},e),n<t.length-1&&", "]},e)))})]}),a.jsxs("div",{className:"flex flex-row overflow-auto gap-2 items-baseline",children:[a.jsx("span",{title:"Used by",children:a.jsx(rc,{className:"w-3.5 h-3.5 text-muted-foreground"})}),a.jsx(HC,{maxCount:3,cellIds:n,skipScroll:!0,onClick:r})]})]})}}];const uA=S.memo((({className:e,cellIds:t,variables:n})=>{const[o,r]=T.useState([]),[s,i]=T.useState(""),l=Da(),c=S.useMemo((()=>{const e=e=>{const n=l[e];return n===Ya?`cell-${t.indexOf(e)}`:n??`cell-${t.indexOf(e)}`};return Object.values(n).map((t=>({...t,declaredByNames:t.declaredBy.map(e),usedByNames:t.usedBy.map(e)})))}),[n,l,t]),d=S.useMemo((()=>{const e=new Map;return t.forEach(((t,n)=>e.set(t,n))),function(e,t,n){t||(t={id:cA,desc:!1});let o=[];switch(t.id){case iA:o=Hi(e,(e=>e.name));break;case lA:o=Hi(e,(e=>e.dataType));break;case cA:o=Hi(e,(e=>n.get(e.declaredBy[0])))}return t.desc?o.reverse():o}(c,o[0],e)}),[c,o,t]),u=Fa({data:d,columns:dA,getCoreRowModel:La(),onGlobalFilterChange:i,getFilteredRowModel:Ra(),enableFilters:!0,enableGlobalFilter:!0,getColumnCanGlobalFilter:e=>e.columnDef.enableGlobalFilter??!0,globalFilterFn:"auto",manualSorting:!0,onSortingChange:r,getSortedRowModel:za(),state:{sorting:o,globalFilter:s}});return a.jsxs(a.Fragment,{children:[a.jsx(Ba,{className:"w-full",placeholder:"Search",value:s,onChange:e=>i(e.target.value)}),a.jsxs(Ua,{className:Lt("w-full text-sm flex-1 border-separate border-spacing-0",e),children:[a.jsx(Va,{children:a.jsx($a,{className:"whitespace-nowrap text-xs",children:u.getFlatHeaders().map((e=>a.jsx(Ga,{className:"sticky top-0 bg-background border-b",children:Ha(e.column.columnDef.header,e.getContext())},e.id)))})}),a.jsx(Wa,{children:u.getRowModel().rows.map((e=>a.jsx($a,{className:"hover:bg-accent",children:e.getVisibleCells().map((e=>a.jsx(qa,{className:"border-b",children:Ha(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))})]})]})}));uA.displayName="VariableTable";const hA=()=>{const e=_a(),t=X();return 0===Object.keys(e).length?a.jsx(nw,{title:"No variables",description:"Global variables will appear here.",icon:a.jsx($e,{})}):a.jsx(uA,{className:"flex-1",cellIds:t.inOrderIds,variables:e})},fA=()=>{const e=Ka(),{clearLogs:t}=P();return 0===e.length?a.jsx(nw,{title:"No logs",description:a.jsxs("span",{children:[a.jsx("code",{className:"border rounded px-1",children:"stdout"})," and"," ",a.jsx("code",{className:"border rounded px-1",children:"stderr"})," logs will appear here."]}),icon:a.jsx(Ge,{})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex flex-row justify-end px-2 py-1",children:a.jsx("button",{"data-testid":"clear-logs-button",className:"text-xs font-semibold text-accent-foreground",onClick:t,children:"Clear"})}),a.jsx("div",{className:"overflow-auto flex-1",children:a.jsx(mA,{logs:e,className:"min-w-[300px]"})})]})},mA=({logs:e,className:t})=>{const n="opacity-70 group-hover:bg-[var(--gray-3)] group-hover:opacity-100";return a.jsx("div",{className:Lt("flex flex-col",t),children:a.jsx("pre",{className:"grid text-xs font-mono gap-1 whitespace-break-spaces font-semibold align-left",children:a.jsx("div",{className:"grid grid-cols-[30px,1fr]",style:{whiteSpace:"pre-wrap"},children:e.map(((e,t)=>a.jsxs("div",{className:"contents group",children:[a.jsx("span",{className:Lt(n,"text-right col-span-1 py-1 pr-1"),children:t+1}),a.jsx("span",{className:Lt(n,"px-2 flex gap-x-1.5 py-1 flex-wrap"),children:pA(e)})]},t)))})})})};function pA(e){const t=Xa(e.timestamp),n=gA[e.level],o=e.level.toUpperCase();return a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"flex-shrink-0 text-[var(--gray-10)]",children:["[",t,"]"]}),a.jsx("span",{className:Lt("flex-shrink-0",n),children:o}),a.jsxs("span",{className:"flex-shrink-0 text-[var(--gray-10)]",children:["(",a.jsx(Ia,{cellId:e.cellId}),")"]}),e.message]})}const gA={stdout:"text-[var(--grass-9)]",stderr:"text-[var(--red-9)]"},xA=()=>{const{documentation:e}=W(Za);return e?a.jsx("div",{className:"p-3 overflow-y-auto overflow-x-hidden h-full docs-documentation flex flex-col gap-4",children:jr({html:e})}):a.jsx(nw,{title:"View docs as you type",description:"Move your text cursor over a symbol to see its documentation.",icon:a.jsx(ec,{})})};function yA(e,t,n){return e[t]?e[t][0]?e[t][0][n]:e[t][n]:"contentBoxSize"===t?e.contentRect["inlineSize"===n?"width":"height"]:void 0}function vA(e){void 0===e&&(e={});var t=e.onResize,n=S.useRef(void 0);n.current=t;var o=e.round||Math.round,r=S.useRef(),a=S.useState({width:void 0,height:void 0}),s=a[0],i=a[1],l=S.useRef(!1);S.useEffect((function(){return l.current=!1,function(){l.current=!0}}),[]);var c=S.useRef({width:void 0,height:void 0}),d=function(e,t){var n=S.useRef(null),o=S.useRef(null);o.current=t;var r=S.useRef(null);S.useEffect((function(){a()}));var a=S.useCallback((function(){var t=r.current,a=o.current,s=t||(a?a instanceof Element?a:a.current:null);n.current&&n.current.element===s&&n.current.subscriber===e||(n.current&&n.current.cleanup&&n.current.cleanup(),n.current={element:s,subscriber:e,cleanup:s?e(s):void 0})}),[e]);return S.useEffect((function(){return function(){n.current&&n.current.cleanup&&(n.current.cleanup(),n.current=null)}}),[]),S.useCallback((function(e){r.current=e,a()}),[a])}(S.useCallback((function(t){return r.current&&r.current.box===e.box&&r.current.round===o||(r.current={box:e.box,round:o,instance:new ResizeObserver((function(t){var r=t[0],a="border-box"===e.box?"borderBoxSize":"device-pixel-content-box"===e.box?"devicePixelContentBoxSize":"contentBoxSize",s=yA(r,a,"inlineSize"),d=yA(r,a,"blockSize"),u=s?o(s):void 0,h=d?o(d):void 0;if(c.current.width!==u||c.current.height!==h){var f={width:u,height:h};c.current.width=u,c.current.height=h,n.current?n.current(f):l.current||i(f)}}))}),r.current.instance.observe(t,{box:e.box}),function(){r.current&&r.current.instance.unobserve(t)}}),[e.box,o]),e.ref);return S.useMemo((function(){return{ref:d,width:s.width,height:s.height}}),[d,s.width,s.height])}const bA=new Map,wA=({file:e,onOpenNotebook:t})=>{const{theme:n}=pe(),o=W(we),[r,i]=S.useState(""),{data:l,loading:c,error:d,setData:u}=zt((async()=>{const t=await Qa({path:e.path}),n=t.contents||"";return i(bA.get(e.path)||n),t}),[e.path]),f=async()=>{r!==(null==l?void 0:l.contents)&&await is({path:e.path,contents:r}).then((e=>{e.success&&(u((e=>e?{...e,contents:r}:void 0)),i(r))}))},m=S.useRef(r);if(m.current=r,S.useEffect((()=>()=>{if(!l)return;const t=m.current;t===l.contents?bA.delete(e.path):bA.set(e.path,t)}),[e.path,null==l?void 0:l.contents]),d)return a.jsx(es,{error:d});if(c||!l)return null;const p=l.mimeType||"text/plain",g=p in NA;if(!l.contents&&!g)return a.jsxs("div",{className:"grid grid-cols-2 gap-2 p-6",children:[a.jsx("div",{className:"font-bold text-muted-foreground",children:"Name"}),a.jsx("div",{children:l.file.name}),a.jsx("div",{className:"font-bold text-muted-foreground",children:"Type"}),a.jsx("div",{children:p})]});const x=a.jsxs("div",{className:"text-xs text-muted-foreground p-1 flex justify-end gap-2 border-b",children:[e.isMarimoFile&&!v()&&a.jsx(s,{content:"Open notebook",children:a.jsx(Ts,{size:"small",onClick:e=>t(e),children:a.jsx(ts,{})})}),a.jsx(s,{content:"Download",children:a.jsx(Ts,{size:"small",onClick:()=>{if(kA(p)){const e=ls(l.contents,p);cs(e,l.file.name)}else h(new Blob([l.contents||r],{type:p}),l.file.name)},children:a.jsx(rt,{})})}),!kA(p)&&a.jsxs(a.Fragment,{children:[a.jsx(s,{content:"Copy contents to clipboard",children:a.jsx(Ts,{size:"small",onClick:()=>{navigator.clipboard.writeText(r)},children:a.jsx(Fe,{})})}),a.jsx(s,{content:As("global.save"),children:a.jsx(Ts,{size:"small",color:r===l.contents?void 0:"green",onClick:f,disabled:r===l.contents,children:a.jsx(Bl,{})})})]})]});return p.startsWith("image/")?a.jsxs(a.Fragment,{children:[x,a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:a.jsx(ns,{base64:l.contents,mime:p})})]}):"text/csv"===p&&l.contents?a.jsxs(a.Fragment,{children:[x,a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:a.jsx(os,{contents:l.contents})})]}):p.startsWith("audio/")?a.jsxs(a.Fragment,{children:[x,a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:a.jsx(rs,{base64:l.contents,mime:p})})]}):p.startsWith("video/")?a.jsxs(a.Fragment,{children:[x,a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:a.jsx(as,{base64:l.contents,mime:p})})]}):a.jsxs(a.Fragment,{children:[x,a.jsx("div",{className:"flex-1 overflow-auto",children:a.jsx(ss,{theme:"dark"===n?"dark":"light",language:NA[p]||NA.default,className:"border-b",extensions:[St.lineWrapping,nn.of([{key:o.getHotkey("global.save").key,stopPropagation:!0,run:()=>r!==l.contents&&(f(),!0)}])],value:r,onChange:i})})]})},kA=e=>!!e&&(e.startsWith("image/")||e.startsWith("audio/")||e.startsWith("video/")),NA={"application/javascript":"javascript","text/markdown":"markdown","text/html":"html","text/css":"css","text/x-python":"python","application/json":"json","application/xml":"xml","text/x-yaml":"yaml","text/csv":"markdown","text/plain":"markdown",default:"markdown"};const EA=L(new class{constructor(e){n(this,"delegate",new ai([])),n(this,"rootPath",""),n(this,"onChange",Rt.NOOP),n(this,"path",new Je("/")),n(this,"initialize",(async e=>{if(this.onChange=e,0===this.delegate.data.length)try{const e=await this.callbacks.listFiles({path:this.rootPath});this.delegate=new ai(e.files),this.rootPath=e.root,this.path=Je.guessDeliminator(e.root)}catch(t){U({title:"Failed",description:Qo(t)})}this.onChange(this.delegate.data)})),n(this,"refreshAll",(async e=>{const t=[this.rootPath,...e.map((e=>{var t;return null==(t=this.delegate.find(e))?void 0:t.data.path}))].filter(Boolean),n=await Promise.all(t.map((e=>this.callbacks.listFiles({path:e}).catch((()=>({files:[]}))))));for(const[o,r]of t.entries()){const e=n[o];r===this.rootPath?this.delegate=new ai(e.files):this.delegate.update({id:r,changes:{children:e.files}})}this.onChange(this.delegate.data)})),n(this,"relativeFromRoot",(e=>{const t=function(e){return e.endsWith("/")?e:`${e}/`}(this.rootPath);return e.startsWith(t)?e.slice(t.length):e})),n(this,"handleResponse",(e=>e.success?e:(U({title:"Failed",description:e.message}),null))),this.callbacks=e}async expand(e){const t=this.delegate.find(e);if(!t)return!1;if(!t.data.isDirectory)return!1;if(t.children&&t.children.length>0)return!0;const n=await this.callbacks.listFiles({path:t.data.path});return this.delegate.update({id:e,changes:{children:n.files}}),this.onChange(this.delegate.data),!0}async rename(e,t){const n=this.delegate.find(e);if(!n)return;const o=n.data.path,r=this.path.join(this.path.dirname(o),t);await this.callbacks.renameFileOrFolder({path:o,newPath:r}).then(this.handleResponse),this.delegate.update({id:e,changes:{name:t,path:r}}),this.onChange(this.delegate.data),await this.refreshAll([r])}async move(e,t){var n;const o=t?(null==(n=this.delegate.find(t))?void 0:n.data.path)??t:this.rootPath;await Promise.all(e.map((e=>{this.delegate.move({id:e,parentId:t,index:0});const n=this.delegate.find(e);if(!n)return Promise.resolve();const r=this.path.join(o,this.path.basename(n.data.path));return this.delegate.update({id:e,changes:{path:r}}),this.callbacks.renameFileOrFolder({path:n.data.path,newPath:r}).then(this.handleResponse)}))),this.onChange(this.delegate.data),await this.refreshAll([o])}async createFile(e,t){var n;const o=t?(null==(n=this.delegate.find(t))?void 0:n.data.path)??t:this.rootPath,r=await this.callbacks.createFileOrFolder({path:o,type:"file",name:e}).then(this.handleResponse);(null==r?void 0:r.info)&&(this.delegate.create({parentId:t,index:0,data:r.info}),this.onChange(this.delegate.data),await this.refreshAll([o]))}async createFolder(e,t){var n;const o=t?(null==(n=this.delegate.find(t))?void 0:n.data.path)??t:this.rootPath,r=await this.callbacks.createFileOrFolder({path:o,type:"directory",name:e}).then(this.handleResponse);(null==r?void 0:r.info)&&(this.delegate.create({parentId:t,index:0,data:r.info}),this.onChange(this.delegate.data),await this.refreshAll([o]))}async delete(e){const t=this.delegate.find(e);t&&(await this.callbacks.deleteFileOrFolder({path:t.data.path}).then(this.handleResponse),this.delegate.drop({id:e}),this.onChange(this.delegate.data))}}({listFiles:Bt,createFileOrFolder:ds,deleteFileOrFolder:us,renameFileOrFolder:hs})),CA=L({});function jA(e={}){return fs({multiple:!0,maxSize:104857600,onError:e=>{f.error(e),U({title:"File upload failed",description:e.message,variant:"danger"})},onDropRejected:e=>{U({title:"File upload failed",description:a.jsx("div",{className:"flex flex-col gap-1",children:e.map((e=>a.jsxs("div",{children:[e.file.name," (",e.errors.map((e=>e.message)).join(", "),")"]},e.file.name)))}),variant:"danger"})},onDrop:async e=>{for(const t of e){const e=(await ms(t)).split(",")[1];await ds({path:"",type:"file",name:t.name,contents:e})}await async function(){await G.get(EA).refreshAll([])}()},...e})}const SA=T.createContext(null),IA=({height:e})=>{const t=S.useRef(null),[n]=be(EA),[o,s]=S.useState([]),[i,l]=S.useState(null),{openPrompt:c}=r(),[d,h]=be(CA),{loading:f,error:m}=zt((()=>n.initialize(s)),[]),p=M((()=>{n.refreshAll(Object.keys(d).filter((e=>d[e])))})),g=M((async()=>{c({title:"Folder name",onConfirm:async e=>{n.createFolder(e,null)}})})),x=M((async()=>{c({title:"File name",onConfirm:async e=>{n.createFile(e,null)}})})),y=M((()=>{var e;null==(e=t.current)||e.closeAll(),h({})}));return f?a.jsx(ma,{size:"medium",centered:!0}):m?a.jsx(es,{error:m}):i?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center pl-1 pr-3 flex-shrink-0 border-b justify-between",children:[a.jsx(u,{onClick:()=>l(null),"data-testid":"file-explorer-back-button",variant:"text",size:"xs",className:"mb-0",children:a.jsx(Wi,{size:16})}),a.jsx("span",{className:"font-bold",children:i.name})]}),a.jsx(S.Suspense,{children:a.jsx(wA,{onOpenNotebook:e=>DA(e,n.relativeFromRoot(i.path)),file:i})})]}):a.jsxs(a.Fragment,{children:[a.jsx(TA,{onRefresh:p,onCreateFile:x,onCreateFolder:g,onCollapseAll:y,tree:n}),a.jsx(SA.Provider,{value:n,children:a.jsx(si,{width:"100%",ref:t,height:e-33,className:"h-full",data:o,initialOpenState:d,openByDefault:!1,renderCursor:()=>null,disableDrop:({parentNode:e})=>!e.data.isDirectory,onDelete:async({ids:e})=>{for(const t of e)await n.delete(t)},onRename:async({id:e,name:t})=>{await n.rename(e,t)},onMove:async({dragIds:e,parentId:t})=>{await n.move(e,t)},onSelect:e=>{const t=e[0];t&&(t.data.isDirectory||l(t.data))},onToggle:async e=>{if(await n.expand(e)){const t=d[e]??!1;h({...d,[e]:!t})}},padding:15,rowHeight:30,indent:AA,overscanCount:1e3,disableMultiSelection:!0,children:_A})})]})},AA=15,TA=({tree:e,onRefresh:t,onCreateFile:n,onCreateFolder:o,onCollapseAll:r})=>{const{getRootProps:i,getInputProps:l}=jA({noDrag:!0,noDragEventsBubbling:!0});return a.jsxs("div",{className:"flex items-center justify-end px-2 flex-shrink-0 border-b",children:[a.jsx(s,{content:"Add file",children:a.jsx(u,{"data-testid":"file-explorer-add-file-button",onClick:n,variant:"text",size:"xs",children:a.jsx(ml,{size:16})})}),a.jsx(s,{content:"Add folder",children:a.jsx(u,{"data-testid":"file-explorer-add-folder-button",onClick:o,variant:"text",size:"xs",children:a.jsx(gl,{size:16})})}),a.jsx(s,{content:"Upload file",children:a.jsx("button",{"data-testid":"file-explorer-upload-button",...i({}),className:ps({variant:"text",size:"xs"}),children:a.jsx(gs,{size:16})})}),a.jsx("input",{...l({}),type:"file"}),a.jsx(s,{content:"Refresh",children:a.jsx(u,{"data-testid":"file-explorer-refresh-button",onClick:t,variant:"text",size:"xs",children:a.jsx(fr,{size:16})})}),a.jsx(s,{content:"Collapse all folders",children:a.jsx(u,{"data-testid":"file-explorer-collapse-button",onClick:r,variant:"text",size:"xs",children:a.jsx(cl,{size:16})})})]})},OA=({node:e,onOpenMarimoFile:t})=>a.jsxs("span",{className:"flex-1 overflow-hidden text-ellipsis",onClick:t=>{e.data.isDirectory||(t.stopPropagation(),e.select())},children:[e.data.name,e.data.isMarimoFile&&!v()&&a.jsxs("span",{className:"flex-shrink-0 ml-2 text-sm hidden group-hover:inline hover:underline",onClick:t,children:["open ",a.jsx(ts,{className:"inline ml-1",size:12})]})]}),MA=({node:e})=>{const t=S.useRef(null);return S.useEffect((()=>{var n,o;null==(n=t.current)||n.focus(),null==(o=t.current)||o.setSelectionRange(0,e.data.name.lastIndexOf("."))}),[e.data.name]),a.jsx("input",{ref:t,className:"flex-1 bg-transparent border border-border text-muted-foreground",defaultValue:e.data.name,onClick:e=>e.stopPropagation(),onBlur:()=>e.reset(),onKeyDown:t=>{"Escape"===t.key&&e.reset(),"Enter"===t.key&&e.submit(t.currentTarget.value)}})},_A=({node:e,style:t,dragHandle:n})=>{const o=e.data.isDirectory?"directory":Ut(e.data.name),s=Wt[o],{openConfirm:i,openPrompt:l}=r(),c=S.useContext(SA),d=async t=>{DA(t,c?c.relativeFromRoot(e.data.path):e.data.path)},h=async t=>{t.stopPropagation(),t.preventDefault(),i({title:"Delete file",description:`Are you sure you want to delete ${e.data.name}?`,confirmAction:a.jsx(Re,{onClick:async()=>{await e.tree.delete(e.id)},"aria-label":"Confirm",children:"Delete"})})},f=M((async()=>{e.open(),l({title:"Folder name",onConfirm:async t=>{null==c||c.createFolder(t,e.id)}})})),m=M((async()=>{e.open(),l({title:"File name",onConfirm:async t=>{null==c||c.createFile(t,e.id)}})}));return a.jsxs("div",{style:t,ref:n,className:Lt("flex items-center cursor-pointer ml-1 text-muted-foreground whitespace-nowrap group"),draggable:!0,onClick:t=>{t.stopPropagation(),e.data.isDirectory&&e.toggle()},children:[a.jsx(PA,{node:e}),a.jsxs("span",{className:Lt("flex items-center pl-1 py-1 cursor-pointer hover:bg-accent/50 hover:text-accent-foreground rounded-l flex-1 overflow-hidden group",e.willReceiveDrop&&e.data.isDirectory&&"bg-accent/80 hover:bg-accent/80 text-accent-foreground"),children:[e.data.isMarimoFile?a.jsx("img",{src:"/favicon.ico",className:"w-5 h-5 flex-shrink-0 mr-2 filter grayscale",alt:"Marimo"}):a.jsx(s,{className:"w-5 h-5 flex-shrink-0 mr-2",strokeWidth:1.5}),e.isEditing?a.jsx(MA,{node:e}):a.jsx(OA,{node:e,onOpenMarimoFile:d}),a.jsxs(ht,{modal:!1,children:[a.jsx(ft,{asChild:!0,tabIndex:-1,onClick:e=>e.stopPropagation(),children:a.jsx(u,{"data-testid":"file-explorer-more-button",variant:"text",tabIndex:-1,size:"xs",className:"mb-0","aria-label":"More options",children:a.jsx(ul,{strokeWidth:2,className:"w-5 h-5 hidden group-hover:block"})})}),(()=>{const t={size:14,strokeWidth:1.5,className:"mr-2"};return a.jsxs(mt,{align:"end",className:"no-print w-[220px]",onClick:e=>e.stopPropagation(),onCloseAutoFocus:e=>e.preventDefault(),children:[!e.data.isDirectory&&a.jsxs(wt,{onSelect:()=>e.select(),children:[a.jsx(nc,{...t}),"Open file"]}),e.data.isDirectory&&a.jsxs(a.Fragment,{children:[a.jsxs(wt,{onSelect:()=>m(),children:[a.jsx(ml,{...t}),"Create file"]}),a.jsxs(wt,{onSelect:()=>f(),children:[a.jsx(gl,{...t}),"Create folder"]}),a.jsx(vt,{})]}),a.jsxs(wt,{onSelect:()=>e.edit(),children:[a.jsx(Pl,{...t}),"Rename"]}),a.jsxs(wt,{onSelect:()=>{U({title:"Copied to clipboard"}),navigator.clipboard.writeText(e.data.path)},children:[a.jsx(Fe,{...t}),"Copy path"]}),c&&a.jsxs(wt,{onSelect:()=>{U({title:"Copied to clipboard"}),navigator.clipboard.writeText(c.relativeFromRoot(e.data.path))},children:[a.jsx(Fe,{...t}),"Copy relative path"]}),a.jsxs(wt,{onSelect:()=>{U({title:"Copied to clipboard",description:"Code to open the file has been copied to your clipboard. You can also drag and drop this file into the editor"});const{path:t}=e.data,n=xs[o](t);navigator.clipboard.writeText(n)},children:[a.jsx(ys,{...t}),"Copy snippet for reading file"]}),e.data.isMarimoFile&&!v()&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsxs(wt,{onSelect:d,children:[a.jsx(Jl,{...t}),"Open notebook"]})]}),a.jsx(vt,{}),a.jsxs(wt,{onSelect:h,variant:"danger",children:[a.jsx(he,{...t}),"Delete"]})]})})()]})]})]})},PA=({node:e})=>e.data.isDirectory?e.isOpen?a.jsx(ue,{className:"w-5 h-5 flex-shrink-0"}):a.jsx(dr,{className:"w-5 h-5 flex-shrink-0"}):a.jsx("span",{className:"w-5 h-5 flex-shrink-0"});function DA(e,t){e.stopPropagation(),e.preventDefault(),window.open(`/?file=${t}`,"_blank")}const FA=()=>{const{ref:e,height:t=1}=vA(),{getRootProps:n,getInputProps:o,isDragActive:r}=jA({noClick:!0,noKeyboard:!0});return a.jsxs("div",{...n(),className:Lt("flex flex-col flex-1 overflow-hidden relative"),children:[a.jsx("input",{...o()}),r&&a.jsx("div",{className:"absolute inset-0 flex items-center uppercase justify-center text-xl font-bold text-primary/90 bg-accent/85 z-10 border-2 border-dashed border-primary/90 rounded-lg pointer-events-none",children:"Drop files here"}),a.jsx("div",{ref:e,className:"flex flex-col flex-1 overflow-hidden",children:a.jsx(IA,{height:t})})]})},LA=({children:e})=>{const{openModal:t,closeModal:n}=r();return a.jsx(xa,{onClick:()=>t(a.jsx(zA,{onClose:n})),children:e})},RA=[St.lineWrapping],zA=({onClose:e})=>{const[t,n]=S.useState(""),{theme:o}=pe();return a.jsx(i,{className:"w-fit",children:a.jsxs("form",{onSubmit:async t=>{t.preventDefault();const n=new FormData(t.target),o=n.get("title"),r=n.get("description"),a=n.get("code");fetch("https://marimo.io/api/suggest-snippet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:o,description:r,code:a})}),e(),U({title:"Snippet Submitted",description:"Thank you for contributing! We will review your snippet shortly."})},children:[a.jsxs(Q,{children:[a.jsx(l,{children:"Contribute a Snippet"}),a.jsxs(c,{children:["Have a useful snippet you want to share with the community? Submit it here or make a pull request"," ",a.jsx("a",{href:Pe.githubPage,target:"_blank",rel:"noreferrer",className:"underline",children:"on GitHub"}),"."]})]}),a.jsxs("div",{className:"flex flex-col gap-6 py-4",children:[a.jsx(De,{id:"title",name:"title",autoFocus:!0,placeholder:"Title",required:!0,autoComplete:"off"}),a.jsx(ya,{id:"description",name:"description",autoFocus:!0,placeholder:"Description",rows:5,required:!0,autoComplete:"off"}),a.jsx("input",{type:"hidden",name:"code",value:t}),a.jsx(ss,{theme:"dark"===o?"dark":"light",language:"python",className:"cm border rounded overflow-hidden",extensions:RA,value:t,onChange:n})]}),a.jsxs(d,{children:[a.jsx(u,{"data-testid":"snippet-cancel-button",variant:"secondary",onClick:e,children:"Cancel"}),a.jsx(u,{"data-testid":"snippet-send-button","aria-label":"Save",variant:"default",type:"submit",children:"Send"})]})]})})},BA=[St.lineWrapping],UA=()=>{const[e,t]=T.useState(),{data:n,error:o,loading:r}=zt((()=>vs()),[]);return o?a.jsx(es,{error:o}):r||!n?a.jsx(ma,{size:"medium",centered:!0}):a.jsxs("div",{className:"flex-1 overflow-hidden",children:[a.jsxs($t,{className:Lt("border-b rounded-none",e?"h-1/3":"h-full"),children:[a.jsxs("div",{className:"flex items-center w-full",children:[a.jsx(Ce,{placeholder:"Search snippets...",className:"h-6 m-1",rootClassName:"flex-1 border-r"}),a.jsx(LA,{children:a.jsx("button",{className:"float-right border-b px-2 m-0 h-full hover:bg-accent hover:text-accent-foreground",children:a.jsx(Co,{className:"h-4 w-4"})})})]}),a.jsx(Se,{children:"No results"}),a.jsx($A,{onSelect:e=>t(e),snippets:n.snippets})]}),a.jsx(S.Suspense,{children:a.jsx("div",{className:"h-2/3 snippet-viewer flex flex-col",children:e?a.jsx(VA,{snippet:e},e.title):a.jsx(nw,{title:"",description:"Click on a snippet to view its content."})})})]})},VA=({snippet:e})=>{const{theme:t}=pe(),{createNewCell:n}=P(),o=Ic();return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-semibold bg-muted border-y px-2 py-1",children:e.title}),a.jsxs("div",{className:"px-2 py-2 space-y-4 overflow-auto flex-1",children:[a.jsx("div",{className:"flex justify-end",children:a.jsx(xd,{children:a.jsxs(u,{className:"float-right",size:"xs",variant:"outline",onClick:()=>{for(const t of[...e.sections].reverse())t.code&&n({code:t.code,before:!1,cellId:o??"__end__"})},children:["Insert snippet",a.jsx(Xi,{className:"ml-2 h-4 w-4"})]})})}),e.sections.map((r=>{const{code:i,html:l,id:c}=r;return l?a.jsx("div",{children:jr({html:l})},`${e.title}-${c}`):i?a.jsxs("div",{className:"relative hover-actions-parent pr-2",children:[a.jsx(xd,{children:a.jsx(s,{content:"Insert snippet",children:a.jsx(u,{className:"absolute -top-2 -right-1 z-10 hover-action px-2 bg-background",size:"sm",variant:"outline",onClick:()=>{(e=>{n({code:e,before:!1,cellId:o??"__end__"})})(i)},children:a.jsx(Xi,{className:"h-5 w-5"})})})}),a.jsx(ss,{theme:"dark"===t?"dark":"light",language:"python",className:"cm border rounded overflow-hidden",extensions:BA,value:i,readOnly:!0},`${e.title}-${c}`)]},`${e.title}-${c}`):null}))]})]})},$A=({snippets:e,onSelect:t})=>a.jsx(_o,{className:"flex flex-col overflow-auto",children:e.map((e=>a.jsx(Oe,{className:"rounded-none",onSelect:()=>t(e),children:a.jsx("div",{className:"flex flex-row gap-2 items-center",children:a.jsx("span",{className:"mt-1 text-accent-foreground",children:e.title})})},e.title)))}),GA=({value:e,className:t,tooltip:n})=>{const[o,r]=S.useState(!1),i=Le.stopPropagation((()=>{navigator.clipboard.writeText(e).then((()=>{r(!0),setTimeout((()=>r(!1)),2e3)}))})),l=a.jsx("span",{onClick:i,children:o?a.jsx(dt,{className:Lt(t,"text-[var(--grass-11)]")}):a.jsx(Fe,{className:t})});return!1===n?l:a.jsx(s,{content:o?"Copied!":n??"Copy to clipboard",delayDuration:400,children:l})},HA=L((e=>{const t=e(Vr),n=e(V),o=e(ua);return Hi(t,(e=>{if(!e.variable_name)return-1;const t=Object.values(n).find((t=>t.name===e.variable_name));if(!t)return 0;const r=o.inOrderIds.indexOf(t.declaredBy[0]);return-1===r?0:r}))})),WA=()=>{const[e,t]=T.useState(""),n=W(K),o=Ic(),{expandedColumns:r,expandedTables:s,columnsPreviews:i}=bs(),{toggleTable:l,toggleColumn:c,closeAllColumns:d}=ws(),{createNewCell:u}=P(),h=W(HA);if(0===h.length)return a.jsx(nw,{title:"No tables found",description:"Any datasets/dataframes in the global scope will be shown here.",icon:a.jsx(ae,{})});const f=!!e.trim();return a.jsx("div",{className:"flex-1 overflow-hidden",children:a.jsxs($t,{className:Lt("border-b bg-background rounded-none","h-full"),children:[a.jsxs("div",{className:"flex items-center w-full",children:[a.jsx(Ce,{placeholder:"Search tables...",className:"h-6 m-1",value:e,onValueChange:e=>{e.length>0&&d(),t(e)},rootClassName:"flex-1 border-r"}),f&&a.jsx("button",{type:"button",className:"float-right border-b px-2 m-0 h-full hover:bg-accent hover:text-accent-foreground",onClick:()=>t(""),children:a.jsx(Pt,{className:"h-4 w-4"})})]}),a.jsx(qA,{onAddColumnChart:e=>{e.includes("alt")&&function(e,t,n){Ec("altair","alt",(o=>{const r=H.create();t({cellId:n??"__end__",before:!1,code:o,lastCodeRun:e?o:void 0,newCellId:r,autoFocus:!1}),e&&F({cellIds:[r],codes:[o]})}))}(n,u,o),u({code:e,before:!1,cellId:o??"__end__"})},onAddTable:e=>{Cc(n,u,o);let t="";switch(e.source_type){case"local":t=`mo.ui.table(${e.name})`;break;case"duckdb":t=`_df = mo.sql(f"SELECT * FROM ${e.name} LIMIT 100")`;break;default:g(e.source_type)}u({code:t,before:!1,cellId:o??"__end__"})},onExpandColumn:(e,t)=>{const n=`${e.name}:${t.name}`;c({table:e.name,column:t.name}),i.has(n)||ks({source:e.source,tableName:e.name,columnName:t.name,sourceType:e.source_type})},onExpandTable:e=>{l(e.name)},columnPreviews:i,tables:h,isSearching:f,isTableExpanded:e=>!!f||s.has(e.name),isColumnExpanded:(e,t)=>{const n=`${e.name}:${t.name}`;return r.has(n)}})]})})},qA=({tables:e,isSearching:t,columnPreviews:n,onAddColumnChart:o,onAddTable:r,onExpandTable:s,onExpandColumn:i,isTableExpanded:l,isColumnExpanded:c})=>{let d=Object.entries(ke.groupBy(e,(e=>e.source),(e=>e)));d=Hi(d,(([e])=>"memory"===e?0:1));const u=e=>{const d=l(e),u=[a.jsx(YA,{table:e,forceMount:t,onExpand:()=>s(e),onAddTable:()=>r(e),isExpanded:d},e.name)];return d&&u.push(...e.columns.map((t=>a.jsxs(T.Fragment,{children:[a.jsx(JA,{table:e,column:t,onExpandColumn:i,isExpanded:c(e,t)},`${e.name}.${t.name}`),c(e,t)&&a.jsx("div",{className:"pl-10 pr-2 py-2 bg-[var(--slate-1)] shadow-inner border-b",children:a.jsx(Es,{children:a.jsx(XA,{table:e,column:t,onAddColumnChart:o,preview:n.get(`${e.name}:${t.name}`)})})})]},`${e.name}.${t.name}`)))),u};return a.jsx(_o,{className:"flex flex-col overflow-auto",children:0===d.length?null:1===d.length?d[0][1].flatMap(u):d.flatMap((([e,t],n)=>[a.jsx("div",{className:Lt("font-bold px-2 py-1 text-muted-foreground bg-[var(--slate-2)] border-t text-sm",n>0&&"border-t"),children:"memory"===e?"In-Memory":e},e),...t.flatMap(u)]))})},YA=({table:e,onExpand:t,onAddTable:n,isExpanded:o})=>a.jsxs(Oe,{className:"rounded-none py-1 group min-h-9 border-t",value:e.name,"aria-selected":o,forceMount:!0,onSelect:t,children:[a.jsxs("div",{className:"flex gap-1 items-center flex-1",children:[a.jsx(dr,{className:Lt("h-3 w-3 transition-transform",o&&"rotate-90")}),a.jsx("span",{className:"text-sm",children:e.name})]}),(()=>{const t=[];return null!=e.num_rows&&t.push(`${e.num_rows} rows`),null!=e.num_columns&&t.push(`${e.num_columns} columns`),0===t.length?null:a.jsx("div",{className:"flex flex-row gap-2 items-center pl-6 group-hover:hidden",children:a.jsx("span",{className:"text-xs text-muted-foreground",children:t.join(", ")})})})(),a.jsx(s,{content:"Add table to notebook",delayDuration:400,children:a.jsx(u,{className:"group-hover:inline-flex hidden",variant:"text",size:"icon",onClick:Le.stopPropagation((()=>n(e))),children:a.jsx(Kl,{className:"h-3 w-3"})})})]}),JA=({table:e,column:t,onExpandColumn:n})=>{const o=Cs[t.type];return a.jsxs(Oe,{className:"rounded-none py-1 group",value:`${e.name}.${t.name}`,onSelect:()=>n(e,t),children:[a.jsxs("div",{className:"flex flex-row gap-2 items-center pl-6 flex-1",children:[a.jsx(o,{className:"flex-shrink-0 h-3 w-3",strokeWidth:1.5}),a.jsx("span",{children:t.name})]}),a.jsx(s,{content:"Copy column name",delayDuration:400,children:a.jsx(u,{variant:"text",size:"icon",className:"group-hover:opacity-100 opacity-0 hover:bg-muted text-muted-foreground hover:text-foreground",children:a.jsx(GA,{tooltip:!1,value:t.name,className:"h-3 w-3"})})}),a.jsx("span",{className:"text-xs text-muted-foreground",children:t.external_type})]},`${e.name}.${t.name}`)},KA=T.lazy((()=>Ns((()=>import("./index-DUl-dbak.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url).then((e=>({default:e.VegaLite}))))),XA=({table:e,column:t,preview:n,onAddColumnChart:o})=>{const{theme:r}=pe();if("duckdb"===e.source_type)return a.jsxs(u,{variant:"text",className:"z-10",size:"xs",onClick:Le.stopPropagation((()=>{const n=`_df = mo.sql(f"SELECT '${t.name}' FROM ${e.name} LIMIT 100")`;o(n)})),children:[a.jsx(Kl,{className:"h-4 w-4 mr-2"})," Add cell"]});if(!n)return a.jsx("span",{className:"text-xs text-muted-foreground",children:"Loading..."});const i=n.error&&a.jsx("span",{className:"text-xs text-muted-foreground",children:n.error}),l=n.summary&&a.jsx("div",{className:"gap-x-16 gap-y-1 grid grid-cols-2-fit border rounded p-2 empty:hidden",children:Object.entries(n.summary).map((([e,t])=>null==t?null:a.jsxs("div",{className:"flex items-center gap-1 group",children:[a.jsx(GA,{className:"h-3 w-3 invisible group-hover:visible",value:String(t)}),a.jsx("span",{className:"text-xs min-w-[60px] uppercase",children:e}),a.jsx("span",{className:"text-xs font-bold text-muted-foreground tracking-wide",children:js(t)})]},e)))}),c=n.chart_spec&&a.jsx(KA,{spec:(d=JSON.parse(n.chart_spec),{...d,config:{...d.config,background:"transparent"}}),width:"container",height:100,actions:!1,theme:"dark"===r?"dark":"vox"});var d;const h=n.chart_code&&a.jsx(s,{content:"Add chart to notebook",delayDuration:400,children:a.jsx(u,{variant:"outline",size:"icon",className:"z-10 bg-background absolute right-1 top-0",onClick:Le.stopPropagation((()=>o(n.chart_code||""))),children:a.jsx(Kl,{className:"h-3 w-3"})})}),f=n.chart_max_rows_errors&&a.jsx("span",{className:"text-xs text-muted-foreground",children:"Too many rows to render the chart."});return i||l||c||f?a.jsxs("div",{className:"flex flex-col gap-2 relative",children:[i,h,f,c,l]}):a.jsx("span",{className:"text-xs text-muted-foreground",children:"No data"})},ZA=({isOpen:e,children:t})=>{const[n,o]=T.useState(!1);return T.useEffect((()=>{e&&!n&&o(!0)}),[e,n]),n?t:null},QA=()=>{const e=O(),[t]=ge(),{theme:n}=pe(),o=S.useRef(null),r=Ic(),{createNewCell:i,updateCellCode:l}=P(),c=me,d=e.cellRuntime[c],h=null==d?void 0:d.output,f=null==d?void 0:d.status,m=null==d?void 0:d.consoleOutputs,p=e.cellData[c],g=(null==p?void 0:p.code)??"",x=M((()=>{Ss({code:g})})),y=M((()=>{g.trim()&&i({code:g,before:!1,cellId:r??"__end__"})})),v=M((()=>{l({cellId:c,code:"",formattingChange:!1}),Ss({code:""});const e=o.current;e&&e.dispatch({changes:{from:0,to:e.state.doc.length,insert:""}})}));return a.jsxs("div",{className:"flex flex-col h-full overflow-hidden divide-y",id:qe.create(c),children:[a.jsxs("div",{className:"flex items-center flex-shrink-0",children:[a.jsx(s,{content:As("cell.run"),children:a.jsx(u,{"data-testid":"scratchpad-run-button",onClick:x,variant:"text",size:"xs",children:a.jsx(Dl,{color:"var(--grass-11)",size:16})})}),a.jsx(s,{content:"Clear code and outputs",children:a.jsx(u,{size:"xs",variant:"text",onClick:v,children:a.jsx(hl,{size:16})})}),a.jsx(xd,{children:a.jsx(s,{content:"Insert code",children:a.jsx(u,{size:"xs",variant:"text",onClick:y,children:a.jsx(Xi,{size:16})})})}),("running"===f||"queued"===f)&&a.jsx(ma,{className:"inline",size:"small"})]}),a.jsx("div",{className:"overflow-auto flex-shrink-0 max-h-[40%]",children:a.jsx(Dy,{theme:n,allowFocus:!1,showPlaceholder:!1,id:c,code:g,status:"idle",serializedEditorState:null,runCell:x,updateCellCode:l,createNewCell:Rt.NOOP,deleteCell:Rt.NOOP,focusCell:Rt.NOOP,moveCell:Rt.NOOP,moveToNextCell:void 0,updateCellConfig:Rt.NOOP,clearSerializedEditorState:Rt.NOOP,userConfig:t,editorViewRef:o,hidden:!1})}),a.jsx("div",{className:"flex-1 overflow-auto flex-shrink-0",children:a.jsx(wr,{allowExpand:!1,output:h,className:"output-area",cellId:c,stale:!1})}),a.jsx("div",{className:"overflow-auto flex-shrink-0 max-h-[35%]",children:a.jsx(vi,{consoleOutputs:m,className:"overflow-auto",stale:!1,cellName:Ya,onSubmitDebugger:Rt.NOOP,cellId:c,debuggerActive:!1})})]})},eT=()=>a.jsx(QA,{}),tT=T.lazy((()=>Ns((()=>import("./terminal-Du0Oc1Yh.js")),__vite__mapDeps([17,2,3,18]),import.meta.url))),nT=({children:e})=>{const{isSidebarOpen:t,isTerminalOpen:n,selectedPanel:o}=$c(),{setIsSidebarOpen:r,setIsTerminalOpen:s}=Gc(),i=T.useRef(null),l=T.useRef(null);S.useEffect((()=>{if(!i.current)return;const e=i.current.isCollapsed();t&&e&&i.current.expand(),t||e||i.current.collapse(),requestAnimationFrame((()=>{requestAnimationFrame((()=>{window.dispatchEvent(new Event("resize"))}))}))}),[t]),S.useEffect((()=>{if(!l.current)return;const e=l.current.isCollapsed();n&&e&&l.current.expand(),n||e||l.current.collapse(),requestAnimationFrame((()=>{requestAnimationFrame((()=>{window.dispatchEvent(new Event("resize"))}))}))}),[n]);const c=a.jsx(Cv,{id:"app",className:"relative h-full",children:a.jsx(S.Suspense,{children:e})},"app"),d=e=>{e||window.dispatchEvent(new Event("resize"))},h=a.jsx(Pb,{onDragging:d,className:Lt("border-border no-print z-10",t?"resize-handle":"resize-handle-collapsed","vertical")}),f=a.jsx(Pb,{onDragging:d,className:Lt("border-border no-print z-20",n?"resize-handle":"resize-handle-collapsed","horizontal")}),m=a.jsx(Es,{children:a.jsx(S.Suspense,{children:a.jsxs("div",{className:"flex flex-col h-full flex-1 overflow-hidden mr-[-4px]",children:[a.jsxs("div",{className:"p-3 border-b flex justify-between items-center",children:[a.jsx("div",{className:"text-sm text-[var(--slate-11)] uppercase tracking-wide font-semibold flex-1",children:o}),a.jsx(u,{"data-testid":"close-helper-pane",className:"m-0",size:"xs",variant:"text",onClick:()=>r(!1),children:a.jsx(Pt,{className:"w-4 h-4"})})]}),"files"===o&&a.jsx(FA,{}),"errors"===o&&a.jsx(ow,{}),"variables"===o&&a.jsx(hA,{}),"dependencies"===o&&a.jsx(sA,{}),"outline"===o&&a.jsx(rw,{}),"datasources"===o&&a.jsx(WA,{}),"documentation"===o&&a.jsx(xA,{}),"snippets"===o&&a.jsx(UA,{}),"scratchpad"===o&&a.jsx(eT,{}),"logs"===o&&a.jsx(fA,{})]})})}),p=a.jsx(Cv,{ref:i,id:"helper",collapsedSize:0,collapsible:!0,className:Lt("dark:bg-[var(--slate-1)] no-print print:hidden",t&&"border-r border-l border-[var(--slate-7)]"),minSize:10,defaultSize:0,maxSize:75,onResize:(e,t)=>{var n;0===t&&10===e&&(null==(n=i.current)||n.resize(30))},onCollapse:()=>r(!1),onExpand:()=>r(!0),children:a.jsxs("span",{className:"flex flex-row h-full",children:[m," ",h]})},"helper"),g=a.jsxs(Cv,{ref:l,id:"terminal",collapsedSize:0,collapsible:!0,className:Lt("dark:bg-[var(--slate-1)] no-print print:hidden",n&&"border-[var(--slate-7)]"),minSize:10,defaultSize:0,maxSize:75,onResize:(e,t)=>{var n;0===t&&10===e&&(null==(n=l.current)||n.resize(30))},onCollapse:()=>s(!1),onExpand:()=>s(!0),children:[f,a.jsx(ZA,{isOpen:n,children:a.jsx(tT,{visible:n,onClose:()=>s(!1)})})]},"terminal");return a.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden absolute inset-0 print:relative",children:[a.jsxs(Ob,{autoSaveId:"marimo:chrome:v1:l2",direction:"horizontal",storage:{getItem:e=>tw||(tw??null),setItem(e,t){tw=t||null}},children:[a.jsx(Zb,{}),p,a.jsx(Cv,{children:a.jsxs(Ob,{autoSaveId:"marimo:chrome:v1:l1",direction:"vertical",children:[c,a.jsx(Wb,{capability:"terminal",children:g})]})})]}),a.jsx(Es,{children:a.jsx(qb,{})})]})},oT=e=>a.jsxs(nT,{children:[a.jsx(ov,{...e}),a.jsx(_c,{})]});export{oT as default};
